/* (C) 2012 AOL Inc. All Rights Reserved */
dojo._xdResourceLoaded(function(){return{depends:[["provide","dijit._editor.selection"],["provide","ws.address.AddressListHoverCard"],["provide","ws.address.ComposeAddressField"],["provide","ws.address.DistributionListWidget"],["provide","ws.widget.HoverCardManager"],["provide","ws.address.PeoplePanel"],["provide","ws.calendar.AddEventDialog"],["provide","ws.calendar.CalendarSelect"],["provide","ws.pictures.PictureViewControl"],["provide","ws.mail.DisplayMessageWidget"],["provide","ws.layers.DisplayMessage"]],
defineResource:function(c,i,l){c._hasResource["dijit._editor.selection"]||(c._hasResource["dijit._editor.selection"]=!0,c.provide("dijit._editor.selection"),c.getObject("_editor.selection",!0,i),c.mixin(i._editor.selection,{getType:function(){if(c.isIE)return c.doc.selection.type.toLowerCase();else{var a="text",b;try{b=c.global.getSelection()}catch(d){}b&&b.rangeCount==1&&(b=b.getRangeAt(0),b.startContainer==b.endContainer&&b.endOffset-b.startOffset==1&&b.startContainer.nodeType!=3&&(a="control"));
return a}},getSelectedText:function(){if(c.isIE){if(i._editor.selection.getType()=="control")return null;return c.doc.selection.createRange().text}else{var a=c.global.getSelection();if(a)return a.toString()}return""},getSelectedHtml:function(){if(c.isIE){if(i._editor.selection.getType()=="control")return null;return c.doc.selection.createRange().htmlText}else{var a=c.global.getSelection();if(a&&a.rangeCount){var b,d="";for(b=0;b<a.rangeCount;b++){var e=a.getRangeAt(b).cloneContents(),f=c.doc.createElement("div");
f.appendChild(e);d+=f.innerHTML}return d}return null}},getSelectedElement:function(){if(i._editor.selection.getType()=="control")if(c.isIE){var a=c.doc.selection.createRange();if(a&&a.item)return c.doc.selection.createRange().item(0)}else return a=c.global.getSelection(),a.anchorNode.childNodes[a.anchorOffset];return null},getParentElement:function(){if(i._editor.selection.getType()=="control"){var a=this.getSelectedElement();if(a)return a.parentNode}else if(c.isIE)return a=c.doc.selection.createRange(),
a.collapse(!0),a.parentElement();else if(a=c.global.getSelection()){for(a=a.anchorNode;a&&a.nodeType!=1;)a=a.parentNode;return a}return null},hasAncestorElement:function(){return this.getAncestorElement.apply(this,arguments)!=null},getAncestorElement:function(){return this.getParentOfType(this.getSelectedElement()||this.getParentElement(),arguments)},isTag:function(a,b){if(a&&a.tagName)for(var c=a.tagName.toLowerCase(),e=0;e<b.length;e++){var f=String(b[e]).toLowerCase();if(c==f)return f}return""},
getParentOfType:function(a,b){for(;a;){if(this.isTag(a,b).length)return a;a=a.parentNode}return null},collapse:function(a){if(window.getSelection){var b=c.global.getSelection();b.removeAllRanges?a?b.collapseToStart():b.collapseToEnd():b.collapse(a)}else c.isIE&&(b=c.doc.selection.createRange(),b.collapse(a),b.select())},remove:function(){var a=c.doc.selection;c.isIE?a.type.toLowerCase()!="none"&&a.clear():(a=c.global.getSelection(),a.deleteFromDocument());return a},selectElementChildren:function(a,
b){var d=c.global,e=c.doc,a=c.byId(a);if(e.selection&&c.isIE&&c.body().createTextRange){if(e=a.ownerDocument.body.createTextRange(),e.moveToElementText(a),!b)try{e.select()}catch(f){}}else d.getSelection&&(d=c.global.getSelection(),c.isOpera?(e=d.rangeCount?d.getRangeAt(0):e.createRange(),e.setStart(a,0),e.setEnd(a,a.nodeType==3?a.length:a.childNodes.length),d.addRange(e)):d.selectAllChildren(a))},selectElement:function(a,b){var d,e=c.doc,f=c.global,a=c.byId(a);if(c.isIE&&c.body().createTextRange)try{d=
c.body().createControlRange(),d.addElement(a),b||d.select()}catch(g){this.selectElementChildren(a,b)}else c.global.getSelection&&(f=f.getSelection(),d=e.createRange(),f.removeAllRanges&&(c.isOpera&&f.getRangeAt(0)&&(d=f.getRangeAt(0)),d.selectNode(a),f.removeAllRanges(),f.addRange(d)))},inSelection:function(a){if(a){var b,d=c.doc,e;if(c.global.getSelection){var f=c.global.getSelection();f&&f.rangeCount>0&&(e=f.getRangeAt(0));if(e&&e.compareBoundaryPoints&&d.createRange)try{if(b=d.createRange(),b.setStart(a,
0),e.compareBoundaryPoints(e.START_TO_END,b)===1)return!0}catch(g){}}else if(d.selection){e=d.selection.createRange();try{(b=a.ownerDocument.body.createControlRange())&&b.addElement(a)}catch(h){try{b=a.ownerDocument.body.createTextRange(),b.moveToElementText(a)}catch(j){}}if(e&&b&&e.compareEndPoints("EndToStart",b)===1)return!0}}return!1}}));c._hasResource["ws.address.AddressListHoverCard"]||(c._hasResource["ws.address.AddressListHoverCard"]=!0,c.provide("ws.address.AddressListHoverCard"),c.declare("ws.address.AddressListHoverCard",
[i._Widget,i._Templated],{templateString:c.cache("ws.address","AddressListHoverCard.html",'<div class="WSPopup addressListHoverCard">\r\n\t<table>\r\n\t\t<tr>\r\n\t\t\t<td colspan="2" class="header">\r\n\t\t\t<div class="mailLink" dojoAttachEvent="onclick: onClickMail" dojoAttachPoint="mailLink"></div>\r\n\t\t\t<div class="imLink" dojoAttachEvent="onclick: onClickIM" dojoAttachPoint="imLink"></div>\r\n\t\t\t<div class="mobileLink" dojoAttachEvent="onclick: onClickMobile" dojoAttachPoint="mobileLink"></div>\t\t\r\n\t\t\t<div class="videoLink" dojoAttachEvent="onclick: onClickVideo" dojoAttachPoint="videoLink"></div>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td valign="top" class="contentContainer">\r\n\t\t\t\t<div dojoType="ws.widget.BuddyIcon" dojoAttachPoint="buddyIcon"></div>\r\n\t\t\t\t<div class="emptyBuddyIcon" style="display:none" dojoAttachPoint="emptyBuddyIcon"></div>\r\n\t\t\t</td>\r\n\t\t\t<td class="contentContainer">\r\n\t\t\t\t<div class="nameNode" dojoAttachPoint="nameNode"></div>\r\n\t\t\t\t<div dojoAttachPoint="screenNameNode" class="wsLink" dojoAttachEvent="onclick: onClickIM"></div>\r\n\t\t\t\t<div dojoAttachPoint="email1Node" class="wsLink" dojoAttachEvent="onclick: onClickEmail1"></div>\r\n\t\t\t\t<div dojoAttachPoint="email2Node" class="wsLink" dojoAttachEvent="onclick: onClickEmail2"></div>\r\n\t\t\t\t<div dojoAttachPoint="phone1Row" class="phoneNode" >\r\n\t\t\t\t\t<span dojoAttachPoint="phone1TypeNode">${Cellular}</span>: <span dojoAttachPoint="phone1Node"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoAttachPoint="phone2Row" class="phoneNode" >\r\n\t\t\t\t\t<span dojoAttachPoint="phone2TypeNode">${Cellular}</span>: <span dojoAttachPoint="phone2Node"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoAttachPoint="phone3Row" class="phoneNode" >\r\n\t\t\t\t\t<span dojoAttachPoint="phone3TypeNode">${Cellular}</span>: <span dojoAttachPoint="phone3Node"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoAttachPoint="phone4Row" class="phoneNode" >\r\n\t\t\t\t\t<span dojoAttachPoint="phone4TypeNode">${Cellular}</span>: <span dojoAttachPoint="phone4Node"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoAttachPoint="phone5Row" class="phoneNode" >\r\n\t\t\t\t\t<span dojoAttachPoint="phone5TypeNode">${Cellular}</span>: <span dojoAttachPoint="phone5Node"></span>\r\n\t\t\t\t</div>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t</table>\r\n\t<div class="linkContainer">\r\n\t\t<span class="wsLink" style="display:none" dojoAttachEvent="onclick: onClickView" dojoAttachPoint="viewContact">${View}</span>\r\n\t\t<span class="wsLink" dojoAttachEvent="onclick: onClickEdit"  dojoAttachPoint="editContact">${Edit}</span>\r\n\t\t<span class="pipe" dojoAttachPoint="seperator">|</span>\r\n\t\t<span class="wsLink deleteLink" dojoAttachEvent="onclick: onClickDelete" dojoAttachPoint="deleteLink">${Delete}</span>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,manager:null,model:null,contactPhoneTypes:["Undefined","Cellular","Fax","Home","Pager","Work"],startup:function(){if(!Settings.ShowPresenceIcon)this.buddyIcon.hide(),this.emptyBuddyIcon.style.display="";if(!Settings.ShowMobileIcon||!Settings.EnableAIMPanel)this.mobileLink.style.display="none";ws.html.setShowing(this.imLink,Settings.ShowPresenceIcon&&Settings.EnableAIMPanel);ws.html.setShowing(this.videoLink,Config.EnableVideoChat)},populate:function(a){this.contact=
this.model.getRow(a.gridRowIndex);return this.paint()},paint:function(){if(!this.contact)return!1;this.editContact.style.display="";this.deleteLink.style.display="";this.seperator.style.display="";this.viewContact.style.display="none";var a=function(a,b){ws.html.setShowing(a,!!b);ws.html.setInnerText(a,ws.string.summary(b||"",32))};a(this.nameNode,this.contact.name);a(this.screenNameNode,this.contact.screenName);a(this.email1Node,this.contact.email1);a(this.email2Node,this.contact.email2);this.imLink.className=
"imLinkDisabled";this.contact.screenName&&ws.io.rpc({action:"GetPresenceInfo",automatic:!1,content:{email:this.contact.screenName},load:c.hitch(this,function(a){if(ws.presence.ableToGetIM(a.presenceState))this.imLink.className="imLink"})});for(a=1;a<=5;a++){var b=this.contact["phone"+a];ws.html.setShowing(this["phone"+a+"Row"],b);ws.html.setInnerText(this["phone"+a+"TypeNode"],this.localizedPhoneType(this.contact["phone"+a+"Type"]));ws.html.setInnerText(this["phone"+a+"Node"],b)}this.buddyIcon.show(this.contact);
return!0},localizedPhoneType:function(a){switch(a){case this.contactPhoneTypes[5]:return Config.Strings.Work;case this.contactPhoneTypes[4]:return Config.Strings.Pager;case this.contactPhoneTypes[3]:return Config.Strings.Home;case this.contactPhoneTypes[2]:return Config.Strings.Fax;default:return Config.Strings.Cellular}},onClickIM:function(){this.contact.screenName&&ws.presence.launchIM(this.contact.screenName);this.manager.close()},onClickMobile:function(){ws.presence.launchIM(this.contact.screenName?
this.contact.screenName:"",!1,!0);this.manager.close()},onClickVideo:function(){this.manager.close()},onClickView:function(){this.contact.bType=="d"&&ws.WebSuite.editDistributionList(this.contact.uid);this.manager.close()},onClickEdit:function(){this.contact.bType=="c"?this.model.getContact({uid:this.contact.uid,load:c.hitch(this,function(a){ws.WebSuite.editContact(this.contact.uid,a,!0)}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.getContact-onClickEdit file:AddressListHoverCard.js");
ws.widget.Dialogs.ok(a||Config.Strings.ErrorLoadingContact)}}):this.contact.bType=="d"?ws.WebSuite.editDistributionList(this.contact.uid):this.contact.bType=="s"&&ws.WebSuite.sharedGroup(this.contact.name);this.manager.close()},onClickMail:function(){var a=this.contact.screenName||this.contact.email1||this.contact.email2||this.contact.composeValue;Config.ValidateEmailFormat&&(a=this.contact.email1||this.contact.email2||this.contact.composeValue||this.contact.screenName);this.startCompose(a)},onClickEmail1:function(){this.startCompose(this.contact.email1)},
onClickEmail2:function(){this.startCompose(this.contact.email2)},startCompose:function(a){a&&ws.WebSuite.getCompose(null,function(b){b.reset({to:a,backToString:"setFolder"})});this.manager.close()},onClickDelete:function(){this.contact.bType=="c"?this.model.getContact({uid:this.contact.uid,load:c.hitch(this,function(a){this.model.setUndoItem(a);this._deleteAddresses([this.contact.uid],!0)}),error:c.hitch(this,function(){this._confirmationDelete()})}):this.contact.bType=="d"?this.model.getDistributionList({uid:this.contact.uid,
load:c.hitch(this,function(a){this.model.setUndoItem(a);this._deleteAddresses([this.contact.uid],!0)}),error:c.hitch(this,function(){this._confirmationDelete()})}):this.contact.bType=="s"&&this._confirmationDelete();this.manager.close()},_confirmationDelete:function(){ws.widget.Dialogs.okCancel(Config.Strings.DeleteContactsConfirmationSingular,c.hitch(this,function(a){a&&this._deleteAddresses([this.contact.uid])}))},_deleteAddresses:function(a,b){this.model.deleteAddresses({uids:a,load:c.hitch(this,
function(){var a=b?c.hitch(this.model,"undoDeletedItem"):null;c.publish("WSFeedbackStart",[Config.Strings.ContactDeletedSingular,!0,a,c.hitch(this,function(){this.model.setUndoItem()})])}),error:c.hitch(this,function(a){this.model.setUndoItem();window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteAddresses-_deleteAddresses file:AddressListHoverCard.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorDeletingContactNotFound)})})}}));c._hasResource["ws.address.ComposeAddressField"]||
(c._hasResource["ws.address.ComposeAddressField"]=!0,c.provide("ws.address.ComposeAddressField"),c.declare("ws.address.ComposeAddressField",ws.address.AddressField,{templateString:"<div class='caf wsInput'><div class='addressLabel' dojoAttachPoint='contactSelector2' style='line-height:${lineHeight}px;'>${ghostText}:</div><div dojoAttachPoint='contactSelector' class='contactSelector'><div class='csIcon mainSprite' style='line-height:${lineHeight}px;'></div></div><div dojoAttachPoint='scrollContainer' style='overflow:hidden;'><textarea dojoAttachPoint='field' dojoAttachEvent='onkeydown: onKeyDown, onkeypress: onKeyPress, onfocus: onFocus, onblur: onBlur' tabindex='${tabindex}' class='${className}' style='overflow:hidden;height: ${baseSize}px; width: 100%'>${value}</textarea></div></div>",
css:{templateString:""},ghostText:"",ghostTextPersistent:!0,maxHeight:0,minHeight:0,numOfLines:0,startingNumOfLines:0,padding:7,baseSize:12,lineHeight:0,width:0,postMixInProperties:function(){if(this.startingNumOfLines>this.numOfLines)this.startingNumOfLines=this.numOfLines;this.lineHeight=this.lineHeight!=0?this.lineHeight:this.baseSize;this.maxHeight=this.numOfLines!=0?this.numOfLines*this.lineHeight:this.lineHeight*4;this.minHeight=this.lineHeight*(this.startingNumOfLines?this.startingNumOfLines:
1)},postCreate:function(){this.inherited(arguments);c.addClass(this.field,"wsInputBare");if(!this.ghostText)this.contactSelector2.style.display="none";if(this.width!=0)this.domNode.style.width=this.width+"px";this.connect(this.contactSelector,"onclick",this.showPeoplePicker);this.ghostText&&!this.ghostTextPersistent?this.connect(this.contactSelector2,"onmousedown",this.showPeoplePicker):this.connect(this.contactSelector2,"onclick",this.showPeoplePicker);this.anchorNode=this.domNode;this.connect(this,
"onClick","handleClick")},onKeyPress:function(a){a.ctrlKey&&window.setTimeout(c.hitch(this,"resizeSelf",!0),100);this.inherited(arguments)},showPeoplePicker:function(a){c.stopEvent(a);this.togglePeoplePicker(this.domNode)},handleClick:function(a){a.target&&(!c.hasClass(a.target,"addressField")&&!c.hasClass(a.target,"csIcon")&&this.field.focus(),(c.hasClass(a.target,"csIcon")||c.hasClass(a.target,"addressLabel"))&&a.preventDefault())},reset:function(){this.setValue("");this.ghostText?c.query(".addressLabel",
this.domNode)[0].style.display="":c.query(".addressLabel",this.domNode)[0].style.display="none"},createMeasureNode:function(){if(!this.measureNode)this.measureNode=c.create("div",{style:{position:"absolute",visibility:"hidden",top:"-10000px",left:"10000px",fontSize:this.baseSize+"px",lineHeight:this.lineHeight+"px"}},c.body()),this.field.style.fontSize=this.baseSize+"px",this.field.style.lineHeight=this.lineHeight+"px"},resizeSelf:function(a){this.createMeasureNode();var b=c.coords(this.field).w;
this.measureNode.innerHTML=this.field.value.replace(/\n/g,"<br>");this.measureNode.style.width=parseInt(b)+"px";var b=c.contentBox(this.measureNode),b=Math.max(this.minHeight,b.h),d=Math.min(this.maxHeight,b);this.field.style.height=b+"px";if(a)this.domNode.style.height=d+this.padding+"px",this.repositionPicker();d==this.maxHeight?b>d?this.domNode.style.overflowY="auto":(this.domNode.style.height=d+this.padding-4+"px",this.repositionPicker()):(this.domNode.style.overflowY="hidden",this.domNode.style.height=
d+"px",this.repositionPicker())},onFocus:function(){if(this.ghostText&&!this.ghostTextPersistent)c.query(".addressLabel",this.domNode)[0].style.display="none";this.inherited(arguments)},onBlur:function(){ws.lang.setTimeout(this,function(){if(this.ghostText&&!this.ghostTextPersistent&&this.getValue()=="")c.query(".addressLabel",this.domNode)[0].style.display=""},50);this.inherited(arguments)},repositionPicker:function(){this._pickerActive&&this.peoplePicker.move(this.domNode,{offsetHeight:-1});this.onResizedSelf()},
scrollToEnd:function(){this.domNode.scrollTop=1E4;this.scrollContainer.scrollTop=1E4;this.field.scrollTop=1E4}}));c._hasResource["ws.address.DistributionListWidget"]||(c._hasResource["ws.address.DistributionListWidget"]=!0,c.provide("ws.address.DistributionListWidget"),c.declare("ws.address.DistributionListGridModel",l.grid.data.Dynamic,{columns:{Icon:0,Name:1,Hover:2,Email:3},modelUpdated:function(){},listInfo:null,constructor:function(a,b,c){this.model=c},setListInfo:function(a){this.listInfo=a;
this.modelUpdated()},getDatum:function(a,b){var c;c=this.listInfo.sortedContactsAndAddresses[a];switch(b){case this.columns.Icon:return this.getBuddyIcon(c);case this.columns.Name:return typeof c=="object"?(sortBy="LastFirstEmailScreenNamePhone",sortBy=Settings.AddressNameDisplayFormat=="LastFirstNick"?"LastFirstEmailScreenNamePhone":"FirstLastEmailScreenNamePhone",ws.address.AddressBookUtil.getNameInfoHTML(c,sortBy)):ws.string.substituteParams("{0}",this.listInfo.sortedContactsAndAddresses[a]);case this.columns.Hover:return this.getHoverColumnCB?
this.getHoverColumnCB(a):"";case this.columns.Email:if(typeof c=="object"){var e="",e=email1=c.email1?c.email1:"",f=c.email2?c.email2+", ":"";f!=""&&(email1!=""&&(e+=", "),e+=f);c=c.screenName?c.screenName:"";if(c!=""){if(e!=""||e!="")e+=", ";e+=c}return e}else return ws.string.substituteParams("({0})",this.listInfo.sortedContactsAndAddresses[a])}},getRowCount:function(){return this.listInfo?this.listInfo.contacts.length+this.listInfo.addresses.length:0},getBuddyIcon:function(a){var b=Config.SpacerImageURL;
a&&Settings.ShowPresenceIcon&&(b=ws.presence.getBuddyIconUrl(a,!0)||Config.SpacerImageURL);return b==Config.SpacerImageURL?ws.string.substituteParams('<img style="width: 32px; height: 32px;" align=\'absmiddle\' src="{0}" class="mainLargeIcon hoverRefNode noBuddyIcon buddyShadow showIcon">',b):ws.string.substituteParams('<div style="width: 32px; height: 32px;"><img style="visibility: hidden; width: 32px; height: 32px; border: 1px solid #85817c" onerror="window.fixMissingAvatar(this);" onload="this.style.visibility = \'\';" class="hoverRefNode buddyIcon buddyShadow showIcon" align=\'absmiddle\' src="{0}"></div>',
b)}}),c.declare("ws.address.DistributionListWidget",ws.widget.ListView,{templateString:c.cache("ws.address","DistributionListWidget.html",'<div dojoAttachEvent="onkeydown: onKeyPressInputField">\r\n\t<div dojoType="dijit.layout.StackContainer" class="listView distributionList" dojoAttachPoint="stackWidget">\r\n\t\t<div dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="createPane" class="createPane">\r\n\t\t\t<div dojoType="ws.widget.WSToolbar" dojoAttachPoint="toolbar" layoutAlign="top" vizType="Controls">\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:cancel" title="${Cancel}" iconClassName="cancelIcon" toolbarPosition="right"></div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" layoutAlign="client" class="newList">\r\n                <div>\r\n                    <div class="headerDiv">${NewList}</div>\r\n\r\n                    <div>\r\n                        <div defaultValue="${ListName}" dojoType="ws.widget.DefaultTextbox" className="wsInput nameInput" dojoAttachPoint="createNameField" maxlength="255" tabindex="1"></div>\r\n                    </div>\r\n\r\n                    <div dojoType="ws.address.ComposeAddressField" ghostText="${AddContacts}" lineHeight="14" ghostTextPersistent="false" startingNumOfLines="4" numOfLines="4" class="selector" width="445" dojoAttachPoint="createAddressField"></div>\r\n\r\n                    <div class="buttonGroup">\r\n                        <div dojoType="ws.widget.Button" dojoAttachPoint="addListButton" dojoAttachEvent="onClick: checkRequiredFields">${AddList}</div>\r\n                        <div dojoType="ws.widget.Button" dojoAttachPoint="cancelListButton" dojoAttachEvent="onClick: cancel" type="Bare">${Cancel}</div>\r\n                    </div>\r\n                </div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t\r\n\t\t<div dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="editPane" class="editPane">\r\n\t\t\t<div dojoType="ws.widget.WSToolbar" dojoAttachPoint="toolbar" layoutAlign="top" vizType="Controls">\r\n                <div dojoType="ws.widget.Button" dojoAttachEvent="onClick:emailList" title="${EmailListTip}" iconClassName="composeIcon">${EmailList}</div>\r\n                <div dojoType="ws.widget.Button" dojoAttachPoint="deleteListButton" dojoAttachEvent="onClick:deleteList" title="${DeleteList}" iconClassName="delIcon">${DeleteListTip}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:cancel" title="${Close}" iconClassName="cancelIcon" toolbarPosition="right"></div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" layoutAlign="top" style="border-bottom: 1px solid #DEDEDE; padding-bottom:12px;" class="editList">\r\n                <div>\r\n                    <div class="displayName" dojoAttachPoint="displayNameDiv">\r\n                        <span dojoAttachPoint="nameSpan" class="nameSpan"></span>\r\n                        <a href="#" dojoAttachPoint="editNameSpan" dojoAttachEvent="onclick:editName">${EditName}</a>\r\n                        <a href="#" dojoAttachEvent="onclick:deleteList" dojoAttachPoint="deleteListAnchor">${DeleteList}</a>\r\n                    </div>\r\n                    <div class="editName" dojoAttachPoint="editNameDiv" style="display:none">\r\n                        <input type="text" class="wsInput" dojoAttachPoint="editNameField" />\r\n                        <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: saveName">${Save}</div>\r\n                        <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: cancelName">${Cancel}</div>\r\n                        <br style="clear: both" />\r\n                    </div>\r\n\r\n                    <div class="addContactDiv" dojoAttachPoint="addContactDiv">\r\n                        <div dojoType="ws.address.ComposeAddressField" ghostText="${AddContacts}" ghostTextPersistent="false" startingNumOfLines="4" numOfLines="4" class="selector" width="445" dojoAttachPoint="editAddressField"></div>\r\n                        <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: addMembers">${Add}</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n           \r\n\t\t\t<div dojoType="ws.widget.Pane" layoutAlign="client" class="content">\r\n\t\t\t\t<div dojoType="dojox.Grid" dojoAttachPoint="grid"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,addressModel:null,listInfo:null,closeCB:null,backToString:Config.Strings.BackToDistList,speedUp:!0,showHeader:!1,hoverColumnHtml:'<div class="wsHotClearButton mainSprite"></div>',autosizeColumnId:"Email",startup:function(){this.inherited(arguments);if(screen.height<=768&&screen.width<=1024)this.createAddressField.minHeight=45,this.createAddressField.maxHeight=90;c.connect(this.editAddressField,"onResizedSelf",this,"onResized");this.setModel(new ws.address.DistributionListGridModel(null,
null,this.addressModel));c.subscribe("Suite/onKeyOnPress",this,"_suiteOnKeyPress");this.addListButton.setTitle(ws.string.substituteParams(Config.Strings.CreateListTip,"("+(c.isMac?Config.Strings.CtrlReturnKey:Config.Strings.CtrlEnterKey)+")"));this.cancelListButton.setTitle(ws.string.substituteParams(Config.Strings.CancelTip,"("+(c.isMac?Config.Strings.OptKey:Config.Strings.AltKey)+" "+Config.Strings.KeyCancelAddContact+")"));ws.WebSuite.SidePanel.setupAdScroll(this.domNode)},_suiteOnKeyPress:function(a){this.isShowing()&&
(a=ws.html.fixKeyForMac(a),a.keyChar&&c.isString(a.keyChar)&&a.keyChar.toLowerCase()==Config.Strings.KeyCancelAddContact&&a.altKey&&this.cancel())},onKeyPressInputField:function(a){if(a.keyCode>=65&&a.keyCode<=90)a.keyChar=String.fromCharCode(a.keyCode);this._suiteOnKeyPress(a)},initView:function(){this.columns=[{id:"Icon",width:"35px"},{id:"Name",width:"200px"},{id:"Hover",width:"18px"},{id:"Email",width:"200px"}];this.inherited(arguments)},showCreateView:function(){this.stackWidget.selectChild(this.createPane);
this.createNameField.setValue("");this.createNameField.focus();this.createAddressField.reset();this.resetDirty();this.reportNewDistList()},reportNewDistList:function(){ws.reporting.report("New DistList","Addresses")},showList:function(a){this.stackWidget.selectChild(this.editPane);this.addressModel.getDistributionList({uid:a,load:c.hitch(this,function(a){this.listDataReceived(a);c.publish("WSFeedbackEnd",[Config.Strings.Loading])}),error:function(a){ws.widget.Dialogs.ok(a||Config.Strings.ErrorLoadingDistList);
c.publish("WSFeedbackEnd",[Config.Strings.Loading])}});ws.reporting.report("Edit DistList","Addresses")},listDataReceived:function(a){if(this.goToListDetails)this.stackWidget.selectChild(this.editPane),this.goToListDetails=!1;this.listInfo=a;this.nameSpan.innerHTML=ws.string.escapeXml(a.name);this.displayNameDiv.style.display="";this.editNameDiv.style.display="none";this.editAddressField.setValue("");this.gridModel.setListInfo(a);this.deleteListButton.show();this.hoverColumnHtml='<div class="mainSprite wsHotClearButton"></div>';
this.editNameSpan.innerHTML=Config.Strings.EditName;this.addContactDiv.style.display="";this.resetDirty();this.onResized()},checkRequiredFields:function(){var a="",b=c.trim(this.createNameField.getValue()),d=c.map(this.createAddressField.getValue().split(/[;,]/),c.trim);if(b)if(this.addressModel.searchDLName(b)!=null)a=Config.Strings.DuplicateDistributionList;else{if(d.length==1&&!d[0])a=Config.Strings.IncludeEmailDistList}else a=Config.Strings.NameDistList;a?this.declaredClass=="ws.address.PeoplePanelAddListCard"?
(this.close(),ws.widget.Dialogs.ok(a,c.hitch(this,"open",this.cachedArgs))):ws.widget.Dialogs.ok(a):this.createList(b)},createList:function(a){var b=ws.address.AddressBookUtil._mapAddressesToContacts(this.createAddressField,this.addressModel);this.listInfo={uid:0,name:a,contacts:b.contacts,addresses:b.addresses};this.goToListDetails=!0;this.saveList(!0,Config.Strings.DistributionListCreated,null,function(){ws.reporting.report("Edit DistList","Addresses")})},addMembers:function(){this._addMembers(ws.address.AddressBookUtil._mapAddressesToContacts(this.editAddressField,
this.addressModel))},_addMembers:function(a,b){if(a.contacts.length||a.addresses[0]){this.listInfo.contacts=this.listInfo.contacts.concat(a.contacts);this.listInfo.addresses=this.listInfo.addresses.concat(a.addresses);var c=a.contacts.length+a.addresses.length,c=c==1?Config.Strings.DistListContactAddedSingular:ws.string.substituteParams(Config.Strings.DistListContactAddedPlural,c);this.saveList(!0,b||c,null,null)}},handleHoverControlClick:function(a){if(a.target&&(c.hasClass(a.target,"wsHotClearButton")||
a.target.firstChild&&c.hasClass(a.target.firstChild,"wsHotClearButton"))){var a=a.rowIndex,b,d=null,e;e=this.listInfo.sortedContactsAndAddresses[a];if(typeof e=="object"){var f;f=this.getIndexOfContact(e);f!=null?b=this.listInfo.contacts.splice(f,1):(f=this.getIndexOfAddress(e),b=this.listInfo.addresses.splice(f,1));this.listInfo.sortedContactsAndAddresses.splice(a,1)}else for(f=0;f<this.listInfo.addresses.length;f++)if(e==this.listInfo.addresses[f]){b=this.listInfo.addresses.splice(f,1);this.listInfo.sortedContactsAndAddresses.splice(a,
1);break}this.gridModel.modelUpdated();if(Config.EnableUndo)var g=typeof b[0]=="object"?{addresses:[],contacts:b}:{addresses:b,contacts:[]},d=c.hitch(this,function(){this._addMembers(g,Config.Strings.DistListContactRestored)});this.saveList(!0,Config.Strings.DistListContactRemoved,d,null)}},getIndexOfContact:function(a){if(!a)return null;for(var b=0;b<this.listInfo.contacts.length;b++)if(a.uid==this.listInfo.contacts[b].uid)return b},getIndexOfAddress:function(a){if(!a)return null;for(var b=0;b<this.listInfo.addresses.length;b++)if((email=
a.email1?a.email1:a.email2)&&email==this.listInfo.addresses[b])return b},editName:function(){this.editNameField.value=this.listInfo.name;this.displayNameDiv.style.display="none";this.editNameDiv.style.display="";ws.html.selectInputText(this.editNameField);this.editPane.resize()},saveName:function(){this.editNameField.value?this.addressModel.searchDLName(this.editNameField.value)!=null?ws.widget.Dialogs.ok(Config.Strings.DuplicateDistributionList):(this.listInfo.name=this.editNameField.value,ws.html.setInnerText(this.nameSpan,
this.editNameField.value),this.saveList(!1,Config.Strings.DistributionListUpdated,null,null),this.cancelName()):ws.widget.Dialogs.ok(Config.Strings.NameDistList)},cancelName:function(){this.editNameDiv.style.display="none";this.displayNameDiv.style.display="";this.editPane.resize()},saveList:function(a,b,d,e){this.addressModel.createOrModifyDistributionList({uid:this.listInfo.uid,name:this.listInfo.name,contactUids:c.map(this.listInfo.contacts,function(a){return a.uid}),addresses:this.listInfo.addresses,
load:c.hitch(this,function(f){b&&c.publish("WSFeedbackStart",[b,!0,d]);a&&this.listDataReceived(f);e&&e()}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for addressModel.createOrModifyDistributionList-saveList file:DistributionListWidget.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorSavingDistList)}})},deleteList:function(){Config.EnableUndo?(this.addressModel.setUndoItem(this.listInfo),this._deleteList(!0)):this._confirmationDelete()},
_confirmationDelete:function(){ws.widget.Dialogs.okCancel(Config.Strings.DeleteDistributionList,c.hitch(this,function(a){a&&this._deleteList()}))},_deleteList:function(a){this.addressModel.deleteAddresses({uids:[this.listInfo.uid],load:c.hitch(this,function(){var b=a?c.hitch(this.addressModel,"undoDeletedItem"):null;c.publish("WSFeedbackStart",[Config.Strings.DistributionListDeletedSingular,!0,b,a?c.hitch(this,function(){this.addressModel.setUndoItem()}):null]);this.cancel()}),error:c.hitch(this,
function(a){this.addressModel.setUndoItem();window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for addressModel.deleteAddresses-_deleteList file:DistributionListWidget.js");ws.widget.OkCancelDialog.alert(a||Config.Strings.ErrorDeletingDistListNotFound)})})},showCreatePeoplePicker:function(a){this.createAddressField.togglePeoplePicker(this.createAddressField);a.preventDefault()},emailList:function(){this.composeEmailCB(c.hitch(this,function(a){a.reset({to:this.listInfo.composeValue,
backToString:this.backToString,isDirty:!0})}))},composeEmailCB:function(){},isDirty:function(){return this.getCurrentStateHash()!=this.initialStateHash},resetDirty:function(){this.initialStateHash=this.getCurrentStateHash()},getCurrentStateHash:function(){var a="";a+=this.createNameField.getValue();a+=this.createAddressField.getValue();a+=this.editAddressField.getValue();return a},cancel:function(){ws.reporting.skipBeaconReporting=!0;this.close(this.isDirty())},close:function(a){this.closeCB&&this.closeCB(a)}}));
c._hasResource["ws.widget.HoverCardManager"]||(c._hasResource["ws.widget.HoverCardManager"]=!0,c.provide("ws.widget.HoverCardManager"),c.declare("ws.widget.HoverCardManager",null,{openDelay:400,closeDelay:400,orient:{TL:"TR"},hoverPointerSide:"right",hoverNodeClass:null,targetNodeClass:null,constructor:function(a,b,d,e,f){this.topNode=a;this.cardCtor=b;this.rowClass=d;e.manager=this;this.cardParams=e;this.shouldOpenFunction=f;this.mouseMoveHandles=[];this.padding=[ws.widget.pointerWidth,-27];c.connect(this.topNode,
"onmouseover",this,"onMouseOverGrid")},setHoverRefNode:function(a,b,c){if(b)this.orient=b;if(c)this.hoverPointerSide=c;if(a)this.hoverNodeClass=a},setTargetNodeClass:function(a){this.targetNodeClass=a},onMouseOverGrid:function(a){if(a){for(var b=a.target;b!=null&&!c.hasClass(b,this.rowClass);)b=b.parentNode;this.card&&this.card.isShowing()?b&&(!this.targetNodeClass||c.hasClass(a.target,this.targetNodeClass))?this.openSoon(b):this.closeSoon():b&&(!this.targetNodeClass||c.hasClass(a.target,this.targetNodeClass))?
this.openSoon(b):this.cancelOpen();this.mouseMoveHandles.length||c.forEach(ws.widget.popup.windows,function(a){try{a.document&&this.mouseMoveHandles.push(c.connect(a.document.documentElement,"onmousemove",this,"onMouseMove"))}catch(b){}},this)}},onMouseMove:function(a){var b=a.target.ownerDocument==document;this.overCard=b&&this.card&&ws.html.overElement(this.card.domNode,a);this.overTopNode=b&&(c.isIE?c.getComputedStyle(this.topNode):!0)&&ws.html.overElement(this.topNode,a);this.overPointerNode=
b&&this.pointerNode&&ws.html.overElement(this.pointerNode,a);this.overCard||this.overPointerNode?this.cancelTimeouts():this.overTopNode||this.closeSoon()},openSoon:function(a){this.cancelTimeouts();this.openTimer=setTimeout(c.hitch(this,"open",a),this.openDelay)},closeSoon:function(){if(!this.closeTimer)this.cancelTimeouts(),this.closeTimer=setTimeout(c.hitch(this,"close"),this.closeDelay)},cancelTimeouts:function(){this.cancelOpen();this.cancelClose()},cancelOpen:function(){this.openTimer&&clearTimeout(this.openTimer);
this.openTimer=null},cancelClose:function(){this.closeTimer&&clearTimeout(this.closeTimer);this.closeTimer=null},open:function(a){this.card&&this.card.isShowing()&&this.close();if(!ws.widget.popup.isAnyPopupOpen()&&a.offsetHeight&&(this.shouldOpenFunction?this.shouldOpenFunction(a):1)){if(!this.card)this.card=new this.cardCtor(this.cardParams),this.card.startup();this.hoverNode=a;if(this.card.populate(this.hoverNode)){var b=a;this.hoverNodeClass&&(a=c.query("."+this.hoverNodeClass,a))&&(b=a[0]);ws.widget.popup({popup:this.card,
around:b,orient:this.orient,padding:this.padding});this.pointerNode=ws.widget.pointer({node:this.card.domNode,side:this.hoverPointerSide,target:b});c.publish("popup/open",[])}}},close:function(){if(!this.overCard&&!this.overTopNode&&!this.overPointerNode)c.forEach(this.mouseMoveHandles,function(a){try{c.disconnect(a)}catch(b){}}),this.mouseMoveHandles=[];this.card&&ws.widget.popup.close(this.card)}}));c._hasResource["ws.address.PeoplePanel"]||(c._hasResource["ws.address.PeoplePanel"]=!0,c.provide("ws.address.PeoplePanel"),
c.declare("ws.address.PeoplePanelGridModel",l.grid.data.Dynamic,{columns:{Name:0},constructor:function(a,b,d){this.model=d;c.connect(this.model,"modelUpdated",this,"modelUpdated")},modelUpdated:function(){},getDatum:function(a,b){var c=this.model.getRow(a);if(c==null)return Config.Strings.ContactError;switch(b){case this.columns.Name:return"<span style='white-space: nowrap;'>"+ws.string.escapeXml(c.name||c.email1||c.email2||c.screenName||"")+"</span>"}},getRowCount:function(){return this.model.getRowCount()}}),
c.declare("ws.address.PeoplePanel",ws.widget.ListView,{templateString:c.cache("ws.address","PeoplePanel.html",'<div style="overflow: hidden;">\r\n\t<div class="peoplePanel listView" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget">\r\n\t\t<div dojoType="ws.widget.Pane" layoutAlign="top">\r\n\t\t\t<div class="searchInputDiv">\r\n\t\t\t\t<span><input type="text" class="wsInput searchInput" dojoAttachPoint="searchInput" dojoAttachEvent="onkeyup: search, onclick: onFocusSearch, onblur: onBlurSearch"></span>\r\n\t\t\t\t<img src="${spacer}" dojoAttachPoint="clearSearchButton" class="clearSearchImg" dojoAttachEvent="onclick:clearSearch" style="display: none;">\r\n\t\t\t</div>\r\n\t\t\t<ul class="addLinks">\r\n\t\t\t\t<li><img src="${spacer}"></li>\r\n\t\t\t\t<li dojoAttachEvent="onclick: openAddContactCard" dojoAttachPoint="addContactLink">\r\n\t\t\t\t\t<span class="wsLink">${AddContact}</span>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li>|</li>\r\n\t\t\t\t<li dojoAttachEvent="onclick: openAddListCard" dojoAttachPoint="addListLink">\r\n\t\t\t\t\t<span class="wsLink">${AddList}</span>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t\t<div dojoType="ws.widget.Pane" layoutAlign="client">\r\n\t\t\t<div dojoType="dojox.Grid" dojoAttachPoint="grid" layoutAlign="client"></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},wrapperModelClass:ws.address.PeoplePanelGridModel,showHeader:!1,speedUp:!0,searchDefaultValue:Config.Strings.FindContacts,autosizeColumnId:"Name",startup:function(){this.setModel(new ws.address.AddressModel({sortable:!0,fullTextSearchable:!0,fetchDataOnInit:!0}));this.model.core.sortData(Settings.AddressNameSortOrder?Settings.AddressNameSortOrder:Config.DefaultAddressNameSortOrder,"Ascending");this.searchInput.value=this.searchDefaultValue;(new ws.widget.HoverCardManager(this.grid.domNode,
ws.address.AddressListHoverCard,"dojoxGrid-row",{model:this.model})).padding=[ws.widget.pointerWidth+7,-40];this.clearSearchButton.style.display="none";c.addClass(this.searchInput,"nickNameInputNew")},initView:function(){this.columns=[{id:"Name",name:Config.Strings.Name,width:"75px"}];this.inherited(arguments);c.connect(this.grid,"onRowContextMenu",this,"onContextMenu")},getRowClasses:function(a){var b=this.inherited(arguments);Config.TopContactsEnabled&&Settings.EnableTopContacts&&this.model.isTopContact(a)&&
b.push("row-top-contact");return b},openAddContactCard:function(){this.addContactCard?this.addContactCard.reset():(this.addContactCard=new ws.address.PeoplePanelAddContactCard({addressModel:this.model}),this.addContactCard.startup());this.addContactCard.open({around:this.addContactLink,orient:{TR:"TR"}})},openAddListCard:function(){this.addListCard?this.addListCard.reset():(this.addListCard=new ws.address.PeoplePanelAddListCard({addressModel:this.model}),this.addListCard.startup());this.addListCard.open({around:this.addListLink,
orient:{TR:"TR"}})},handleCellClick:function(a){if(!ws.WebSuite.isComposeInTransition()){var a=this.model.getRow(a.rowIndex),b=ws.WebSuite.isComposeOpen();if(a.screenName||a.email1||a.email2||a.composeValue){var c=a.email1||a.email2||a.composeValue||a.screenName;Config.ValidateEmailFormat&&(c=a.email1||a.email2||a.composeValue||a.screenName);ws.lang.setTimeout(this,function(){b?ws.WebSuite.reuseComposeWindow(c):ws.WebSuite.getCompose(null,function(a){a.reset({to:c,backToString:"setFolder",isDirty:!0})})},
0)}}},onResized:function(){this.inherited(arguments)},positionClearSearch:function(a){ws.html.setShowing(this.clearSearchButton,a)},onFocusSearch:function(){if(c.hasClass(this.searchInput,"nickNameInputNew"))this.searchInput.value="",c.removeClass(this.searchInput,"nickNameInputNew")},onBlurSearch:function(){if(this.searchInput.value=="")this.searchInput.value=Config.Strings.FindContacts,c.addClass(this.searchInput,"nickNameInputNew")},clearSearch:function(){this.searchInput.value="";this.search()},
search:function(){this.searchTimer&&clearTimeout(this.searchTimer);this.searchTimer=null;this._toggleClearButton();this.searchTimer=setTimeout(c.hitch(this,function(){this.model.search(this.searchInput.value)}),c.isIE==6?900:300)},_toggleClearButton:function(){this.positionClearSearch(!!this.searchInput.value)},getZeroRowsMessage:function(){var a="<div class='search'>"+Config.Strings.NoMatchesFound+"</div>";a+="<div class='z1'>";a+=ws.string.substituteParams('<div class="transferHeader">{0}</div><div class="mainLargeIcon"></div><div class="desc"><span class="tip">{1}</span><span>{2}</span><a href="{3}" class="transferLink" target="_blank">{4}</a><span>{5}</span></div><div class="btnRow"></div>',
Config.Strings.EasyTransferNoContacts,Config.Strings.TipWithColon,Config.Strings.EasyTransferText1,Config.EasyTransferUrl,Config.Strings.EasyTransfer,Config.Strings.EasyTransferText2);a+="</div><div class='z2'>";a+=Config.Strings.AddressBookEmpty+"</div>";return a},beforeShowZeroRowsMessage:function(){var a=c.query(".search",this.zeroRowsNode)[0],b=c.query(".z1",this.zeroRowsNode)[0],d=c.query(".z2",this.zeroRowsNode)[0];this.model.currentTextSearch?(this.zeroRowsNode.className="loading",ws.html.setShowing(b,
!1),ws.html.setShowing(d,!1),ws.html.setShowing(a,!0)):(!this.model.easyTransferShowing&&Config.ShowEasyTransfer?(this.zeroRowsNode.className="easyTransferContainer",ws.html.setShowing(b,!0),ws.html.setShowing(d,!1)):(ws.html.setShowing(b,!1),ws.html.setShowing(d,!0)),ws.html.setShowing(a,!1))},postCreateZeroRowsMessage:function(){},getErrorMessage:function(){return Config.Strings.ErrorLoadingAddressBook},onHide:function(){this.addContactCard&&this.addContactCard.isShowing()&&this.addContactCard.close()},
onContextMenu:function(a){var b=this.getRightClickMenu();b.isShowingNow&&b.close();this.rightClickMenu.rowIndex=a.rowIndex;this.rightClickMenu.contact=this.model.getRow(this.rightClickMenu.rowIndex);if(this.rightClickMenu.contact){var c=this.rightClickMenu.contact,e=c.screenName||c.email1||c.email2||c.composeValue,f=this.rightClickMenu.contact.screenName!=null,g=this.rightClickMenu.getChildren();g[3].setEnabled(e);g[4].setEnabled(f);Config.TopContactsEnabled&&Settings.EnableTopContacts&&g.length>=
10&&(c.bType=="d"?(g[8].setEnabled(!1),g[9].setEnabled(!1)):this.model.isUidTopContact(c.uid)?(g[8].setEnabled(!1),g[9].setEnabled(!0)):(g[8].setEnabled(!0),g[9].setEnabled(!1)));b.open(a.pageX,a.pageY,null,[]);a.preventDefault();a.stopPropagation()}},getRightClickMenu:function(){if(!this.rightClickMenu){var a=[{caption:Config.Strings.Edit,onClick:c.hitch(this,"editContact")},{caption:Config.Strings.Delete,onClick:c.hitch(this,"deleteContact")},{separator:!0},{caption:Config.Strings.SendEmail,onClick:c.hitch(this,
"sendEmail")},{caption:Config.Strings.SendIM,onClick:c.hitch(this,"sendIM")},{separator:!0},{caption:Config.Strings.NewContact,_onClick:c.hitch(this,"addContact")}];Config.TopContactsEnabled&&Settings.EnableTopContacts&&a.push({separator:!0},{caption:Config.Strings.TopContacts_AddToTopContacts,onClick:c.hitch(this,"addContactToTopContacts")},{caption:Config.Strings.TopContacts_RemoveFromTopContacts,onClick:c.hitch(this,"removeContactFromTopContacts")});this.rightClickMenu=ws.widget.createMenu(a)}return this.rightClickMenu},
addContact:function(a){a.stopPropagation();this.rightClickMenu.close();this.openAddContactCard()},deleteContact:function(){var a=this.rightClickMenu.contact;a.bType=="c"?this.model.getContact({uid:this.rightClickMenu.contact.uid,load:c.hitch(this,function(a){this.model.setUndoItem(a);this._deleteAddresses([this.rightClickMenu.contact.uid],!0)}),error:c.hitch(this,function(){this._confirmationDelete()})}):a.bType=="d"?this.model.getDistributionList({uid:this.rightClickMenu.contact.uid,load:c.hitch(this,
function(a){this.model.setUndoItem(a);this._deleteAddresses([this.rightClickMenu.contact.uid],!0)}),error:c.hitch(this,function(){this._confirmationDelete()})}):a.bType=="s"&&this._confirmationDelete()},_confirmationDelete:function(){ws.widget.Dialogs.okCancel(Config.Strings.DeleteContactsConfirmationSingular,c.hitch(this,function(a){a&&this._deleteAddresses([this.rightClickMenu.contact.uid])}))},_deleteAddresses:function(a,b){this.model.deleteAddresses({uids:a,load:c.hitch(this,function(a){a.isSuccess&&
(a=b?c.hitch(this.model,"undoDeletedItem"):null,c.publish("WSFeedbackStart",[Config.Strings.ContactDeletedSingular,!0,a,c.hitch(this,function(){this.model.setUndoItem()})]),Config.TopContactsEnabled&&Settings.EnableTopContacts&&this.model.topContactsEnabled()&&ws.WebSuite.theMailModel.resetCachedLists())}),error:c.hitch(this,function(a){this.model.setUndoItem();window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteAddresses-_deleteAddresses file:PeoplePanel.js");
ws.widget.Dialogs.ok(a||Config.Strings.ErrorDeletingContactNotFound)})})},sendIM:function(){this.rightClickMenu.contact.screenName&&ws.presence.launchIM(this.rightClickMenu.contact.screenName)},editContact:function(){var a=this.rightClickMenu.contact;a.bType=="c"?this.model.getContact({uid:a.uid,load:c.hitch(this,function(b){ws.WebSuite.editContact(a.uid,b,!0)}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.getContact-editContact file:PeoplePanel.js");
ws.widget.Dialogs.ok(a||Config.Strings.ErrorLoadingContact)}}):a.bType=="d"?ws.WebSuite.editDistributionList(a.uid):a.bType=="s"&&ws.WebSuite.sharedGroup(a.name)},addContactToTopContacts:function(){var a=this.rightClickMenu.contact;a.bType=="c"&&this.model.addContactToTopContacts({uid:a.uid,load:c.hitch(this,function(a){a.tcdluid?(ws.WebSuite.theMailModel.resetCachedLists(),c.publish("WSFeedbackStart",[Config.Strings.TopContacts_ContactAdded,!0])):ws.widget.Dialogs.ok(Config.Strings.TopContacts_ContactNotAdded)}),
error:c.hitch(this,function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.addContactToTopContacts-addContactToTopContacts file:PeoplePanel.js");ws.widget.Dialogs.ok(a||Config.Strings.TopContacts_ContactNotAdded)})})},removeContactFromTopContacts:function(){var a=this.rightClickMenu.contact;a.bType=="c"&&this.model.removeContactFromTopContacts({uid:a.uid,load:c.hitch(this,function(a){a.tcremoved?(ws.WebSuite.theMailModel.resetCachedLists(),
c.publish("WSFeedbackStart",[Config.Strings.TopContacts_ContactRemoved,!0])):ws.widget.Dialogs.ok(Config.Strings.TopContacts_ContactNotRemoved)}),error:c.hitch(this,function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.removeContactFromTopContacts-removeContactFromTopContacts file:PeoplePanel.js");ws.widget.Dialogs.ok(a||Config.Strings.TopContacts_ContactNotRemoved)})})},sendEmail:function(){var a=this.rightClickMenu.contact,b=a.email1||
a.email2||a.composeValue||a.screenName;Config.ValidateEmailFormat&&(b=a.email1||a.email2||a.composeValue);b&&ws.WebSuite.getCompose(null,function(a){a.reset({to:b,backToString:"setFolder"})})}}),c.declare("ws.address.PeoplePanelAddContactCard",[i._Widget,i._Templated],{templateString:c.cache("ws.address","PeoplePanelAddContactCard.html",'<div class="peoplePanelAddContactCard hoverCard">\r\n\t<img src="${spacer}" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick: close">\r\n\t<div class="contentDiv" dojoAttachPoint="contentDiv">\r\n\t\t<table dojoAttachPoint="inputTable">\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${Name}</td>\r\n\t\t\t\t<td colspan="2">\r\n\t\t\t\t\t<div dojoType="ws.widget.DefaultTextbox" className="nameInput ieFirstNameInput" dojoAttachPoint="firstNameInput" maxlength="255" defaultValue="${FirstName}" tabindex="200"></div>\r\n\t\t\t\t\t<div dojoType="ws.widget.DefaultTextbox" className="nameInput" dojoAttachPoint="lastNameInput" maxlength="255" defaultValue="${LastName}" tabindex="201"></div>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${Email}</td>\r\n\t\t\t\t<td colspan="2"><input type="text" maxlength="255" dojoAttachPoint="emailInput" class="wsInput emailInput" tabindex="202"></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${Phone}</td>\r\n\t\t\t\t<td style="width:130px"><input type="text" maxlength="255" dojoAttachPoint="phoneInput" class="wsInput" tabindex="203"></td>\r\n\t\t\t\t<td style="width:170px">\r\n\t\t\t\t\t<ul dojoType="ws.widget.WSSelect" dojoAttachPoint="phoneTypeSelect" style="margin-left:3px">\r\n\t\t\t\t\t\t<li value="Cellular">${Cellular}</li>\r\n\t\t\t\t\t\t<li value="Home">${Home}</li>\r\n\t\t\t\t\t\t<li value="Work">${Work}</li>\r\n\t\t\t\t\t\t<li value="Pager">${Pager}</li>\r\n\t\t\t\t\t\t<li value="Fax">${Fax}</li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t<td>\r\n\t\t\t\t<span class="wsLink moreDetailsLink" dojoAttachEvent="onclick: moreDetails">${MoreDetails2}</span>\r\n\t\t\t</td>\r\n\t\t\t<td colspan="2">\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick: checkRequiredFields">${AddContact}</div>\r\n\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,addressModel:null,isPopup:!1,open:function(a){a.popup=this;this.cachedArgs=a;ws.widget.popup(a);this.phoneTypeSelect.sizeMyself()},close:function(){ws.widget.popup.close(this)},moreDetails:function(){this.isPopup&&_ws_isOpenerWS()?opener.ws.WebSuite.editContact(0,this.getData(),!0):ws.WebSuite.editContact(0,this.getData(),!0);this.close()},isEmptyContact:function(){return this.firstNameInput.getValue()?!1:this.lastNameInput.getValue()?!1:!0},checkRequiredFields:function(){if(this.isEmptyContact()==
!0)ws.widget.Dialogs.ok(Config.Strings.EmptyContactMessageNoNickName);else{var a="";if(this.emailInput.value&&!this.isEmailAddress(this.emailInput.value))a=Config.Strings.ErrorEmailFormat2;a?(this.close(),ws.widget.Dialogs.ok(a,c.hitch(this,"open",this.cachedArgs))):this.addContact()}},isEmailAddress:function(a){a=a.match(/(.+)@(.+)\.(.+)/);return a!=null&&a.length==4},addContact:function(){var a=this.getData();a.category="General";a.uid=0;a.load=c.hitch(this,function(){c.publish("WSFeedbackStart",
[Config.Strings.ContactCreated,!0]);this.close()});a.error=function(a){if(a&&a.indexOf(Config.AddressBookFullCodeString)>=0)a=Config.Strings.ErrorAddressBookFull;ws.widget.Dialogs.ok(a||Config.Strings.ErrorSavingContactServerError)};this.addressModel.createOrModifyContact(a)},getData:function(){var a="",b="";this.firstNameInput.getValue()&&(a=c.trim(this.firstNameInput.getValue()));this.lastNameInput.getValue()&&(b=c.trim(this.lastNameInput.getValue()));return{firstName:a,lastName:b,email1:this.emailInput.value,
phone1:this.phoneInput.value,phone1Type:this.phoneTypeSelect.currentValue}},setData:function(a,b,c,e,f){a!=null&&this.firstNameInput.setValue(a);b!=null&&this.lastNameInput.setValue(b);if(c!=null)this.emailInput.value=c;if(e!=null)this.phoneInput.value=e;f!=null&&this.phoneTypeSelect.setOption(f)},setPointer:function(a,b){a!=null?(this.domNode.style.overflow="visible",ws.widget.setPointerLoc(this.domNode,b)):(this.domNode.style.overflow="auto",ws.widget.hidePointer(this.domNode))},reset:function(){this.firstNameInput.setValue();
this.lastNameInput.setValue();this.emailInput.value="";this.phoneInput.value="";this.phoneTypeSelect.setOption(0)}}),c.declare("ws.address.PeoplePanelAddListCard",[ws.address.PeoplePanelAddContactCard],{templateString:c.cache("ws.address","PeoplePanelAddListCard.html",'<div class="peoplePanelAddListCard hoverCard">\r\n\t<img src="${spacer}" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick: close">\r\n\t<div class="contentDiv" dojoAttachPoint="contentDiv">\r\n\t\t<table dojoAttachPoint="inputTable">\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${ListName}</td>\r\n\t\t\t\t<td><input type="text" maxlength="255" class="wsInput nameInput" dojoAttachPoint="createNameField" tabindex="201"></div>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${Contacts}</td>\r\n\t\t\t\t<td><div dojoType="ws.address.AddressField" fieldWidth="222px" minHeight="72" maxHeight="280" dojoAttachPoint="createAddressField" tabindex="202"></div></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td colspan="2"><div dojoType="ws.widget.Button" dojoAttachEvent="onClick: checkRequiredFields">${AddList}</div></td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n\t<span style="clear:both"></span>\r\n</div>\r\n'),
reset:function(){this.createNameField.value="";this.createAddressField.setValue()},createList:function(a){var b=ws.address.AddressBookUtil._mapAddressesToContacts(this.createAddressField,this.addressModel);this.listInfo={uid:0,name:a,contacts:b.contacts,addresses:b.addresses};this.saveList(!1,Config.Strings.DistributionListCreated,null,c.hitch(this,function(){ws.reporting.report("Edit DistList","Addresses");this.close()}))}}),c.extend(ws.address.PeoplePanelAddListCard,{checkRequiredFields:ws.address.DistributionListWidget.prototype.checkRequiredFields,
saveList:ws.address.DistributionListWidget.prototype.saveList}));c._hasResource["ws.calendar.AddEventDialog"]||(c._hasResource["ws.calendar.AddEventDialog"]=!0,c.provide("ws.calendar.AddEventDialog"),c.declare("ws.calendar.AddEventDialog",[ws.widget.WSModalPane,i._Templated],{templateString:c.cache("ws.calendar","AddEventDialog.html",'<div class="addEditEvent WSModalPane" dojoAttachPoint="addDialogWidget">\r\n\t<div style="overflow: hidden;" dojoAttachEvent="onkeypress:onKeyPress,onkeydown:onKeyPress">\r\n\t\t<div class="WSModalPaneInner">\r\n\t\t\t<img src="${spacer}" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick:hide">\r\n\t\t\t<div class="modalContainer" dojoAttachPoint="modalContainer">\r\n\t\t\t\t<div dojoAttachPoint="dlgTitleDiv">\r\n\t\t\t\t\t<div dojoAttachPoint="dlgTitleAdd" class="dlgTitle">${AddEventBtn}</div>\r\n\t\t\t\t\t<div dojoAttachPoint="dlgTitleEdit" class="dlgTitle" style="display:none">${EditEvent}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoAttachPoint="contentPane" class="inputData">\r\n                    <input type="text" class="wsInput summaryInput" maxlength="100" dojoAttachPoint="summaryInput" dojoAttachEvent="onclick:summaryTextClick,onblur:summaryTextBlur,onkeypress:summaryKeyPress" />\r\n                    <div class="dateTimeDiv">\r\n                        <input type="text" class="wsInput dateInputField" dojoAttachPoint="startDateInput" />\r\n                        <input type="text" class="wsInput timeInputField" dojoAttachPoint="startTimeInput" />\r\n                        <span style="padding-bottom:2px" dojoAttachPoint="toSpan" style="display:none">${CalTo}</span>\r\n                        <input type="text" class="wsInput timeInputField" dojoAttachPoint="endTimeInput" />\r\n                        <input type="text" class="wsInput dateInputField" dojoAttachPoint="endDateInput" style="display:none" />\r\n\r\n                    </div>\r\n\r\n                    <div class="allDayDiv">\r\n                        <div dojoType="ws.widget.Checkbox" dojoAttachEvent="onClick:checkBoxChange" dojoAttachPoint="allDayBox" label="${AllDay}" uncheckedClass="checkBoxNotChecked"></div>\r\n                    </div>\r\n\r\n                    <div class="menuDivs">\r\n                        <div class="mainSprite iconDiv iconCalendar"></div>\r\n                        <div dojoType="ws.calendar.CalendarSelect" dojoAttachPoint="calendarMenu" class="calendarList"></div>\r\n                    </div>\r\n\r\n                    <div class="separator"></div>\r\n\r\n                    <div dojoAttachPoint="repeatDiv" class="menuDivs">\r\n                        <div class="mainSprite iconDiv iconRepeat"></div>\r\n                        <ul dojoType="ws.widget.WSSelect" className="selectMenu" dojoAttachPoint="repeatMenu" size="byValue">\r\n                            <li value="doesNotRepeat">${DoesNotRepeat}</li>\r\n                            <li value="everyDay">${EveryDay}</li>\r\n                            <li value="everyWeek">${EveryWeek}</li>\r\n                            <li value="everyMonth">${EveryMonth}</li>\r\n                            <li value="everyYear">${EveryYear}</li>\r\n                            <li value="customRepeat">${CustomRepeat}</li>\r\n                        </ul>\r\n\r\n                        <div class="customDialog" dojoAttachPoint="repeatDialog" style="display:none;overflow: auto;">\r\n                            <div style="clear:both;overflow: auto;">\r\n                                <span class="spanText">${Every}&nbsp;</span>\r\n                                <input type="text" class="wsInput everyInput" dojoAttachPoint="repeatEveryInput" />\r\n                                <ul dojoType="ws.widget.WSSelect" dojoAttachPoint="repeatEveryMenu" className="repeatOption" size="byValue">\r\n                                    <li value="repeatEveryDay">${day}</li>\r\n                                    <li value="repeatEveryWeek">${week}</li>\r\n                                    <li value="repeatEveryMonth">${month}</li>\r\n                                    <li value="repeatEveryYear">${year}</li>\r\n                                </ul>\r\n                            </div>\r\n                            <div dojoAttachPoint="dayIntervalSelect" class="dayIntervalSelect" style="overflow: hidden;">\r\n                                <span class="spanText" dojoAttachPoint="onTextSpan">${CalendarOn}:</span>\r\n                                <span class="pickDaySpan" dojoAttachPoint="day0Span"></span>\r\n                                <span class="pickDaySpan" dojoAttachPoint="day1Span"></span>\r\n                                <span class="pickDaySpan" dojoAttachPoint="day2Span"></span>\r\n                                <span class="pickDaySpan" dojoAttachPoint="day3Span"></span>\r\n                                <span class="pickDaySpan" dojoAttachPoint="day4Span"></span>\r\n                                <span class="pickDaySpan" dojoAttachPoint="day5Span"></span>\r\n                                <span class="pickDaySpan" dojoAttachPoint="day6Span"></span>\r\n                            </div>\r\n                            <div dojoAttachPoint="monthIntervalSelect" class="monthIntervalSelect" style="display:none">\r\n                                <input name="monthSelect" type="radio" dojoAttachEvent="onchange:monthButtonChange" dojoAttachPoint="customMonthDateButton" />\r\n                                <span dojoAttachPoint="customMonthDate">on the 15th&nbsp;</span>\r\n                                <input name="monthSelect" type="radio" dojoAttachEvent="onchange:monthButtonChange" dojoAttachPoint="customMonthDayButton" />\r\n                                <span dojoAttachPoint="customMonthDay">on the fourth Monday</span>\r\n                            </div>\r\n                            <div class="endMenuRow">\r\n                                <ul dojoType="ws.widget.WSSelect" className="zeroMarginLeft" dojoAttachPoint="endDateMenu" size="byValue">\r\n                                    <li value="noEndDate">${NoEndDate}</li>\r\n                                    <li value="repeatUntil">${RepeatUntil}</li>\r\n                                </ul>\r\n                                <input type="text" dojoAttachPoint="endRepeatDateInput" class="wsInput dateInputField" />\r\n                            </div>\r\n                        </div>\r\n                        <div dojoAttachPoint="repeatCustomSummary" class="customSummaryDiv" style="display:none">\r\n                            <span dojoAttachPoint="repeatEverySummarySpan"></span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class="separator"></div>\r\n\r\n                    <div dojoAttachPoint="remindRow" class="menuDivs">\r\n                        <div class="mainSprite iconReminder iconDiv"></div>\r\n                        <ul dojoType="ws.widget.WSSelect" className="selectMenu" dojoAttachPoint="reminderMenu" size="byValue"></ul>\r\n                        <div dojoAttachPoint="remindDialog" class="customDialog" style="display:none">\r\n                            <table dojoAttachPoint="repeatTable" border="0" style="width:100%">\r\n                                <tr>\r\n                                    <td width="14" align="left">\r\n                                        <input type="text" dojoAttachPoint="remindInput" class="wsInput remindAt" />\r\n                                    </td>\r\n                                    <td align="left">\r\n                                        <ul dojoType="ws.widget.WSSelect" dojoAttachPoint="customRemindMenu" className="customReminderMenu" size="byValue"></ul>\r\n                                        <span dojoAttachPoint="customRemindBeforeSpan" class="remindBeforeSpan" style="display:none">${Before}</span>\r\n                                        <input type="text" class="wsInput dateInputField remindBeforeInput" dojoAttachPoint="remindAtEndInput" style="display:none" />\r\n                                    </td>\r\n                                </tr>\r\n                            </table>\r\n                        </div>\r\n                     </div>\r\n\r\n                    <div dojoAttachPoint="remindSummaryRow" style="display:none" class="customSummaryDiv">\r\n                        <span dojoAttachPoint="remindSummarySpan"></span>\r\n                    </div>\r\n                    <div class="separator"></div>\r\n                    <div dojoAttachPoint="locationRow" class="menuDivs">\r\n                        <div class="mainSprite iconDiv iconLocation"></div>\r\n                        <input type="text" class="wsInput addLocationInputShowNew" dojoAttachEvent="onclick:locationTextType" dojoAttachPoint="addLocationInputArea" />\r\n                        <span class="ctrl wsLink" dojoAttachPoint="mapLink" dojoAttachEvent="onclick:showMapLink">${ShowMapLink}</span>\r\n                    </div>\r\n                    <div class="separator"></div>\r\n                    <div class="menuDivs">\r\n                        <div class="mainSprite iconDiv iconNotes"></div>\r\n                        <div class="notesDiv">\r\n                            <div defaultValue="${AddNoteHere}" class="addNotesInputShow" dojoAttachPoint="addNotesInput" dojoType="ws.widget.DefaultTextarea"></div>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <div dojoType="ws.widget.WSToolbar" dojoAttachPoint="toolbar" layoutAlign="top" vizType="Bare">\r\n                        <div dojoType="ws.widget.Button" dojoAttachPoint="saveButton" dojoAttachEvent="onClick:saveAndClose" toolbarPosition="right">${AddEventBtn}</div>\r\n                    </div>\r\n\r\n    \t\t\t</div>\r\n                <div dojoType="ws.widget.PopupDatePicker" dojoAttachPoint="eventDatePopupPicker" hidePickerOnSetDate="true" closeOnMouseOut="true"></div>\r\n                <div dojoType="ws.widget.PopupTimePicker" dojoAttachPoint="eventTimePopupPicker" hidePickerOnSetTime="true" closeOnMouseOut="true"></div>\r\n            </div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},destroyOnClose:!1,widgetsInTemplate:!0,hasPrevLocationValue:!1,textValues:["summary","startDate","startTime","endDate","endTime"],daySpanValues:["day0","day1","day2","day3","day4","day5","day6"],startup:function(){this.dateFormat=Config.Strings.DateYear;this.timeFormat=Config.Strings.CalTimeFormatRange1;this.timeFormatShort=Config.Strings.CalTimeFormatRange2;this.eventInfo=this.model=this.dateInputField=null;this.selectedDays={};this.customSelectUnit=null;this.sortedDays=[];
this.editEvent=!1;this.targetDate=this.showIndexCB=null;this.inherited(arguments);this.connect(this.startDateInput,"onclick",c.hitch(this,"showPicker",this.startDateInput));this.connect(this.endRepeatDateInput,"onclick",c.hitch(this,"showPicker",this.endRepeatDateInput));this.connect(this.remindAtEndInput,"onclick",c.hitch(this,"showPicker",this.remindAtEndInput));this.connect(this.startTimeInput,"onclick",c.hitch(this,"showTimePicker",this.startTimeInput));this.connect(this.endTimeInput,"onclick",
c.hitch(this,"showTimePicker",this.endTimeInput));this.setupPickDaySpans();if(!Config.ShowReminderEvent)this.remindRow.style.display="none",this.remindSummaryRow.style.display="none";if(!Config.EnableCalendarMapLink)this.mapLink.style.display="none";this.connect(this.eventDatePopupPicker.datePicker,"selectDateConnect","fillInDateField");this.connect(this.eventTimePopupPicker.timePicker,"selectTimeConnect","fillInTimeField");this.connect(this.repeatMenu,"valueChanged","handleRepeat");this.connect(this.reminderMenu,
"valueChanged","handleReminder");this.connect(this.repeatEveryMenu,"valueChanged","handleCustomRepeat");this.connect(this.endDateMenu,"valueChanged","handleEndDate");this.connect(this.customRemindMenu,"valueChanged","handleCustomRemind");this.modelUpdatedHandler=c.connect(this.model,"modelUpdated",this,"update");this.subscribe("Suite/onKeyOnPress","_suiteOnKeyPress")},uninitialize:function(){this.modelUpdatedHandler&&c.disconnect(this.modelUpdatedHandler)},update:function(){this.calendarMenu.buildList()},
setupPickDaySpans:function(){for(var a=0;a<this.daySpanValues.length;a++)this[this.daySpanValues[a]+"Span"].innerHTML=a+ws.date.firstDayOfWeek<ws.date.abbrevDays.length?ws.date.abbrevDays[a+ws.date.firstDayOfWeek]:ws.date.abbrevDays[a+ws.date.firstDayOfWeek-ws.date.abbrevDays.length],this[this.daySpanValues[a]+"Span"].title=a+ws.date.firstDayOfWeek<ws.date.days.length?ws.date.days[a+ws.date.firstDayOfWeek]:ws.date.days[a+ws.date.firstDayOfWeek-ws.date.days.length],this[this.daySpanValues[a]+"Span"].value=
a,this[this.daySpanValues[a]+"Span"].onmouseover=c.hitch(this,"onMouseOverSpan",this[this.daySpanValues[a]+"Span"]),this[this.daySpanValues[a]+"Span"].onmouseout=c.hitch(this,"onMouseOutSpan",this[this.daySpanValues[a]+"Span"]),this[this.daySpanValues[a]+"Span"].onclick=c.hitch(this,"onClickSpan",this[this.daySpanValues[a]+"Span"])},handleRepeat:function(){if(this.eventInfo==null)this.hideRepeat();else{switch(this.repeatMenu.currentValue){case "doesNotRepeat":this.repeatEverySummarySpan.innerHTML=
"";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.eventInfo.recurType="0";this.hideRepeat();break;case "everyDay":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.eventInfo.recurType="1";this.eventInfo.frequency=1;this.hideRepeat();break;case "everyWeek":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.eventInfo.recurType="2";this.eventInfo.frequency=
1;this.hideRepeat();break;case "everyMonth":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.eventInfo.recurType="5";this.eventInfo.frequency=1;this.hideRepeat();break;case "everyYear":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.eventInfo.recurType="6";this.eventInfo.frequency=1;this.hideRepeat();break;case "customRepeat":this.dayIntervalSelect.style.display=
"",this.monthIntervalSelect.style.display="none",this.repeatEveryInput.value="1",this.customSelectUnit="repeatEveryWeek",this.onTextSpan.style.display="",this.repeatEveryMenu.setOption(1,!0),this.endDateMenu.setOption(0,!0),this.customMonthDateButton.checked=!0,this.eventInfo.recurType="2",this.repeatDialog.style.display="",this.repeatEveryMenu.sizeMyself(),this.endDateMenu.sizeMyself()}this.checkSize()}},handleReminder:function(){if(this.eventInfo==null)this.hideRemind();else{this.remindInput.style.display=
"";switch(this.reminderMenu.currentValue){case "noReminder":this.remindSummarySpan.innerHTML="";this.remindSummaryRow.style.display="none";this.eventInfo.reminderEnabled=!1;"reminderLeadTime"in this.eventInfo&&delete this.eventInfo.reminderLeadTime;this.hideRemind();break;case "remindAt":this.remindInput.style.display="none";this.remindInput.parentNode.setAttribute("width","14");c.replaceClass(this.remindInput,"remindAt","everyInput");this.customRemindMenu.setOption(0,!0);this.remindDialog.style.display=
"";break;case "timeOfEvent":case "min15Before":case "min30Before":case "hour1Before":this.remindSummarySpan.innerHTML="";this.remindSummaryRow.style.display="none";this.eventInfo.reminderEnabled=!0;this.eventInfo.reminderLeadTime=this.getLeadTimeInMinutes(this.reminderMenu.currentValue);this.hideRemind();break;case "customReminder":this.remindInput.parentNode.setAttribute("width","28"),c.replaceClass(this.remindInput,"everyInput","remindAt"),this.customRemindMenu.setOption(0,!0),this.remindInput.value=
"15",this.remindDialog.style.display=""}this.customRemindMenu.sizeMyself();this.checkSize()}},handleCustomRepeat:function(){if(this.repeatCustomSummary.style.display!="none")this.repeatEverySummarySpan.innerHTML="",this.repeatCustomSummary.style.display="none";switch(this.repeatEveryMenu.currentValue){case "repeatEveryDay":this.dayIntervalSelect.style.display="none";this.monthIntervalSelect.style.display="none";this.onTextSpan.style.display="none";this.eventInfo.recurType="1";break;case "repeatEveryWeek":this.dayIntervalSelect.style.display=
"";this.monthIntervalSelect.style.display="none";this.onTextSpan.style.display="";var a=Config.Strings.CalDateParseFormat,a=ws.date.ParseDateFromFormat(this.startDateInput.value,a);if(a!=null){var b=a.getDay()-ws.date.firstDayOfWeek;b<0&&(b+=7);this.selectedDays[this[this.daySpanValues[b]+"Span"].value]=!0;c.addClass(this[this.daySpanValues[b]+"Span"],"pickDaySpanOnHover")}this.eventInfo.recurType="2";break;case "repeatEveryMonth":b=[Config.Strings.Sunday,Config.Strings.Monday,Config.Strings.Tuesday,
Config.Strings.Wednesday,Config.Strings.Thursday,Config.Strings.Friday,Config.Strings.Saturday];a=Config.Strings.CalDateParseFormat;a=ws.date.ParseDateFromFormat(this.startDateInput.value,a);if(a!=null){this.customMonthDate.innerHTML=ws.string.substituteParams(Config.Strings.onTheDate,a.getDate());var d="",d=a.getDate()<8?Config.Strings.First:a.getDate()>7&&a.getDate()<15?Config.Strings.Second:a.getDate()>14&&a.getDate()<22?Config.Strings.Third:a.getDate()>21&&a.getDate()<29?Config.Strings.Fourth:
Config.Strings.Last;this.customMonthDay.innerHTML=ws.string.substituteParams(Config.Strings.onTheDay,d,b[a.getDay()]);this.dayIntervalSelect.style.display="none";this.monthIntervalSelect.style.display="";this.onTextSpan.style.display="none";this.eventInfo.recurType="5"}break;case "repeatEveryYear":this.dayIntervalSelect.style.display="none",this.monthIntervalSelect.style.display="none",this.onTextSpan.style.display="none",this.eventInfo.recurType="6"}this.customSelectUnit=this.repeatEveryMenu.currentValue;
this.checkSize()},handleCustomRemind:function(){switch(this.customRemindMenu.currentValue){case "onThisDate":this.remindAtEndInput.style.display="";this.remindAtEndInput.value=ws.date.formatDateTime(new Date,this.dateFormat);break;case "dayOfEvent":case "oneDayBefore":case "twoDaysBefore":case "oneWeekBefore":case "remindMinutes":case "remindHours":case "remindDays":case "remindWeeks":this.remindAtEndInput.style.display="none"}},handleEndDate:function(){switch(this.endDateMenu.currentValue){case "noEndDate":this.endRepeatDateInput.style.display=
"none";break;case "repeatUntil":var a=ws.date.add(new Date,ws.date.dateParts.DAY,7);this.endRepeatDateInput.value=ws.date.formatDateTime(a,this.dateFormat);this.endRepeatDateInput.style.display=""}this.customRemindMenu.sizeMyself()},onMouseOverSpan:function(a){c.addClass(a,"pickDaySpanOnHover")},onMouseOutSpan:function(a){this.selectedDays[a.value]||c.removeClass(a,"pickDaySpanOnHover")},onClickSpan:function(a){a.value in this.selectedDays?(delete this.selectedDays[a.value],c.removeClass(a,"pickDaySpanOnHover")):
(this.selectedDays[a.value]=!0,c.addClass(a,"pickDaySpanOnHover"))},addLocation:function(){this.addLocationInputArea.className="wsInput addLocationInputShowNew";this.addLocationInputArea.value=Config.Strings.AddLocationHere;this.checkSize()},locationTextType:function(){if(!c.hasClass(this.addLocationInputArea,"addLocationInputShow"))this.addLocationInputArea.value="",this.addLocationInputArea.className="wsInput addLocationInputShow"},showMapLink:function(){ws.calendar.calutil.showMapLink(this.addLocationInputArea.value,
!1)},setModel:function(a){this.model&&this.modelUpdatedHandler&&c.disconnect(this.modelUpdatedHandler);this.model=a;this.modelUpdatedHandler=c.connect(this.model,"modelUpdated",this,"update");this.calendarMenu.setModel(a)},saveAndClose:function(){if((this.eventInfo==null||this.eventInfo.dtstart==null)&&this.model!=null){var a=this.model.getDefaultComponentArgs();this.eventInfo.dtstart=a.dtstart;this.eventInfo.dtend=a.dtend}a=this.checkAndGetInfo();null===a?(this.eventInfo.index=!0,this.isSelectedEventRecurring()?
(this.addDialogWidget.style.display="none",ws.calendar.calutil.showConfirmRecurDialog("edit",c.hitch(this,function(a,c){a?(this.saveComponentCallback(c),this.resetSearch()):(this.addDialogWidget.style.display="",this.cancelSave())}))):(this.saveComponentCallback(),this.resetSearch())):(this.addDialogWidget.style.display="none",ws.widget.OkCancelDialog.alert(a,c.hitch(this,function(){this.addDialogWidget.style.display=""})))},resetSearch:function(){this.model&&this.model.getSearchString()&&this.model.refreshSearchResult()},
isSelectedEventRecurring:function(){var a=!1,b=this.eventInfo;b&&b.rid&&(a=b.rid.length>0);return a},cancelSave:function(){},saveComponentCallback:function(a){a||(a="CHANGE_CURRENT");this.eventInfo.recurChangeMode=a;this.eventInfo.loadCallback=c.hitch(this,function(){this.setDate(this.targetDate);if(this.onSavedCB)this.onSavedCB(),this.onSavedCB=null;this.selectCalendar(this.eventInfo.calid)});a=!1;if(this.showIndexCB)a=this.showIndexCB;this.model.saveComponent(this.eventInfo,a);this.hide()},selectCalendar:function(a){a=
this.model.calendars[a];if(!a[this.model.calendarEnum.selected])a=this.model.getCalendarArgs(a,!1),a.selected=!0,this.model.saveCalendar(a)},setDate:function(){},checkAndGetInfo:function(){var a=null,b=a=null;if(this.summaryInput.value==""||c.hasClass(this.summaryInput,"summaryInputNew"))return Config.Strings.AddTitleToEvent;var d=Config.Strings.CalDateParseFormat,a=ws.date.ParseDateFromFormat(this.startDateInput.value,d),b=ws.date.ParseDateFromFormat(this.startDateInput.value,d);if(a==null)return Config.Strings.InvalidDateOnCreate;
if(b==null)return Config.Strings.InvalidDateOnCreate;if(!this.allDayBox.checked){d=ws.date.ParseHourMinTextField(this.startTimeInput.value,this.timeFormat,this.timeFormatShort);if(d==null)return a=Config.Strings.Calendar_AddEvent_InvalidStart;a.setHours(d.hr,d.min,0,0);var e=ws.date.ParseHourMinTextField(this.endTimeInput.value,this.timeFormat,this.timeFormatShort);if(e==null)return a=Config.Strings.Calendar_AddEvent_InvalidEnd;if(a.getDate()==b.getDate()&&(e.hr<d.hr||e.hr==d.hr&&e.min<d.min))b=ws.date.add(b,
ws.date.dateParts.HOUR,24);b.setHours(e.hr,e.min,0,0)}if(a>b)return a=Config.Strings.Calendar_AddEvent_InvalidStartAfterEnd;b.getTime()>=a.getTime()+864E5&&(b=ws.date.add(b,ws.date.dateParts.HOUR,-24));if(this.eventInfo.recurType){if(this.repeatMenu.currentValue=="customRepeat"){d=!1;if(this.repeatEveryInput.value!=""&&Number(this.repeatEveryInput.value).toString()!="NaN"){this.eventInfo.frequency=Number(this.repeatEveryInput.value);this.eventInfo.frequency=Math.floor(this.eventInfo.frequency);if(this.eventInfo.frequency<
1)this.eventInfo.frequency=1;this.eventInfo.frequency>1E4&&(d=!0)}else d=!0;if(d)return a=Config.Strings.Calendar_AddEvent_InvalidNumberCustomRepeat}if(this.customSelectUnit=="repeatEveryWeek"){if(this.sortSelectedDays(),this.sortedDays.length)this.eventInfo.occursOn=this.getOccursOnDay(this.sortedDays,!0)}else if(this.customSelectUnit=="repeatEveryMonth")if(this.customMonthDayButton.checked)this.eventInfo.occursOn=a.getDate()<8?a.getDay():a.getDate()>7&&a.getDate()<15?a.getDay()+7:a.getDate()>14&&
a.getDate()<22?a.getDay()+14:a.getDate()>21&&a.getDate()<29?a.getDay()+21:a.getDay()+28;else if(this.customMonthDateButton.checked)this.eventInfo.occursOn=a.getDate();else return a=Config.Strings.Calendar.AddEvent.InvalidCustomMonth;else this.eventInfo.recurType=="2"?(d=[],e=a.getDay(),d.push(e),this.eventInfo.occursOn=this.getOccursOnDay(d,!1)):this.eventInfo.occursOn=this.eventInfo.recurType=="5"?a.getDate():0;if(this.repeatMenu.currentValue=="customRepeat"&&this.endDateMenu.currentValue=="repeatUntil")if(e=
null,d=Config.Strings.CalDateParseFormat,e=this.endRepeatDateInput.value,e=ws.date.ParseDateFromFormat(e,d),null!=e){if(ws.date.ParseDateFromFormat(this.startDateInput.value,d)>e)return a=Config.Strings.Calendar_AddEvent_InvalidStartAfterEnd;this.eventInfo.recurEnd=ws.date.formatISO8601(e)}else return a=ws.string.substituteParams(Config.Strings.ErrorDateNotValidFormat,Config.Strings.EventRepeatEndDate,Config.Strings.CalDateFormat);else this.eventInfo.recurEnd&&delete this.eventInfo.recurEnd}if(this.reminderMenu.currentValue!=
"noReminder"){this.eventInfo.reminderEnabled=!0;d=null;if(this.reminderMenu.currentValue=="customReminder"||this.reminderMenu.currentValue=="remindAt"){if(d=this.reminderMenu.currentValue=="remindAt"?this.calculateLeadTimeInMinutes(this.customRemindMenu.currentValue,"12:00am",a):this.calculateLeadTimeInMinutes(this.customRemindMenu.currentValue,this.remindInput.value,a),typeof d=="string")return d}else d=this.getLeadTimeInMinutes(this.reminderMenu.currentValue);this.eventInfo.reminderLeadTime=d;d=
this.eventInfo.reminderLeadTime*60;d=a.getTime()/1E3-d;if(d>0&&(e=this.model.currentServerTime,d=((new Date(d*1E3)).getTime()-e.getTime())/1E3,this.allDayBox.checked&&(d-=3600),d<1))return a=Config.Strings.InvalidReminderDateInPastOnCreate}this.targetDate=a;this.addNotesInput.getValue()?this.eventInfo.description=this.addNotesInput.getValue():delete this.eventInfo.description;this.addLocationInputArea.value==""||c.hasClass(this.addLocationInputArea,"addLocationInputShowNew")?this.hasPrevLocationValue?
this.eventInfo.location="":delete this.eventInfo.location:this.eventInfo.location=this.addLocationInputArea.value;this.eventInfo.summary=this.summaryInput.value;this.eventInfo.start=ws.date.formatISO8601(a);this.eventInfo.end=ws.date.formatISO8601(b);this.eventInfo.allDay=this.allDayBox.checked;if(typeof this.calendarMenu.getValue()=="string")this.eventInfo.calid=this.calendarMenu.getValue();return null},getOccursOnDay:function(a,b){for(var c=0,e=null,f=0,e=0;e<a.length;e++)switch(f=b?a[e]+ws.date.firstDayOfWeek<
7?a[e]+ws.date.firstDayOfWeek:a[e]+ws.date.firstDayOfWeek-7:a[e],f){case 0:c+=1;break;case 1:c+=2;break;case 2:c+=4;break;case 3:c+=8;break;case 4:c+=16;break;case 5:c+=32;break;case 6:c+=64}return c},decodeSelectedDays:function(){for(var a=this.eventInfo.occursOn,b=[Config.Strings.Sunday,Config.Strings.Monday,Config.Strings.Tuesday,Config.Strings.Wednesday,Config.Strings.Thursday,Config.Strings.Friday,Config.Strings.Saturday],c=[],e=[],f=1,g=0;g<7;g++){var h=g+ws.date.firstDayOfWeek;h>=7&&(h-=7);
f=Math.pow(2,h);a&f&&(c.push(b[h]),e.push(h-ws.date.firstDayOfWeek<0?h-ws.date.firstDayOfWeek+7:h-ws.date.firstDayOfWeek))}return{days:c,daysValues:e}},getCustomMonthly:function(a,b){var c=null,c=[Config.Strings.Sunday,Config.Strings.Monday,Config.Strings.Tuesday,Config.Strings.Wednesday,Config.Strings.Thursday,Config.Strings.Friday,Config.Strings.Saturday];if(a){this.customMonthDayButton.checked=!0;var e=Math.floor(this.eventInfo.occursOn/7),f=this.eventInfo.occursOn%7,e=e==0?Config.Strings.First:
e==1?Config.Strings.Second:e==2?Config.Strings.Third:e==3?Config.Strings.Fourth:Config.Strings.Last,c=b==1?ws.string.substituteParams(Config.Strings.onTheDayOfEveryMonth,e,c[f],Config.Strings.month):ws.string.substituteParams(Config.Strings.onTheDayOfEveryFreqMonth,e,c[f],b,Config.Strings.Months)}else this.customMonthDateButton.checked=!0,c=b==1?ws.string.substituteParams(Config.Strings.onTheDateOfEveryMonth,this.eventInfo.occursOn,Config.Strings.month):ws.string.substituteParams(Config.Strings.onTheDateOfEveryFreqMonth,
this.eventInfo.occursOn,b,Config.Strings.Months);return c},buildReminderMenu:function(a){var b=[];a?(b.push({display:Config.Strings.NoReminder,value:"noReminder",selected:!0}),b.push({display:Config.Strings.RemindMeAt2,value:"remindAt"})):(b.push({display:Config.Strings.NoReminder,value:"noReminder",selected:!0}),b.push({display:Config.Strings.ReminderAtDateAndTimeAbove,value:"timeOfEvent"}),b.push({display:"15 "+Config.Strings.RemindMinsBefore,value:"min15Before"}),b.push({display:"30 "+Config.Strings.RemindMinsBefore,
value:"min30Before"}),b.push({display:"1 "+Config.Strings.HourBefore,value:"hour1Before"}),b.push({display:Config.Strings.CustomReminder,value:"customReminder"}));this.reminderMenu.setOptions(b)},buildCustomReminderMenu:function(a){var b=[];a?(b.push({display:Config.Strings.DayOfEvent,value:"dayOfEvent",selected:!0}),b.push({display:Config.Strings.OneDayBefore,value:"oneDayBefore"}),b.push({display:Config.Strings.TwoDaysBefore,value:"twoDaysBefore"}),b.push({display:Config.Strings.OneWeekBefore,value:"oneWeekBefore"}),
b.push({display:Config.Strings.OnThisDate,value:"onThisDate"})):(b.push({display:Config.Strings.Minutes,value:"remindMinutes",selected:!0}),b.push({display:Config.Strings.Hours,value:"remindHours"}),b.push({display:Config.Strings.Days,value:"remindDays"}),b.push({display:Config.Strings.Weeks,value:"remindWeeks"}));this.customRemindMenu.setOptions(b)},clearForm:function(){for(var a=0;a<this.textValues.length;a++)this[this.textValues[a]+"Input"].value="";this.allDayBox.setChecked(!0);this.startTimeInput.style.display=
"none";this.endTimeInput.style.display="none";this.toSpan.style.display="none"},defaultPopulateForm:function(){var a=new Date;this.editEvent=!1;c.replaceClass(this.summaryInput,"summaryInputNew","summaryInput");a=ws.calendar.calutil.GetNext30MinuteIncrement(a);this.startDateInput.value=ws.date.formatDateTime(a,this.dateFormat);this.startTimeInput.value=ws.date.formatDateTime(a,this.timeFormat);a=ws.date.add(a,ws.date.dateParts.MINUTE,30);this.endDateInput.value=ws.date.formatDateTime(a,this.dateFormat);
this.endTimeInput.value=ws.date.formatDateTime(a,this.timeFormat);this.allDayBox.setChecked(!0);this.buildReminderMenu(!0);this.buildCustomReminderMenu(!0);this.startTimeInput.style.display="none";this.endTimeInput.style.display="none";this.toSpan.style.display="none";this.repeatMenu.setOption(0,!0);this.reminderMenu.setOption(0,!0);this.calendarMenu.setOption(0,!0);this.repeatEveryMenu.setOption(1);this.customRemindMenu.setOption(0,!0);this.endDateMenu.setOption(0,!0);a.setHours(18,0);this.remindInput.value=
ws.date.formatDateTime(a,this.timeFormat);this.reminderInputPrevValue="1";this.addNotesInput.setValue();this.addLocationInputArea.value="";this.addLocation()},populateForm:function(a){this.editEvent=!0;c.replaceClass(this.summaryInput,"summaryInput","summaryInputNew");this.eventInfo.calid&&this.calendarMenu.setValue(this.eventInfo.calid);var b=this.eventInfo.summary;a!=null&&a==4&&b==Config.Strings.AddEventName?c.replaceClass(this.summaryInput,"summaryInputNew","summaryInput"):b=ws.calendar.calutil.DecodeHTMLEntities(b);
this.summaryInput.value=b;this.startDateInput.value=ws.date.formatDateTime(this.eventInfo.start,this.dateFormat);this.startTimeInput.value=ws.date.formatDateTime(this.eventInfo.start,this.timeFormat);this.endDateInput.value=ws.date.formatDateTime(this.eventInfo.end,this.dateFormat);this.endTimeInput.value=ws.date.formatDateTime(this.eventInfo.end,this.timeFormat);this.allDayBox.setChecked(this.eventInfo.allDay);this.checkBoxChange();if(this.eventInfo.rid){var d=a=null;if(this.eventInfo.frequency)d=
this.eventInfo.frequency==1?!0:!1;else return;switch(this.eventInfo.recurType){case "1":d&&this.eventInfo.recurEnd==null?(this.repeatEverySummarySpan.innerHTML="",this.repeatMenu.setOption(1,!0)):(this.repeatMenu.setOption(5,!0),this.repeatDialog.style.display="",this.repeatEveryInput.value=this.eventInfo.frequency,this.repeatEveryMenu.setOption(0),this.handleCustomRepeat(),a=Config.Strings.Every+" "+this.eventInfo.frequency+" "+Config.Strings.Days);break;case "2":b=this.decodeSelectedDays();if(b.days.length){a=
d?Config.Strings.EveryWeekOn+" ":Config.Strings.Every+" "+this.eventInfo.frequency+" "+Config.Strings.WeeksOn;if(b.days.length>1){for(d=0;d<b.days.length-1;d++)a+=d<b.days.length-2?b.days[d]+", ":b.days[d];a+=" "+Config.Strings.And+" "+b.days[d]}else a+=b.days[0];this.repeatMenu.setOption(5);this.repeatDialog.style.display="";this.repeatEveryInput.value=this.eventInfo.frequency;this.repeatEveryMenu.setOption(1);this.handleCustomRepeat();for(d=0;d<b.daysValues.length;d++)this.selectedDays[b.daysValues[d]]=
!0;this.setupDaySpans()}else this.repeatMenu.setOption(2);break;case "4":this.repeatMenu.setOption(5,!0);this.repeatDialog.style.display="";this.repeatEveryInput.value=this.eventInfo.frequency;this.repeatEveryMenu.setOption(2,!0);this.handleCustomRepeat();this.eventInfo.recurType="4";a=this.getCustomMonthly(!0,this.eventInfo.frequency);break;case "5":d&&this.eventInfo.recurEnd==null?this.repeatMenu.setOption(3,!0):(this.repeatMenu.setOption(5,!0),this.repeatDialog.style.display="",this.repeatEveryInput.value=
this.eventInfo.frequency,this.repeatEveryMenu.setOption(2,!0),this.handleCustomRepeat(),a=this.getCustomMonthly(!1,this.eventInfo.frequency));break;case "6":this.repeatMenu.setOption(5,!0),this.repeatDialog.style.display="",this.repeatEveryInput.value=this.eventInfo.frequency,this.repeatEveryMenu.setOption(3,!0),this.handleCustomRepeat(),a=d?Config.Strings.EveryYear:Config.Strings.Every+" "+this.eventInfo.frequency+" "+Config.Strings.Years}this.eventInfo.recurEnd?(this.endDateMenu.setOption(1,!0),
b=this.eventInfo.recurEnd.length>=8?this.eventInfo.recurEnd.substring(0,8):this.eventInfo.recurEnd,b=ws.date.ParseDateFromFormat(b,ws.date.RFC2445),this.endRepeatDateInput.value=ws.date.formatDateTime(b,Config.Strings.CalDateFormat),this.endRepeatDateInput.style.display=""):this.endDateMenu.setOption(0,!0);if(a)this.repeatCustomSummary.style.display="",this.repeatEverySummarySpan.innerHTML=a}else this.repeatMenu.setOption(0,!0);this.buildReminderMenu(this.eventInfo.allDay);this.buildCustomReminderMenu(this.eventInfo.allDay);
this.remindInput.style.display="";this.eventInfo.reminderEnabled&&this.eventInfo.allDay?(this.reminderMenu.setOption(1,!0),this._populateCustomReminder(this.eventInfo.reminderLeadTime,!0,this.eventInfo.start),this.remindInput.style.display="none"):this.eventInfo.reminderEnabled?(a=this.getReminderLeadTime(this.eventInfo.reminderLeadTime),typeof a=="number"?this.reminderMenu.setOption(a,!0):(this.reminderMenu.setOption(5,!0),this._populateCustomReminder(this.eventInfo.reminderLeadTime))):(this.reminderMenu.setOption(0,
!0),a=new Date,a.setHours(18,0),this.remindInput.value=ws.date.formatDateTime(a,this.timeFormat),this.reminderInputPrevValue="1");this.eventInfo.description?(a=this.eventInfo.description,a=ws.calendar.calutil.DecodeHTMLEntities(a),this.addNotesInput.setValue(a)):this.addNotesInput.setValue();this.eventInfo.location&&!(this.eventInfo.location==null||this.eventInfo.location=="")?(a=this.eventInfo.location,a=ws.calendar.calutil.DecodeHTMLEntities(a),this.addLocationInputArea.className="wsInput addLocationInputShow",
this.addLocationInputArea.value=a,this.hasPrevLocationValue=!0):(this.addLocationInputArea.value="",this.addLocation())},_populateCustomReminder:function(a,b,c){if(b){var b=new Date,e=0,f=0;if(a<=1440)c=1,a==0?(b.setHours(0,0),c=0):a==1440?b.setHours(0,0):(e=Math.ceil(a/60),f=a%60,b.setHours(e==0?0:24-e,f==0?0:60-f)),this.remindInput.value=ws.date.formatDateTime(b,this.timeFormat),this.customRemindMenu.setOption(c,!0);else if(a<=2880)a==2880?b.setHours(0,0):(e=Math.ceil((a-1440)/60),f=(a-1440)%60,
b.setHours(24-e,f==0?0:60-f)),this.remindInput.value=ws.date.formatDateTime(b,this.timeFormat),this.customRemindMenu.setOption(2,!0);else{var g=Math.ceil(a/1440);a%=1440*(g-1);e=Math.ceil(a/60);f=a%60;b.setHours(24-e,f==0?0:60-f);b.setFullYear(c.getFullYear(),c.getMonth(),c.getDate()-g);this.remindInput.value=ws.date.formatDateTime(b,this.timeFormat);this.customRemindMenu.setOption(4,!0);this.remindAtEndInput.value=ws.date.formatDateTime(b,this.dateFormat)}this.reminderInputPrevValue="1"}else a%10080==
0?(this.remindInput.value=a/10080,this.customRemindMenu.setOption(3,!0)):a%1440==0?(this.remindInput.value=a/1440,this.customRemindMenu.setOption(2,!0)):a%60==0?(this.remindInput.value=a/60,this.customRemindMenu.setOption(1,!0)):(this.remindInput.value=a,this.customRemindMenu.setOption(0,!0)),b=new Date,b.setHours(18,0),this.reminderInputPrevValue=ws.date.formatDateTime(b,this.timeFormat)},toggleTitle:function(a){a=="Add"?(this.dlgTitleEdit.style.display="none",this.dlgTitleAdd.style.display="",this.saveButton.setLabel(Config.Strings.AddEventBtn)):
(this.dlgTitleEdit.style.display="",this.dlgTitleAdd.style.display="none",this.saveButton.setLabel(Config.Strings.Save))},show:function(a,b){this.hide();this.eventInfo=null;this.toggleTitle("Edit");this.calendarMenu.buildList(b);if(a==1||a==4)if(b){this.eventInfo=b;if(b.index!=null)this.showIndexCB=b.index;this.eventInfo.id!=null||this.toggleTitle("Add");this.populateForm(a);this.inherited(arguments);this.eventInfo.id?ws.reporting.reportAction("Edit Event"):ws.reporting.reportAction("Add Event - Full")}else return;
else if(a==2)if(b){this.model.isSuccess||this.model.getData();this.defaultPopulateForm();this.eventInfo=this.model.getDefaultArgs();b.notes==null||b.notes==""||this.addNotesInput.setValue(b.notes);if(!(b.location==null||b.location==""))this.addLocationInputArea.className="wsInput addLocationInputShow",this.addLocationInputArea.value=b.location,this.hasPrevLocationValue=!0;if(b.start)this.startDateInput.value=ws.date.formatDateTime(b.start,this.dateFormat),this.startTimeInput.value=ws.date.formatDateTime(b.start,
this.timeFormat);this.toggleTitle("Add");this.inherited(arguments);if(b.summary==null||b.summary==""){var d;ws.lang.setTimeout(this,function(){this.summaryInput.value=Config.Strings.AddEventName;ws.html.selectInputText(this.summaryInput)},50)}else c.replaceClass(this.summaryInput,"summaryInput","summaryInputNew"),this.summaryInput.value=b.summary}else return;else this.toggleTitle("Add"),this.eventInfo=this.model.getDefaultArgs(),this.defaultPopulateForm(),this.inherited(arguments),ws.lang.setTimeout(this,
function(){this.summaryInput.value=Config.Strings.AddEventName;ws.html.selectInputText(this.summaryInput)},50),ws.reporting.reportAction("Add Event - Full");c.isMozilla&&!ws.browser.ns7&&ws.widget.fixFFCursor(this.contentPane);ws.browser.ns7&&(c.style(this.addDialogWidget,"padding-right","13px"),c.style(this.summaryInput,"margin-top","6px"));this.endDateMenu.hide();this.endDateMenu.show();this.repeatMenu.sizeMyself();this.repeatEveryMenu.sizeMyself();this.endDateMenu.sizeMyself();this.reminderMenu.sizeMyself();
this.customRemindMenu.sizeMyself()},hide:function(){this.hideRepeat();this.customSelectUnit=null;this.sortedDays=[];this.hideRemind();this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.remindSummarySpan.innerHTML="";this.remindSummaryRow.style.display="none";this.addNotesInput.setValue();this.addLocation();this.inherited(arguments)},checkBoxChange:function(a){if(this.allDayBox.checked){if(this.startTimeInput.style.display="none",this.endTimeInput.style.display=
"none",this.customRemindBeforeSpan.style.display="none",c.replaceClass(this.remindInput,"remindAt","everyInput"),this.remindInput.parentNode.setAttribute("width","14"),this.remindInput.onclick=c.hitch(this,"showTimePicker",this.remindInput),this.toSpan.style.display="none",a){this.buildReminderMenu(!0);this.buildCustomReminderMenu(!0);var b=this.reminderInputPrevValue?this.reminderInputPrevValue:"6:00pm"}}else this.startTimeInput.style.display="",this.endTimeInput.style.display="",this.customRemindBeforeSpan.style.display=
"",c.replaceClass(this.remindInput,"everyInput","remindAt"),this.remindInput.parentNode.setAttribute("width","28"),this.remindInput.onclick=function(){},this.toSpan.style.display="",a&&(this.buildReminderMenu(!1),this.buildCustomReminderMenu(!1),b=this.reminderInputPrevValue?this.reminderInputPrevValue:"1");if(a)this.reminderMenu.setOption(0,!0),this.reminderInputPrevValue=this.remindInput.value,this.remindInput.value=b},showPicker:function(a){if(!this.eventDatePopupPicker.isShowing())ws.widget.popup({popup:this.eventDatePopupPicker,
around:a,orient:{BL:"TL"}}),this.dateInputField=a},showTimePicker:function(a){if(!this.eventTimePopupPicker.isShowing()){ws.widget.popup({popup:this.eventTimePopupPicker,around:a,orient:{BL:"TL"}});this.timeInputField=a;var b=new Date,a=ws.date.ParseHourMinTextField(a.value,this.timeFormat,this.timeFormatShort);a!=null?(b.setHours(a.hr,a.min,0,0),this.eventTimePopupPicker.initializeTime(b)):this.eventTimePopupPicker.initializeTime()}},fillInDateField:function(a){this.dateInputField.value=ws.date.formatDateTime(new Date(a),
this.dateFormat);this.dateInputField==this.startDateInput&&this.repeatEveryMenu.currentValue=="repeatEveryMonth"&&this.handleCustomRepeat();if(this.dateInputField==this.startDateInput){if(ws.date.ParseDateFromFormat(this.endDateInput.value,Config.Strings.CalDateParseFormat)<a)this.endDateInput.value=this.dateInputField.value;this.endDateInput.value=this.startDateInput.value}else if(this.dateInputField==this.endDateInput){if(ws.date.ParseDateFromFormat(this.startDateInput.value,Config.Strings.CalDateParseFormat)>
a)this.startDateInput.value=this.dateInputField.value;this.startDateInput.value=this.endDateInput.value}},fillInTimeField:function(a){this.timeInputField.value=a},monthButtonChange:function(){this.eventInfo.recurType=this.customMonthDateButton.checked?"5":"4"},setupDaySpans:function(){for(var a in this.selectedDays)switch(a){case "0":c.addClass(this.day0Span,"pickDaySpanOnHover");break;case "1":c.addClass(this.day1Span,"pickDaySpanOnHover");break;case "2":c.addClass(this.day2Span,"pickDaySpanOnHover");
break;case "3":c.addClass(this.day3Span,"pickDaySpanOnHover");break;case "4":c.addClass(this.day4Span,"pickDaySpanOnHover");break;case "5":c.addClass(this.day5Span,"pickDaySpanOnHover");break;case "6":c.addClass(this.day6Span,"pickDaySpanOnHover")}},sortSelectedDays:function(){for(var a in this.selectedDays)this.sortedDays.push(a*1);this.sortedDays.sort(function(a,c){return a-c})},hideRepeat:function(){this.selectedDays={};for(var a=0;a<this.daySpanValues.length;a++)c.removeClass(this[this.daySpanValues[a]+
"Span"],"pickDaySpanOnHover");this.repeatDialog.style.display="none"},hideRemind:function(){this.remindDialog.style.display="none"},getLeadTimeInMinutes:function(a){var b=0;switch(a){case "timeOfEvent":b=0;break;case "min15Before":b=15;break;case "min30Before":b=30;break;case "hour1Before":b=60;break;case "day1Before":b=1440;break;default:b=0}return b},calculateLeadTimeInMinutes:function(a,b,c){var e=0;switch(a){case "remindMinutes":b=Math.round(new Number(b));if(b=="NaN")return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;
e=b;break;case "remindHours":b=Math.round(new Number(b));if(b=="NaN")return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;e=b*this.getLeadTimeInMinutes("hour1Before");break;case "remindDays":b=Math.round(new Number(b));if(b=="NaN")return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;e=b*this.getLeadTimeInMinutes("day1Before");break;case "remindWeeks":b=Math.round(new Number(b));if(b=="NaN")return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;e=b*this.getLeadTimeInMinutes("day1Before")*
7;break;case "dayOfEvent":e=0;break;case "oneDayBefore":e=this._getLeadTime(ws.date.ParseHourMinTextField(b,this.timeFormat,this.timeFormatShort),1);break;case "twoDaysBefore":e=this._getLeadTime(ws.date.ParseHourMinTextField(b,this.timeFormat,this.timeFormatShort),2);break;case "oneWeekBefore":e=this._getLeadTime(ws.date.ParseHourMinTextField(b,this.timeFormat,this.timeFormatShort),7);break;case "onThisDate":a=ws.date.ParseDateFromFormat(this.remindAtEndInput.value,Config.Strings.CalDateParseFormat);
e=this._getLeadTime(ws.date.ParseHourMinTextField(b,this.timeFormat,this.timeFormatShort),a,c);break;default:e=0}return e},_getLeadTime:function(a,b,c){if(a==null)return Config.Strings.Calendar_AddEvent_InvalidTimeCustomRemind;else if(c&&typeof b=="object")return c=new Date(c.getFullYear(),c.getMonth(),c.getDate(),0,0,0,0),a=new Date(b.getFullYear(),b.getMonth(),b.getDate(),a.hr,a.min,0,0),a=c.getTime()-a.getTime(),a>0?Math.round(a/1E3/60):Config.Strings.Calendar_AddEvent_ReminderAfterEvent;else{var e=
new Date,c=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0),a=new Date(e.getFullYear(),e.getMonth(),e.getDate()-b,a.hr,a.min,0,0),a=c.getTime()-a.getTime();return Math.round(a/1E3/60)}},getReminderLeadTime:function(a){var b=null;switch(a){case 0:b=1;break;case 15:b=2;break;case 30:b=3;break;case 60:b=4;break;default:b=ws.string.substituteParams(Config.Strings.RemindBefore,a,Config.Strings.Minutes)}return b},summaryTextClick:function(){if(c.hasClass(this.summaryInput,"summaryInputNew"))this.summaryInput.value=
"",c.replaceClass(this.summaryInput,"summaryInput","summaryInputNew")},summaryKeyPress:function(){c.hasClass(this.summaryInput,"summaryInputNew")&&c.replaceClass(this.summaryInput,"summaryInput","summaryInputNew")},summaryTextBlur:function(){if(this.summaryInput.value=="")c.addClass(this.summaryInput,"summaryInputNew"),this.summaryInput.value=Config.Strings.AddEventName},_suiteOnKeyPress:function(a){this.isShowing()&&(Config.EnableKeyboardShortcuts&&a.ctrlKey?ws.html.fixKeyCodeForMac(a)==c.keys.ENTER&&
this.saveAndClose():a.keyChar&&c.isString(a.keyChar)&&a.keyChar.toLowerCase()==Config.Strings.KeyCancelAddContact&&a.altKey&&this.hide())}}));c._hasResource["ws.calendar.CalendarSelect"]||(c._hasResource["ws.calendar.CalendarSelect"]=!0,c.provide("ws.calendar.CalendarSelect"),c.declare("ws.calendar.CalendarSelect",ws.widget.DropDownLink,{model:null,menuDef:null,currentValue:null,listWritableCalendars:!0,css:{templateString:""},constructor:function(){this.model=null;this.menuDef=[];this.currentValue=
null;this.valueChanged=this.calendarSelected;this.setOption=this.setByIndex},postCreate:function(){c.addClass(this.domNode,"wsIcon")},onClick:function(){if(this.model.getCalendarList().length!=1)this.anchorPosition=c.query(".text",this.containerNode)[0],this.inherited(arguments)},setModel:function(a){this.model=a;this.menuDef=[];this.currentValue=null;this.buildList()},buildList:function(a){if(this.model!=null){this.menuDef=[];this.currentValue=null;var b,d,e,f,g,h,j,i,n,o;e=this.model.getCalendarList();
if(e.length!=0){d=this.model.calendarEnum;(!e||!d)&&this.menuDef.push({caption:"",enabled:!1,calid:""});for(var k=0,p=0;k<e.length;k++)b=e[k],this.listWritableCalendars&&b[d.writable]&&(f=b[d.id],g=b[d.calType],h=b[d.color],i=(j=b[d.subscribeURL])&&j.length>0,n=b[d.displayName],ws.string.escapeXml(n),b="wsCalCB_"+h.substring(1)+" checked",o="wsCalCB_"+h.substring(1)+"_c",b='<div class="calendarItem"><div class="wsCalCB '+b+'"></div><div class="text '+o+'"><span>'+n+"</span></div></div>",this.menuDef.push({caption:b,
onClick:c.hitch(this,"calendarMenuClick",p++),enabled:!0,calid:f,calType:g,subscribeUrl:j,isIcalSubcal:i,color:h}));e.length>1&&(f=c.query("img",this.contentNode)[0],c.removeClass(f,"btnArrowImg"),c.addClass(f,"wsArrow"),this.setMenuDefinition(this.menuDef),this.getMenu());if(a&&a.calid)for(k=0;k<e.length;k++){if(b=e[k],b[d.id]==a.calid){this.calendarMenuClick(k);break}}else this.calendarMenuClick(0)}}},calendarMenuClick:function(a){if(this.menuDef.length!=0){if(a>this.menuDef.length-1||this.menuDef.length==
0)a=0;this.setLabel(this.menuDef[a].caption);c.addClass(this.containerNode.firstChild,"calendarLabel");var b=c.query(".text",this.domNode)[0].firstChild;this.currentValue=this.menuDef[a].calid;b.style.color=ws.calendar.calutil.componentColorMapTxt[this.menuDef[a].color];this.model.getCalendarList().length==1?(c.query("img",this.contentNode)[0].style.display="none",c.addClass(c.query(".calendarItem",this.domNode)[0],"noDropDown")):(c.query("img",this.contentNode)[0].style.display="",c.removeClass(c.query(".calendarItem",
this.domNode)[0],"noDropDown"));this.calendarSelected(this.menuDef[a])}},getValue:function(){return this.currentValue},setValue:function(a){this.currentValue=typeof a=="object"&&a.calid?a.calid:a;for(a=0;a<this.menuDef.length;a++)if(this.menuDef[a].calid==this.currentValue){this.calendarMenuClick(a);break}},calendarSelected:function(){},setByIndex:function(a){this.calendarMenuClick(a)}}));c._hasResource["ws.pictures.PictureViewControl"]||(c._hasResource["ws.pictures.PictureViewControl"]=!0,c.provide("ws.pictures.PictureViewControl"),
c.declare("ws.pictures.PictureViewControl",null,{picturesModel:null,image:null,isAttachment:!1,folder:"",uid:"",constructor:function(a){c.mixin(this,a);c.query("*",this.domNode).forEach(function(a){var c=a.getAttribute("dojoAttachPoint");c&&(this[c]=a)},this);ws.lang.setTimeout(this,"positionSelf",0);this.isAttachment=c.hasClass(this.image,"AOLAttachedImage");Config.EnablePictures||(ws.html.setShowing(this.saveNode,!1),ws.html.setShowing(this.saveNodeSep,!1),ws.html.setShowing(this.savingNode,!1));
this.positionSelf()},positionSelf:function(){if(this.domNode)try{c.withDoc(this.domNode.ownerDocument,c.hitch(this,function(){var a=c._abs(this.image,!0),d=c.contentBox(this.image);this.domNode.style.left=a.x+"px";this.domNode.style.top=a.y+d.h+1+"px"}))}catch(a){}}}));c._hasResource["ws.mail.DisplayMessageWidget"]||(c._hasResource["ws.mail.DisplayMessageWidget"]=!0,c.provide("ws.mail.DisplayMessageWidget"),c.declare("ws.mail.DisplayMessageWidget",[i._Widget,i._Templated],{templateString:c.cache("ws.mail",
"DisplayMessageWidget.html",'<div style="display: none">\r\n\t<\!-- We start out with display:none to avoid a layout call at widget creation time. When the\r\n\t\t\t\t\t\t    PageContainer parent shows this widget, it will call show(). --\>\r\n\t<div dojotype="dijit.layout.LayoutContainer" class="displayMessage" dojoattachpoint="layoutWidget">\r\n\t\t<div layoutalign="top" dojotype="ws.widget.WSToolbar" dojoattachpoint="toolbar" viztype="Controls">\r\n\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: backToInbox" dojoattachpoint="backToMail" title="${BackToMail}" iconClassName="iconInbox" style="display: none">${BackToMail}</div>\r\n\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: reportNotSpam" dojoattachpoint="notSpamButton" iconClassName="notSpamIcon" title="${NotSpamButton}" style="display:none">${NotSpamButton}</div>\r\n\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: markUnread" dojoattachpoint="keepNewButton" iconClassName="keepNewIcon" style="display:none" tip="${KeepAsNewActionLabel}">${KeepAsNewActionLabel}</div>\r\n\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: reply, onMouseDown: saveSelection" iconClassName="replyIcon" title="${DisplayReply} (${KeyMailReply})" tip="${DisplayReply} <span>(${KeyMailReply})</span>">${DisplayReply}</div>\r\n\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: replyAll, onMouseDown: saveSelection" iconClassName="replyAllIcon" title="${DisplayReplyAll} (${KeyMailReplyAll})" tip="${DisplayReplyAll} <span>(${KeyMailReplyAll})</span>">${DisplayReplyAll}</div>\r\n\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: forward, onMouseDown: saveSelection" iconClassName="forwardIcon" title="${DisplayForward} (${KeyMailForward})" tip="${DisplayForward} <span>(${KeyMailForward})</span>">${DisplayForward}</div>\r\n\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: restartIM" iconClassName="iconIM" dojoattachpoint="restartIMButton" title="${DisplayIM}" style="display:none">${DisplayIM}</div>\r\n\t\t\t<div dojotype="ws.widget.DropDownButton" dojoattachpoint="actionButton" iconClassName="actionIcon" title="${ActionButtonTip}">${ActionButton}</div>\r\n\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: deleteMessage" iconClassName="delIcon" title="${DeleteButton} (${DeleteKey})" tip="${DeleteButton} <span>(${DeleteKey})</span>">${DeleteButton}</div>\r\n\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: restoreMessage" dojoattachpoint="restoreButton" iconClassName="wsIconButton" style="display:none" title="${RestoreButton}">${RestoreButton}</div>\r\n\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: reportSpam" dojoattachpoint="spamButton" iconClassName="spamIcon" title="${ReportSpamTooltip}" style="display:none">${ReportSpamButton}</div>\r\n\t\t\t<div toolbarposition="right" dojotype="ws.widget.Pane" style="white-space: nowrap">\r\n\t\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: nextMessage" dojoattachpoint="nextButtonNode" iconClassName="nextButton"></div>\r\n\t\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: prevMessage" dojoattachpoint="prevButtonNode" iconClassName="prevButton"></div>\r\n\t\t\t\t<div dojotype="ws.widget.Button" dojoattachevent="onClick: backToList" dojoattachpoint="backButton" iconClassName="cancelIcon"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojotype="ws.widget.Pane" class="messageArea" layoutalign="client" dojoattachpoint="messageArea">\r\n\t\t\t<div dojotype="ws.widget.Pane" class="searchInfo" dojoattachpoint="searchInfoPane" style="display: none">\r\n\t\t\t\t<div class="searchData">\r\n\t\t\t\t\t<div dojoattachpoint="searchInfoLink" dojoattachevent="onclick: backToList"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class="clrFlt"></div>\r\n\t\t\t<div dojoattachpoint="infoStrips"></div>\r\n\t\t\t<div class="header" dojoattachpoint="headerNode">\r\n\t\t\t\t<div class="main" dojoattachpoint="mainHeaderNode">\r\n\t\t\t\t\t<div class="headerLinksNode" dojoattachpoint="headerLinksNode">\r\n\t\t\t\t\t\t<img src="${spacer}" dojoattachevent="onclick: print,onmouseenter:showTip,onmouseleave:hideTip" dojoattachpoint="printLink" class="mainSprite printIcon">\r\n\t\t\t\t\t\t<span dojoattachpoint="addToLinksNode">\r\n\t\t\t\t\t\t\t<img src="${spacer}" dojoattachevent="onclick: addToCalendar, onmousedown: saveSelection,onmouseenter:showTip,onmouseleave:hideTip"  dojoattachpoint="createEventLink" class="mainSprite calendarIcon">\r\n\t\t\t\t\t\t\t<img src="${spacer}" dojoattachevent="onclick: addToTask, onmousedown: saveSelection,onmouseenter:showTip,onmouseleave:hideTip" dojoattachpoint="addToTaskLink" class="mainSprite toDoIcon">\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t<img src="${spacer}" class="mainSprite newWindowIcon" dojoattachevent="onclick: popOut,onmouseenter:showTip,onmouseleave:hideTip" dojoattachpoint="newWindowLink">\r\n\t\t\t\t\t\t<img src="${spacer}" class="mainSprite fullMessageIcon" dojoattachevent="onclick: showFullMessage,onmouseenter:showTip,onmouseleave:hideTip" dojoattachpoint="fullMessageLink" title="${FullMessage}">\r\n\t\t\t\t\t\t<div dojoattachpoint="fullDateNode" class="dateField">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div dojoattachpoint="subjectContainer" class="subjectContainer">\r\n\t\t\t\t\t\t<span dojoattachpoint="editDraft" style="display: none" class="wsLink editDraft" dojoattachevent="onclick: openDraft">${EditDraft}</span> <span class="subject" dojoattachpoint="subjectNode"></span>\r\n\t\t\t\t\t\t<img src="${spacer}" class="mainSprite flag" dojoattachpoint="flagIcon" dojoattachevent="onclick: toggleFlag">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div dojoattachpoint="shortHeaderContainer" class="shortHeader">\r\n\t\t\t\t\t\t<span dojoattachpoint="shortHeaderNode"></span><span dojoattachevent="onclick: showFullHeader"><span class="wsLink moreLessLink" title="${MoreInfoTip}">${showDetails}</span><img src="${spacer}" class="mainSprite moreLinkArrw"></span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<table dojoattachpoint="fullFromTable" class="fullFromTable" style="display: none">\r\n\t\t\t\t\t\t<tr dojoattachpoint="fromRow" class="fieldRow" style="display: none">\r\n\t\t\t\t\t\t\t<td class="label">\r\n\t\t\t\t\t\t\t\t${From}\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td dojoattachpoint="fullFromNode">\r\n\t\t\t\t\t\t\t\t<span dojoattachpoint="fullFromNode"></span><span dojoattachevent="onclick: showShortHeader"><span class="wsLink moreLessLink" title="${HideDetailsTip}">${hideDetails}</span><img src="${spacer}" class="mainSprite lessLinkArrw"></span>\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t<tr dojoattachpoint="toRow" class="fieldRow" style="display: none">\r\n\t\t\t\t\t\t\t<td class="label">\r\n\t\t\t\t\t\t\t\t${To}\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td dojoattachpoint="fullToNode">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t<tr dojoattachpoint="ccRow" class="fieldRow" style="display: none">\r\n\t\t\t\t\t\t\t<td class="label">\r\n\t\t\t\t\t\t\t\t${Cc}\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td dojoattachpoint="fullCcNode">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t<tr dojoattachpoint="bccRow" class="fieldRow" style="display: none">\r\n\t\t\t\t\t\t\t<td class="label">\r\n\t\t\t\t\t\t\t\t${Bcc}\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td dojoattachpoint="fullBccNode">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoattachpoint="attachmentsRow" class="attachmentsRow" style="display: none">\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div dojotype="ws.widget.Pane" layoutalign="client" class="iframeContainer" dojoattachpoint="bodyPane">\r\n\t\t\t\t<iframe name="bodyFrame" dojoattachpoint="bodyFrame" class="msgBody" src="about:blank" frameborder="no" scrolling="no"></iframe>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojotype="ws.widget.Pane" layoutalign="client" class="bodyPrompt" style="display: none" dojoattachpoint="bodyPromptPane">\r\n\t\t</div>\r\n\t\t<div dojotype="ws.widget.Pane" dojoattachpoint="bottomPane" layoutalign="bottom">\r\n\t\t\t<div dojoattachpoint="adsPane" class="ads" style="display: none">\r\n\t\t\t\t<div dojotype="ws.widget.Advertisement" adtype="displaymessagetext" dojoattachpoint="displayMessageAd">\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,model:null,picturesModel:null,msgInfo:null,addEditDialog:null,calendarModel:null,extraBodyHtml:"<style>.AOLWebSuite .AOLPicturesFullSizeLink { height: 1px; width: 1px; overflow: hidden; } .AOLWebSuite a {color:blue; text-decoration: underline; cursor: pointer} .AOLWebSuite a.hsSig {cursor: default} .AOLWebSuiteM1 {margin: 10px 20px;} .AOLWebSuiteM2 {margin: 5px;} .AOLWebSuiteM3 {margin: 10px;} .dmItemSelected {padding: 2px !important;text-decoration: none !important;color:#fff !important;background-color: #656565 !important;border-radius: 2px;}</style>",
microFormatStyles:"<link rel='stylesheet' type='text/css' href='"+Config.BaseCssURL+"microformat.css'/>",pictureViewControls:[],showNewWindowLink:!0,showFullMessageLink:!1,showSearchItems:!0,showToolbar:!0,beaconSuffix:"",isPopup:!1,isPreviewPane:!1,enableNextPrev:!0,enableKeyboardShortcuts:!0,enableFilters:!0,enableAddressActionMenu:!0,hideFeedbackDelay:7E3,enableBackToMail:!1,isStandAlone:!1,undoFeedbackCB:null,msgMarkedUp:!1,imagesRemoved:!1,linksRemoved:!1,kidTeenAccount:ws.UserContext.ParentalControls==
"Y"||ws.UserContext.ParentalControls=="K",lastDispMsgTime:0,previewPaneUidBucket:{},addrMap:{},presenceCount:0,_handlers:[],startup:function(){this.addressModel=new ws.address.AddressModel({fetchDataOnInit:!0,sortable:!0});this.DLreport=this.isPopup&&_ws_isOpenerWS()?opener.ws.reporting.DL:ws.reporting.DL;this.actionButton.menu=this.actionMenu;this.showToolbar?this.connect(this.toolbar,"wrap","wrapToolbar"):this.toolbar.hide();this.updateToolbarState();var a=this.showNewWindowLink&&ws.settings.allowPopups();
ws.html.setShowing(this.newWindowLink,a);ws.html.setShowing(this.fullMessageLink,this.showFullMessageLink);this.defineActionMenu();this.connect(this.actionButton,"updateMenu","updateActionMenu");this.backToMail.setShowing(this.enableBackToMail);this.restartIMButton.setShowing(!this.isStandAlone&&Settings.EnableAIMPanel);c.subscribe("Suite/onKeyOnPress",this,"_suiteOnKeyPress");c.subscribe("MessageList/flagMessage",this,"onMsgListFlagMessage");c.isIE&&this.isPreviewPane&&(c.subscribe("SplitContainer/BeginSizing",
c.hitch(this,"addSizingHandlers")),c.subscribe("SplitContainer/EndSizing",c.hitch(this,"removeSizingHandlers")));if(Settings.DisplayMessageTextAdMagic!="0"&&!this.isPreviewPane)this.adsPane.style.display="";if(!Config.PrintingSupported)this.printLink.style.display="none";a=this.isPreviewPane?"":" <span>("+Config.Strings.KeyMailPrint+")</span>";this.printLink.setAttribute("title",Config.Strings.PrintMessage+a);a=this.isPreviewPane?"":" <span>("+Config.Strings.KeyMailAddToCalendar+")</span>";this.createEventLink.setAttribute("title",
Config.Strings.CreateEvent+a);a=this.isPreviewPane?"":" <span>("+Config.Strings.KeyMailAddToToDo+")</span>";this.addToTaskLink.setAttribute("title",Config.Strings.CreateTodo+a);a=this.isPreviewPane?"":" <span>("+Config.Strings.KeyMailPopout+")</span>";this.newWindowLink.setAttribute("title",Config.Strings.NewWindowTip+a);this.nextButtonNode.setTip(Config.Strings.NextMessage+" <span>("+Config.Strings.KeyMailNext+")</span>");this.prevButtonNode.setTip(Config.Strings.PreviousMessage+" <span>("+Config.Strings.KeyMailPrevious+
")</span>");this.backButton.setTip(Config.Strings.MessageCloseTip+" <span>("+Config.Strings.KeyMailClose+")</span>");!this.isPopup&&!this.isStandAlone?(ws.WebSuite.SidePanel.setupAdScroll(this.messageArea.domNode,"read"),ws.WebSuite.SidePanel.setupAdScroll(this.bodyPromptPane.domNode,"preview")):c.addClass(this.domNode,"popupWin");this.connect(this.messageArea.domNode,"onscroll","onBodyScroll")},onBodyScroll:function(){(!this.isPreviewPane||this.isPopup||this.isStandAlone)&&ws.WebSuite.Navigation.showMnSearch(this.messageArea.domNode.scrollTop==
0);this.clearOpenMenus();if(c.isIE&&this.mouseDownOnBody){var a=window.event,b=c.coords(this.messageArea.domNode);b.h>25&&(a.y>b.h-25?this.messageArea.domNode.scrollTop+=5:a.y<8&&(this.messageArea.domNode.scrollTop-=5))}},postCreate:function(){this.isPreviewPane&&this.displayMessageAd&&this.displayMessageAd.block(!0)},setModel:function(a){this.model=a;if(this.statusDialog)this.statusDialog.model=a},setPicturesModel:function(a){this.picturesModel=a;c.forEach(this.pictureViewControls,function(b){b.picturesModel=
a})},onHide:function(){this.hidePopups();this.displayMessageAd&&this.displayMessageAd.block(!0);if(this.updateBtnsTimer)window.clearInterval(this.updateBtnsTimer),this.updateBtnsTimer=null},hidePopups:function(){this.addToTaskCard&&this.addToTaskCard.closeCard()},constructUID:function(a,b){return b!=null&&b.indexOf(".")==-1&&!Config.UseOMS?a!=null?a+"."+b:"1."+b:b},scheduleDisplayMessage:function(a,b){this.folder=a;this.uid=b;this.scheduleDisplayMessageHandle=this.connect(this.model,"modelUpdated",
"_scheduleDisplayMessage")},_scheduleDisplayMessage:function(){this.disconnect(this.scheduleDisplayMessageHandle);this.model.folders.length==0?this.scheduleDisplayMessageHandle=this.connect(this.model,"folderListChanged","_scheduleDisplayMessage"):this.displayMessage()},displayMessage:function(a,b,d,e,f){var a=a||this.folder,b=b||this.uid,g=(new Date).getTime(),h=g-this.lastDispMsgTime;if(!(this.lastFolder==a&&this.lastUid==b&&h<400)){ws.WebSuite.setLastReadMsg(a,b);this.readReportDone=!1;var j=b;
this.DLreport.hasEvent(b)||(h=this.model.getUidData(b),j=this.DLreport.startEvent(h!=null&&h[this.model.columns.Attachment]?"read_mail_att":"read_mail",b,{opData:b,op1:this.isPopup?"popup":this.isPreviewPane?"preview":"inline"}),this.model.trackdl("-DMW.DMa",b));if(ws.bubbleConfig.isShowable("DM_OPENED_BUBBLE")&&!this.isPopup&&!this.isStandAlone&&ws.bubbleConfig.pinBubblesEnabled&&ws.widget.bubbleManager&&(h=ws.widget.bubbleManager.getPinByName("MiniNavNub"))&&h.isShowing()&&h.pinned)ws.bubbleConfig.saveAsSeen("DM_OPENED_BUBBLE"),
h.expandTip();var i="";this.lastDispMsgTime=g;a=="Drafts"?(ws.html.setShowing(this.addToLinksNode,!1),ws.html.setShowing(this.editDraft,!0)):(ws.html.setShowing(this.addToLinksNode,!0),ws.html.setShowing(this.editDraft,!1));this.lastFolder=a;this.lastUid=b;g=this.model.screenName;this.folder=a;this.uid=b;this.recipSNs=[];if(g==ws.UserContext.ActiveScreenName)if(!Settings.ViewNewOld&&(this.folder=="NewMail"||this.folder=="OldMail"))this.folder="Inbox";else if(Settings.ViewNewOld&&this.folder=="Inbox")this.folder=
"NewMail";c.publish("WSFeedbackStart",[Config.Strings.MessageLoading]);this.model.trackdl("-DMW.DMb",this.uid);this.headerNode.style.visibility="hidden";this.bodyFrame.style.visibility="hidden";this.fullHeaderState=Settings.DisplayFullHeader;this.savedScrollLeft=this.savedScrollTop=0;if(!this.updateBtnsTimer)this.updateBtnsTimer=window.setInterval(c.hitch(this,"updateNextPrevButtons"),2E3);this.model.getMessage({folder:this.folder,uid:this.uid,screenName:g,peek:e,isPreviewPane:f,load:c.hitch(this,
function(a){this.model.trackdl("-DMW.DMc",this.uid);this.previewPaneUidBucket[b]&&delete this.previewPaneUidBucket[b];var e=!1;Config.UseOMS&&a.folderType=="Drafts"&&this.folder!="Drafts"&&(this.model.trackdl("-DMW.DMf",this.uid),this.getComposeCB(c.hitch(this,function(a){this.setToolbarEnabled(!0);a.openDraft("Drafts",this.uid)})),e=!0,this.model.trackdl("-DMW.DMg",this.uid));if(!e){this.model.trackdl("-DMW.DMh",this.uid);this.messageReceived(this.uid,a);if(a!=null&&a.body!=null)i=a.body.length;
(this.msgInfo.isOfficialMail||this.msgInfo.isCertifiedMail||this.msgInfo.isVoicemail)&&ws.html.setShowing(this.addToLinksNode,!1)}c.publish("WSFeedbackEnd",[Config.Strings.MessageLoading]);this.model.trackdl("-DMW.DMi",this.uid);e||d&&d(b);this.model.trackdl("-DMW.DMe",this.uid);this.DLreport.endEvent(j,{opResult:"success",msgSize:i})}),error:c.hitch(this,function(a,d,e){this.model.trackdl("-DMW.DMd",this.uid);this.DLreport.endEvent(j,{opResult:"fail",errType:"api",errCode:e||a,sessionID:Settings.SessionID});
c.publish("WSFeedbackEnd",[Config.Strings.MessageLoading]);this.previewPaneUidBucket[b]?delete this.previewPaneUidBucket[b]:(window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.getMessage-displayMessage file:DisplayMessageWidget.js"),ws.widget.Dialogs.ok(a||Config.Strings.ErrorLoadingMessage,this.isPreviewPane?c.hitch(this,function(){this.messageArea.hide();this.bodyPromptPane.show();this.layoutWidget.resize()}):c.hitch(this,"backToList")))})})}},
messageReceived:function(a,b){if(a==this.uid){for(;this._handlers.length>0;)try{c.disconnect(this._handlers.pop())}catch(d){}this.hidePopups();this.messageArea.domNode.scrollTop=0;this.messageArea.domNode.scrollLeft=0;this.startSizeFrameToContent(!0);this.msgInfo=ws.lang.shallowCopy(b,!0);this.msgInfo==null&&this.model.trackdl("-DMW.MRn",a);this.foldersCanMoveTo=ws.lang.shallowCopy(this.model.getFoldersCanMoveTo());this.headerNode.style.visibility="inherit";this.messageArea.domNode.scrollTop=0;this.messageArea.domNode.scrollLeft=
0;this.msgBodyLoaded=!1;if(this.sizeFrameToContentTimeout)window.clearTimeout(this.sizeFrameToContentTimeout),this.sizeFrameToContentTimeout=null;if(c.isWebKit&&this.bodyFrame&&this.bodyFrame.contentWindow)try{this.bodyFrame.contentWindow.stop()}catch(e){}this.bodyPromptPane.hide();this.messageArea.show();this.addrMap={};this.presenceCount=0;this.fromMe=ws.UserContext.UserAddress==this.msgInfo.from[0].userInputForm;this.imagesRemoved=this.linksRemoved=!1;this.setupShortHeader();this.setupFullHeader();
this.getPresence();this.setFullHeader(this.fullHeaderState);if(!this.msgInfo.subject)this.msgInfo.subject="";this.model.trackdl("-DMW.MRp",a);try{this.model.getSearchString()&&Config.HighlightSeachTermInMessageRead?(subject=this.markupSearchString(this.msgInfo.subject),this.subjectNode.innerHTML=subject||Config.Strings.NoSubject):ws.html.setInnerText(this.subjectNode,this.msgInfo.subject||Config.Strings.NoSubject)}catch(f){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,f.message?f.message:
"*","DisplayMessageWidget.js: exception Msg Headers innerHTML")}c.toggleClass(this.flagIcon,"flagged",!!this.msgInfo.isFlagged);this.checkForLinksAndImageBlock(!0);this.updateInfoStrips();this.updateAttachments();this.bodyWritten=!1;this.writeBody();this.isPreviewPane||this.updateSearchInfo();this.setToolbarEnabled(!0);c.isIE==7?setTimeout(c.hitch(this,function(){this.updateToolbarState();this.toolbar.layout()}),50):this.updateToolbarState();this.layout()}},onMouseUp:function(){if(c.isIE&&(this.mouseDownOnBody=
!1,this.isPreviewPane)){var a=i.byId("messageList");a&&a.splitContainer&&this._sizingCtor&&a.splitContainer.endSizing()}},onMouseDown:function(){if(c.isIE)this.mouseDownOnBody=!0},addSizingHandlers:function(){document.onselectstart=function(){return!1};var a=c.io.iframe.doc(this.bodyFrame);a.onselectstart=function(){return!1};this._sizingCtor=c.connect(a.body,"onmousemove",c.hitch(this,"onMouseMove"))},removeSizingHandlers:function(){c.disconnect(this._sizingCtor);this._sizingCtor=null;c.io.iframe.doc(this.bodyFrame).onselectstart=
null;document.onselectstart=null},onMouseMove:function(a){var b=i.byId("messageList");if(b&&b.splitContainer){var d=c.position(this.bodyFrame);b.splitContainer.changeSizing(null,a.pageX+d.x,a.pageY+d.y)}},selectionChanged:function(){},writeBody:function(){if(this.msgInfo&&this.domNode.style.display!="none"&&!this.bodyWritten){this.bodyWritten=!0;var a=this.msgInfo.body;if(this.folder=="Drafts"&&!Settings.UseRichEditor)a=this.msgInfo.richBody;var b=a.search(/<div class=.hChat/i)!=-1,a=a.replace(/(<body.*>)/i,
"$1"+this.extraBodyHtml+(b?this.microFormatStyles:"")),b=a.indexOf("<body");b!=-1?a=a.substring(0,b+5)+" onmouseup=\"parent.dijit.byId('"+this.id+"').onMouseUp()\""+(!c.isIE?" onload=\"parent.dijit.byId('"+this.id+"').onBodyLoaded()\" ":" onmousedown=\"parent.dijit.byId('"+this.id+"').onMouseDown()\"")+a.substring(b+5):c.isIE||setTimeout(c.hitch(this,this.onBodyLoaded),500);ws.widget.popup.unregisterWin(this.bodyFrame.contentWindow);this.bodyFrame=ws.html.rewriteIframe(this.bodyFrame,a,"dispMsg");
c.isIE&&this.watchForBodyLoaded();if(c.isWebKit)c.io.iframe.doc(this.bodyFrame).body.scrollTop=0;if(!this.readReportDone){this.readReportDone=!0;a=0;b=!1;Settings.PreviewPaneVisible&&Settings.PreviewPaneVisible&&!Settings.ReadInPopup&&(a=1E3,b=!0);var d="Read Message - "+this.beaconSuffix;ws.lang.setTimeout(this,c.hitch(this,function(a,b,c){b=ws.WebSuite.getCurrentViewId();(!this.skipPreviewReporting||!c||!(b=="displayMessage"||b=="composeMessage"))&&ws.reporting.report(a,"Mail")}),a,d,this.skipPreviewReporting,
b)}}},onShow:function(){this.inherited(arguments);this.domNode.style.display="";this.writeBody();this.displayMessageAd&&!this.isPreviewPane&&this.displayMessageAd.block(!1);this.model.getSearchString()&&ws.WebSuite.Navigation.showMnSearch(!0)},marginClasses:["AOLWebSuiteM2","AOLWebSuiteM2","AOLWebSuiteM3","AOLWebSuiteM1"],updateMargins:function(){var a;if((a=c.isIE?this.bodyFrame.contentWindow.document:c.io.iframe.doc(this.bodyFrame))&&a.body)a.body.className="AOLWebSuite "+this.marginClasses[ws.WebSuite.widthMode-
1]},watchForBodyLoaded:function(){if(c.io.iframe.doc(this.bodyFrame).readyState=="complete")this.onBodyLoaded();else ws.lang.setTimeout(this,"watchForBodyLoaded",100)},onBodyLoaded:function(){ws.widget.popup.registerWin(this.bodyFrame.contentWindow);this.initializeImages();var a=c.io.iframe.doc(this.bodyFrame),b=null;a&&(b=c.query("table[height='100%']",a.body));if(b)for(var d=0;d<b.length;d++)b[d].removeAttribute("height");c.isIE<=7?this._handlers.push(c.connect(this.bodyFrame.contentWindow.document.body,
"onclick",c.hitch(this,"onMailBodyClick",this.bodyFrame.contentWindow.document))):this._handlers.push(c.connect(a,"onclick",c.hitch(this,"onMailBodyClick",a)));c.isIE||c.isWebKit?this._handlers.push(c.connect(a.body,"onkeypress",c.hitch(this,function(a){this.enableKeyboardShortcuts=!0;this._suiteOnKeyPress(a);this.enableKeyboardShortcuts=!1}))):this._handlers.push(c.connect(a,"onkeypress",c.hitch(this,function(a){this.enableKeyboardShortcuts=!0;this._suiteOnKeyPress(a);this.enableKeyboardShortcuts=
!1})));this.enableNextPrev&&Config.EnableClientSideMessagePrefetch&&ws.lang.setTimeout(this,"_prefetchAdjacentMessages",2E3);this.msgBodyLoaded=!0;this.endSizeFrameToContent()},startSizeFrameToContent:function(a){if(this.isShowing()){this.msgDocWidth=this.msgDocHeight=null;var b=c.contentBox(document.getElementById(this.isPopup||this.isStandAlone?"notebook":"ws_view")).w;if(!ws.WebSuite.scrollbarWidth)ws.WebSuite.scrollbarWidth=ws.html.getScrollbar().w;var d=ws.WebSuite.scrollbarWidth;this.bodyFrame.style.width=
Math.max(b,d)-d+"px";this.bodyFrame.style.height="30px";this.sizeFrameToContentRetryCnt=0;a&&setTimeout(c.hitch(this,this.endSizeFrameToContent),5)}},endSizeFrameToContent:function(){if(this.domNode&&this.domNode.style.display!="none"){var a=!0;if(c.isIE){var b=this.bodyFrame.contentWindow.document.body.scrollWidth;b<=0?a=!1:(this.msgDocHeight=this.bodyFrame.contentWindow.document.body.scrollHeight,this.msgDocWidth=b)}else b=c.io.iframe.doc(this.bodyFrame),this.msgDocHeight=b.body.scrollHeight,this.msgDocWidth=
b.body.scrollWidth;if(a&&(this.bodyFrame.style.height=this.msgDocHeight+"px",this.bodyFrame.style.width=this.msgDocWidth+"px",this.bodyFrame.style.visibility="inherit",this.messageArea.domNode.style.overflow="auto",this.updateMargins(),!this.isPreviewPane&&this.sizeFrameToContentRetryCnt==0))try{if(this.bodyFrame.contentWindow.document.body.tabIndex="-1",this.bodyFrame.contentWindow.document.body.focus(),c.isWebKit){var d=c.byId("ws_application");if(d)d.scrollTop=0,d.scrollLeft=0;document.body.scrollTop=
0;document.body.scrollLeft=0;this.messageArea.domNode.scrollTop=0;this.messageArea.domNode.scrollLeft=0}}catch(e){}if((!this.msgBodyLoaded||!a)&&this.sizeFrameToContentRetryCnt<10)this.sizeFrameToContentRetryCnt++,a=Math.pow(this.sizeFrameToContentRetryCnt,3)*20,this.sizeFrameToContentTimeout=setTimeout(c.hitch(this,this.endSizeFrameToContent),a);else if(this.savedScrollTop)this.messageArea.domNode.scrollTop=Math.abs(this.savedScrollTop),this.messageArea.domNode.scrollLeft=this.savedScrollLeft,this.savedScrollTop>
0?this.savedScrollTop=-this.savedScrollTop:this.savedScrollLeft=this.savedScrollTop=0}},_prefetchAdjacentMessages:function(){this.model.prefetchAdjacentMessages(this.msgInfo.uid)},showBodyPrompt:function(a){this.bodyPromptPane.domNode.innerHTML=a;this.messageArea.hide();this.bodyPromptPane.show();this.domNode.style.display!="none"?this.layoutWidget.resize():this.height=this.width=0},onResized:function(){if(this.isShowing())this.inherited(arguments),this.updateMargins(),this.layout(),this.sizeFrameToContentTimer&&
clearTimeout(this.sizeFrameToContentTimer),this.messageArea.domNode.style.overflow="hidden",this.sizeFrameToContentTimer=setTimeout(c.hitch(this,this.startSizeFrameToContent,!0),300),c.forEach(this.pictureViewControls,function(a){a.positionSelf()})},layout:function(){this.isShowing()?(this.layoutWidget.resize(),this.toolbar.layout()):this.height=this.width=0},popoutLayout:function(){if(this.layoutWidget._contentBox.h<c._getMarginSize(this.toolbar.domNode).h+c._getMarginSize(this.messageArea.domNode).h)this.onResized()},
updateToolbarState:function(){if(this.model){var a=this.model.getFolderByName(this.folder);if(a){var b=a.name.toLowerCase();this.buttonViz=c.map((b in Config.FolderButtons?Config.FolderButtons[b]:Config.FolderButtons.other).split(","),function(a){return c.trim(a)=="true"});if(this.msgInfo)this.msgInfo.containsHchat=this.msgInfo.body.search(/<div class=.hChat/i)!=-1;this.isStandAlone||this.restartIMButton.setShowing(this.msgInfo.containsHchat&&Settings.EnableAIMPanel);this.spamButton.setShowing(this.buttonViz[4]&&
Config.EnableSpamButton);this.notSpamButton.setShowing(this.buttonViz[5]&&Config.EnableSpamButton);this.restoreButton.setShowing(this.buttonViz[8]||a.type=="Deleted"&&Settings.ViewNewOld);this.keepNewButton.setShowing(this.buttonViz[12]&&Settings.ViewNewOld);this.updateNextPrevButtons()}}},updateNextPrevButtons:function(){if(this.updateBtnsTimer&&(!this.domNode||this.domNode.style.display=="none"))window.clearInterval(this.updateBtnsTimer),this.updateBtnsTimer=null;var a=this.model&&this.model.activeCachedList&&
this.msgInfo&&this.enableNextPrev;this.nextButtonNode&&this.nextButtonNode.domNode&&c.toggleClass(this.nextButtonNode.domNode,"btnDisabled",!a||this.model.getAdjacentMessageUid(this.msgInfo.uid,1)==null);this.prevButtonNode&&this.prevButtonNode.domNode&&c.toggleClass(this.prevButtonNode.domNode,"btnDisabled",!a||this.model.getAdjacentMessageUid(this.msgInfo.uid,-1)==null)},setToolbarEnabled:function(a){c.forEach(this.toolbar.getChildren(),function(b){b.enable&&b.setEnabled(a)});c.addClass(this.nextButtonNode.domNode,
"btnDisabled");c.addClass(this.prevButtonNode.domNode,"btnDisabled")},updateSearchInfo:function(){var a=this.searchInfoPane.domNode;this.model.getSearchString()?(this.searchInfoLink.innerHTML=Config.UseOMS&&Config.CrossFolderSearch?"<span class='mainSprite wsArrowLeft'></span> "+this.model.getDisplayableSearchHeaderStr(!0):"<span class='mainSprite wsArrowLeft'></span> "+this.model.getDisplayableSearchHeaderStr(),a.style.display="block",ws.WebSuite.Navigation&&!this.isPopup&&ws.WebSuite.Navigation.searchActive(!0,
this.searchInfoPane)):(a.style.display="none",ws.WebSuite.Navigation&&!this.isPopup&&ws.WebSuite.Navigation.searchActive(!1,this.searchInfoPane))},showFullHeader:function(){this.fullHeaderState=!0;this.setFullHeader(this.fullHeaderState);this.layout()},showShortHeader:function(){this.fullHeaderState=!1;this.setFullHeader(this.fullHeaderState);this.layout()},setFullHeader:function(a){c.toggleClass(this.subjectContainer,"subjectShort",!a);ws.html.setShowing(this.shortHeaderContainer,!a);this.fullDateNode.innerHTML=
a?ws.date.formatDateTime(new Date(this.msgInfo.receivedTime),Config.Strings.MsgViewDateFormat):"<span class='time' title='"+ws.date.formatDateTime(new Date(this.msgInfo.receivedTime),Config.Strings.MsgViewDateFormat)+"'>"+ws.date.timeAgo(this.msgInfo.receivedTime)+"</span>";ws.html.setShowing(this.hideLink,a);ws.html.setShowing(this.fullFromTable,a);ws.html.setShowing(this.fromRow,a);ws.html.setShowing(this.toRow,a&&this.msgInfo.displayTo);ws.html.setShowing(this.ccRow,a&&this.msgInfo.displayCc);
ws.html.setShowing(this.bccRow,a&&this.msgInfo.displayBcc)},createHdrAddress:function(a,b,d,e,f){var g=document.createElement("span");c.addClass(g,"addressItem");if(Settings.EnableAIMPanel&&Settings.ShowPresenceIcon&&this.presenceCount<Config.ReadMsgPresCap){this.presenceCount++;var h=document.createElement("img");h.src=Config.SpacerImageURL;c.addClass(h,"presIconEmpty");var j=ws.presence.getScreenNameForAddress(a)||a;this.addrMap[j]||(this.addrMap[j]=[]);this.addrMap[j].push(h);g.appendChild(h)}h=
document.createElement("span");if(this.enableAddressActionMenu)h.onclick=c.hitch(this,this.onAddressSelect,a,h);c.addClass(h,"address wsItem");ws.html.addHoverClass(h,"wsItemHover");a=document.createElement("span");a.innerHTML=b;c.addClass(a,"addressDispForm");h.appendChild(a);e&&(h.appendChild(document.createTextNode(" ")),document.createElement("span"),f&&(d+=","),h.appendChild(document.createTextNode(d)));g.appendChild(h);return g},getPresence:function(){var a=[];this.aimStates=null;for(var b in this.addrMap)a.push(b);
a={users:a,load:c.hitch(this,function(a){if(a&&a.response&&a.response.statusCode&&a.response.statusCode==200&&a.response.data&&a.response.data.users&&a.response.data.users.length){this.aimStates=a.response.data.users;for(var b=0;b<a.response.data.users.length;b++){var f=a.response.data.users[b];if(this.addrMap[f.aimId])for(var g=this.addrMap[f.aimId],h=0;h<g.length;h++)if(this.updateUserPresence(g[h],f.state))g[h].onclick=c.hitch(this,this.launchIM,f.aimId,!1,!0),g[h].style.cursor="pointer"}}}),timeout:1E3};
ws.presence.getPresence(a)},launchIM:function(a,b,c){try{ws.presence.launchIM(a,!0,b)}catch(e){}c&&ws.reporting.reportAction("Presence Icon")},handleAddContact:function(){this.addContactCard?this.addContactCard.reset():(this.addContactCard=new ws.address.PeoplePanelAddContactCard({addressModel:this.addressModel,isPopup:this.isPopup}),this.addContactCard.startup());this.currentScreenNameOrEmail?this.addContactCard.setData(null,null,this.currentScreenNameOrEmail,null,null):this.addContactCard.reset();
var a=c._abs(this.currentAddressItemNode);this.addContactCard.open({x:a.x,y:a.y});this.addContactCard.popupNode.style.zIndex="998"},handleViewContact:function(){this.currentContact&&(this.isPopup&&_ws_isOpenerWS()?opener.ws.WebSuite.showContactDetails(this.currentContact):ws.WebSuite.showContactDetails(this.currentContact))},onAddressSelect:function(a,b){c.addClass(b,"itemSelected");this.openAddrActionMenu(a,b)},getContactInfo:function(a){var b=this.addressModel.getRecordByEmail(a);!b&&a.indexOf("@")==
-1&&(b=this.addressModel.getRecordByScreenName(a));return{contact:b,snOrEmail:b&&b.screenName?b.screenName:a}},openAddrActionMenu:function(a,b){if(!this.addrActionMenu){var d=[];d.push({emailItem:!0,caption:Config.Strings.AddrAction_Email,iconClass:"mainSprite AddrActionMenuIcon AddrEmail",onClick:c.hitch(this,function(){ws.WebSuite.getCompose(null,c.hitch(this,function(a){a.reset({to:this.currentScreenNameOrEmail||"",backToString:"setFolder"})}))})});Settings.EnableAIMPanel&&(d.push({chatItem:!0,
caption:Config.Strings.AddrAction_Chat,iconClass:"mainSprite AddrActionMenuIcon AddrChat",disabled:f,onClick:c.hitch(this,function(){this.launchIM(this.currentScreenNameOrEmail,!1,!1)})}),Settings.ShowMobileIcon&&d.push({caption:Config.Strings.AddrAction_Text,iconClass:"mainSprite AddrActionMenuIcon AddrText",onClick:c.hitch(this,function(){this.launchIM(this.currentScreenNameOrEmail,!0,!1)})}));d.push({addItem:!0,caption:Config.Strings.AddrAction_Add,iconClass:"mainSprite AddrActionMenuIcon AddrAdd",
onClick:c.hitch(this,function(){this.handleAddContact()})});d.push({viewItem:!0,caption:Config.Strings.AddrAction_Veiw,iconClass:"mainSprite AddrActionMenuIcon AddrView",onClick:c.hitch(this,function(){this.handleViewContact()})});this.addrActionMenu=ws.widget.createMenu(d);this.connect(this.addrActionMenu,"onClose","clearAddrActionMenu")}var e=this.getContactInfo(a);this.currentScreenNameOrEmail=e.snOrEmail;this.currentContact=e.contact;this.currentAddressItemNode=b;var f=!0,d=ws.presence.getScreenNameForAddress(a)||
a;if(this.aimStates&&this.aimStates.length)for(var g=0;g<this.aimStates.length;g++)if(d==this.aimStates[g].aimId){f=this.aimStates[g].state=="offline";break}for(var d=e.contact?"none":"",e=e.contact?"":"none",g=this.addrActionMenu.getChildren(),h=0;h<g.length;h++){if(g[h].chatItem)g[h].disabled=f,g[h].updateDisabled();if(g[h].addItem)g[h].domNode.style.display=d;if(g[h].viewItem)g[h].domNode.style.display=e}this.addrActionMenu.bindDomNode(b,null,!0);this.addrActionMenu.openMyself()},clearAddrActionMenu:function(){try{c.removeClass(this.addrActionMenu.boundNode,
"itemSelected")}catch(a){}},updateUserPresence:function(a,b){var c=!1,e="presIconEmpty";switch(b){case "online":case "idle":case "invisible":case "away":case "mobile":e="mainSprite presIcon status-"+b,c=!0}a.className=e;return c},addFullDisplayAddress:function(a,b){if(!a)return"";b.innerHTML="";for(var c=0;c<a.length;c++){var e=a[c].userInputForm.replace("@unknown.domain",""),f=ws.string.escapeXml(e),g=ws.string.escapeXml(a[c].shorterDisplayForm),h=c<a.length-1,e=this.createHdrAddress(e,g,f,!0,h);
b.appendChild(e);h&&b.appendChild(document.createTextNode(" "))}return""},setupFullHeader:function(){this.addFullDisplayAddress(this.msgInfo.from,this.fullFromNode);this.addFullDisplayAddress(this.msgInfo.to,this.fullToNode);this.addFullDisplayAddress(this.msgInfo.cc,this.fullCcNode);this.addFullDisplayAddress(this.msgInfo.bcc,this.fullBccNode)},setupShortHeader:function(){if(this.msgInfo){var a=ws.string.substituteParams(Config.Strings.FromSomeoneTo,"")+" ";this.shortHeaderNode.innerHTML="";var b=
this.msgInfo.from[0].userInputForm.replace("@unknown.domain",""),c=ws.string.escapeXml(this.msgInfo.from[0].shorterDisplayForm);this.model.getSearchString()&&Config.HighlightSeachTermInMessageRead&&(c=this.markupSearchString(c));b=this.createHdrAddress(b,c,null,!1,!1);this.shortHeaderNode.appendChild(b);var e,b=Config.Strings.ToYou;if(this.folder=="Drafts"||this.folder=="Sent")if(this.shortHeaderNode.appendChild(document.createTextNode(a)),this.msgInfo.to.length){if(b=this.msgInfo.to[0].userInputForm,
a=[["",b]],e=this.findMoreCount(a),c=ws.string.escapeXml(this.msgInfo.to[0].shorterDisplayForm),b=this.createHdrAddress(b,c,null,!1,!1),this.shortHeaderNode.appendChild(b),e)a=" "+ws.string.substituteParams(Config.Strings.plusMore,e),b=document.createElement("span"),b.innerHTML=a,this.shortHeaderNode.appendChild(b)}else this.shortHeaderNode.appendChild(document.createTextNode(Config.Strings.None));else if(c=ws.UserContext.UserAddress,e=this.isBCCorDistro(),e.isDistro){if(this.shortHeaderNode.appendChild(document.createTextNode(a)),
b=this.msgInfo.distroListId,a=[["",b]],e=this.findMoreCount(a),a=b.indexOf("@"),c=a!=-1?b.substr(0,a):b,b=this.createHdrAddress(b,c,null,!1,!1),this.shortHeaderNode.appendChild(b),e)b=document.createElement("span"),b.innerHTML=" "+ws.string.substituteParams(Config.Strings.plusMore,e),this.shortHeaderNode.appendChild(b)}else e.isBCC&&(b+=" ("+Config.Strings.Bcc+")"),e=this.findMoreCount(this.model.sendAddresses),c=(Settings.HasAggregatedAccount?ws.string.substituteParams("<span class='recipIcon iconS%{0}' title='%{1}'></span>",
this.model.getAcctType(c),this.getTipForAddr(c)):"")+ws.string.substituteParams("<span title='%{0}'>%{1}</span>",c,b),c+=e>0?" "+ws.string.substituteParams(Config.Strings.plusMore,e):"",b=document.createElement("span"),b.innerHTML=a+c,this.shortHeaderNode.appendChild(b)}},findMoreCount:function(a){var b=0,c=this.msgInfo.to.concat(this.msgInfo.cc);this.msgInfo.displayBcc&&(c=c.concat(this.msgInfo.bcc));for(var e=0;e<c.length;e++){var f=c[e].userInputForm.toLowerCase(),g=!1;if(f.indexOf("@")==-1&&f.indexOf("undisclosed")!=
-1&&f.indexOf("recipients")!=-1)g=!0;else for(var h=0;h<a.length;h++)if(f==a[h][1].toLowerCase()){g=!0;break}g||b++}return b},isBCCorDistro:function(){var a={isBCC:!1,isDistro:!1},b=this.msgInfo.to.concat(this.msgInfo.cc);this.msgInfo.displayBcc&&(b=b.concat(this.msgInfo.bcc));for(var c=!1,e=this.model.sendAddresses,f=0;f<b.length;f++){for(var g=b[f].userInputForm.toLowerCase(),h=0;h<e.length;h++)if(g==e[h][1].toLowerCase()){c=!0;break}if(c)break}if(!c)this.msgInfo.distroListId?a.isDistro=!0:a.isBCC=
!0;return a},updateInfoStrips:function(){var a=function(){var a=document.createElement("div");c.addClass(a,"bar");var b=document.createElement("span");a.appendChild(b);var d=document.createElement("img");d.src=Config.SpacerImageURL;c.addClass(d,"mainSprite");b.appendChild(d);var e=document.createElement("span");c.addClass(e,"barRight");a.appendChild(e);return{bar:a,barLeft:b,barRight:e,barIcon:d}};this.infoStrips.innerHTML="";for(var b,d,e,f=["chrome","spf","virus","images"],g=0;g<f.length;g++)switch(f[g]){case "chrome":c.forEach([["isOfficialMail",
"official","AOLOfficialMail"],["isCertifiedMail","certified","AOLCertifiedMail"],["isVoicemail","official","AOLVoiceMail"]],function(d){if(this.msgInfo[d[0]]){b=a();var f=d[0]=="isCertifiedMail",g=Config.Strings[d[2]],i=f?Config.Strings.AOLCertifiedMailMsg:Config.Strings.AOLOfficialMailMsg,d=d[1];c.addClass(b.barLeft,d+"Left");c.addClass(b.bar,d+"Bar");c.addClass(b.barIcon,d+"Icon");b.barLeft.appendChild(document.createTextNode(g));b.barRight.appendChild(document.createTextNode(i+" "));e=document.createElement("a");
e.href=f?Config.LearnMoreCertifiedMailURL:Config.LearnMoreOfficialMailURL;e.target="_blank";e.appendChild(document.createTextNode(Config.Strings.dm_LearnMore));c.addClass(e,"wsLink");c.addClass(e,d+"Link");b.barRight.appendChild(e);this.infoStrips.appendChild(b.bar)}},this);break;case "spf":this.msgInfo.hasFailedSpfCheck&&(b=a(),c.addClass(b.barLeft,"alertLeft"),c.addClass(b.bar,"alertBar"),c.addClass(b.barIcon,"dmAlertIcon"),b.barLeft.appendChild(document.createTextNode(Config.Strings.dm_SpfCheckTitle)),
d=ws.string.escapeXml(this.msgInfo.from[0].shorterDisplayForm+" "+this.msgInfo.from[0].userInputForm),d=ws.string.substituteParams(Config.Strings.dm_SpfCheckMsg,d),b.barRight.appendChild(document.createTextNode(d)),this.infoStrips.appendChild(b.bar));break;case "virus":if(this.msgInfo.hasAttachments)if(!this.msgInfo.isVirusScanned&&!(this.folder=="Drafts"||this.folder=="Sent"))b=a(),c.addClass(b.barLeft,"alertLeft"),c.addClass(b.bar,"alertBar"),c.addClass(b.barIcon,"dmAlertIcon"),b.barLeft.appendChild(document.createTextNode(Config.Strings.dm_NotScannedTitle)),
b.barRight.appendChild(document.createTextNode(Config.Strings.dm_NotScannedMsg+" ")),e=document.createElement("a"),e.href=Config.LearnMoreVirusURL,e.target="_blank",e.appendChild(document.createTextNode(Config.Strings.dm_LearnMore)),c.addClass(e,"wsLink alertLink"),b.barRight.appendChild(e),this.infoStrips.appendChild(b.bar);else if(this.msgInfo.isVirusRepaired)b=a(),c.addClass(b.barLeft,"confirmLeft"),c.addClass(b.bar,"confirmBar"),c.addClass(b.barIcon,"confirmIcon"),b.barLeft.appendChild(document.createTextNode(Config.Strings.dm_VirusRemovedTitle)),
b.barRight.appendChild(document.createTextNode(Config.Strings.dm_VirusRemovedMsg+" ")),e=document.createElement("a"),e.href=Config.LearnMoreVirusURL,e.target="_blank",e.appendChild(document.createTextNode(Config.Strings.dm_LearnMore)),c.addClass(e,"wsLink confirmLink"),b.barRight.appendChild(e),this.infoStrips.appendChild(b.bar);break;case "images":if(this.imagesRemoved&&(b=a(),this.imagesRemovedBar=b.bar,c.addClass(b.barLeft,"alertLeft"),c.addClass(b.bar,"alertBar"),c.addClass(b.barIcon,"dmAlertIcon"),
b.barLeft.appendChild(document.createTextNode(Config.Strings.dm_ImageBlockedTitle)),this.infoStrips.appendChild(b.bar),d=document.createElement("span"),d.appendChild(document.createTextNode(Config.Strings.dm_ImageEnable)),c.addClass(d,"wsLink blockBarLink alertLink"),d.onclick=c.hitch(this,this.restoreImages),b.barRight.appendChild(d),d=document.createElement("span"),d.style.color="#777",d.innerHTML="|",b.barRight.appendChild(d),d=document.createElement("span"),d.appendChild(document.createTextNode(Config.Strings.dm_ImageEnable4Sender)),
c.addClass(d,"wsLink blockBarLink alertLink"),d.onclick=c.hitch(this,this.restoreImagesAddContact),b.barRight.appendChild(d),Config.TurnOffLinkAndImageBlockingInSettings))d=document.createElement("span"),d.appendChild(document.createTextNode(Config.Strings.dm_ImageOffBlocking)),c.addClass(d,"wsLink blockBarRightLink alertLink"),d.onclick=c.hitch(this,this.restoreImagesUpdateSettings),b.bar.appendChild(d);break;case "links":if(this.linksRemoved&&(b=a(),this.linksRemovedBar=b.bar,c.addClass(b.barLeft,
"alertLeft"),c.addClass(b.bar,"alertBar"),c.addClass(b.barIcon,"dmAlertIcon"),b.barLeft.appendChild(document.createTextNode(Config.Strings.dm_LinkBlockedTitle)),this.infoStrips.appendChild(b.bar),d=document.createElement("span"),d.appendChild(document.createTextNode(Config.Strings.dm_LinkEnable)),c.addClass(d,"wsLink blockBarLink alertLink"),d.onclick=c.hitch(this,this.restoreLinks),b.barRight.appendChild(d),d=document.createElement("span"),d.style.color="#777",d.innerHTML="|",b.barRight.appendChild(d),
d=document.createElement("span"),d.appendChild(document.createTextNode(Config.Strings.dm_LinkEnable4Sender)),c.addClass(d,"wsLink blockBarLink  alertLink"),d.onclick=c.hitch(this,this.restoreLinksAddContact),b.barRight.appendChild(d),Config.TurnOffLinkAndImageBlockingInSettings))d=document.createElement("span"),d.appendChild(document.createTextNode(Config.Strings.dm_LinkOffBlocking)),c.addClass(d,"wsLink blockBarRightLink  alertLink"),d.onclick=c.hitch(this,this.restoreLinkUpdateSettings),b.bar.appendChild(d)}},
checkForLinksAndImageBlock:function(a){var b=!!this.msgInfo.stripImagesKey&&this.msgInfo.body.indexOf(this.msgInfo.stripImagesKey)!=-1,c=!!this.msgInfo.stripLinksKey&&this.msgInfo.body.indexOf(this.msgInfo.stripLinksKey)!=-1,e=this.addressModel.getRecordByEmail(this.msgInfo.from[0].userInputForm);if(b&&(!Settings.DisplayImageWarning||this.fromMe||e||ws.WebSuite.isDispMessageSafe(this.uid)))this._restoreImages(a),b=!1;if(c&&(!Settings.DisplayLinkWarning||this.fromMe||e||ws.WebSuite.isDispMessageSafe(this.uid,
!0)))this._restoreLinks(a),c=!1;this.linksRemoved=c;this.imagesRemoved=b},_restoreImages:function(a){this.msgInfo.body=this.msgInfo.body.replace(RegExp(this.msgInfo.stripImagesKey,"g"),"");this.msgInfo.stripImagesKey=null;ws.WebSuite.setDispMessageSafe(this.uid);a||this.messageReceived(this.uid,this.msgInfo)},_restoreLinks:function(a){this.msgInfo.body=this.msgInfo.body.replace(RegExp(this.msgInfo.stripLinksKey,"g"),"");this.msgInfo.stripLinksKey=null;ws.WebSuite.setDispMessageSafe(this.uid,!0);if(!a)this.savedScrollTop=
this.messageArea.domNode.scrollTop,this.savedScrollLeft=this.messageArea.domNode.scrollLeft,this.messageReceived(this.uid,this.msgInfo)},_addContact:function(){this.addressModel.createOrModifyContact({uid:0,category:"Auto-Added",email1:this.msgInfo.from[0].userInputForm,load:c.hitch(this,function(){c.publish("WSFeedbackStart",[Config.Strings.SenderAdded,!0])})})},restoreImages:function(){if(this.imagesRemoved)this._restoreImages(),this.imagesRemoved=!1},restoreLinks:function(){if(this.linksRemoved)this._restoreLinks(),
this.linksRemoved=!1},restoreImagesAddContact:function(){if(this.imagesRemoved)this._restoreImages(),this._addContact(),this.imagesRemoved=!1},restoreLinksAddContact:function(){if(this.linksRemoved)this._restoreLinks(),this._addContact(),this.linksRemoved=!1},restoreImagesUpdateSettings:function(){if(this.imagesRemoved){this._restoreImages();this.messageReceived(this.uid,this.msgInfo);ws.settings.saveNow({DisplayImageWarning:!1});Settings.DisplayImageWarning=!1;var a=i.byId("GeneralSettings");if(a&&
a.DisplayImageWarning.checked)a.DisplayImageWarning.checked=!1;this.imagesRemoved=!1}},restoreLinkUpdateSettings:function(){if(this.linksRemoved){this._restoreLinks();this.messageReceived(this.uid,this.msgInfo);ws.settings.saveNow({DisplayLinkWarning:!1});Settings.DisplayLinkWarning=!1;var a=i.byId("GeneralSettings");if(a&&a.DisplayLinkWarning.checked)a.DisplayLinkWarning.checked=!1;this.linksRemoved=!1}},restartIM:function(){var a=this.msgInfo.body.search(/<div class=.hChat/i);if(a!=-1){var a=this.msgInfo.body.search(/<div id=.AOLMsg/i),
b=this.msgInfo.body.search(/<\!-- end of AOLMsg/i),c=!1;this.isPopup&&_ws_isOpenerWS()?(opener.ws.presence.launchAIMPanel("",!1,!0),c=opener.ws.im.wim.restoreConversation(this.msgInfo.to[0].shorterDisplayForm,this.msgInfo.body.substr(a,b-a)),opener.focus()):(ws.presence.launchAIMPanel("",!1,!0),c=ws.im.wim.restoreConversation(this.msgInfo.to[0].shorterDisplayForm,this.msgInfo.body.substr(a,b-a)));c||ws.widget.Dialogs.ok(Config.Strings.ChatError_Restore);ws.reporting.reportAction("IM Reconstitute Conversation")}},
getTipForAddr:function(a){if(a)for(var b=this.model.getIdentities(),c=0;c<b.length;c++)if(a.toLowerCase()==b[c][1])return b[c][0]==b[c][1]?b[c][1]:b[c][0]+"  "+b[c][1];return a},reply:function(){this.composeResponse("reply")},replyAll:function(){this.composeResponse("replyAll")},forward:function(){this.composeResponse("forward")},composeResponse:function(a){if(this.getComposeCB)this.msgInfo.selectedText=this.selectedHtml,a=="forward"&&this.model.forwardMessages({uids:[this.msgInfo.uid]}),this.getComposeCB(c.hitch(this,
function(b){b.isStandAlone=this.isStandAlone;b[a](this.msgInfo)}))},openDraft:function(){this.getComposeCB(c.hitch(this,function(a){a.openDraft(this.model.currentFolder,this.uid)}))},onMsgListFlagMessage:function(a,b,d){if(this.isPreviewPane&&a==this.folder){for(var a=0,e=!1;a<b.length;){if(b[a]==this.msgInfo.uid){e=!0;break}a++}if(e)this.msgInfo.isFlagged=d,c.toggleClass(this.flagIcon,"flagged",d)}},toggleFlag:function(){var a=!this.msgInfo.isFlagged;this.msgInfo.isFlagged=a;c.toggleClass(this.flagIcon,
"flagged",a);this.model.flagMessages({folder:this.folder,uids:[this.msgInfo.uid],flag:a,fromDisplayMessage:!0,load:c.hitch(this,function(){c.publish("WSFeedbackStart",[a?Config.Strings.MessageFlagged:Config.Strings.MessageUnflagged,!0])}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.flagMessages-toggleFlag file:DisplayMessageWidget.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorSettingFlag)}})},markRead:function(){this.changeReadState(!0)},
markUnread:function(){this.changeReadState(!1)},changeReadState:function(a){var b=this.getNextUid();this.model.changeMessagesReadState({msgInfos:[this.msgInfo],folder:this.folder,uids:[this.msgInfo.uid],read:a,load:c.hitch(this,function(){c.publish("WSFeedbackStart",[a?Config.Strings.MessageMarkedRead:Config.Strings.MessageMarkedNew,!0])}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.changeMessagesReadState-changeReadState file:DisplayMessageWidget.js");
ws.widget.Dialogs.ok(a||Config.Strings.MarkReadError)}});var d=this.model.getFolderByName(this.folder).type;(a&&Config.EnableMoveForMarkSeen&&d=="NewMail"||!a&&Config.EnableMoveForMarkUnseen&&d=="OldMail")&&this.showNextOrList(b)},deleteMessage:function(){var a=this.model.getFolderByName(this.folder);if(a.type=="Deleted"||a.type=="Spam")ws.widget.Dialogs.okCancel(Config.Strings.PermDeleteConfirmation,c.hitch(this,function(a){a&&this.deleteMessageHelper()}));else return this.deleteMessageHelper();
return""},deleteMessageHelper:function(a){var b=this.getNextUid(),d="",d=!a||typeof a!="string"?Config.Strings.MessageDeleted:ws.string.substituteParams(Config.Strings.MessageMoved,a);this.setToolbarEnabled(!1);var e=this.msgInfo.uid;this.model.deleteMessages({folder:this.folder,uids:[e],checkUndo:!0,reason:a?"movread":"delread",skipRefetchCounts:!0,load:c.hitch(this,function(a){if(this.isPopup)Settings.GotoNextOnDelete?this.showNextOrList(b,c.hitch(this,function(){this._undoLastAction=!Config.UseOMS&&
(Config.EnableRestoreButton||Settings.ViewNewOld)?a.canUndo?c.hitch(this,"_restoreMessage",e):null:a.responseUIDs?a.canUndo?c.hitch(this,"_undoMoveMessages",a.responseUIDs,Config.DeletedItemsFolderName,this.folder):null:null;c.publish("WSFeedbackStart",[d,!0,this._undoLastAction])})):(this.undoFeedbackCB&&this.undoFeedbackCB("Delete",a,d,[e],this.folder),this.showNextOrList(b));else{var g=null,g=!Config.UseOMS&&(Config.EnableRestoreButton||Settings.ViewNewOld)?a.canUndo?c.hitch(this,"_restoreMessage",
e):null:a.canUndo?c.hitch(this.model,"undoMoveMessages",a.responseUIDs,Config.DeletedItemsFolderName,this.folder):null;c.publish("WSFeedbackStart",[d,!0,g])}}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteMessages-deleteMessageHelper file:DisplayMessageWidget.js");ws.widget.Dialogs.ok(a||Config.Strings.DeleteMessageError)}});this.isPopup||this.showNextOrList(b)},_undoReportSpamMessages:function(a){this.model.undoReportSpamMessages(a)},
_undoMoveMessages:function(a,b,c){this.model.undoMoveMessages(a,b,c)},restoreMessage:function(){this._restoreMessage()},_restoreMessage:function(a){var b=this.getNextUid();this.setToolbarEnabled(!1);this.model.restoreMessages({folder:Config.DeletedItemsFolderName,uids:a?[a]:[this.msgInfo.uid],load:c.hitch(this,function(d){a&&(b=a);this.isPopup?Settings.GotoNextOnDelete?this.showNextOrList(b,c.hitch(this,function(){this.model.refetchFolderIndex(this.model.currentFolder);c.publish("WSFeedbackStart",
[Config.Strings.MessageRestored,!0])})):(this.undoFeedbackCB&&this.undoFeedbackCB("None",d,Config.Strings.MessageRestored),this.showNextOrList(b)):(this.model.refetchFolderIndex(this.model.currentFolder),a&&this.showNextOrList(b),c.publish("WSFeedbackStart",[Config.Strings.MessageRestored,!0]))}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.restoreMessages-_restoreMessage file:DisplayMessageWidget.js");ws.widget.Dialogs.ok(a||
Config.Strings.RestoreMessageError)}});!this.isPopup&&!a&&this.showNextOrList(b)},moveMessage:function(a,b){var d=this.getNextUid();this.model.getFolderByName(this.folder).type!="Deleted"&&a==Config.DeletedItemsFolderName?this.deleteMessageHelper(b):a==Config.SpamFolderName?this.spamAction(!0):(this.setToolbarEnabled(!1),this.model.moveMessages({folder:this.folder,destFolder:a,uids:[this.msgInfo.uid],checkUndo:!0,skipRefetchCounts:!0,load:c.hitch(this,function(e){if(this.isPopup)Settings.GotoNextOnDelete?
this.showNextOrList(d,c.hitch(this,function(){this._undoLastAction=e.canUndo?c.hitch(this,"_undoMoveMessages",e.responseUIDs,a,this.folder):null;c.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.MessageMoved,b),!0,this._undoLastAction])})):(this.undoFeedbackCB&&this.undoFeedbackCB("Move",e,ws.string.substituteParams(Config.Strings.MessageMoved,b),a,this.folder),this.showNextOrList(d));else{var f=e.canUndo?c.hitch(this.model,"undoMoveMessages",e.responseUIDs,a,this.folder):null;
c.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.MessageMoved,b),!0,f])}}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.moveMessages-moveMessage file:DisplayMessageWidget.js");ws.widget.Dialogs.ok(a||Config.Strings.MoveMessageError)}}),this.isPopup||this.showNextOrList(d))},backToInbox:function(){ws.reporting.reportAction("DisplayMessage - Back To Inbox");this.backToList(!0)},reportSpam:function(){this.spamAction(!0)},
reportNotSpam:function(){this.spamAction(!1)},spamAction:function(a){var b=this.getNextUid();this.setToolbarEnabled(!1);var d;this.model.reportSpamMessages({checkUndo:a,folder:this.folder,uids:[this.msgInfo.uid],isSpam:a,skipRefetchCounts:!0,load:c.hitch(this,function(e){a&&(this.isPopup?Settings.GotoNextOnDelete?this.showNextOrList(b,c.hitch(this,function(){d=this.model.isInboxNewOld(this.model.currentFolder)?c.hitch(this,"_undoReportSpamMessages",e.responseUIDs):c.hitch(this,"_undoMoveMessages",
e.responseUIDs,Config.SpamFolderName);this._undoLastAction=e.canUndo?d:null;c.publish("WSFeedbackStart",[Config.Strings.MessageMarkedSpam,!0,this._undoLastAction])})):(this.undoFeedbackCB&&(this.model.isInboxNewOld(this.model.currentFolder)?this.undoFeedbackCB("Spam",e,Config.Strings.MessageMarkedSpam):this.undoFeedbackCB("Move",e,Config.Strings.MessageMarkedSpam,Config.SpamFolderName,this.folder)),this.showNextOrList(b)):(d=this.model.isInboxNewOld(this.model.currentFolder)?c.hitch(this.model,"undoReportSpamMessages",
e.responseUIDs):c.hitch(this.model,"undoMoveMessages",e.responseUIDs,Config.SpamFolderName),c.publish("WSFeedbackStart",[Config.Strings.MessageMarkedSpam,!0,e.canUndo?d:null])))}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.reportSpamMessages-spamAction file:DisplayMessageWidget.js");ws.widget.Dialogs.ok(a||Config.Strings.ReportSpamError)}});(!this.isPopup||!a)&&this.showNextOrList(b)},nextMessage:function(){c.hasClass(this.nextButtonNode.domNode,
"btnDisabled")||this.nextPrevMessage(1)},prevMessage:function(){c.hasClass(this.prevButtonNode.domNode,"btnDisabled")||this.nextPrevMessage(-1)},nextPrevMessage:function(a){if(a=this.model.getAdjacentMessageUid(this.msgInfo.uid,a))this.setToolbarEnabled(!1),this.displayMessage(this.folder,a)},getNextUid:function(){var a=this.msgInfo.uid;return this.model.getAdjacentMessageUid(a,1)||this.model.getAdjacentMessageUid(a,-1)},showNextOrList:function(a,b){Settings.GotoNextOnDelete&&a&&this.enableNextPrev?
this.displayMessage(this.folder,a,b):ws.lang.setTimeout(this,"backToList",100,!1,a)},backToList:function(a,b,d){if(this.backToListCB){typeof a!="boolean"&&(a=null);if(!b)b=this.uid;var e=this.model.activeCachedList.GetAvailableRowsForUIDs([b]);this.backToListCB(a,e.length==1?e[0]:-1,b,d);c.publish("ccgRefresh",[!0])}else ws.io.closeWindow()},defineActionMenu:function(){this.actionButton.menuDefinition=[{caption:Config.Strings.MarkReadActionLabel,onClick:c.hitch(this,"markRead")},{caption:Settings.ViewNewOld?
Config.Strings.KeepAsNewActionLabel:Config.Strings.MarkUnreadActionLabel,onClick:c.hitch(this,"markUnread")},{caption:Config.Strings.FlagForFollowUp,onClick:c.hitch(this,"toggleFlag")},{caption:Config.Strings.ClearFlag,onClick:c.hitch(this,"toggleFlag")},{caption:Config.Strings.MailFilter_CreateFilter,onClick:c.hitch(this,"onClickCreateFilter")},{separator:!0},{caption:Config.Strings.SearchForSubject,onClick:c.hitch(this,"searchForSubject")},{caption:Config.Strings.SearchForSender,onClick:c.hitch(this,
"searchForSender")},{separator:!0},{caption:Config.Strings.PrintMessage,onClick:c.hitch(this,"print")},{caption:Config.Strings.ShowMessageStatus,onClick:c.hitch(this,"viewStatus")},{caption:Config.Strings.ViewMessageSource,onClick:c.hitch(this,"viewSource")},{separator:!0}]},updateActionMenu:function(){var a=this.actionButton.menu;if(a){var b=a.getChildren(),d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],m=b[6],n=b[7],o=b[9],k=b[10],p=b[12],l=this.model.getFoldersCanMoveTo().length>0,q=this.buttonViz&&
this.buttonViz[7]&&this.model.canChangeMessageReadState(this.msgInfo.folder);d.setShowing(q&&!this.msgInfo.isSeen);e.setShowing(q&&this.msgInfo.isSeen);h.setShowing(this.enableFilters&&Config.EnableFiltersSettings);d=this.msgInfo?!!this.msgInfo.isFlagged:!1;f.setShowing(!d);g.setShowing(d);f=this.showSearchItems&&this.model.getFolderByName(this.msgInfo.folder).type!="Sent"&&this.model.getFolderByName(this.msgInfo.folder).type!="SavedIMs";m.setShowing(this.showSearchItems);n.setShowing(f);i.setShowing(f);
o.setShowing(Config.PrintingSupported);k.setShowing(ws.UserContext.MailboxType=="ANGELIA"?Config.ShowMessageStatus&&Config.UseOMS:Config.ShowMessageStatus);p.setShowing(l);for(m=b.length-1;m>12;m--)i=b[m],a.removeChild(i),i!=this.newFolderSeparator&&i!=this.newFolderMenu&&i!=this.newFolderInputMenu&&i.destroy();i=new ws.widget.WSMenuItem({caption:Config.Strings.MoveActionLabel,isLabel:!0});i.setShowing(l);a.addChild(i);c.forEach(this.model.folders,c.hitch(this,function(b){if(c.indexOf(this.foldersCanMoveTo,
b.name)!=-1){var d=new ws.widget.WSMenuItem({caption:ws.string.escapeXml(b.displayName)});d.onClick=c.hitch(this,"moveMessage",b.name,b.displayName);a.addChild(d)}}));if(!this.newFolderSeparator)this.newFolderSeparator=new ws.widget.WSMenuSeparator,this.newFolderSeparator.startup(),this.newFolderMenu=new ws.widget.WSMenuItem({caption:Config.Strings.NewFolder}),this.newFolderMenu._onClick=c.hitch(this,"newFolder"),this.newFolderMenu.startup();a.addChild(this.newFolderSeparator);a.addChild(this.newFolderMenu);
this.model.getSearchString()&&Config.UseOMS&&Config.CrossFolderSearch&&b[7].setCaption(Config.Strings.SearchForFromTo)}},newFolder:function(a){a&&a.stopPropagation();var b=this.actionButton.menu;if(b){this.newFolderMenu.hide();if(!this.newFolderInputMenu)this.newFolderInputMenu=new ws.widget.WSInputableMenuItem({okCB:c.hitch(this,"moveToNewFolder"),defaultValue:Config.Strings.NewFolder,originalMenuItem:this.newFolderMenu,maxlength:ws.mail.folderName.MaxLength});ws.lang.setTimeout(this,function(){b.addChild(this.newFolderInputMenu);
this.newFolderInputMenu.show();this.newFolderInputMenu.initializeText(Config.Strings.NewFolder);c.window.scrollIntoView(this.newFolderInputMenu.domNode)},0)}},moveToNewFolder:function(a){if(a&&a.newName){var b=c.hitch(this,"moveMessage");this.model.createFolder({newName:a.newName,load:c.hitch(this,function(d){c.publish("WSFeedbackStart",[Config.Strings.FolderCreated,!0]);b(ws.UserContext.MailboxType=="ANGELIA"?d.iName:Config.NewFolderPrefix+a.newName,a.newName)}),error:function(b){window.ws_ErrLgr&&
!b&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.createFolder-moveToNewFolder file:DisplayMessageWidget.js");ws.widget.Dialogs.ok(b?b:ws.string.substituteParams(Config.Strings.ErrorCreatingFolder,a.newName))}})}},popOut:function(){window.openerContext={model:this.model,picturesModel:this.picturesModel,folder:this.folder,uid:this.msgInfo.uid,Settings:Settings,undoFeedbackPopup:this.undoFeedbackCB,callback:c.hitch(this,"backToList",!0,null,!0),webSuite:ws.WebSuite};
ws.io.openWindow(Config.BaseMailPagesURL+"DisplayMessage.aspx?ws_popup=true","","status=yes,resizable=yes,left=5,top=5,width=885,height=606")},showFullMessage:function(){this.folder=="Drafts"?this.getComposeCB(c.hitch(this,function(a){a.openDraft(this.model.currentFolder,this.uid)})):this.showFullMessageCB&&this.showFullMessageCB(this.folder,this.uid)},searchForSubject:function(){this.model.search(this.model.getBaseSubject(this.msgInfo.subject),"subject");this.backToList()},searchForSender:function(){this.model.search(this.msgInfo.from[0].userInputForm,
"from");this.backToList()},getLinkHandler:function(a){try{if(a.indexOf("mailto:")==0)return c.hitch(this,"onMailtoClick",a);else if(a.match(this.presenceIconRE))return c.hitch(this,"onPresenceIconClick",a)}catch(b){}return null},onMailtoClick:function(a,b){var d=a.match(/mailto:([^?]+)(\?(.*))?/i),e={to:decodeURIComponent(d[1])};if(d=d[3])for(var f=["subject","cc","bcc","body"],d=d.split("&"),g=0;g<d.length;g++){var h=d[g].split("=");h[0]&&c.indexOf(f,h[0].toLowerCase())!=-1&&(e[h[0].toLowerCase()]=
decodeURIComponent(h[1]))}this.getComposeCB(c.hitch(this,function(a){if(!this.isPopup)e.beaconSuffix="Inline Response";a.reset(e)}));b&&b.preventDefault()},presenceIconRE:/IM\/\?sn=([^&]*)&locale=([^&]*)&pd=(0|1)$/,onPresenceIconClick:function(a,b){var c=a.match(this.presenceIconRE);ws.presence.launchIM(c[1],c[3]=="1");b&&b.preventDefault()},viewSource:function(){var a=ws.string.substituteParams("%{0}ViewSource.aspx?user=%{1}&folder=%{2}&uid=%{3}",Config.BaseMailPagesURL,encodeURIComponent(ws.io.getUserUid()),
encodeURIComponent(this.msgInfo.folder),encodeURIComponent(this.msgInfo.uid));setTimeout(function(){ws.io.openWindow(a,"","status=yes,resizable=yes,menubar=yes,scrollbars=yes")},100);ws.reporting.report("Message Source","Mail")},viewStatus:function(){if(!this.statusDialog)this.statusDialog=new ws.mail.MessageStatusDialog({model:this.model}),c.body().appendChild(this.statusDialog.domNode),this.statusDialog.startup();this.statusDialog.show(this.msgInfo.folder,[this.msgInfo.uid]);ws.reporting.reportAction("Message Status")},
print:function(){window.printContext=this.msgInfo;ws.io.openWindow(Config.BaseMailPagesURL+"PrintMessage.aspx",null,"")},getSizeLabeled:function(a){var b=a+" B";Number(a)>1024&&(b=(a/1024).toFixed(0)+" KB");Number(a)>1048576&&(b=(a/1048576).toFixed(1)+" MB");return b},makeAttachmentsLabel:function(a,b){var c=this.getSizeLabeled(b),e=a.lastIndexOf("."),f=a.substr(e+1);e==-1?a.length>30&&(a=a.substr(0,30)+"..."):e>30?a=f.length>4?a.substr(0,30)+"...":a.substr(0,30)+"..."+f:e+f.length>30&&(a=a.substr(0,
30)+"...");return a+" ("+c+")"},updateAttachments:function(){var a=this.msgInfo.attachments||[];this.attachmentsRow.innerHTML="";for(var b=0;b<a.length;b++){var d=a[b],e=ws.string.escapeXml(d.name),f=d.url,g=new ws.widget.Button({fixSize:!0});g.startup();g.setLabel(this.makeAttachmentsLabel(e,d.size));this.msgInfo.isVirusScanned&&!(this.folder=="Drafts"||this.folder=="Sent")&&g.setTip("("+this.getSizeLabeled(d.size)+") "+Config.Strings.NoVirusesFound);g.onClick=c.hitch(this,function(a){!c.isIE&&this.isPopup?
ws.io.openWindow(a,"",""):document.location=a},f);c.addClass(g.domNode,"attBtn");this.attachmentsRow.appendChild(g.domNode)}ws.html.setShowing(this.attachmentsRow,a.length>0)},initializeImages:function(){var a=c.io.iframe.doc(this.bodyFrame),b=a.getElementsByTagName("img");this.pictureViewControls=[];for(var d=0;d<b.length;d++){var e=c.hasClass(b[d],"AOLAttachedImage"),f=c.hasClass(b[d],"AOLInlineImage");if(e){var g=c.contentBox(b[d]),h=Config.InsertedPictureLongestEdge,i=g.w<g.h;i&&g.h>h?c.contentBox(b[d],
{h:h,w:Math.round(g.w*(h/g.h))}):!i&&g.w>h&&c.contentBox(b[d],{w:h,h:Math.round(g.h*(h/g.w))});b[d].style.visibility="visible"}b[d].src&&(e||f)&&c.withDoc(a,c.hitch(this,function(){this.pictureViewControls.push(new ws.pictures.PictureViewControl({image:b[d],picturesModel:this.picturesModel,folder:this.msgInfo.folder,uid:this.msgInfo.uid}))}))}},saveSelection:function(){var a=!1,b="",d="";try{var e=this.bodyFrame.contentWindow,a=c.withGlobal(e,function(){return i._editor.selection.getAncestorElement("pre")}),
b=c.withGlobal(e,i._editor.selection.getSelectedHtml),d=c.withGlobal(e,i._editor.selection.getSelectedText);c.isIE<9&&e.document.selection.type=="None"&&d==""&&(b="")}catch(f){}a&&b&&(b="<pre><tt>"+b+"</tt></pre>");this.selectedHtml=b;this.selectedText=d},addToCalendar:function(){if(!this.model.standAloneMailModel){var a=this.selectedText;a||(a=ws.html.renderedTextContent(c.io.iframe.doc(this.bodyFrame).body));this.getAddEditWidgetCB(c.hitch(this,function(b){if(null==b){if(!this.calendarModel)this.calendarModel=
new ws.calendar.CalendarViewModel({modelType:"event"});if(!this.addEditDialog)this.addEditDialog=new ws.calendar.AddEventDialog({model:this.calendarModel}),this.addEditDialog.startup(),this.addEditDialog.setModel(this.calendarModel),c.body().appendChild(this.addEditDialog.domNode);b=this.addEditDialog}b.onSavedCB=this.calendarDataUpdatedCB;b.show(2,{summary:this.msgInfo.subject,notes:a});ws.reporting.reportAction("Display Message - Add To Calendar")}))}},addToTask:function(){if(!this.model.standAloneMailModel){if(!this.taskView)this.taskView=
new ws.panels.TaskPanel({doHideTodoList:!0}),this.taskView.onCancelCB=c.hitch(this.taskView,"close"),this.taskView.onBeforeSaveCB=c.hitch(this.taskView,function(){this.popupNode.style.visibility="hidden"}),this.taskView.onSavedCB=c.hitch(this,function(){this.taskView.close();this.calendarDataUpdatedCB()}),this.taskView.startup();var a=[-100,6];c.window.getBox().w-c.position(this.addToTaskLink).x<200&&(a=[-180,6]);this.taskView.openPopUpNew(this.msgInfo.subject,this.selectedText,this.addToTaskLink,
{BL:"TL"},a,"top",6);this.hideTip(this.addToTaskLink);ws.reporting.reportAction("Display Message - Add To ToDo")}},_suiteOnKeyPress:function(a){if(this.domNode&&!(this.domNode.style.display=="none"||c.hasClass(this.domNode,"dijitHidden")||!this.enableKeyboardShortcuts||!Config.EnableKeyboardShortcuts)){var b=null;if(a.keyChar&&c.isString(a.keyChar)&&!a.ctrlKey&&!a.altKey&&!a.metaKey)switch(a.keyChar.toLowerCase()){case Config.Strings.KeyMailReply:this.saveSelection();b=this.reply;break;case Config.Strings.KeyMailReplyAll:this.saveSelection();
b=this.replyAll;break;case Config.Strings.KeyMailForward:this.saveSelection();b=this.forward;break;case Config.Strings.KeyMailPopout:if(ws.settings.allowPopups()&&!this.isPopup&&!this.isStandAlone&&!this.isPreviewPane)b=this.popOut;break;case Config.Strings.KeyMailNext:if(this.enableNextPrev&&!this.isPreviewPane)b=this.nextMessage;break;case Config.Strings.KeyMailPrevious:if(this.enableNextPrev&&!this.isPreviewPane)b=this.prevMessage;break;case Config.Strings.KeyMailPrint:if(!this.isPreviewPane)b=
this.print;break;case Config.Strings.KeyMailClose:b=this.backToList;break;case Config.Strings.KeyMailAddToCalendar:if(!this.isPreviewPane)this.saveSelection(),b=this.addToCalendar;break;case Config.Strings.KeyMailAddToToDo:if(!this.isPreviewPane)this.saveSelection(),b=this.addToTask}else{var d=ws.html.fixKeyCodeForMac(a);switch(d){case c.keys.DELETE:if(!this.isPreviewPane)b=this.deleteMessage}if(c.isWebKit&&!this.isPreviewPane)switch(d){case c.keys.DOWN_ARROW:this.messageArea.domNode.scrollTop+=15;
break;case c.keys.UP_ARROW:this.messageArea.domNode.scrollTop-=15;break;case c.keys.RIGHT_ARROW:this.messageArea.domNode.scrollLeft+=15;break;case c.keys.LEFT_ARROW:this.messageArea.domNode.scrollLeft-=15}}a.stopPropagation();b&&setTimeout(c.hitch(this,b))}},nodeOrParentLinkTag:function(a){for(var b=null;a;)if(a.nodeName&&a.nodeName.toLowerCase()=="a"){b=a;break}else a=a.parentNode;return b},onMailBodyClick:function(a,b){var d=!0;typeof b.which!="undefined"&&b.which!=1&&(d=!1);if(b.target&&b.target.nodeName&&
d&&(d=this.nodeOrParentLinkTag(b.target))){var e=d.href,f=document.location.href;if(e&&e.indexOf(f)==0){if((d=e.substring(f.length))&&d.length>1){d.indexOf("#")==0&&(d=d.substring(1));e=a.body.getElementsByTagName("a");f=null;if(e)for(var g=0;g<e.length;g++)if(e[g].name==d){f=e[g];break}if(f)c.isSafari?(d=f,e=a.body,f=e.scrollTop+c._getMarginSize(e).h,g=d.offsetTop+c._getMarginSize(d).h,f<g?e.scrollTop+=g-f:e.scrollTop>d.offsetTop&&(e.scrollTop-=e.scrollTop-d.offsetTop)):c.window.scrollIntoView(f)}b.preventDefault();
b.stopPropagation()}else this.showEnableLinkWidget(b,d)}c.publish("DisplayMessage/BodyClick");this.isPopup&&c.publish("WSFeedbackHide")},createEnableLinkWidget:function(){var a=[{caption:Config.Strings.dm_LinkEnable,onClick:c.hitch(this,this.restoreLinks)},{caption:Config.Strings.dm_LinkEnable4Sender,onClick:c.hitch(this,this.restoreLinksAddContact)}];Config.TurnOffLinkAndImageBlockingInSettings&&a.push({caption:Config.Strings.dm_LinkOffBlocking,onClick:c.hitch(this,this.restoreLinkUpdateSettings)});
this.enableLinkWidget=ws.widget.createMenu(a);this.connect(this.enableLinkWidget,"onClose","clearOpenLinkMenu");this.positionOpenLinkMenu()},clearOpenMenus:function(){this.enableLinkWidget&&(this.enableLinkWidget.close(),this.clearOpenLinkMenu());this.addrActionMenu&&(this.addrActionMenu.close(),this.clearAddrActionMenu())},clearOpenLinkMenu:function(){if(this.currentLinkNode)try{c.removeClass(this.currentLinkNode,"dmItemSelected")}catch(a){}},positionOpenLinkMenu:function(){if(this.currentLinkNode){c.addClass(this.currentLinkNode,
"dmItemSelected");var a=c.position(this.bodyFrame,!0),b=c.position(this.currentLinkNode,!0);ws.widget.popup({popup:this.enableLinkWidget,x:a.x+b.x,y:a.y+b.y,padding:c.isIE<=8?c.isIE<=7?[2,20]:[0,20]:[0,17],shadow:!1})}},showEnableLinkWidget:function(a,b){if(this.isShowing()&&this.msgInfo)if(this.msgInfo.stripLinksKey&&this.msgInfo.body.indexOf(this.msgInfo.stripLinksKey)!=-1)c.position(this.bodyFrame,!0),c.position(b,!0),this.currentLinkNode=b,this.enableLinkWidget?this.positionOpenLinkMenu():setTimeout(c.hitch(this,
this.createEnableLinkWidget),0);else{var d=b.getAttribute("href");if(d){var e=this.getLinkHandler(d);e?e():ws.io.openWindow(d,"","")}a.preventDefault();a.stopPropagation()}},onClickCreateFilter:function(){var a=new ws.mail.MailFilterModalPane({mailModel:this.model,from:this.msgInfo.from[0].userInputForm});c.body().appendChild(a.domNode);a.startup()},markupSearchString:function(a){var b=this.model.getSearchString(),c=this.model.getSearchIn();if(b&&c=="alltext"&&(b=ws.string.escapeXml(b),a.toLowerCase().indexOf(b.toLowerCase())!=
-1)){for(var c=a.toLowerCase(),e=b.length,b=b.toLowerCase(),f=[],g=c.indexOf(b);g!=-1;)f.push(a.substr(0,g)),f.push("<span class='searchTerm'>",a.substr(g,e),"</span>"),a=a.substr(g+e),c=c.substr(g+e),g=c.indexOf(b);f.push(a);a=f.join("")}this.msgMarkedUp=!0;return a},isMessageMarkedUp:function(){return this.msgMarkedUp},wrapToolbar:function(){this.toolbar.skipLayout=!0;this.layoutWidget.resize()},showTip:function(a){ws.widget.showInstatip(a.target)},hideTip:function(a){ws.widget.hideInstatip(a.target)}}));
c._hasResource["ws.layers.DisplayMessage"]||(c._hasResource["ws.layers.DisplayMessage"]=!0,c.provide("ws.layers.DisplayMessage"))}}});

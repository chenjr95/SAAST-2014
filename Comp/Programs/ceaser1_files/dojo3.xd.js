/* (C) 2012 AOL Inc. All Rights Reserved */
dojo._xdResourceLoaded(function(){return{depends:[["provide","ws.address.ContactDetails"],["provide","ws.address.ComposeAddressField"],["provide","ws.address.DistributionListWidget"],["provide","ws.address.EditContactDialog"],["provide","ws.address.ImportContactsWidget"],["provide","ws.address.ExportContactsWidget"],["provide","ws.widget.HoverCardManager"],["provide","ws.address.AddressListView"],["provide","ws.address.AddressListHoverCard"],["provide","ws.address.PeoplePanel"],["provide","dojo.fx.Toggler"],
["provide","dojo.fx"],["provide","ws.dnd.DragAndDrop"],["provide","ws.dnd.HtmlDragManager"],["provide","ws.dnd.HtmlDragAndDrop"],["provide","ws.dnd.suite"],["provide","ws.mail.EditFolderDialog"],["provide","ws.suite.MiniLogin"],["provide","ws.layers.dojo3"]],defineResource:function(b,h,l){b._hasResource["ws.address.ContactDetails"]||(b._hasResource["ws.address.ContactDetails"]=!0,b.provide("ws.address.ContactDetails"),b.declare("ws.address.ContactDetails",[h._Widget,h._Templated],{templateString:b.cache("ws.address",
"ContactDetails.html",'<div class="contactDetail">\r\n\t<div dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget" style="height: 100%; width: 100%;">\r\n\t\t<div dojoType="ws.widget.WSToolbar" dojoAttachPoint="toolbar" layoutAlign="top" vizType="Controls">\r\n\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:emailContact" dojoAttachPoint="emailButton" title="${EmailContactTip}" iconClassName="composeIcon">${SendEmail}</div>\r\n\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:showEditContact" dojoAttachPoint="editButton" title="${EditContactTip}" iconClassName="editIcon">${Edit}</div>\r\n\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:deleteContact" dojoAttachPoint="deleteButton" title="${Delete}" iconClassName="delIcon">${Delete}</div>\r\n\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:printContact" dojoAttachPoint="printButton" iconClassName="printIcon">${PrintButton}</div>\r\n\t\t\t<div dojoType="ws.widget.Button" style="display:none" dojoAttachEvent="onClick:addToTopContacts" dojoAttachPoint="addToTopContactsButton" title="${TopContacts_AddToTopContactsTip}">${TopContacts_AddToTopContacts}</div>\r\n\t\t\t<div dojoType="ws.widget.Button" style="display:none" dojoAttachEvent="onClick:removeFromTopContacts" dojoAttachPoint="removeFromTopContactsButton" title="${TopContacts_RemoveFromTopContactsTip}">${TopContacts_RemoveFromTopContacts}</div>\r\n\t\t\t\r\n\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:close" dojoAttachPoint="cancelButton" title="${CloseContactTip}" iconClassName="cancelIcon" toolbarPosition="right"></div>\r\n\t\t</div>\r\n\t\t<div dojoType="ws.widget.Pane" dojoAttachPoint="searchInfoPane" class="searchInfo" layoutAlign="top" style="display:none">\r\n\t\t\t<div class="searchData">\r\n\t\t\t\t<span class="wsLink" dojoAttachPoint="searchResultsNode" dojoAttachEvent="onclick: close"></span>\r\n\t\t\t\t<div class="mainSprite wsCloseBtn" dojoAttachEvent="onclick:clearSearch"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojoType="ws.widget.Pane" dojoAttachPoint="regularPane" layoutAlign="client" class="mainContent">\r\n            <div>\r\n                <div style="margin-bottom: 15px;overflow: hidden;">\r\n                    <div class="iconPane">\r\n                        <div dojoType="ws.widget.BuddyIcon" dojoAttachPoint="buddyIcon"></div>\r\n                    </div>\r\n                    <div class="nameRow" dojoAttachPoint="nameRow">\r\n                        <span class="infoLabel"></span>\r\n                        <span width="100%">\r\n                            <div class="nameInfo">\r\n                                <span dojoAttachPoint="nameInfo"></span>\r\n                            </div>\r\n                        </span>\r\n                    </div>\r\n                    <a class="editLink" href="#" dojoAttachEvent="onclick:showEditContact" dojoAttachPoint="editButton">${Edit}</a>\r\n                </div>\r\n                <div dojoAttachPoint="displayNameRow">\r\n                    <span class="infoLabel">${DisplayNameWithColon}</span>\r\n                    <span width="100%" valign="top"><span dojoAttachPoint="displayNameInfo" class="primaryInfo"></span></span>\r\n                </div>\r\n                <div dojoAttachPoint="nickNameRow" class="nickNameDiv">\r\n                    <span class="infoLabel">${NickNameWithColon}</span>\r\n                    <span dojoAttachPoint="nickNameInfo" class="nickNameInfo"></span>\r\n                </div>\r\n                <div dojoAttachPoint="screenNameRow">\r\n                    <span class="infoLabel">${ScreenNameWithColon}</span>\r\n                    <span width="100%" valign="top"><a href="#" dojoAttachPoint="screenNameInfo" class="emailLink"></a></span>\r\n                </div>\r\n                <div dojoAttachPoint="email1Row">\r\n                    <span class="infoLabel">${Email1WithColon}</span>\r\n                    <span width="100%" valign="top"><a href="#" dojoAttachPoint="email1Info" class="emailLink"></a></span>\r\n                </div>\r\n                <div dojoAttachPoint="email2Row">\r\n                    <span class="infoLabel">${Email2WithColon}</span>\r\n                    <span width="100%" valign="top"><a href="#" dojoAttachPoint="email2Info" class="emailLink"></a></span>\r\n                </div>\r\n                <div dojoAttachPoint="phone1Row">\r\n                    <span class="infoLabel">${PhonePrimaryWithColon}</span>\r\n                    <span width="100%" valign="top"><span dojoAttachPoint="phone1Info" class="primaryInfo"></span></span>\r\n                </div>\r\n                <div dojoAttachPoint="phone2Row">\r\n                    <span class="infoLabel">${PhoneOtherWithColon}</span>\r\n                    <span width="100%"valign="top"><span dojoAttachPoint="phone2Info" class="primaryInfo"></span></span>\r\n                </div>\r\n                <div dojoAttachPoint="phone3Row">\r\n                    <span class="infoLabel">${PhoneOtherWithColon}</span>\r\n                    <span width="100%" valign="top"><span dojoAttachPoint="phone3Info" class="primaryInfo"></span></span>\r\n                </div>\r\n                <div dojoAttachPoint="phone4Row">\r\n                    <span class="infoLabel">${PhoneOtherWithColon}</span>\r\n                    <span width="100%" valign="top"><span dojoAttachPoint="phone4Info" class="primaryInfo"></span></span>\r\n                </div>\r\n                <div dojoAttachPoint="phone5Row">\r\n                    <span class="infoLabel">${PhoneOtherWithColon}</span>\r\n                    <span width="100%" valign="top"><span dojoAttachPoint="phone5Info" class="primaryInfo"></span></span>\r\n                </div>\r\n\r\n                <div dojoAttachPoint="categoryRow">\r\n                    <span class="infoLabel">${CategoryWithColon}</span>\r\n                    <span width="100%" valign="top"><span dojoAttachPoint="categoryInfo" class="primaryInfo"></span></span>\r\n                </div>\r\n\r\n                <div dojoAttachPoint="workRow">\r\n                    <div class="headerLabels">${CompanyInfo}</div>\r\n                    <div><span dojoAttachPoint="companyInfo" class="primaryInfo"></span></div>\r\n                    <div><span dojoAttachPoint="jobTitleInfo" class="primaryInfo"></span></div>\r\n                    <div><span dojoAttachPoint="deptInfo" class="primaryInfo"></span></div>\r\n\r\n                </div>\r\n                <div dojoAttachPoint="workAddressRow">\r\n                    <div class="headerLabels">${CompanyAddress}</div>\r\n                    <div dojoAttachPoint="workAddressInfo" class="primaryInfo"></div>\r\n                </div>\r\n                <div dojoAttachPoint="homeRow">\r\n                    <div class="headerLabels">${HomeAddress}</div>\r\n                    <div class="primaryInfo" dojoAttachPoint="homeAddressInfo"></div>\r\n                </div>\r\n                <div dojoAttachPoint="personalInfoHeader">\r\n                    <div class="headerLabels">${PersonalInfo}</div>\r\n                    <div dojoAttachPoint="personalSpouseRow">\r\n                        <span class="infoLabel">${SpouseWithColon}</span>\r\n                        <span width="100%" valign="top"><span dojoAttachPoint="personalSpouseInfo" class="primaryInfo"></span></span>\r\n                    </div>\r\n                    <div dojoAttachPoint="personalFamilyRow">\r\n                        <span class="infoLabel">${FamilyWithColon}</span>\r\n                        <span width="100%" valign="top"><span dojoAttachPoint="personalFamilyInfo" class="primaryInfo"></span></span>\r\n                    </div>\r\n                    <div dojoAttachPoint="personalBirthdayRow">\r\n                        <span class="infoLabel">${BirthdayWithColon}</span>\r\n                        <span width="100%" valign="top"><span dojoAttachPoint="personalBirthdayInfo" class="primaryInfo"></span></span>\r\n                    </div>\r\n                    <div dojoAttachPoint="personalAnniversaryRow">\r\n                        <span class="infoLabel">${AnniversaryWithColon}</span>\r\n                        <span width="100%" valign="top"><span dojoAttachPoint="personalAnniversaryInfo" class="primaryInfo"></span></span>\r\n                    </div>\r\n                    <div dojoAttachPoint="personalNotesRow">\r\n                        <span class="infoLabel">${NotesWithColon}</span>\r\n                        <span width="100%" valign="top"><span dojoAttachPoint="personalNotesInfo" class="primaryInfo"></span></span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,addressModel:null,closeCB:null,data:null,uid:null,backToString:Config.Strings.BackToContactDetails,showMapString:Config.Strings.ShowMap,infoRows:["name","screenName","displayName","email1","email2","phone1","phone2","phone3","phone4","phone5","category","work","workAddress","home","personalSpouse","personalFamily","personalBirthday","personalAnniversary","personalNotes"],infoSpans:["nickName","name","screenName","email1","email2",
"phone1","phone2","phone3","phone4","phone5","category","company","dept","jobTitle","workAddress","homeAddress","personalSpouse","personalFamily","personalBirthday","personalAnniversary","personalNotes"],contactPhoneTypes:["Undefined","Cellular","Fax","Home","Pager","Work"],phoneTypes:["phone1Type","phone2Type","phone3Type","phone4Type","phone5Type"],personalInfo:["personalSpouse","personalFamily","personalBirthday","personalAnniversary","personalNotes"],addressFields:[],startup:function(){this.addressFields=
Config.AddressOrder.split(" ");b.connect(this.email1Info,"onclick",b.hitch(this,"composeEmail",this.email1Info));b.connect(this.email2Info,"onclick",b.hitch(this,"composeEmail",this.email2Info));Config.PageLocale=="en-in"?b.connect(this.screenNameInfo,"onclick",b.hitch(this,"composeEmail",this.screenNameInfo)):b.connect(this.screenNameInfo,"onclick",this,"openIM");b.subscribe("Suite/onKeyOnPress",this,"_suiteOnKeyPress");Config.PrintingSupported?this.printButton.domNode.title=ws.string.substituteParams(Config.Strings.PrintContactTip,
Config.Strings.KeyPrintContactDetail):this.printButton.hide();this.defaultView();ws.WebSuite.SidePanel.setupAdScroll(this.domNode)},showContact:function(a,c,d){c?(b.isIE&&b.addClass(this.searchInfoPane.domNode,"searchInfo"),this.searchResultsNode.innerHTML=c,this.searchInfoPane.show()):(b.isIE&&b.removeClass(this.searchInfoPane.domNode,"searchInfo"),this.searchInfoPane.hide());this.defaultView();this.data=null;this.uid=a||"0";a&&this.addressModel.getContact({uid:a,load:b.hitch(this,function(a){this.fillInDetails(a);
d&&d();b.publish("WSFeedbackEnd",[Config.Strings.Loading])}),error:b.hitch(this,function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for addressModel.getContact-showContact file:ContactDetails.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorLoadingContact);b.publish("WSFeedbackEnd",[Config.Strings.Loading]);this.close()})})},showCreatedContact:function(a){this.defaultView();this.data=null;this.uid=a.uid;this.fillInDetails(a)},fillInDetails:function(a){var c=
null;this.data=a;this.emailButton.setShowing(a.ScreenName||a.email1||a.email2);this.editButton.setShowing(!0);this.deleteButton.setShowing(!0);this.showOrHideTopContactButtons();Settings.ShowPresenceIcon&&this.buddyIcon.show(a);a.nickName?(this.nickNameInfo.innerHTML=a.nickName?ws.string.escapeXml(ws.string.summary(a.nickName,16)):"",this.nickNameRow.style.display=""):this.nickNameRow.style.display="none";if(a.firstName||a.lastName)this.nameRow.style.display="",this.nameInfo.innerHTML=ws.address.AddressBookUtil.getNameInfoHTML(a,
Config.ContactDetailDisplayFormat,!1,!0);a.displayName?(this.displayNameRow.style.display="",this.displayNameInfo.innerHTML=ws.string.escapeXml(a.displayName)):this.displayNameRow.style.display="none";if(a.screenName)this.screenNameRow.style.display="",this.screenNameInfo.innerHTML=ws.string.escapeXml(a.screenName);if(a.email1)this.email1Row.style.display="",this.email1Info.innerHTML=ws.string.escapeXml(a.email1);if(a.email2)this.email2Row.style.display="",this.email2Info.innerHTML=ws.string.escapeXml(a.email2);
for(c=0;c<this.phoneTypes.length;c++)if(a["phone"+(c+1)])this["phone"+(c+1)+"Row"].style.display="",this["phone"+(c+1)+"Info"].innerHTML=this.buildPhoneString(a["phone"+(c+1)+"Type"],a["phone"+(c+1)]);if(a.category)this.categoryRow.style.display="",this.categoryInfo.innerHTML=this.translateCategoryName(a.category);if(a.company||a.jobTitle||a.dept)this.workRow.style.display="",this.companyInfo.innerHTML=a.company?ws.string.escapeXml(a.company):"",this.deptInfo.innerHTML=a.dept?ws.string.escapeXml(a.dept):
"",this.jobTitleInfo.innerHTML=a.jobTitle?ws.string.escapeXml(a.jobTitle):"";if(a.workStreet1||a.workStreet2||a.workStreet3||a.workCity||a.workState||a.workZip||a.workCountry){this.workAddressRow.style.display="";for(c=0;c<5;c++){var b=this.getAddressField(c);b=="Street"?(b="workStreet1",this.workAddressInfo.innerHTML+=a[b]?ws.string.escapeXml(a[b])+"<br>":"",b="workStreet2",this.workAddressInfo.innerHTML+=a[b]?ws.string.escapeXml(a[b])+"<br>":"",b="workStreet3"):b="work"+b;this.workAddressInfo.innerHTML+=
a[b]?ws.string.escapeXml(a[b])+"<br>":""}this.workAddressInfo.innerHTML+=a.workMapQuestUrl?'<a class="wsLink mapQuestLink" href="'+a.workMapQuestUrl+'" target="_blank">'+this.showMapString+"</a>":""}if(a.homeStreet1||a.homeStreet2||a.homeStreet3||a.homeCity||a.homeState||a.homeZip||a.homeCountry){this.homeRow.style.display="";for(c=0;c<5;c++)b=this.getAddressField(c),b=="Street"?(b="homeStreet1",this.homeAddressInfo.innerHTML+=a[b]?ws.string.escapeXml(a[b])+"<br>":"",b="homeStreet2",this.homeAddressInfo.innerHTML+=
a[b]?ws.string.escapeXml(a[b])+"<br>":"",b="homeStreet3"):b="home"+b,this.homeAddressInfo.innerHTML+=a[b]?ws.string.escapeXml(a[b])+"<br>":"";this.homeAddressInfo.innerHTML+=a.homeMapQuestUrl?'<a class="wsLink " href="'+a.homeMapQuestUrl+'" target="_blank">'+this.showMapString+"</a>":""}for(ii=c=0;c<this.personalInfo.length;c++)if(a[this.personalInfo[c]])ii++,this[this.personalInfo[c]+"Row"].style.display="",this[this.personalInfo[c]+"Info"].innerHTML=ws.string.escapeXml(a[this.personalInfo[c]]);
this.personalInfoHeader.style.display=ii==0?"none":""},showOrHideTopContactButtons:function(a){if(Config.TopContactsEnabled&&Settings.EnableTopContacts){var c;c=arguments.length>0?a:this.uid&&this.uid!="0"&&this.addressModel.isUidTopContact(this.uid);this.addToTopContactsButton.setShowing(!c);this.removeFromTopContactsButton.setShowing(c)}else this.addToTopContactsButton.setShowing(!1),this.removeFromTopContactsButton.setShowing(!1)},getAddressField:function(a){a=this.addressFields[a];return a=="State"&&
Config.ABHideState?"":a},translateCategoryName:function(a){return a=="Co-Workers"||a=="Friends"||a=="Family"||a=="General"||a=="Auto-Added"||a=="Uncategorized"?Config.Strings["ABCat"+a.replace("-","")]:ws.string.escapeXml(ws.string.summary(a,37))},getEmailDomain:function(a){if(a==null||a=="")return"";var c="",a=a.match(/(.*)@(.*)/);a!=null&&a.length==3&&(c=a[2],c!=null&&(c=c.toLowerCase()));return c},buildPhoneString:function(a,c){var b="";if(a){switch(a){case this.contactPhoneTypes[1]:b="("+Config.Strings.Cellular+
")";break;case this.contactPhoneTypes[2]:b="("+Config.Strings.Fax+")";break;case this.contactPhoneTypes[3]:b="("+Config.Strings.Home+")";break;case this.contactPhoneTypes[4]:b="("+Config.Strings.Pager+")";break;case this.contactPhoneTypes[5]:b="("+Config.Strings.Work+")";break;default:return""}return b=(c?ws.string.escapeXml(c):"")+" "+b}else return""},defaultView:function(){this.regularPane.show();for(var a=0;a<this.infoSpans.length;a++)this[this.infoSpans[a]+"Info"].innerHTML="";for(a=0;a<this.infoRows.length;a++)this[this.infoRows[a]+
"Row"].style.display="none"},showEditContact:function(){this.editContact(this.uid,this.data,!1)},editContact:function(){},deleteContact:function(){Config.EnableUndo?(this.addressModel.setUndoItem(this.data),this._deleteContact(!0)):this._confirmationDelete()},_confirmationDelete:function(){ws.widget.Dialogs.okCancel(Config.Strings.DeleteContactsConfirmationSingular,b.hitch(this,function(a){a&&this._deleteContact()}))},_deleteContact:function(a){this.addressModel.deleteAddresses({uids:[this.uid],load:b.hitch(this,
function(){var c=a?b.hitch(this.addressModel,"undoDeletedItem"):null;b.publish("WSFeedbackStart",[Config.Strings.ContactDeletedSingular,!0,c,a?b.hitch(this,function(){this.addressModel.setUndoItem()}):null])}),error:b.hitch(this,function(a){this.addressModel.setUndoItem();window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for addressModel.deleteAddresses-_deleteContact file:ContactDetails.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorDeletingContactNotFound)})});
this.close()},addToTopContacts:function(){this.addressModel.addContactToTopContacts({uid:this.uid,load:b.hitch(this,function(a){a.tcdluid?(this.showOrHideTopContactButtons(!0),ws.WebSuite.theMailModel.resetCachedLists(),b.publish("WSFeedbackStart",[Config.Strings.TopContacts_ContactAdded,!0])):ws.widget.Dialogs.ok(Config.Strings.TopContacts_ContactNotAdded)}),error:b.hitch(this,function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for addressModel.addContactToTopContacts-addToTopContacts file:ContactDetails.js");
ws.widget.Dialogs.ok(a||Config.Strings.TopContacts_ContactNotAdded)})})},removeFromTopContacts:function(){this.addressModel.removeContactFromTopContacts({uid:this.uid,load:b.hitch(this,function(a){a.tcremoved?(this.showOrHideTopContactButtons(!1),ws.WebSuite.theMailModel.resetCachedLists(),b.publish("WSFeedbackStart",[Config.Strings.TopContacts_ContactRemoved,!0])):ws.widget.Dialogs.ok(Config.Strings.TopContacts_ContactNotRemoved)}),error:b.hitch(this,function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,
"Dialogs.ok shown - Error Handler for addressModel.removeContactFromTopContacts-removeFromTopContacts file:ContactDetails.js");ws.widget.Dialogs.ok(a||Config.Strings.TopContacts_ContactNotRemoved)})})},emailContact:function(){var a=null;if(this.isEmailAddress(this.data.email1))a=this.data.email1;else if(this.isEmailAddress(this.data.email2))a=this.data.email2;else if(this.data.screenName)a=this.data.screenName;a?this.composeEmail(a):ws.widget.Dialogs.ok(Config.Strings.EmailNotCorrectNoSN)},composeEmail:function(a){if(a){var c=
null;if(typeof a=="string")c=a;else if(this.isEmailAddress(a.innerHTML))c=a.innerHTML;c?this.composeEmailCB(b.hitch(this,function(a){a.reset({to:c,backToString:this.backToString,isDirty:!0})})):ws.widget.Dialogs.ok(Config.Strings.EmailNotCorrect)}},composeEmailCB:function(){},isEmailAddress:function(a){return a?(a=a.match(/(.+)@(.+)\.(.+)/),a!=null&&a.length==4):!1},openIM:function(){this.data.screenName&&ws.presence.launchIM(this.data.screenName)},GetRequestParamsForPrint:function(a){var c={};c.sortBy=
this.addressModel.core.sortBy;c.sortDir=this.addressModel.core.sortDirection;c.nameFormat=Settings.AddressNameDisplayFormat;c.categoryFilter=this.addressModel.getCurrentCategorySearchString();return ws.address.AddressBookUtil.GetRequestParamsForPrint(a,c)},printContact:function(){var a=this.uid+"";a?(a="command=selected&"+this.GetRequestParamsForPrint("selected")+"&uidList="+a,ws.address.AddressBookUtil.OpenAddressPrintWindow(a)):ws.widget.Dialogs.ok(Config.Strings.NoContactsCheckedErrorMsg)},_suiteOnKeyPress:function(a){if(this.isShowing()&&
Config.EnableKeyboardShortcuts&&a.keyChar&&b.isString(a.keyChar)&&!a.ctrlKey&&!a.altKey&&!a.metaKey)switch(a.keyChar.toLowerCase()){case Config.Strings.KeyPrintContactDetail:this.printContact();break;case Config.Strings.KeyCloseContactDetail:this.close()}},close:function(){this.closeCB&&this.closeCB()},clearSearch:function(){this.addressModel.search();this.close()}}));b._hasResource["ws.address.ComposeAddressField"]||(b._hasResource["ws.address.ComposeAddressField"]=!0,b.provide("ws.address.ComposeAddressField"),
b.declare("ws.address.ComposeAddressField",ws.address.AddressField,{templateString:"<div class='caf wsInput'><div class='addressLabel' dojoAttachPoint='contactSelector2' style='line-height:${lineHeight}px;'>${ghostText}:</div><div dojoAttachPoint='contactSelector' class='contactSelector'><div class='csIcon mainSprite' style='line-height:${lineHeight}px;'></div></div><div dojoAttachPoint='scrollContainer' style='overflow:hidden;'><textarea dojoAttachPoint='field' dojoAttachEvent='onkeydown: onKeyDown, onkeypress: onKeyPress, onfocus: onFocus, onblur: onBlur' tabindex='${tabindex}' class='${className}' style='overflow:hidden;height: ${baseSize}px; width: 100%'>${value}</textarea></div></div>",
css:{templateString:""},ghostText:"",ghostTextPersistent:!0,maxHeight:0,minHeight:0,numOfLines:0,startingNumOfLines:0,padding:7,baseSize:12,lineHeight:0,width:0,postMixInProperties:function(){if(this.startingNumOfLines>this.numOfLines)this.startingNumOfLines=this.numOfLines;this.lineHeight=this.lineHeight!=0?this.lineHeight:this.baseSize;this.maxHeight=this.numOfLines!=0?this.numOfLines*this.lineHeight:this.lineHeight*4;this.minHeight=this.lineHeight*(this.startingNumOfLines?this.startingNumOfLines:
1)},postCreate:function(){this.inherited(arguments);b.addClass(this.field,"wsInputBare");if(!this.ghostText)this.contactSelector2.style.display="none";if(this.width!=0)this.domNode.style.width=this.width+"px";this.connect(this.contactSelector,"onclick",this.showPeoplePicker);this.ghostText&&!this.ghostTextPersistent?this.connect(this.contactSelector2,"onmousedown",this.showPeoplePicker):this.connect(this.contactSelector2,"onclick",this.showPeoplePicker);this.anchorNode=this.domNode;this.connect(this,
"onClick","handleClick")},onKeyPress:function(a){a.ctrlKey&&window.setTimeout(b.hitch(this,"resizeSelf",!0),100);this.inherited(arguments)},showPeoplePicker:function(a){b.stopEvent(a);this.togglePeoplePicker(this.domNode)},handleClick:function(a){a.target&&(!b.hasClass(a.target,"addressField")&&!b.hasClass(a.target,"csIcon")&&this.field.focus(),(b.hasClass(a.target,"csIcon")||b.hasClass(a.target,"addressLabel"))&&a.preventDefault())},reset:function(){this.setValue("");this.ghostText?b.query(".addressLabel",
this.domNode)[0].style.display="":b.query(".addressLabel",this.domNode)[0].style.display="none"},createMeasureNode:function(){if(!this.measureNode)this.measureNode=b.create("div",{style:{position:"absolute",visibility:"hidden",top:"-10000px",left:"10000px",fontSize:this.baseSize+"px",lineHeight:this.lineHeight+"px"}},b.body()),this.field.style.fontSize=this.baseSize+"px",this.field.style.lineHeight=this.lineHeight+"px"},resizeSelf:function(a){this.createMeasureNode();var c=b.coords(this.field).w;
this.measureNode.innerHTML=this.field.value.replace(/\n/g,"<br>");this.measureNode.style.width=parseInt(c)+"px";var c=b.contentBox(this.measureNode),c=Math.max(this.minHeight,c.h),d=Math.min(this.maxHeight,c);this.field.style.height=c+"px";if(a)this.domNode.style.height=d+this.padding+"px",this.repositionPicker();d==this.maxHeight?c>d?this.domNode.style.overflowY="auto":(this.domNode.style.height=d+this.padding-4+"px",this.repositionPicker()):(this.domNode.style.overflowY="hidden",this.domNode.style.height=
d+"px",this.repositionPicker())},onFocus:function(){if(this.ghostText&&!this.ghostTextPersistent)b.query(".addressLabel",this.domNode)[0].style.display="none";this.inherited(arguments)},onBlur:function(){ws.lang.setTimeout(this,function(){if(this.ghostText&&!this.ghostTextPersistent&&this.getValue()=="")b.query(".addressLabel",this.domNode)[0].style.display=""},50);this.inherited(arguments)},repositionPicker:function(){this._pickerActive&&this.peoplePicker.move(this.domNode,{offsetHeight:-1});this.onResizedSelf()},
scrollToEnd:function(){this.domNode.scrollTop=1E4;this.scrollContainer.scrollTop=1E4;this.field.scrollTop=1E4}}));b._hasResource["ws.address.DistributionListWidget"]||(b._hasResource["ws.address.DistributionListWidget"]=!0,b.provide("ws.address.DistributionListWidget"),b.declare("ws.address.DistributionListGridModel",l.grid.data.Dynamic,{columns:{Icon:0,Name:1,Hover:2,Email:3},modelUpdated:function(){},listInfo:null,constructor:function(a,c,b){this.model=b},setListInfo:function(a){this.listInfo=a;
this.modelUpdated()},getDatum:function(a,c){var b;b=this.listInfo.sortedContactsAndAddresses[a];switch(c){case this.columns.Icon:return this.getBuddyIcon(b);case this.columns.Name:return typeof b=="object"?(sortBy="LastFirstEmailScreenNamePhone",sortBy=Settings.AddressNameDisplayFormat=="LastFirstNick"?"LastFirstEmailScreenNamePhone":"FirstLastEmailScreenNamePhone",ws.address.AddressBookUtil.getNameInfoHTML(b,sortBy)):ws.string.substituteParams("{0}",this.listInfo.sortedContactsAndAddresses[a]);case this.columns.Hover:return this.getHoverColumnCB?
this.getHoverColumnCB(a):"";case this.columns.Email:if(typeof b=="object"){var e="",e=email1=b.email1?b.email1:"",f=b.email2?b.email2+", ":"";f!=""&&(email1!=""&&(e+=", "),e+=f);b=b.screenName?b.screenName:"";if(b!=""){if(e!=""||e!="")e+=", ";e+=b}return e}else return ws.string.substituteParams("({0})",this.listInfo.sortedContactsAndAddresses[a])}},getRowCount:function(){return this.listInfo?this.listInfo.contacts.length+this.listInfo.addresses.length:0},getBuddyIcon:function(a){var c=Config.SpacerImageURL;
a&&Settings.ShowPresenceIcon&&(c=ws.presence.getBuddyIconUrl(a,!0)||Config.SpacerImageURL);return c==Config.SpacerImageURL?ws.string.substituteParams('<img style="width: 32px; height: 32px;" align=\'absmiddle\' src="{0}" class="mainLargeIcon hoverRefNode noBuddyIcon buddyShadow showIcon">',c):ws.string.substituteParams('<div style="width: 32px; height: 32px;"><img style="visibility: hidden; width: 32px; height: 32px; border: 1px solid #85817c" onerror="window.fixMissingAvatar(this);" onload="this.style.visibility = \'\';" class="hoverRefNode buddyIcon buddyShadow showIcon" align=\'absmiddle\' src="{0}"></div>',
c)}}),b.declare("ws.address.DistributionListWidget",ws.widget.ListView,{templateString:b.cache("ws.address","DistributionListWidget.html",'<div dojoAttachEvent="onkeydown: onKeyPressInputField">\r\n\t<div dojoType="dijit.layout.StackContainer" class="listView distributionList" dojoAttachPoint="stackWidget">\r\n\t\t<div dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="createPane" class="createPane">\r\n\t\t\t<div dojoType="ws.widget.WSToolbar" dojoAttachPoint="toolbar" layoutAlign="top" vizType="Controls">\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:cancel" title="${Cancel}" iconClassName="cancelIcon" toolbarPosition="right"></div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" layoutAlign="client" class="newList">\r\n                <div>\r\n                    <div class="headerDiv">${NewList}</div>\r\n\r\n                    <div>\r\n                        <div defaultValue="${ListName}" dojoType="ws.widget.DefaultTextbox" className="wsInput nameInput" dojoAttachPoint="createNameField" maxlength="255" tabindex="1"></div>\r\n                    </div>\r\n\r\n                    <div dojoType="ws.address.ComposeAddressField" ghostText="${AddContacts}" lineHeight="14" ghostTextPersistent="false" startingNumOfLines="4" numOfLines="4" class="selector" width="445" dojoAttachPoint="createAddressField"></div>\r\n\r\n                    <div class="buttonGroup">\r\n                        <div dojoType="ws.widget.Button" dojoAttachPoint="addListButton" dojoAttachEvent="onClick: checkRequiredFields">${AddList}</div>\r\n                        <div dojoType="ws.widget.Button" dojoAttachPoint="cancelListButton" dojoAttachEvent="onClick: cancel" type="Bare">${Cancel}</div>\r\n                    </div>\r\n                </div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t\r\n\t\t<div dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="editPane" class="editPane">\r\n\t\t\t<div dojoType="ws.widget.WSToolbar" dojoAttachPoint="toolbar" layoutAlign="top" vizType="Controls">\r\n                <div dojoType="ws.widget.Button" dojoAttachEvent="onClick:emailList" title="${EmailListTip}" iconClassName="composeIcon">${EmailList}</div>\r\n                <div dojoType="ws.widget.Button" dojoAttachPoint="deleteListButton" dojoAttachEvent="onClick:deleteList" title="${DeleteList}" iconClassName="delIcon">${DeleteListTip}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:cancel" title="${Close}" iconClassName="cancelIcon" toolbarPosition="right"></div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" layoutAlign="top" style="border-bottom: 1px solid #DEDEDE; padding-bottom:12px;" class="editList">\r\n                <div>\r\n                    <div class="displayName" dojoAttachPoint="displayNameDiv">\r\n                        <span dojoAttachPoint="nameSpan" class="nameSpan"></span>\r\n                        <a href="#" dojoAttachPoint="editNameSpan" dojoAttachEvent="onclick:editName">${EditName}</a>\r\n                        <a href="#" dojoAttachEvent="onclick:deleteList" dojoAttachPoint="deleteListAnchor">${DeleteList}</a>\r\n                    </div>\r\n                    <div class="editName" dojoAttachPoint="editNameDiv" style="display:none">\r\n                        <input type="text" class="wsInput" dojoAttachPoint="editNameField" />\r\n                        <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: saveName">${Save}</div>\r\n                        <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: cancelName">${Cancel}</div>\r\n                        <br style="clear: both" />\r\n                    </div>\r\n\r\n                    <div class="addContactDiv" dojoAttachPoint="addContactDiv">\r\n                        <div dojoType="ws.address.ComposeAddressField" ghostText="${AddContacts}" ghostTextPersistent="false" startingNumOfLines="4" numOfLines="4" class="selector" width="445" dojoAttachPoint="editAddressField"></div>\r\n                        <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: addMembers">${Add}</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n           \r\n\t\t\t<div dojoType="ws.widget.Pane" layoutAlign="client" class="content">\r\n\t\t\t\t<div dojoType="dojox.Grid" dojoAttachPoint="grid"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,addressModel:null,listInfo:null,closeCB:null,backToString:Config.Strings.BackToDistList,speedUp:!0,showHeader:!1,hoverColumnHtml:'<div class="wsHotClearButton mainSprite"></div>',autosizeColumnId:"Email",startup:function(){this.inherited(arguments);if(screen.height<=768&&screen.width<=1024)this.createAddressField.minHeight=45,this.createAddressField.maxHeight=90;b.connect(this.editAddressField,"onResizedSelf",this,"onResized");this.setModel(new ws.address.DistributionListGridModel(null,
null,this.addressModel));b.subscribe("Suite/onKeyOnPress",this,"_suiteOnKeyPress");this.addListButton.setTitle(ws.string.substituteParams(Config.Strings.CreateListTip,"("+(b.isMac?Config.Strings.CtrlReturnKey:Config.Strings.CtrlEnterKey)+")"));this.cancelListButton.setTitle(ws.string.substituteParams(Config.Strings.CancelTip,"("+(b.isMac?Config.Strings.OptKey:Config.Strings.AltKey)+" "+Config.Strings.KeyCancelAddContact+")"));ws.WebSuite.SidePanel.setupAdScroll(this.domNode)},_suiteOnKeyPress:function(a){this.isShowing()&&
(a=ws.html.fixKeyForMac(a),a.keyChar&&b.isString(a.keyChar)&&a.keyChar.toLowerCase()==Config.Strings.KeyCancelAddContact&&a.altKey&&this.cancel())},onKeyPressInputField:function(a){if(a.keyCode>=65&&a.keyCode<=90)a.keyChar=String.fromCharCode(a.keyCode);this._suiteOnKeyPress(a)},initView:function(){this.columns=[{id:"Icon",width:"35px"},{id:"Name",width:"200px"},{id:"Hover",width:"18px"},{id:"Email",width:"200px"}];this.inherited(arguments)},showCreateView:function(){this.stackWidget.selectChild(this.createPane);
this.createNameField.setValue("");this.createNameField.focus();this.createAddressField.reset();this.resetDirty();this.reportNewDistList()},reportNewDistList:function(){ws.reporting.report("New DistList","Addresses")},showList:function(a){this.stackWidget.selectChild(this.editPane);this.addressModel.getDistributionList({uid:a,load:b.hitch(this,function(a){this.listDataReceived(a);b.publish("WSFeedbackEnd",[Config.Strings.Loading])}),error:function(a){ws.widget.Dialogs.ok(a||Config.Strings.ErrorLoadingDistList);
b.publish("WSFeedbackEnd",[Config.Strings.Loading])}});ws.reporting.report("Edit DistList","Addresses")},listDataReceived:function(a){if(this.goToListDetails)this.stackWidget.selectChild(this.editPane),this.goToListDetails=!1;this.listInfo=a;this.nameSpan.innerHTML=ws.string.escapeXml(a.name);this.displayNameDiv.style.display="";this.editNameDiv.style.display="none";this.editAddressField.setValue("");this.gridModel.setListInfo(a);this.deleteListButton.show();this.hoverColumnHtml='<div class="mainSprite wsHotClearButton"></div>';
this.editNameSpan.innerHTML=Config.Strings.EditName;this.addContactDiv.style.display="";this.resetDirty();this.onResized()},checkRequiredFields:function(){var a="",c=b.trim(this.createNameField.getValue()),d=b.map(this.createAddressField.getValue().split(/[;,]/),b.trim);if(c)if(this.addressModel.searchDLName(c)!=null)a=Config.Strings.DuplicateDistributionList;else{if(d.length==1&&!d[0])a=Config.Strings.IncludeEmailDistList}else a=Config.Strings.NameDistList;a?this.declaredClass=="ws.address.PeoplePanelAddListCard"?
(this.close(),ws.widget.Dialogs.ok(a,b.hitch(this,"open",this.cachedArgs))):ws.widget.Dialogs.ok(a):this.createList(c)},createList:function(a){var c=ws.address.AddressBookUtil._mapAddressesToContacts(this.createAddressField,this.addressModel);this.listInfo={uid:0,name:a,contacts:c.contacts,addresses:c.addresses};this.goToListDetails=!0;this.saveList(!0,Config.Strings.DistributionListCreated,null,function(){ws.reporting.report("Edit DistList","Addresses")})},addMembers:function(){this._addMembers(ws.address.AddressBookUtil._mapAddressesToContacts(this.editAddressField,
this.addressModel))},_addMembers:function(a,c){if(a.contacts.length||a.addresses[0]){this.listInfo.contacts=this.listInfo.contacts.concat(a.contacts);this.listInfo.addresses=this.listInfo.addresses.concat(a.addresses);var b=a.contacts.length+a.addresses.length,b=b==1?Config.Strings.DistListContactAddedSingular:ws.string.substituteParams(Config.Strings.DistListContactAddedPlural,b);this.saveList(!0,c||b,null,null)}},handleHoverControlClick:function(a){if(a.target&&(b.hasClass(a.target,"wsHotClearButton")||
a.target.firstChild&&b.hasClass(a.target.firstChild,"wsHotClearButton"))){var a=a.rowIndex,c,d=null,e;e=this.listInfo.sortedContactsAndAddresses[a];if(typeof e=="object"){var f;f=this.getIndexOfContact(e);f!=null?c=this.listInfo.contacts.splice(f,1):(f=this.getIndexOfAddress(e),c=this.listInfo.addresses.splice(f,1));this.listInfo.sortedContactsAndAddresses.splice(a,1)}else for(f=0;f<this.listInfo.addresses.length;f++)if(e==this.listInfo.addresses[f]){c=this.listInfo.addresses.splice(f,1);this.listInfo.sortedContactsAndAddresses.splice(a,
1);break}this.gridModel.modelUpdated();if(Config.EnableUndo)var g=typeof c[0]=="object"?{addresses:[],contacts:c}:{addresses:c,contacts:[]},d=b.hitch(this,function(){this._addMembers(g,Config.Strings.DistListContactRestored)});this.saveList(!0,Config.Strings.DistListContactRemoved,d,null)}},getIndexOfContact:function(a){if(!a)return null;for(var c=0;c<this.listInfo.contacts.length;c++)if(a.uid==this.listInfo.contacts[c].uid)return c},getIndexOfAddress:function(a){if(!a)return null;for(var c=0;c<this.listInfo.addresses.length;c++)if((email=
a.email1?a.email1:a.email2)&&email==this.listInfo.addresses[c])return c},editName:function(){this.editNameField.value=this.listInfo.name;this.displayNameDiv.style.display="none";this.editNameDiv.style.display="";ws.html.selectInputText(this.editNameField);this.editPane.resize()},saveName:function(){this.editNameField.value?this.addressModel.searchDLName(this.editNameField.value)!=null?ws.widget.Dialogs.ok(Config.Strings.DuplicateDistributionList):(this.listInfo.name=this.editNameField.value,ws.html.setInnerText(this.nameSpan,
this.editNameField.value),this.saveList(!1,Config.Strings.DistributionListUpdated,null,null),this.cancelName()):ws.widget.Dialogs.ok(Config.Strings.NameDistList)},cancelName:function(){this.editNameDiv.style.display="none";this.displayNameDiv.style.display="";this.editPane.resize()},saveList:function(a,c,d,e){this.addressModel.createOrModifyDistributionList({uid:this.listInfo.uid,name:this.listInfo.name,contactUids:b.map(this.listInfo.contacts,function(a){return a.uid}),addresses:this.listInfo.addresses,
load:b.hitch(this,function(f){c&&b.publish("WSFeedbackStart",[c,!0,d]);a&&this.listDataReceived(f);e&&e()}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for addressModel.createOrModifyDistributionList-saveList file:DistributionListWidget.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorSavingDistList)}})},deleteList:function(){Config.EnableUndo?(this.addressModel.setUndoItem(this.listInfo),this._deleteList(!0)):this._confirmationDelete()},
_confirmationDelete:function(){ws.widget.Dialogs.okCancel(Config.Strings.DeleteDistributionList,b.hitch(this,function(a){a&&this._deleteList()}))},_deleteList:function(a){this.addressModel.deleteAddresses({uids:[this.listInfo.uid],load:b.hitch(this,function(){var c=a?b.hitch(this.addressModel,"undoDeletedItem"):null;b.publish("WSFeedbackStart",[Config.Strings.DistributionListDeletedSingular,!0,c,a?b.hitch(this,function(){this.addressModel.setUndoItem()}):null]);this.cancel()}),error:b.hitch(this,
function(a){this.addressModel.setUndoItem();window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for addressModel.deleteAddresses-_deleteList file:DistributionListWidget.js");ws.widget.OkCancelDialog.alert(a||Config.Strings.ErrorDeletingDistListNotFound)})})},showCreatePeoplePicker:function(a){this.createAddressField.togglePeoplePicker(this.createAddressField);a.preventDefault()},emailList:function(){this.composeEmailCB(b.hitch(this,function(a){a.reset({to:this.listInfo.composeValue,
backToString:this.backToString,isDirty:!0})}))},composeEmailCB:function(){},isDirty:function(){return this.getCurrentStateHash()!=this.initialStateHash},resetDirty:function(){this.initialStateHash=this.getCurrentStateHash()},getCurrentStateHash:function(){var a="";a+=this.createNameField.getValue();a+=this.createAddressField.getValue();a+=this.editAddressField.getValue();return a},cancel:function(){ws.reporting.skipBeaconReporting=!0;this.close(this.isDirty())},close:function(a){this.closeCB&&this.closeCB(a)}}));
b._hasResource["ws.address.EditContactDialog"]||(b._hasResource["ws.address.EditContactDialog"]=!0,b.provide("ws.address.EditContactDialog"),b.declare("ws.address.EditContactDialog",[h._Widget,h._Templated],{templateString:b.cache("ws.address","EditContactDialog.html",'<div class="editContact" dojoAttachEvent="onkeydown: onKeyPressInputField">\r\n    <div dojoAttachPoint="layoutWidget" dojoType="dijit.layout.LayoutContainer" style="height: 100%; width: 100%;">\r\n\t\t<div dojoType="ws.widget.WSToolbar" dojoAttachPoint="toolbar" layoutAlign="top" vizType="Controls">\r\n\t\t\t<div dojoType="ws.widget.Button" dojoAttachPoint="deleteContactButton" dojoAttachEvent="onClick: deleteContact" title="${DeleteContactTip}" iconClassName="delIcon">${Delete}</div>\r\n\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:cancel" title="${Cancel}" iconClassName="cancelIcon" toolbarPosition="right"></div>\r\n\t\t</div>\r\n        <div dojoType="ws.widget.Pane" layoutAlign="client" class="editContainer">\r\n            <div class="parentContainer">\r\n\r\n                <div class="contactType" dojoAttachPoint="contactTypeSpan"></div>\r\n\r\n                <div dojoAttachPoint="buddyIconNode" class="buddyIconNode" style="display:none;">\r\n                    <div style="float:left" dojoType="ws.widget.BuddyIcon" dojoAttachPoint="buddyIcon"></div>\r\n                    <div style="float:left" dojoAttachPoint="theName" class="theName"></div>\r\n                </div>\r\n                <div dojoAttachPoint="firstLastNameBlk" class="firstNameDiv">\r\n                    <div style="float:left">\r\n                        <label>${FirstName}</label>\r\n                        <div dojoType="ws.widget.DefaultTextbox" className="regularInput" dojoAttachPoint="firstNameInput1" maxlength="255" tabindex="1"></div>\r\n                    </div>\r\n                    <div style="float:left">\r\n                        <label>${LastName}</label>\r\n                        <div dojoType="ws.widget.DefaultTextbox" className="regularInput" dojoAttachPoint="lastNameInput1"  maxlength="255" tabindex="2"></div>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="lastFirstNameBlk">\r\n                    <div style="float:left">\r\n                        <label>${LastName}</label>\r\n                        <div dojoType="ws.widget.DefaultTextbox" className="regularInput" dojoAttachPoint="lastNameInput2"  maxlength="255" tabindex="1"></div>\r\n                    </div>\r\n                    <div style="float:left">\r\n                        <label>${FirstName} *</label>\r\n                        <div dojoType="ws.widget.DefaultTextbox" className="regularInput" dojoAttachPoint="firstNameInput2" maxlength="255" tabindex="2"></div>\r\n                    </div>\r\n                </div>\r\n                <div>\r\n                    <label>${Nickname}</label>\r\n                    <div><div class="regularInput" dojoType="ws.widget.DefaultTextbox" className="buddyIconInput" dojoAttachPoint="nickNameInput" maxlength="90" tabindex="3"></div></div>\r\n                </div>\r\n                <div dojoAttachPoint="row" style="display:none;">\r\n                    <label>${DisplayName}</label>\r\n                    <div><input type="text" maxlength="80" class="wsInput regularInput" dojoAttachPoint="displayNameInput" tabindex="3" /></div>\r\n                </div>\r\n\r\n                <div dojoAttachPoint="row1">\r\n                    <label>${ScreenName}</label>\r\n                    <div><input type="text" maxlength="80" class="wsInput regularInput" dojoAttachPoint="screenNameInput" tabindex="3" /></div>\r\n                </div>\r\n\r\n                <div dojoAttachPoint="row2" class="row2">\r\n                    <label>${Email1}</label>\r\n                    <div><input type="text" maxlength="255" class="wsInput regularInput" dojoAttachPoint="email1Input" tabindex="4" /> <a href="#" dojoAttachPoint="addAnotherEmailLink" dojoAttachEvent="onclick: addAnotherEmail" class="wsLink addAnother">+ ${Another}</a></div>\r\n                </div>\r\n\r\n                <div dojoAttachPoint="row3">\r\n                    <label>${Email2}</label>\r\n                    <div><input type="text" maxlength="255" class="wsInput regularInput" dojoAttachPoint="email2Input" tabindex="5" /></div>\r\n                </div>\r\n\r\n                <div dojoAttachPoint="row4">\r\n                    <label>${PhonePrimary}</label>\r\n                    <div>\r\n                        <input type="text" maxlength="255" class="wsInput phoneInput leftAlign" dojoAttachPoint="phone1Input" tabindex="6" />\r\n                        <ul dojoType="ws.widget.WSSelect" className="phoneDropDownButton leftAlign" tabindex="7" dojoAttachPoint="phone1Button">\r\n                            <li value="Cellular">${Cellular}</li>\r\n                            <li value="Home">${Home}</li>\r\n                            <li value="Work">${Work}</li>\r\n                            <li value="Pager">${Pager}</li>\r\n                            <li value="Fax">${Fax}</li>\r\n                        </ul>\r\n                        <a href="#" dojoAttachPoint="phone1Link" dojoAttachEvent="onclick: addAnotherPhone1" class="wsLink addAnother leftAlign">+ ${Another}</a>\r\n                    </div>\r\n                </div>\r\n\r\n\r\n                <div dojoAttachPoint="row5">\r\n                    <label>${PhoneOther}</label>\r\n                    <div>\r\n                        <input type="text" maxlength="255" class="wsInput phoneInput leftAlign" dojoAttachPoint="phone2Input" tabindex="8" />\r\n                        <ul dojoType="ws.widget.WSSelect" className="phoneDropDownButton leftAlign" tabindex="9" dojoAttachPoint="phone2Button">\r\n                            <li value="Cellular">${Cellular}</li>\r\n                            <li value="Home">${Home}</li>\r\n                            <li value="Work">${Work}</li>\r\n                            <li value="Pager">${Pager}</li>\r\n                            <li value="Fax">${Fax}</li>\r\n                        </ul>\r\n                        <a href="#" dojoAttachPoint="phone2Link" dojoAttachEvent="onclick: addAnotherPhone2" class="wsLink addAnother leftAlign">+ ${Another}</a>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row6">\r\n                    <label>${PhoneOther}</label>\r\n                    <div>\r\n                        <input type="text" maxlength="255" class="wsInput phoneInput leftAlign" dojoAttachPoint="phone3Input" tabindex="10" />\r\n                        <ul dojoType="ws.widget.WSSelect" className="phoneDropDownButton leftAlign" tabindex="11" dojoAttachPoint="phone3Button">\r\n                            <li value="Cellular">${Cellular}</li>\r\n                            <li value="Home">${Home}</li>\r\n                            <li value="Work">${Work}</li>\r\n                            <li value="Pager">${Pager}</li>\r\n                            <li value="Fax">${Fax}</li>\r\n                        </ul>\r\n                        <a href="#" dojoAttachPoint="phone3Link" dojoAttachEvent="onclick: addAnotherPhone3" class="wsLink addAnother leftAlign">+ ${Another}</a>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row7">\r\n                    <label>${PhoneOther}</label>\r\n                    <div>\r\n                        <input type="text" maxlength="255" class="wsInput phoneInput leftAlign" dojoAttachPoint="phone4Input" tabindex="12" />\r\n                        <ul dojoType="ws.widget.WSSelect" className="phoneDropDownButton leftAlign" tabindex="13" dojoAttachPoint="phone4Button">\r\n                            <li value="Cellular">${Cellular}</li>\r\n                            <li value="Home">${Home}</li>\r\n                            <li value="Work">${Work}</li>\r\n                            <li value="Pager">${Pager}</li>\r\n                            <li value="Fax">${Fax}</li>\r\n                        </ul>\r\n                        <a href="#" dojoAttachPoint="phone4Link" dojoAttachEvent="onclick: addAnotherPhone4" class="wsLink addAnother leftAlign">+ ${Another}</a>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row8">\r\n                    <label>${PhoneOther}</label>\r\n                    <div>\r\n                        <input type="text" maxlength="255" class="wsInput phoneInput leftAlign" dojoAttachPoint="phone5Input" tabindex="14" />\r\n                        <ul dojoType="ws.widget.WSSelect" className="phoneDropDownButton leftAlign" tabindex="15" dojoAttachPoint="phone5Button">\r\n                            <li value="Cellular">${Cellular}</li>\r\n                            <li value="Home">${Home}</li>\r\n                            <li value="Work">${Work}</li>\r\n                            <li value="Pager">${Pager}</li>\r\n                            <li value="Fax">${Fax}</li>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row9" class="categoryList">\r\n                    <div>\r\n                        <div className="categoryDropDownButton" dojoType="ws.widget.DropDownLink" tabindex="16" arrowSize="large" dojoAttachPoint="categoryButton" dojoAttachEvent="onClick: refreshDefaultItems, onKeyPress: refreshDefaultItems"></div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div dojoAttachPoint="row10">\r\n                    <div class="headerLabels ciLabel">${CompanyInfo}</div>\r\n                </div>\r\n\r\n                <div dojoAttachPoint="row11">\r\n                    <div style="float:left;">\r\n                        <label>${CompanyNameInfo}</label>\r\n                        <div><input type="text" maxlength="255" class="wsInput regularInput" dojoAttachPoint="companyInput" tabindex="16" /></div>\r\n                    </div>\r\n                    <div style="float:left;">\r\n                        <label>${JobTitle}</label>\r\n                        <input type="text" maxlength="255" class="wsInput jobTitleInput regularInput" dojoAttachPoint="jobTitleInput" tabindex="17" />\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row12">\r\n                    <label>${Department}</label>\r\n                    <input type="text" maxlength="255" class="wsInput deptInput" dojoAttachPoint="deptInput" tabindex="18" />\r\n                </div>\r\n\r\n                <div dojoAttachPoint="row13" class="fll">\r\n                    <div class="headerLabels">${CompanyAddress}</div>\r\n                    <div>\r\n                        <\!--\r\n                        <div class="addressFieldDiv">\r\n                            <div class="addressInputLabels">${Street}</div>\r\n                            <input type="text" maxlength="255" class="addressInput" dojoAttachPoint="workStreet1Input" tabindex="19" />\r\n                            <a href="#" dojoAttachPoint="addAnotherWorkStreet1Link" dojoAttachEvent="onclick: addAnotherWorkStreet1" class="wsLink addAnother">+ ${StreetField}</a>\r\n                        </div>\r\n                        --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row14" class="fll">\r\n                    <div>\r\n                        <\!--\r\n                        <div class="addressFieldDiv">\r\n                            <div class="addressInputLabels">${Street}</div>\r\n                            <input type="text" maxlength="255" class="addressInput" dojoAttachPoint="workStreet2Input" tabindex="20" />\r\n                            <a href="#" dojoAttachPoint="addAnotherWorkStreet2Link" dojoAttachEvent="onclick: addAnotherWorkStreet2" class="wsLink addAnother">+ ${StreetField}</a>\r\n                        </div>\r\n                        --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row15" class="fll">\r\n                    <div>\r\n                        <\!--\r\n                        <div class="addressFieldDiv2">\r\n                            <div class="addressInputLabels">${Street}</div>\r\n                            <input type="text" maxlength="255" class="addressInput" dojoAttachPoint="workStreet3Input" tabindex="21"/>\r\n                        </div>\r\n                        --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row16">\r\n                    <div>\r\n                        <\!--\r\n                        <div class="addressFieldDiv2">\r\n                            <div class="addressInputLabels">${City}</div>\r\n                            <input type="text" maxlength="255" class="addressInput" dojoAttachPoint="workCityInput" />\r\n                        </div>\r\n                        --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row17" class="fl">\r\n                    <div>\r\n                        <\!--\r\n                        <div class="addressFieldDiv2">\r\n                            <div class="addressInputLabels" dojoAttachPoint="workStateLabel">${State}</div>\r\n                            <input type="text" maxlength="255" class="addressStateInput" dojoAttachPoint="workStateInput" />\r\n                        </div>\r\n                        --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row18" class="fl">\r\n                    <div>\r\n                        <\!--\r\n                        <div class="addressFieldDiv2">\r\n                            <div class="addressInputLabels">${Zip}</div>\r\n                            <input type="text" maxlength="255" class="addressZipInput" dojoAttachPoint="workZipInput" />\r\n                        </div>\r\n                        --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row19" class="fl">\r\n                    <div>\r\n                        <\!--\r\n                        <div class="addressFieldDiv2">\r\n                            <div class="addressInputLabels">${Country}</div>\r\n                            <input type="text" maxlength="255" class="addressInput" dojoAttachPoint="workCountryInput" />\r\n                        </div>\r\n                        --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row20"></div>\r\n                <div dojoAttachPoint="row21" class="fll">\r\n                    <div class="headerLabels">${Home} ${Address}</div>\r\n                    <div>\r\n                        <\!--\r\n                        <div class="addressFieldDiv">\r\n                            <div class="addressInputLabels">${Street}</div>\r\n                            <input type="text" maxlength="255" class="addressInput" dojoAttachPoint="homeStreet1Input" tabindex="22" />\r\n                            <a href="#" dojoAttachPoint="addAnotherHomeStreet1Link" dojoAttachEvent="onclick: addAnotherHomeStreet1" class="wsLink addAnother">+ ${StreetField}</a>\r\n                        </div>\r\n                        --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row22" class="fll">\r\n                    <div>\r\n                    <\!--\r\n                        <div class="addressFieldDiv">\r\n                            <div class="addressInputLabels">${Street}</div>\r\n                            <input type="text" maxlength="255" class="addressInput" dojoAttachPoint="homeStreet2Input" tabindex="23"/>\r\n                            <a href="#" dojoAttachPoint="addAnotherHomeStreet2Link" dojoAttachEvent="onclick: addAnotherHomeStreet2" class="wsLink addAnother">+ ${StreetField}</a>\r\n                        </div>\r\n                    --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row23" class="fll">\r\n                    <div>\r\n                    <\!--\r\n                        <div class="addressFieldDiv2">\r\n                            <div class="addressInputLabels">${Street}</div>\r\n                            <input type="text" maxlength="255" class="addressInput" dojoAttachPoint="homeStreet3Input" tabindex="24"/>\r\n                        </div>\r\n                    --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row24">\r\n                    <div>\r\n                    <\!--\r\n                        <div class="addressFieldDiv2">\r\n                            <div class="addressInputLabels">${City}</div>\r\n                            <input type="text" maxlength="255" class="addressInput" dojoAttachPoint="homeCityInput" />\r\n                        </div>\r\n                    --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row25" class="fl">\r\n                    <div>\r\n                    <\!--\r\n                        <div class="addressFieldDiv2">\r\n                            <div class="addressInputLabels" dojoAttachPoint="homeStateLabel">${State}</div>\r\n                            <input type="text" maxlength="255" class="addressStateInput" dojoAttachPoint="homeStateInput" />\r\n                        </div>\r\n                    --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row26" class="fl">\r\n                    <div>\r\n                    <\!--\r\n                        <div class="addressFieldDiv2">\r\n                            <div class="addressInputLabels">${Zip}</div>\r\n                            <input type="text" maxlength="255" class="addressZipInput" dojoAttachPoint="homeZipInput" />\r\n                        </div>\r\n                    --\>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row27" class="fl">\r\n                    <div>\r\n                    <\!--\r\n                        <div class="addressFieldDiv2">\r\n                            <div class="addressInputLabels">${Country}</div>\r\n                            <input type="text" maxlength="255" class="addressInput" dojoAttachPoint="homeCountryInput" />\r\n                        </div>\r\n                    --\>\r\n                    </div>\r\n                </div>\r\n\r\n                <div dojoAttachPoint="row28">\r\n                    <div class="headerLabels piLabel">${PersonalInfo}</div>\r\n                </div>\r\n\r\n                <div dojoAttachPoint="row29" class="fl">\r\n                    <label>${SpouseOrSignificant}</label>\r\n                    <div><input type="text" maxlength="80" class="wsInput regularInput" dojoAttachPoint="personalSpouseInput" tabindex="25"/></div>\r\n                </div>\r\n                <div dojoAttachPoint="row30" class="fl">\r\n                    <label>${KidsQuestion}</label>\r\n                    <div><input type="text" maxlength="80" class="wsInput regularInput" dojoAttachPoint="personalFamilyInput" tabindex="26"/></div>\r\n                </div>\r\n                <div dojoAttachPoint="row31">\r\n                    <div style="float:left;">\r\n                        <label>${Birthday}</label>\r\n                        <div><input type="text" maxlength="80" class="wsInput regularInput" dojoAttachPoint="personalBirthdayInput" tabindex="27"/></div>\r\n                    </div>\r\n                    <div style="float:left;">\r\n                        <label>${Anniversary}</label>\r\n                        <div><input type="text" maxlength="80" class="wsInput regularInput" dojoAttachPoint="personalAnniversaryInput" tabindex="28"/></div>\r\n                    </div>\r\n                </div>\r\n                <div dojoAttachPoint="row32">\r\n                    <label>${Notes}</label>\r\n                    <div><div dojoType="ws.widget.DefaultTextarea" className="regularInput notes" dojoAttachPoint="personalNotesInput" maxLength="4096" rows="4" tabindex="29"></div></div>\r\n                </div>\r\n                <div dojoAttachPoint="row33"></div>\r\n                <div dojoAttachPoint="row34"></div>\r\n                <div dojoAttachPoint="row35">\r\n                    <div>\r\n                        <a href="#" class="addMoreDetail" dojoAttachEvent="onclick: showAllDetails">${AddMoreDetail}</a>\r\n                    </div>\r\n                </div>\r\n                <div class="buttonGroup">\r\n                    <div dojoType="ws.widget.Button" dojoAttachPoint="saveContactButton" dojoAttachEvent="onClick: checkRequiredFields" title="${SaveContactTip}">\r\n                        ${AddContact}\r\n                    </div>\r\n                    <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: cancel" dojoAttachPoint="cancelContactButton" type="Bare">\r\n                        ${Cancel}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,addressModel:null,closeCB:null,cancelCB:null,backToListCB:null,uid:null,data:null,returnToGridOnCancel:null,lastFirstFmt:!1,firstNameInput:null,lastNameInput:null,textValues:["personalBirthday","personalAnniversary","displayName","screenName","email1","email2","phone1","phone2","phone3","phone4","phone5","company","jobTitle","dept","workStreet1","workStreet2","workStreet3","workCity","workState","workZip","workCountry","homeStreet1",
"homeStreet2","homeStreet3","homeCity","homeState","homeZip","homeCountry","personalSpouse"],preferredEmailTypes:["Undefined","ScreenName","Email1","Email2"],contactPhoneTypes:["Undefined","Cellular","Fax","Home","Pager","Work"],phoneTypeItems:["cellItem","homeItem","workItem","pagerItem","faxItem"],phones:["phone1","phone2","phone3","phone4","phone5"],startup:function(){Config.ContactDetailDisplayFormat.toLowerCase().indexOf("last")==0?(b._destroyElement(this.firstLastNameBlk),this.firstNameInput=
this.firstNameInput2,this.lastNameInput=this.lastNameInput2):(b._destroyElement(this.lastFirstNameBlk),this.firstNameInput=this.firstNameInput1,this.lastNameInput=this.lastNameInput1);for(var a=Config.AddressOrder.split(" "),c=13,d=0;d<2;){var e=!1,c=13;d==1&&(c=21,e=!0);for(var f=0;f<5;f++)a[f]=="Street"?(this._buildAddressFields(this["row"+c],"Street1",e),c++,this._buildAddressFields(this["row"+c],"Street2",e),c++,this._buildAddressFields(this["row"+c],"Street3",e)):this._buildAddressFields(this["row"+
c],a[f],e),c++;d++}b.subscribe("Suite/onKeyOnPress",this,"_suiteOnKeyPress");if(b.isIE)this.firstNameInput.textbox.style.marginRight="7px";this.cancelContactButton.domNode.title=ws.string.substituteParams(Config.Strings.CancelTip,"("+(b.isMac?Config.Strings.OptKey:Config.Strings.AltKey)+" "+Config.Strings.KeyCancelAddContact+")");e=b.create("span",{style:{left:"-9999px",top:"-9999px"}},b.body());a=0;d=null;for(f=13;f<=19;f++)if(c="row"+f,c=b.query(".addressInputLabels",this[c])[0])d=c,e.innerHTML=
d.innerHTML,c=b._getMarginSize(e).w,c>a&&(a=c);b._destroyElement(e);f=0;if(d)f=b._getMarginSize(d).w;if(a>f)for(f=13;f<=27;f++)if(f!=20&&(c="row"+f,c=b.query(".addressInputLabels",this[c])))(d=c[0])&&b.marginBox(d,{w:a+2});ws.WebSuite.SidePanel.setupAdScroll(this.domNode)},_buildAddressFields:function(a,c,d){var e={City:'<div class="addressFieldDiv2"><label>'+Config.Strings.City+'</label><input type="text" maxlength="255" class="wsInput addressInput"/></div>',State:'<div class="addressFieldDiv2"><label>'+
Config.Strings.State+'</label><input type="text" maxlength="255" class="wsInput stateInput" /></div>',Zip:'<div class="addressFieldDiv2"><label>'+Config.Strings.Zip+'</label><input type="text" maxlength="255" class="wsInput zipInput"/></div>',Country:'<div class="addressFieldDiv2"><label>'+Config.Strings.Country+'</label><input type="text" maxlength="255" class="wsInput countryInput"/></div>',Street1:'<div class="addressFieldDiv2"><label>'+Config.Strings.Street+'</label><input type="text" maxlength="255" class="wsInput addressInput"/><a href="#" class="wsLink addAnother">'+
Config.Strings.StreetField+"</a></div>",Street2:'<div class="addressFieldDiv2"><label>'+Config.Strings.Street+'</label><input type="text" maxlength="255" class="wsInput addressInput"/><a href="#" class="wsLink addAnother">'+Config.Strings.StreetField+"</a></div>",Street3:'<div class="addressFieldDiv2"><label>'+Config.Strings.Street+'</label><input type="text" maxlength="255" class="wsInput addressInput"/></div>'}[c],f=b.query("div:last-child",a)[0];f.innerHTML=e;this[d?"home"+c+"Input":"work"+c+"Input"]=
f.getElementsByTagName("input")[0];if(c=="Street1"||c=="Street2"||c=="Street3"){var g;d?(d="addAnotherHome"+c+"Link",e="addAnotherHome"+c,g="home"+c+"Row"):(d="addAnotherWork"+c+"Link",e="addAnotherWork"+c,g="work"+c+"Row");c!="Street3"&&(this[d]=f.getElementsByTagName("a")[0],this.connect(this[d],"onclick",e));c!="Street1"&&(this[g]=a)}},buildCategoryDropDownMenu:function(){if(this.addressModel.getCategories()){var a=null,c=[];b.forEach(this.addressModel.getCategories(),b.hitch(this,function(a){c.push(a)}));
for(var d=[],a=0;a<c.length;a++){var e=this.translateCategoryName(c[a]),f=c[a];d.push({caption:e,value:f,onClick:b.hitch(this,"setupCategoryLabel",e,f)})}d.push({separator:!0});d.push({caption:Config.Strings.AddNew,_onClick:b.hitch(this,"addNewCategory"),id:this.id+"newcat"});this.categoryButton.setMenuDefinition(d)}},translateCategoryName:function(a){return a=="Co-Workers"||a=="Friends"||a=="Family"||a=="General"||a=="Auto-Added"||a=="Uncategorized"?Config.Strings["ABCat"+a.replace("-","")]:ws.string.escapeXml(ws.string.summary(a,
17))},setupCategoryLabel:function(a,c){this.categoryButton.setLabel(a);this.categoryButton.value=c},addNewCategory:function(a){a&&a.stopPropagation();a=h.byId(this.id+"newcat");this.newCategoryWidget=new ws.widget.WSInputableMenuItem({defaultValue:Config.Strings.NewCategory,okCB:b.hitch(this,"displayNewCategory"),originalMenuItem:a,inputClassName:"newCategoryInput"});this.categoryButton.menu.addChild(this.newCategoryWidget);this.categoryButton.menu.getChildren();a.hide();ws.lang.setTimeout(this,function(){this.newCategoryWidget.show();
this.newCategoryWidget.initializeText(Config.Strings.NewCategory);if(b.isFF==2)this.categoryButton.menu.domNode.style.minWidth="126px"},0)},displayNewCategory:function(a){return a&&a.newName?(this.setupCategoryLabel(this.translateCategoryName(a.newName),a.newName),!1):!0},refreshDefaultItems:function(){},isEmptyContact:function(){return this.nickNameInput.getValue()?!1:this.firstNameInput.getValue()?!1:this.lastNameInput.getValue()?!1:!0},checkRequiredFields:function(){if(this.isEmptyContact()==!0)ws.widget.Dialogs.ok(Config.Strings.EmptyContactMessage);
else{var a="",c="";this.email1Input.value&&!this.isEmailAddress(this.email1Input.value)&&(a=ws.string.substituteParams(Config.Strings.ErrorEmailFormat,Config.Strings.Email1));this.email2Input.value&&!this.isEmailAddress(this.email2Input.value)&&(c=ws.string.substituteParams(Config.Strings.ErrorEmailFormat,Config.Strings.Email2));a?ws.widget.Dialogs.ok(a):c?ws.widget.Dialogs.ok(c):this.saveAndClose()}},isEmailAddress:function(a){a=a.match(/(.+)@(.+)\.(.+)/);return a!=null&&a.length==4},saveAndClose:function(){var a=
null,c={uid:this.uid};if(this.firstNameInput.getValue())c.firstName=this.firstNameInput.getValue();if(this.lastNameInput.getValue())c.lastName=this.lastNameInput.getValue();a=b.trim(this.personalBirthdayInput.value);if(a!=null&&a.length>0)c.personalBirthday=a;a=b.trim(this.personalAnniversaryInput.value);if(a!=null&&a.length>0)c.personalAnniversary=a;if(this.nickNameInput.getValue())c.nickName=this.nickNameInput.getValue();c.personalFamily=this.personalFamilyInput.value;if(this.personalNotesInput.getValue())c.personalNotes=
ws.string.summary(this.personalNotesInput.getValue(),4096);for(a=2;a<this.textValues.length;a++)c[this.textValues[a]]=b.trim(this[this.textValues[a]+"Input"].value);for(a=0;a<this.phoneTypeItems.length;a++)if(this[this.phones[a]+"Input"].value)c[this.phones[a]+"Type"]=this[this.phones[a]+"Button"].currentValue;c.category=this.categoryButton.containerNode.innerHTML==Config.Strings.ABCatSelectGroup?"Uncategorized":this.categoryButton.value||"Uncategorized";c.preferredEmail=this.getPreferredEmail(c);
this.saveContactButton.disable();c.load=b.hitch(this,"contactSaved");c.error=b.hitch(this,function(a){this.saveContactButton.enable();if(a&&a.indexOf(Config.AddressBookFullCodeString)>=0)a=Config.Strings.ErrorAddressBookFull;ws.widget.Dialogs.ok(a||Config.Strings.ErrorSavingContactServerError,b.hitch(this,function(){a==Config.Strings.InvalidBirthdayDate?this.personalBirthdayInput.select():a==Config.Strings.InvalidAnniversaryDate&&this.personalAnniversaryInput.select();a==Config.Strings.ErrorAddressBookFull&&
this.backToList()}))});this.addressModel.createOrModifyContact(c);this.data=c},getPreferredEmail:function(a){return"screenName"in a&&a.screenName?this.preferredEmailTypes[1]:"email1"in a&&a.email1?this.preferredEmailTypes[2]:"email2"in a&&a.email2?this.preferredEmailTypes[3]:this.preferredEmailTypes[1]},populateForm:function(a){if(a){if(Settings.ShowPresenceIcon)this.buddyIconNode.style.display="",this.buddyIcon.show(a),this.buddyIcon.onLoad();var c=null;this.row.style.display="displayName"in a&&
b.trim(a.displayName).length>0?"":"none";if("personalBirthday"in a)this.personalBirthdayInput.value=a.personalBirthday,this.showSection("Personal");if("personalAnniversary"in a)this.personalAnniversaryInput.value=a.personalAnniversary,this.showSection("Personal");a.nickName&&this.nickNameInput.setValue(a.nickName);a.firstName&&this.firstNameInput.setValue(a.firstName);a.lastName&&this.lastNameInput.setValue(a.lastName);if(a.personalFamily)this.personalFamilyInput.value=a.personalFamily,this.showSection("Personal");
a.personalNotes&&(this.personalNotesInput.setValue(a.personalNotes),this.showSection("Personal"));var d;if(a.firstName)d=a.firstName;a.lastName&&(d+=(a.firstName?" ":"")+a.lastName);if(d)this.theName.innerHTML=d;for(c=2;c<this.textValues.length;c++)if(this[this.textValues[c]+"Input"].value=this.textValues[c]in a?a[this.textValues[c]]:"",this[this.textValues[c]+"Input"].value)c>10&&c<20?this.showSection("Work"):c>19&&c<27?this.showSection("Home"):c>26?this.showSection("Personal"):this[this.textValues[c]+
"Input"].parentNode.parentNode.style.display="";if(this.email2Input.value)this.addAnotherEmailLink.style.display="none";for(c=0;c<this.phones.length;c++)if(this.setPhoneTypeMenu(this[this.phones[c]+"Button"],this.phones[c]+"Type"in a?a[this.phones[c]+"Type"]:"Undefined"),c<4&&this.phones[c+1]+"Type"in a)this[this.phones[c]+"Link"].style.display="none";this.categoryButton.setLabel("category"in a?this.translateCategoryName(a.category):Config.Strings.ABCatGeneral);this.categoryButton.value="category"in
a?a.category:"General"}else{for(a=0;a<this.textValues.length;a++)this[this.textValues[a]+"Input"].value="";this.theName.innerHTML="";this.nickNameInput.setValue();this.firstNameInput.setValue();this.lastNameInput.setValue();this.personalFamilyInput.value="";this.personalNotesInput.setValue();this.buddyIconNode.style.display="none"}},setPhoneTypeMenu:function(a,c){switch(c){case this.contactPhoneTypes[3]:a.setOption(1);break;case this.contactPhoneTypes[4]:a.setOption(3);break;case this.contactPhoneTypes[5]:a.setOption(2);
break;case this.contactPhoneTypes[2]:a.setOption(4);break;default:a.setOption(0)}},showSection:function(){for(var a=null,a=10;a<20;a++)this["row"+a.toString()].style.display="";this.workStreet2Input.value?(this.addAnotherWorkStreet1Link.parentNode.className="addressFieldDiv2",this.workStreet2Row.style.display="",this.addAnotherWorkStreet1Link.style.display="none"):this.workStreet2Row.style.display="none";this.workStreet3Input.value?(this.addAnotherWorkStreet2Link.parentNode.className="addressFieldDiv2",
this.workStreet3Row.style.display="",this.addAnotherWorkStreet2Link.style.display="none"):this.workStreet3Row.style.display="none";if(Config.ABHideState)a=this.workStateInput.parentNode.getElementsByTagName("div")[0],a.style.display="none",this.workStateInput.style.display="none";for(a=20;a<28;a++)this["row"+a.toString()].style.display="";this.homeStreet2Input.value?(this.addAnotherHomeStreet1Link.parentNode.className="addressFieldDiv2",this.homeStreet2Row.style.display="",this.addAnotherHomeStreet1Link.style.display=
"none"):this.homeStreet2Row.style.display="none";this.homeStreet3Input.value?(this.addAnotherHomeStreet2Link.parentNode.className="addressFieldDiv2",this.homeStreet3Row.style.display="",this.addAnotherHomeStreet2Link.style.display="none"):this.homeStreet3Row.style.display="none";if(Config.ABHideState)a=this.homeStateInput.parentNode.getElementsByTagName("div")[0],a.style.display="none",this.homeStateInput.style.display="none";for(a=28;a<32;a++)this["row"+a.toString()].style.display="";this.row32.style.display=
"";this.row34.style.display="none";this.row35.style.display="none"},getEmailDomain:function(a){if(a==null||a=="")return"";var c="",a=a.match(/(.*)@(.*)/);a!=null&&a.length==3&&(c=a[2],c!=null&&(c=c.toLowerCase()));return c},showContact:function(a,c,d){this.returnToGridOnCancel=d||!1;this.uid=a||"0";this.data=null;this.populateForm();this.buildCategoryDropDownMenu();this.categoryButton.setLabel(Config.Strings.ABCatSelectGroup);for(d=5;d<35;d++)this["row"+d.toString()].style.display="none";this.row3.style.display=
"none";this.row9.style.display="";this.row34.style.display="";this.row35.style.display="";this.addAnotherEmailLink.style.display="";for(d=1;d<5;d++)this["phone"+d+"Link"].style.display="";this.addAnotherWorkStreet1Link.style.display="";this.addAnotherWorkStreet2Link.style.display="";this.addAnotherHomeStreet1Link.style.display="";this.addAnotherHomeStreet2Link.style.display="";this.deleteContactButton.hide();d=b.isMac?Config.Strings.CtrlReturnKey:Config.Strings.CtrlEnterKey;c?(this.data=c,a?(this.deleteContactButton.show(),
this.contactTypeSpan.style.display="none",ws.lang.setTimeout(this,function(){this.buddyIcon.show(c)},0),a=ws.string.substituteParams(Config.Strings.SaveContactTip,"("+d+")"),this.saveContactButton.setTitle(a),this.saveContactButton.setLabel(Config.Strings.Save)):(this.contactTypeSpan.innerHTML=Config.Strings.NewContact,a=ws.string.substituteParams(Config.Strings.CreateContactTip,"("+d+")"),this.saveContactButton.setTitle(a),this.saveContactButton.setLabel(Config.Strings.AddContact)),this.populateForm(c)):
(this.contactTypeSpan.innerHTML=Config.Strings.NewContact,this.contactTypeSpan.style.display="",a=ws.string.substituteParams(Config.Strings.CreateContactTip,"("+d+")"),this.saveContactButton.setTitle(a),this.saveContactButton.setLabel(Config.Strings.AddContact),this.row.style.display="none");this.resetDirty();this.firstNameInput1.textbox.focus();this.phone1Button.sizeMyself()},addAnotherEmail:function(){this.row3.style.display="";this.addAnotherEmailLink.style.display="none"},addAnotherPhone1:function(){this.row5.style.display=
"";this.phone1Link.style.display="none";this.phone2Button.sizeMyself()},addAnotherPhone2:function(){this.row6.style.display="";this.phone2Link.style.display="none";this.phone3Button.sizeMyself()},addAnotherPhone3:function(){this.row7.style.display="";this.phone3Link.style.display="none";this.phone4Button.sizeMyself()},addAnotherPhone4:function(){this.row8.style.display="";this.phone4Link.style.display="none";this.phone5Button.sizeMyself()},addAnotherWorkStreet1:function(){this.addAnotherWorkStreet1Link.parentNode.className=
"addressFieldDiv2";this.workStreet2Row.style.display="";this.addAnotherWorkStreet1Link.style.display="none"},addAnotherWorkStreet2:function(){this.addAnotherWorkStreet2Link.parentNode.className="addressFieldDiv2";this.workStreet3Row.style.display="";this.addAnotherWorkStreet2Link.style.display="none"},addAnotherHomeStreet1:function(){this.addAnotherHomeStreet1Link.parentNode.className="addressFieldDiv2";this.homeStreet2Row.style.display="";this.addAnotherHomeStreet1Link.style.display="none"},addAnotherHomeStreet2:function(){this.addAnotherHomeStreet2Link.parentNode.className=
"addressFieldDiv2";this.homeStreet3Row.style.display="";this.addAnotherHomeStreet2Link.style.display="none"},showWorkDetail:function(){this.showSection("Work")},showHomeDetail:function(){this.showSection("Home")},showPersonalDetail:function(){this.showSection("Personal")},showAllDetails:function(){this.showWorkDetail();this.showPersonalDetail();this.showHomeDetail()},isDirty:function(){return this.getCurrentStateHash()!=this.initialStateHash},resetDirty:function(){this.initialStateHash=this.getCurrentStateHash()},
getCurrentStateHash:function(){var a="";for(i=0;i<this.textValues.length;i++)a+=this[this.textValues[i]+"Input"].value;a+=this.nickNameInput.getValue();a+=this.firstNameInput.getValue();a+=this.lastNameInput.getValue();return a},cancel:function(){ws.reporting.skipBeaconReporting=!0;this.isDirty()&&this.cancelCB?this.cancelCB(b.hitch(this,function(){this.returnToGridOnCancel?this.backToList():this.close()})):this.returnToGridOnCancel?this.backToList():this.close()},close:function(){this.closeCB&&this.closeCB()},
contactSaved:function(a){this.resetDirty();this.data.uid=a.uid;this.savedCB(this.data);b.publish("WSFeedbackStart",[this.uid&&this.uid!="0"?Config.Strings.ContactUpdated:Config.Strings.ContactCreated,!0]);this.saveContactButton.enable()},deleteContact:function(){Config.EnableUndo?(this.addressModel.setUndoItem(this.data),this._deleteContact(!0)):this._confirmationDelete()},_confirmationDelete:function(){ws.widget.Dialogs.okCancel(Config.Strings.DeleteContactsConfirmationSingular,b.hitch(this,function(a){a&&
this._deleteContact()}))},_deleteContact:function(a){this.addressModel.deleteAddresses({uids:[this.uid],load:b.hitch(this,function(c){this.resetDirty();c.isSuccess&&(c=a?b.hitch(this.addressModel,"undoDeletedItem"):null,b.publish("WSFeedbackStart",[Config.Strings.ContactDeletedSingular,!0,c,a?b.hitch(this,function(){this.addressModel.setUndoItem()}):null]))}),error:b.hitch(this,function(a){this.addressModel.setUndoItem();window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for addressModel.deleteAddresses-_deleteContact file:EditContactDialog.js");
ws.widget.Dialogs.ok(a||Config.Strings.ErrorDeletingContactNotFound)})});this.backToList()},_suiteOnKeyPress:function(a){this.isShowing()&&(a=ws.html.fixKeyForMac(a),Config.EnableKeyboardShortcuts&&a.ctrlKey?ws.html.fixKeyCodeForMac(a)==b.keys.ENTER&&this.checkRequiredFields():a.keyChar&&b.isString(a.keyChar)&&a.keyChar.toLowerCase()==Config.Strings.KeyCancelAddContact&&a.altKey&&this.cancel())},onKeyPressInputField:function(a){if(a.keyCode>=65&&a.keyCode<=90)a.keyChar=String.fromCharCode(a.keyCode);
this._suiteOnKeyPress(a)},savedCB:function(){},backToList:function(){this.backToListCB&&this.backToListCB()}}));b._hasResource["ws.address.ImportContactsWidget"]||(b._hasResource["ws.address.ImportContactsWidget"]=!0,b.provide("ws.address.ImportContactsWidget"),b.declare("ws.address.ImportContactsWidget",[ws.widget.WSModalPane,h._Templated],{templateString:b.cache("ws.address","ImportContactsWidget.html",'<div class="importContacts WSModalPane" dojoAttachPoint="importContactsDialog">\r\n\t<div dojoAttachEvent="onkeypress:onKeyPress,onkeydown:onKeyPress">\r\n        <img src="${spacer}" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick:hide">\r\n\t\t<div class="WSModalPaneInner">\r\n            <div class="importContainer">\r\n                <div class="heading">${AB_Import_ContactsImport}</div>\r\n\r\n                <div dojoAttachPoint="ImportAssistantDiv" class="sectionTop">\r\n                    <div dojoAttachPoint="ImportAssistantTitle" class="title">\r\n                        <span class="titleMain">${AB_Import_Assistant_Title}</span>\r\n                        <span class="titleMinor">${AB_Import_Assistant_TitleInfo}</span>\r\n                    </div>\r\n                    <div dojoAttachPoint="ImportAssistantComment" class="comment">${AB_Import_Assistant_Text1}</div>\r\n                    <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: downloadOutlookAssistant">${AB_Import_Assistant_ButtonLabel}</div>\r\n                </div>\r\n\r\n                <div dojoAttachPoint="ImportFileDiv" class="sectionBottom">\r\n\r\n                    <div class="formContainer">\r\n                        <div class="browseBtn">\r\n                            <div defaultValue="CSV, TXT or LDIF File" dojoType="ws.widget.DefaultTextbox" className="regularInput" dojoAttachPoint="selectedFileName" maxlength="255" tabindex="1"></div>\r\n                            <a href="#">Browse for file...</a>\r\n                        </div>\r\n                        <form method="post" enctype="multipart/form-data" dojoAttachPoint="fileUploadForm" style="margin-bottom:0px">\r\n                            <input class="chooseFileBtn" type="file" dojoAttachEvent="onchange: onFileInputChanged" dojoAttachPoint="fileInputNode" name="${id}file">\r\n                        </form>\r\n                        <div class="inputShield"></div>\r\n                    </div>\r\n\r\n                    <div class="choices">\r\n                        <input type="radio" name="${id}type" checked dojoAttachPoint="csvInputNode">\r\n                        <label for="${id}typecsv">${CSV}</label>\r\n                        <input type="radio" name="${id}type" dojoAttachPoint="txtInputNode">\r\n                        <label for="${id}typetxt">${TXT}</label>\r\n                        <input type="radio" name="${id}type" dojoAttachPoint="ldifInputNode">\r\n                        <label for="${id}typeldif">${LDIF}</label>\r\n                    </div>\r\n                </div>\r\n                <div class="buttonGroup">\r\n                    <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: importFromFile">${Import}</div>\r\n                    <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: cancel" type="Bare">${Cancel}</div>\r\n                 </div>\r\n            </div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,addressModel:null,startup:function(){if(!Config.EnableAddressBookImportAssistant||!Config.ImportAssistantDownloadURL)this.ImportAssistantDiv.style.display="none";this.inherited(arguments)},downloadOutlookAssistant:function(){var a=ws.io.openWindow(Config.ImportAssistantDownloadURL,"","");a!=null&&a.focus()},onFileInputChanged:function(){var a=this.fileInputNode.value,c=a.lastIndexOf("\\");c!=-1&&(a=a.substring(c+1));this.selectedFileName.setValue(a);
var b=a.lastIndexOf("."),c=!1;if(b!=-1){a=a.substring(b+1).toLowerCase();if(a=="csv")c=this.csvInputNode.checked=!0;else if(a=="txt")c=this.txtInputNode.checked=!0;else if(a=="ldif")c=this.ldifInputNode.checked=!0;c?this.disableTypeSelection([0,1,2],!0):this.disableTypeSelection([0,1,2],!1,0)}},disableTypeSelection:function(a,c,d){for(var e=b.query(".choices input",this.domNode),f=0;f<a.length;f++)e[a[f]].disabled=c;if(d!=void 0)e[d].checked=!0},getFormatParam:function(){var a="csv";this.ldifInputNode.checked?
a="ldif":this.txtInputNode.checked&&(a="txt");return a},importFromFile:function(){if(this.fileInputNode.value){var a=this.getFormatParam();b.publish("WSFeedbackStart",[Config.Strings.ImportingContacts]);this.addressModel.importContacts({formNode:this.fileUploadForm,format:a,timeout:18E5,load:b.hitch(this,function(a){b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.ContactsImported,a.count),!0]);this.hide()}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,
"Dialogs.ok shown - Error Handler for addressModel.importContacts-importFromFile file:ImportContactsWidget.js");this.hide();ws.widget.Dialogs.ok(a||Config.Strings.ErrorImportingContacts)}})}else ws.widget.Dialogs.ok(Config.Strings.ErrorSelectFile)},cancel:function(){this.hide()}}));b._hasResource["ws.address.ExportContactsWidget"]||(b._hasResource["ws.address.ExportContactsWidget"]=!0,b.provide("ws.address.ExportContactsWidget"),b.declare("ws.address.ExportContactsWidget",[ws.widget.WSModalPane,h._Templated],
{templateString:b.cache("ws.address","ExportContactsWidget.html",'<div class="exportContacts WSModalPane" dojoAttachPoint="importContactsDialog">\r\n\t<div dojoAttachEvent="onkeypress:onKeyPress,onkeydown:onKeyPress">\r\n        <img src="${spacer}" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick:hide">\r\n\t\t<div class="WSModalPaneInner">\r\n            <div class="exportContainer">\r\n                <div class="heading">${AB_Export_ContactsExport}</div>\r\n                <div dojoAttachPoint="ExportFileDiv" class="sectionBottom">\r\n                    <input type="radio" name="${id}type" checked dojoAttachPoint="csvInputNode">\r\n                    <label for="${id}typecsv">${CSV}</label>\r\n                    <input type="radio" name="${id}type" dojoAttachPoint="txtInputNode">\r\n                    <label for="${id}typetxt">${TXT}</label>\r\n                    <input type="radio" name="${id}type" dojoAttachPoint="ldifInputNode">\r\n                    <label for="${id}typeldif">${LDIF}</label>\r\n                </div>\r\n                <div class="buttonGroup">\r\n                    <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: exportToFile">${Export}</div>\r\n                    <div dojoType="ws.widget.Button" dojoAttachEvent="onClick: cancel" type="Bare">${Cancel}</div>\r\n                 </div>\r\n            </div>\r\n        </div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,addressModel:null,closeCB:null,getFormatParam:function(){var a="csv";this.ldifInputNode.checked?a="ldif":this.txtInputNode.checked&&(a="txt");return a},exportToFile:function(){var a=this.getFormatParam(),a=Config.BaseABPagesURL+"ABExport.aspx?command=all&format="+a;a+="&user="+ws.io.getUserUid();var c=b.io.iframe.create("ExportContacts",null,Config.EmptyFileURL);b.io.iframe.setSrc(c,a,!0);ws.reporting.report("Export Contacts",
"Addresses");this.hide()},cancel:function(){this.hide()}}));b._hasResource["ws.widget.HoverCardManager"]||(b._hasResource["ws.widget.HoverCardManager"]=!0,b.provide("ws.widget.HoverCardManager"),b.declare("ws.widget.HoverCardManager",null,{openDelay:400,closeDelay:400,orient:{TL:"TR"},hoverPointerSide:"right",hoverNodeClass:null,targetNodeClass:null,constructor:function(a,c,d,e,f){this.topNode=a;this.cardCtor=c;this.rowClass=d;e.manager=this;this.cardParams=e;this.shouldOpenFunction=f;this.mouseMoveHandles=
[];this.padding=[ws.widget.pointerWidth,-27];b.connect(this.topNode,"onmouseover",this,"onMouseOverGrid")},setHoverRefNode:function(a,c,b){if(c)this.orient=c;if(b)this.hoverPointerSide=b;if(a)this.hoverNodeClass=a},setTargetNodeClass:function(a){this.targetNodeClass=a},onMouseOverGrid:function(a){if(a){for(var c=a.target;c!=null&&!b.hasClass(c,this.rowClass);)c=c.parentNode;this.card&&this.card.isShowing()?c&&(!this.targetNodeClass||b.hasClass(a.target,this.targetNodeClass))?this.openSoon(c):this.closeSoon():
c&&(!this.targetNodeClass||b.hasClass(a.target,this.targetNodeClass))?this.openSoon(c):this.cancelOpen();this.mouseMoveHandles.length||b.forEach(ws.widget.popup.windows,function(a){try{a.document&&this.mouseMoveHandles.push(b.connect(a.document.documentElement,"onmousemove",this,"onMouseMove"))}catch(c){}},this)}},onMouseMove:function(a){var c=a.target.ownerDocument==document;this.overCard=c&&this.card&&ws.html.overElement(this.card.domNode,a);this.overTopNode=c&&(b.isIE?b.getComputedStyle(this.topNode):
!0)&&ws.html.overElement(this.topNode,a);this.overPointerNode=c&&this.pointerNode&&ws.html.overElement(this.pointerNode,a);this.overCard||this.overPointerNode?this.cancelTimeouts():this.overTopNode||this.closeSoon()},openSoon:function(a){this.cancelTimeouts();this.openTimer=setTimeout(b.hitch(this,"open",a),this.openDelay)},closeSoon:function(){if(!this.closeTimer)this.cancelTimeouts(),this.closeTimer=setTimeout(b.hitch(this,"close"),this.closeDelay)},cancelTimeouts:function(){this.cancelOpen();this.cancelClose()},
cancelOpen:function(){this.openTimer&&clearTimeout(this.openTimer);this.openTimer=null},cancelClose:function(){this.closeTimer&&clearTimeout(this.closeTimer);this.closeTimer=null},open:function(a){this.card&&this.card.isShowing()&&this.close();if(!ws.widget.popup.isAnyPopupOpen()&&a.offsetHeight&&(this.shouldOpenFunction?this.shouldOpenFunction(a):1)){if(!this.card)this.card=new this.cardCtor(this.cardParams),this.card.startup();this.hoverNode=a;if(this.card.populate(this.hoverNode)){var c=a;this.hoverNodeClass&&
(a=b.query("."+this.hoverNodeClass,a))&&(c=a[0]);ws.widget.popup({popup:this.card,around:c,orient:this.orient,padding:this.padding});this.pointerNode=ws.widget.pointer({node:this.card.domNode,side:this.hoverPointerSide,target:c});b.publish("popup/open",[])}}},close:function(){if(!this.overCard&&!this.overTopNode&&!this.overPointerNode)b.forEach(this.mouseMoveHandles,function(a){try{b.disconnect(a)}catch(c){}}),this.mouseMoveHandles=[];this.card&&ws.widget.popup.close(this.card)}}));if(!b._hasResource["ws.address.AddressListView"])b._hasResource["ws.address.AddressListView"]=
!0,b.provide("ws.address.AddressListView"),b.declare("ws.address.AddressGridModel",l.grid.data.Dynamic,{columns:{Select:0,Icon:1,Contact:2,Email:3,ScreenName:4,Phone:5},sortableCols:["Contact","Email","ScreenName"],_initSort:!1,constructor:function(a,c,d){this.model=d;b.connect(this.model,"modelUpdated",this,"modelUpdated");b.connect(this.model,"change",this,"change")},modelUpdated:function(){},change:function(a){this.rowChange(null,a)},getDatum:function(a,c){var b=this.model.getRow(a);if(b==null)return Config.Strings.ContactError;
switch(c){case this.columns.Select:return this.model.isSelected(b.uid)?"ON":"OFF";case this.columns.Contact:return this.getContactColumnCB?this.getContactColumnCB(a,b):"";case this.columns.Icon:return this.getBuddyIcon(b);case this.columns.Email:var e="";b.bType=="c"?(e=[],b.email1&&e.push(" <span class='email' >"+ws.string.markupSearchString(this.model.currentTextSearch||null,b.email1)+" </span>"),b.email2&&e.push(" <span class='email' >"+ws.string.markupSearchString(this.model.currentTextSearch||
null,b.email2)+" </span>"),e=e.join("<span>,&nbsp;</span>")):b.bType=="d"?(e=b.count==1?Config.Strings.OneAddress:ws.string.substituteParams(Config.Strings.NAddresses,b.count),e=ws.string.substituteParams("{0} - {1}",e,ws.string.markupSearchString(this.model.currentTextSearch||null,b.composeValue))):b.bType=="s"&&(e=ws.string.markupSearchString(this.model.currentTextSearch||null,b.composeValue));return"<span class='emailCol wsLink'>"+e+"</span>";case this.columns.ScreenName:return b.screenName?"<span class='wsLink screenName'>"+
b.screenName+"</span>":"";case this.columns.Phone:return"<span class='phone'>"+ws.string.markupSearchString(this.model.currentTextSearch||null,this.buildPhoneString(b))+"</span>";default:return"Invalid Column"}},getBuddyIcon:function(a){var c=Config.SpacerImageURL;return a.bType=="d"?ws.string.substituteParams('<img align=\'absmiddle\' src="{0}" class="mainLargeIcon hoverRefNode distListBuddyIcon showIcon buddyShadow">',c):(Settings.ShowPresenceIcon&&(c=ws.presence.getBuddyIconUrl(a,!0)||Config.SpacerImageURL),
c==Config.SpacerImageURL?ws.string.substituteParams('<img style="width:32px;height:32px;" align=\'absmiddle\' src="{0}" class="mainLargeIcon hoverRefNode noBuddyIcon buddyShadow showIcon">',c):ws.string.substituteParams('<div style="width:32px;height:32px;position:relative;"><img style="visibility:hidden;width:32px;height:32px;position:absolute;" onerror="window.fixMissingAvatar(this);" onload="this.style.visibility = \'\';" class="hoverRefNode buddyIcon showIcon" align=\'absmiddle\' src="{0}"><div class="buddyShadow" style="width:31px;height:31px;position:absolute;"></div></div>',
c))},getRowCount:function(){return this.model.getRowCount()},buildPhoneString:function(a){var c="",b="";if(a.phone1Type&&a.phone1)c=a.phone1,b=a.phone1Type;else if(a.phone2Type&&a.phone2)c=a.phone2,b=a.phone2Type;else if(a.phone3Type&&a.phone3)c=a.phone3,b=a.phone3Type;else if(a.phone4Type&&a.phone4)c=a.phone4,b=a.phone4Type;else if(a.phone5Type&&a.phone5)c=a.phone5,b=a.phone5Type;else return"";a="";switch(b){case "Cellular":a=Config.Strings.Cellular+" ";break;case "Fax":a=Config.Strings.Fax+" ";
break;case "Home":a=Config.Strings.Home+" ";break;case "Pager":a=Config.Strings.Pager+" ";break;case "Work":a=Config.Strings.Work+" "}a+=c?ws.string.escapeXml(c):"";return a},getSortColumnIndex:function(a){var c="";switch(a){case this.columns.Contact:c=Settings.AddressNameSortOrder?Settings.AddressNameSortOrder:Config.DefaultAddressNameSortOrder;break;case this.columns.Email:c="PreferredEmail";break;case this.columns.ScreenName:c="ScreenName"}return c},canSort:function(a){a=Math.abs(a)-1;return b.some(this.sortableCols,
function(c){return a==this.columns[c]},this)},sort:function(a){this._initSort&&ws.reporting.report("Sort Contacts","Addresses");this.model.core.sortData(this.getSortColumnIndex(Math.abs(a)-1),a<0?"Descending":"Ascending")}}),b.declare("ws.address.AddressListView",ws.widget.ListView,{templateString:b.cache("ws.address","AddressListView.html",'<div>\r\n\t<div class="addressListView" dojoType="dijit.layout.StackContainer" dojoAttachPoint="stackWidget" style="height: 100%; width: 100%;">\r\n\t\t<div class="listView addressListView" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget">\r\n\t\t\t<div dojoType="ws.widget.WSToolbar" layoutAlign="top" dojoAttachPoint="toolbar" vizType="Controls">\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:newContact" iconClassName="newContactIcon" tip="${NewContact} <span>(${KeyNewContact})</span>">${NewContact}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:newDistributionList" iconClassName="newDistroIcon">${NewList}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick:deleteSelection" dojoAttachPoint="deleteButton" tip="${DeleteButton} <span>(${DeleteKey})</span>" iconClassName="delIcon">${DeleteButton}</div>\r\n\t\t\t\t<div dojoType="ws.widget.DropDownButton" dojoAttachPoint="toolsButton" title="${ActionButtonTip}" iconClassName="actionIcon">${ToolsButton}</div>\r\n\t\t\t\t<div dojoAttachPoint="printButton" dojoType="ws.widget.DropDownButton" title="${PrintContactsTip}" iconClassName="printIcon">${PrintButton}</div>\r\n\t\t\t\t<\!--<div dojoType="ws.widget.Button" dojoAttachEvent="onClick: LocateOnMap" dojoAttachPoint="mapButton">${LocateOnMapButton}</div>--\>\r\n\t\t\t\t<div toolbarPosition="right" dojoType="ws.widget.DropDownLink" dojoAttachPoint="filterButton" className="filterLink"></div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" dojoAttachPoint="searchInfoPane" class="searchInfo" layoutAlign="top" style="display:none">\r\n\t\t\t\t<div class="searchData">\r\n\t\t\t\t\t<span dojoAttachPoint="searchResultsNode"></span>\r\n\t\t\t\t\t<div class="mainSprite wsCloseBtn" dojoAttachEvent="onclick:clearSearch"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" layoutAlign="client">\r\n\t\t\t\t<div dojoAttachPoint="grid" dojoType="dojox.Grid"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojoType="ws.widget.Pane" dojoAttachPoint="emptyPane"/>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},wrapperModelClass:ws.address.AddressGridModel,backToString:Config.Strings.BackToAddressList,searchString:"",autosizeColumnId:"Email",contactDetails:null,distributionListWidget:null,editContactWidget:null,importContactsWidget:null,exportContactsWidget:null,origPrefs:null,columnDefaults:{Select:{order:0,width:36,hidden:!1},Icon:{order:1,width:36,hidden:!1},Contact:{order:2,width:190,min:100,max:300,hidden:!1},Email:{order:3,width:180,min:195,max:300,hidden:!1},ScreenName:{order:4,
width:75,min:45,max:150,hidden:!1},Phone:{order:5,width:134,min:75,max:250,hidden:!1}},initView:function(){this.initColumns();this.inherited(arguments);this.defSort=this.columnDefaults.Contact.order;this.grid.getSortIndex(this.grid.sortInfo)>0&&this.grid.setSortInfo(this.grid.sortInfo);this.gridModel._initSort=!0;this.gridModel.getContactColumnCB=b.hitch(this,"getContactColumn");this.initButtons();Config.HasLocalFileSystem||this.toolsButton.hide();Config.PrintingSupported||this.printButton.hide();
this.filterButton.setLabel("<b>"+Config.Strings.View+":</b> "+Config.Strings.All);this.buildFilterDropDownMenu();this.connect(this.model,"modelUpdated","modelUpdated");this.connect(ws.WebSuite,"processKeyPress","onKeyPress");this.connect(this.grid,"onRowContextMenu","onContextMenu");this.connect(this.grid,"onRowMouseOver","onRowMouseOver");this.connect(this.grid,"onRowMouseOut","onRowMouseOut");this.subscribe("ListSpacingResize",function(){this.grid.update()});this.setupAdScroll()},initColumns:function(a){this.columns=
[];var c=b.fromJson(Settings.AddressListPrefs);if(a||!c||c==""||c===Settings.AddressListPrefs)c=this.columnDefaults;this.origPrefs=c;try{var d={Select:"<div class='gridIcon ws_image_chkOffIcon'></div>",Icon:" ",Contact:Config.Strings.ContactsName,Email:Config.Strings.Email,ScreenName:Config.Strings.ContactsAIM,Phone:Config.Strings.Phone};this.columns[c.Select.order]={id:"Select",name:d.Select,width:this.columnDefaults.Select.width+"px",hidden:c.Select.hidden,noresize:!0,formatter:b.hitch(this,"formatSprite",
this.baseSprites.chkBox)};this.columns[c.Icon.order]={id:"Icon",name:d.Icon,width:c.Icon.width+"px",hidden:c.Icon.hidden,noresize:!0};this.columns[c.Contact.order]={id:"Contact",name:d.Contact,width:c.Contact.width+"px",hidden:c.Contact.hidden,noresize:!1};this.columns[c.Email.order]={id:"Email",name:d.Email,width:c.Email.width+"px",hidden:c.Email.hidden,noresize:!1};this.columns[c.ScreenName.order]={id:"ScreenName",name:d.ScreenName,width:c.ScreenName.width+"px",hidden:c.ScreenName.hidden,noresize:!1};
this.columns[c.Phone.order]={id:"Phone",name:d.Phone,width:c.Phone.width+"px",hidden:c.Phone.hidden,noresize:!1};this.columnMenuSpec=[{caption:Config.Strings.ColumnBuddy,checked:!1,onClick:b.hitch(this,"toggleColumn","Icon")},{caption:Config.Strings.ContactsName,checked:!1,onClick:b.hitch(this,"toggleColumn","Contact")},{caption:Config.Strings.Email,checked:!1,onClick:b.hitch(this,"toggleColumn","Email")},{caption:Config.Strings.ContactsAIM,checked:!1,onClick:b.hitch(this,"toggleColumn","ScreenName")},
{caption:Config.Strings.Phone,checked:!1,onClick:b.hitch(this,"toggleColumn","Phone")},{separator:!0},{caption:Config.Strings.ColumnReset,onClick:b.hitch(this,"toggleColumn","RESET")}];var e=b.filter(this.columns,function(a){return!a.hidden});this.grid.sortInfo=ws.lang.findByProp(e,"id","Contact")+1;b.isIE<8&&setTimeout(b.hitch(this,function(){this.grid.setStructure([{cells:[e]}])}))}catch(f){a||this.initColumns(!0)}},getRowClasses:function(a){var c=this.inherited(arguments);Config.TopContactsEnabled&&
Settings.EnableTopContacts&&this.model.isTopContact(a)&&c.push("row-top-contact");"Select"in this.gridModel.columns&&this.gridModel.getDatum(a,this.gridModel.columns.Select)=="ON"&&c.push("row-selected");return c},onHeaderColumnChange:function(a,c){for(var d={},e=this.columns,f=this.grid.views.views[0].structure.rows[0],g=0;g<e.length;g++){var j=e[g],k=ws.lang.findByProp(f,"id",j.id),k=parseInt(k==-1?j.width:f[k].unitWidth);b.isWebKit&&(k-=this.cellWidthPad);d[j.id]={order:g,width:k,hidden:j.hidden}}e=
!0;for(g in d){var f=d[g],j=this.origPrefs[g],h;for(h in f)if(h!="width"&&f[h]!=j[h]){e=!1;break}}if(!e||c)this.origPrefs=d,ws.settings.saveSoon({AddressListPrefs:d})},onHeaderContextMenu:function(a){if(!this.columnMenu)this.columnMenu=ws.widget.createMenu(this.columnMenuSpec),this.columnMenu.startup();var c=this.gridModel.columns,b=this.columnMenu.getChildren();b[0].setChecked(c.Icon!=-1);b[1].setChecked(c.Contact!=-1);b[2].setChecked(c.Email!=-1);b[3].setChecked(c.ScreenName!=-1);b[4].setChecked(c.Phone!=
-1);this.columnMenu.open(a.pageX,a.pageY)},modelUpdated:function(a){a&&this.buildFilterDropDownMenu();this.updateSearchInfo();this.onResized();this.setupAdScroll()},setupAdScroll:function(){var a=this.grid;setTimeout(function(){ws.WebSuite.SidePanel.setupAdScroll(a.views.views[0].scrollboxNode,"clist")},200)},updateZeroRowsView:function(){ws.address.AddressModel.prototype.easyTransferShowing=!1;this.inherited(arguments)},postCreateZeroRowsMessage:function(){},getZeroRowsMessage:function(){var a="<div class='search'>"+
Config.Strings.NoMatchesFound+"</div>";a+="<div class='zero'>";a+=Config.ShowEasyTransfer?ws.string.substituteParams('<div class="zeroRowHeader">{0}</div><div class="mainLargeIcon"></div><div class="desc"><span class="tip">{1}</span><span>{2}</span><a href="{3}" class="transferLink" target="_blank">{4}</a><span>{5}</span></div><div class="btnRow"></div>',Config.Strings.EasyTransferNoContacts,Config.Strings.TipWithColon,Config.Strings.EasyTransferText1,Config.EasyTransferUrl,Config.Strings.EasyTransfer,
Config.Strings.EasyTransferText2):Config.Strings.AddressBookEmpty;a+="</div>";return a},beforeShowZeroRowsMessage:function(){var a=this.model.getCurrentCategorySearchString(),c=b.query(".search",this.zeroRowsNode)[0],d=b.query(".zero",this.zeroRowsNode)[0];this.model.currentTextSearch||typeof a=="string"?(this.zeroRowsNode.className="loading",ws.html.setShowing(d,!1),ws.html.setShowing(c,!0)):(this.zeroRowsNode.className="easyTransferContainer",ws.address.AddressModel.prototype.easyTransferShowing=
!0,ws.html.setShowing(d,!0),ws.html.setShowing(c,!1))},initButtons:function(){this.printButton.menuDefinition=[{caption:Config.Strings.SelectedContacts,onClick:b.hitch(this,"PrintSelectedContacts")},{caption:Config.Strings.CurrentContacts,onClick:b.hitch(this,"PrintCurrentCategory")},{caption:Config.Strings.AllContacts,onClick:b.hitch(this,"PrintAllContacts")}];this.toolsButton.menuDefinition=[{caption:Config.Strings.Import,onClick:b.hitch(this,"importContacts"),disabled:!Config.EnableABImportButton},
{caption:Config.Strings.Export,onClick:b.hitch(this,"exportContacts"),disabled:!Config.EnableABExportButton}]},updatePrintMenu:function(a){a.getChildren()[0].setEnabled(this.model.getSelectedUids().length>0)},getContactColumn:function(a,c){var b='<div class="nameColumn">';b+='<span class="contactName showIcon">';c.name&&c.name!=""?b+=ws.string.markupSearchString(this.model.currentTextSearch||null,c.name):c.columnDisplayName&&c.columnDisplayName!=""&&(b+=ws.string.markupSearchString(this.model.currentTextSearch||
null,c.columnDisplayName));b+="</span>";b+='<span class="hoverGroup">';b+=ws.string.substituteParams('<span class="wsLink editHover wsMenuItemHover">{0}</span>',Config.Strings.Edit);b+="</span>";b+="</div>";return b},clearSearch:function(){this.model.search()},updateSearchInfo:function(){if(this.model.currentTextSearch){this.searchString=this.model.currentCategorySearch?ws.string.substituteParams(Config.Strings.ContactSearchHeaderCat,this.model.filteredIndex.offsets.length,this.model.currentTextSearch,
this.translateCategoryName(this.model.getCurrentCategorySearchString())):ws.string.substituteParams(Config.Strings.ContactSearchHeader,this.model.filteredIndex.offsets.length,"&ldquo;"+this.model.currentTextSearch+"&rdquo;");this.searchResultsNode.innerHTML=this.searchString;if(this.searchInfoPane.isShowing())return;this.searchInfoPane.show();ws.WebSuite.Navigation.searchActive(!0,this.searchInfoPane)}else this.searchInfoPane.hide(),this.searchString="",ws.WebSuite.Navigation.searchActive(!1,this.searchInfoPane);
ws.WebSuite.Navigation.hiliteCurrentApp()},GetRequestParamsForPrint:function(a){var c={};c.sortBy=this.model.core.sortBy;c.sortDir=this.model.core.sortDirection;c.nameFormat=Settings.AddressNameDisplayFormat;c.categoryFilter=this.model.getCurrentCategorySearchString();return ws.address.AddressBookUtil.GetRequestParamsForPrint(a,c)},PrintSelectedContacts:function(){var a=this.model.getSelectedUids();if(a.length==0)ws.widget.Dialogs.ok(Config.Strings.NoContactsCheckedErrorMsg);else{for(var c="",b=this.model.getRowsForUids(a),
e=0;e<a.length;e++){var f=this.model.getRow(b[e]);if(f!=null&&(f.bType=="c"||f.bType=="d"))c+=a[e]+","}c?(c=c.substring(0,c.length-1),a="command=selected&"+this.GetRequestParamsForPrint("selected")+"&uidList="+c,ws.address.AddressBookUtil.OpenAddressPrintWindow(a)):ws.widget.Dialogs.ok(Config.Strings.NoContactsCheckedErrorMsg)}},PrintCurrentCategory:function(){var a="command=category&"+this.GetRequestParamsForPrint("category");ws.address.AddressBookUtil.OpenAddressPrintWindow(a)},PrintAllContacts:function(){var a=
"command=all&"+this.GetRequestParamsForPrint("all");ws.address.AddressBookUtil.OpenAddressPrintWindow(a)},buildFilterDropDownMenu:function(){var a=this.model.getCurrentCategorySearchString();if(a)this.filterButton.setLabel("<b>"+Config.Strings.View+":</b> "+this.translateCategoryName(a)),this.toolbar.layout();else if(typeof a=="undefined"){this.model.categoryFilter("");this.filterButton.setLabel("<b>"+Config.Strings.View+":</b> "+Config.Strings.All);this.toolbar.layout();return}if(this.model.getCategories()){var a=
null,c=[];b.forEach(this.model.getCategories(),b.hitch(this,function(a){c.push(a)}));var d=[];d.push({caption:Config.Strings.All,onClick:b.hitch(this,"handleFilter",Config.Strings.All)});for(a=0;a<c.length;a++){var e=c[a],f=this.translateCategoryName(e);d.push({caption:f,onClick:b.hitch(this,"handleFilter",f,e)})}Config.TopContactsEnabled&&Settings.EnableTopContacts&&this.model.hasTopContacts()&&d.push({caption:Config.Strings.TopContacts_DisplayName,onClick:b.hitch(this,"handleFilter",Config.Strings.TopContacts_DisplayName)});
this.filterButton.setMenuDefinition(d)}},translateCategoryName:function(a){return a=="Co-Workers"||a=="Friends"||a=="Family"||a=="General"||a=="Auto-Added"||a=="Uncategorized"?Config.Strings["ABCat"+a.replace("-","")]:ws.string.escapeXml(ws.string.summary(a,26))},handleFilter:function(a,c){this.filterButton.setLabel("<b>"+Config.Strings.View+":</b> "+a);this.toolbar.layout();for(var b=[],e=this.model.getUnorderedCategories(),f=0;f<e.length;f++)b[e[f]]=f;a==Config.Strings.All?this.model.categoryFilter(""):
a==Config.Strings.TopContacts_DisplayName?this.model.categoryFilter(Config.Strings.TopContacts_DisplayName):this.model.categoryFilter(b[c]);ws.reporting.report("Filter Contacts","Addresses")},handleContactClick:function(a,c){b.hasClass(a.target,"trashHoverContacts")?(c=this.model.getRow(a.rowIndex),this.deleteSingleByRow(a.rowIndex,c.bType)):b.hasClass(a.target,"editHover")?(c=this.model.getRow(a.rowIndex),c.bType=="c"?(b.publish("WSFeedbackStart",[Config.Strings.Loading]),this.model.getContact({uid:c.uid,
load:b.hitch(this,function(a){this.editContact(c.uid,a,!0,!0)}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.getContact-handleContactClick file:AddressListView.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorLoadingContact);b.publish("WSFeedbackEnd",[Config.Strings.Loading])}})):c.bType=="d"?this.editDistributionList(c.uid):c.bType=="s"&&this.sharedGroup(c.name)):b.hasClass(a.target,"viewHover")?(c=this.model.getRow(a.rowIndex),
c.bType=="d"&&this.editDistributionList(c.uid)):c.bType=="c"?this.showContactDetails(c):c.bType=="d"?this.editDistributionList(c.uid):c.bType=="s"&&this.sharedGroup(c.name)},selectView:function(a,c,d){var e={contactDetails:[ws.address.ContactDetails,"View Contact"],editContactWidget:[ws.address.EditContactDialog,"Edit Contact"],distributionListWidget:[ws.address.DistributionListWidget,null]};if(!this[a]){var f=e[a][0],g={addressModel:this.model};g.closeCB=a=="editContactWidget"?b.hitch(this,"selectView",
"contactDetails"):a=="distributionListWidget"?b.hitch(this,"editDistListCancel"):b.hitch(this,"backToList");if(a=="editContactWidget")g.backToListCB=b.hitch(this,"backToList"),g.cancelCB=b.hitch(this,"editContactCancel");g.transitionCB=b.hitch(this,"selectEmptyPane");this[a]=new f(g);if(a=="contactDetails"||a=="distributionListWidget")b.connect(this[a],"composeEmailCB",this,"getComposeCB"),a=="contactDetails"&&b.connect(this[a],"editContact",this,"editContact");a=="editContactWidget"&&b.connect(this[a],
"savedCB",b.hitch(this,function(a){this.contactDetails?(this.contactDetails.showCreatedContact(a),this.selectView("contactDetails")):(this.selectView("contactDetails"),this.contactDetails.showCreatedContact(a))}));this.stackWidget.addChild(this[a])}c||(this.stackWidget.selectChild(this[a]),e[a][1]&&ws.reporting.report(d?"New Contact":e[a][1],"Addresses"))},deleteSelection:function(a){b.isArray(a)||(a=this.model.getSelectedUids());a.length==0?ws.widget.Dialogs.ok(Config.Strings.NoContactsCheckedErrorMsg):
a.length>1?this._confirmationDelete(Config.Strings.DeleteContactsConfirmationPlural,a,ws.string.substituteParams(Config.Strings.ContactDeletedPlural,a.length)):this.deleteSingleByUID(a[0])},deleteSingleByUID:function(a){var c=this.model.getRecordByUID(a);this._deleteSingle(a,c.bType)},deleteSingleByRow:function(a,c){this._deleteSingle(this.model.getUidForRow(a),c)},_deleteSingle:function(a,c){this.model.getRecordByUID(a);var b=Config.Strings.DeleteContactsGeneric,e=Config.Strings.ContactsGenericDeleted,
f=null;if(c=="c")b=Config.Strings.DeleteContactsConfirmationSingular,e=Config.Strings.ContactDeletedSingular,f="getContact";else if(c=="d")b=Config.Strings.DeleteDistributionList,e=Config.Strings.DistributionListDeletedSingular,f="getDistributionList";else if(c=="s")b=Config.Strings.DeleteSharedGroup,e=Config.Strings.SharedGroupDeleted,this._confirmationDelete(b,[a],e);f&&(Config.EnableUndo?this._deleteItemUndoPrep(f,a,b,e):this._confirmationDelete(b,[a],e))},_deleteItemUndoPrep:function(a,c,d,e){if(a)this.model[a]({uid:c,
load:b.hitch(this,function(a){this.model.setUndoItem(a);this._deleteAddresses([c],!0,e)}),error:b.hitch(this,function(){this._confirmationDelete(d,[c],e)})})},_confirmationDelete:function(a,c,d){ws.widget.Dialogs.okCancel(a||Config.Strings.DeleteContactsConfirmationSingular,b.hitch(this,function(a){a&&this._deleteAddresses(c,!1,d)}))},_deleteAddresses:function(a,c,d){d=a.length==1?Config.Strings.ContactDeletedSingular:ws.string.substituteParams(Config.Strings.ContactDeletedPlural,a.length);this.__deleteAddresses(a,
c,d,b.hitch(this,function(){this.model.deselectAll();Config.TopContactsEnabled&&Settings.EnableTopContacts&&this.model.topContactsEnabled()&&ws.WebSuite.theMailModel.resetCachedLists()}))},__deleteAddresses:function(a,c,d,e){this.model.deleteAddresses({uids:a,load:b.hitch(this,function(a){a.isSuccess&&(a=c?b.hitch(this.model,"undoDeletedItem"):null,b.publish("WSFeedbackStart",[d?d:Config.Strings.ContactDeletedSingular,!0,a,c?b.hitch(this,function(){this.model.setUndoItem()}):null]),e&&e())}),error:b.hitch(this,
function(a){this.model.setUndoItem();window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteAddresses-__deleteAddresses file:AddressListView.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorDeletingContactNotFound)})})},search:function(a){this.model.search(a)},getErrorMessage:function(){return Config.Strings.ErrorLoadingAddressBook},handleCellClick:function(a){var c=this.model.getRow(a.rowIndex);if(a.cellIndex==this.gridModel.columns.Contact)this.handleContactClick(a,
c);else if(a.target.className=="email"){var d=this.model.getRow(a.rowIndex),e="";if(d.bType=="c")e=d.email1||d.email2;else if(d.bType=="d")e=d.composeValue||"";else return;e?this.getComposeCB(b.hitch(this,function(a){a.reset({to:e,backToString:this.backToString,isDirty:!0})})):c.bType=="c"&&a.cellIndex!=this.gridModel.columns.Icon?this.showContactDetails(c):c.bType=="d"?this.editDistributionList(c.uid):c.bType=="s"&&this.sharedGroup(c.name)}else c.bType=="c"&&b.hasClass(a.target,"screenName")?(d=
ws.presence.getScreenNameForContact(c))?ws.presence.launchIM(d):c.bType=="c"&&a.cellIndex!=this.gridModel.columns.Icon?this.showContactDetails(c):c.bType=="d"?this.editDistributionList(c.uid):c.bType=="s"&&this.sharedGroup(c.name):c.bType=="c"?this.showContactDetails(c):c.bType=="d"?this.editDistributionList(c.uid):c.bType=="s"&&this.sharedGroup(c.name)},onContextMenu:function(a){var c=this.getRightClickMenu();c.isShowing()&&c.close();this.rightClickMenu.rowIndex=a.rowIndex;this.rightClickMenu.contact=
this.model.getRow(this.rightClickMenu.rowIndex);if(this.rightClickMenu.contact){var b=this.rightClickMenu.contact,e=b.screenName||b.email1||b.email2||b.composeValue,f=this.rightClickMenu.contact.screenName!=null,g=this.rightClickMenu.getChildren();g[3].setEnabled(e);g[4].setEnabled(f);Config.TopContactsEnabled&&Settings.EnableTopContacts&&g.length>=11&&(b.bType=="d"?(g[9].setEnabled(!1),g[10].setEnabled(!1)):this.model.isUidTopContact(b.uid)?(g[9].setEnabled(!1),g[10].setEnabled(!0)):(g[9].setEnabled(!0),
g[10].setEnabled(!1)));c.open(a.pageX,a.pageY);a.preventDefault();a.stopPropagation()}},getRightClickMenu:function(){var a=Config.TopContactsEnabled&&Settings.EnableTopContacts?10:7;if(!this.rightClickMenu){var c=[{caption:Config.Strings.Edit,onClick:b.hitch(this,"editContactFromMenu")},{caption:Config.Strings.Delete,onClick:b.hitch(this,"deleteContactFromMenu")},{separator:!0},{caption:Config.Strings.SendEmail,onClick:b.hitch(this,"sendEmail")},{caption:Config.Strings.SendIM,onClick:b.hitch(this,
"sendIM")},{separator:!0},{caption:Config.Strings.NewContact,onClick:b.hitch(this,"newContact")},{caption:Config.Strings.NewDistList,onClick:b.hitch(this,"newDistributionList")}];Config.TopContactsEnabled&&Settings.EnableTopContacts&&c.push({separator:!0},{caption:Config.Strings.TopContacts_AddToTopContacts,onClick:b.hitch(this,"addContactToTopContactsFromMenu")},{caption:Config.Strings.TopContacts_RemoveFromTopContacts,onClick:b.hitch(this,"removeContactFromTopContactsFromMenu")});this.rightClickMenu=
ws.widget.createMenu(c)}for(var c=this.rightClickMenu.getChildren(),d=c.length-1;d>a;d--){var e=c[d];this.rightClickMenu.removeChild(e);e.destroy()}return this.rightClickMenu},deleteContactFromMenu:function(){this.deleteSingleByRow(this.rightClickMenu.rowIndex,this.rightClickMenu.contact.bType)},sendIM:function(){this.rightClickMenu.contact.screenName&&ws.presence.launchIM(this.rightClickMenu.contact.screenName)},editContactFromMenu:function(){var a=this.rightClickMenu.contact;a.bType=="c"?this.model.getContact({uid:a.uid,
load:b.hitch(this,function(c){ws.WebSuite.editContact(a.uid,c,!0)}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.getContact-editContactFromMenu file:AddressListView.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorLoadingContact)}}):a.bType=="d"?ws.WebSuite.editDistributionList(a.uid):a.bType=="s"&&ws.WebSuite.sharedGroup(a.name)},addContactToTopContactsFromMenu:function(){var a=this.rightClickMenu.contact;a.bType==
"c"&&this.model.addContactToTopContacts({uid:a.uid,load:b.hitch(this,function(a){a.tcdluid?(ws.WebSuite.theMailModel.resetCachedLists(),b.publish("WSFeedbackStart",[Config.Strings.TopContacts_ContactAdded,!0])):ws.widget.Dialogs.ok(Config.Strings.TopContacts_ContactNotAdded)}),error:b.hitch(this,function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.addContactToTopContacts-addContactToTopContactsFromMenu file:AddressListView.js");
ws.widget.Dialogs.ok(a||Config.Strings.TopContacts_ContactNotAdded)})})},removeContactFromTopContactsFromMenu:function(){var a=this.rightClickMenu.contact;a.bType=="c"&&this.model.removeContactFromTopContacts({uid:a.uid,load:b.hitch(this,function(a){a.tcremoved?(ws.WebSuite.theMailModel.resetCachedLists(),b.publish("WSFeedbackStart",[Config.Strings.TopContacts_ContactRemoved,!0])):ws.widget.Dialogs.ok(Config.Strings.TopContacts_ContactNotRemoved)}),error:b.hitch(this,function(a){window.ws_ErrLgr&&
!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.removeContactFromTopContactsFromMenu-removeContactFromTopContactsFromMenu file:AddressListView.js");ws.widget.Dialogs.ok(a||Config.Strings.TopContacts_ContactNotRemoved)})})},sendEmail:function(){var a=this.rightClickMenu.contact,c=a.email1||a.email2||a.composeValue||a.screenName;Config.ValidateEmailFormat&&(c=a.email1||a.email2||a.composeValue);c&&ws.WebSuite.getCompose(null,function(a){a.reset({to:c,backToString:"setFolder"})})},
showContactDetails:function(a){b.publish("WSFeedbackStart",[Config.Strings.Loading]);ws.lang.setTimeout(this,function(){this.contactDetails?this.contactDetails.showContact(a.uid,this.searchString,b.hitch(this,function(){this.selectView("contactDetails");this.contactDetails.onResized()})):(this.selectView("contactDetails"),this.contactDetails.showContact(a.uid,this.searchString),this.contactDetails.onResized())},0)},updateToolbarState:function(){},newContact:function(){this.editContact(null,null,!0)},
editContact:function(a,c,d,e){var f=!1,g=a==null;this.editContactWidget?ws.lang.setTimeout(this,function(){this.selectView("editContactWidget",!1,g);this.editContactWidget.showContact(a,c,d?d:!1);this.editContactWidget.onResized()},0):(f=!0,e?(this.selectView("editContactWidget",!1,g),this.editContactWidget.showContact(a,c,d?d:!1)):(b.publish("WSFeedbackStart",[Config.Strings.Loading]),ws.lang.setTimeout(this,function(){this.selectView("editContactWidget",!1,g);this.editContactWidget.showContact(a,
c,d?d:!1)},0)));(f||e)&&ws.lang.setTimeout(function(){b.publish("WSFeedbackEnd",[Config.Strings.Loading])},0)},newDistributionList:function(){this.distributionListWidget?(this.selectView("distributionListWidget"),this.distributionListWidget.showCreateView()):(b.publish("WSFeedbackStart",[Config.Strings.Loading]),ws.lang.setTimeout(this,function(){this.selectView("distributionListWidget");this.distributionListWidget.showCreateView();b.publish("WSFeedbackEnd",[Config.Strings.Loading])},0))},createEditContactWidget:function(){this.selectView("editContactWidget",
!0)},createDistributionList:function(){this.selectView("distributionListWidget",!0)},editDistributionList:function(a){b.publish("WSFeedbackStart",[Config.Strings.Loading]);ws.lang.setTimeout(this,function(){this.selectView("distributionListWidget");this.distributionListWidget.showList(a)},0)},sharedGroup:function(a){a=ws.string.substituteParams(Config.SharedGroupEditURL,encodeURIComponent(a));ws.io.openWindow(a)},importContacts:function(){var a=new ws.address.ImportContactsWidget({addressModel:this.model});
a.startup();a.show()},exportContacts:function(){var a=new ws.address.ExportContactsWidget({addressModel:this.model});a.startup();a.show()},editDistListCancel:function(a){a?this.confirmClose(b.hitch(this,"backToList")):this.backToList()},editContactCancel:function(a){this.confirmClose(a)},confirmClose:function(a){var c=this.editContactWidget&&this.stackWidget.selectedChildWidget==this.editContactWidget&&this.editContactWidget.isDirty(),d=this.distributionListWidget&&this.stackWidget.selectedChildWidget==
this.distributionListWidget&&this.distributionListWidget.isDirty();c||d?ws.widget.Dialogs.showTransientDialog(c?Config.Strings.ConfirmClose1:Config.Strings.ConfirmClose4,b.hitch(this,function(c){c==0&&a&&ws.lang.setTimeout(a,0)}),null,[{label:Config.Strings.DiscardChanges,type:"Bare",subType:"Cancel"},{label:Config.Strings.ContinueEditing}]):a&&a()},onKeyPress:function(a){this.stackWidget.selectedChildWidget==this.layoutWidget&&this._onKeyPress(a)},onEnterKeyPress:function(a){a=this.model.getRow(a);
a.bType=="c"?this.showContactDetails(a):a.bType=="d"?this.editDistributionList(a.uid):a.bType=="s"&&this.sharedGroup(a.name)},onDelKeyPress:function(a){if(b.isArray(a))this.deleteSelection(a);else{var c=this.model.getRow(a);this.deleteSingleByRow(a,c.bType)}},onOtherKeyPress:function(a){if(Config.EnableKeyboardShortcuts&&a.keyChar&&b.isString(a.keyChar)&&!a.ctrlKey&&!a.altKey&&!a.metaKey)switch(a.keyChar.toLowerCase()){case Config.Strings.KeyNewContact:this.newContact();break;case Config.Strings.KeyPrintContactDetail:this.PrintSelectedContacts()}},
onRowMouseOver:function(a){b.addClass(a.rowNode,"dojoxGrid-row-hover")},onRowMouseOut:function(a){b.removeClass(a.rowNode,"dojoxGrid-row-hover")},backToList:function(a){this.stackWidget.selectChild(this.layoutWidget);this.gridModel.modelUpdated();this.buildFilterDropDownMenu();this.updateSearchInfo();this.onResized();a&&a();ws.reporting.report("Contact List","Addresses")},selectEmptyPane:function(){this._preSelectedChild=this.stackWidget.selectedChildWidget;this.stackWidget.selectChild(this.emptyPane)},
deSelectEmptyPane:function(){if(this.stackWidget.selectedChildWidget==this.emptyPane){if(!this._preSelectedChild)this._preSelectedChild=this.layoutWidget;this.stackWidget.selectChild(this._preSelectedChild);this._preSelectedChild=null}}}),window.fixMissingAvatar=function(a){var c='<img align="absmiddle" src="'+Config.SpacerImageURL+'" class="mainLargeIcon hoverRefNode noBuddyIcon buddyShadow showIcon" style="width:32px;height:32px;">';if(a&&a.parentNode)a.parentNode.innerHTML=c};b._hasResource["ws.address.AddressListHoverCard"]||
(b._hasResource["ws.address.AddressListHoverCard"]=!0,b.provide("ws.address.AddressListHoverCard"),b.declare("ws.address.AddressListHoverCard",[h._Widget,h._Templated],{templateString:b.cache("ws.address","AddressListHoverCard.html",'<div class="WSPopup addressListHoverCard">\r\n\t<table>\r\n\t\t<tr>\r\n\t\t\t<td colspan="2" class="header">\r\n\t\t\t<div class="mailLink" dojoAttachEvent="onclick: onClickMail" dojoAttachPoint="mailLink"></div>\r\n\t\t\t<div class="imLink" dojoAttachEvent="onclick: onClickIM" dojoAttachPoint="imLink"></div>\r\n\t\t\t<div class="mobileLink" dojoAttachEvent="onclick: onClickMobile" dojoAttachPoint="mobileLink"></div>\t\t\r\n\t\t\t<div class="videoLink" dojoAttachEvent="onclick: onClickVideo" dojoAttachPoint="videoLink"></div>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td valign="top" class="contentContainer">\r\n\t\t\t\t<div dojoType="ws.widget.BuddyIcon" dojoAttachPoint="buddyIcon"></div>\r\n\t\t\t\t<div class="emptyBuddyIcon" style="display:none" dojoAttachPoint="emptyBuddyIcon"></div>\r\n\t\t\t</td>\r\n\t\t\t<td class="contentContainer">\r\n\t\t\t\t<div class="nameNode" dojoAttachPoint="nameNode"></div>\r\n\t\t\t\t<div dojoAttachPoint="screenNameNode" class="wsLink" dojoAttachEvent="onclick: onClickIM"></div>\r\n\t\t\t\t<div dojoAttachPoint="email1Node" class="wsLink" dojoAttachEvent="onclick: onClickEmail1"></div>\r\n\t\t\t\t<div dojoAttachPoint="email2Node" class="wsLink" dojoAttachEvent="onclick: onClickEmail2"></div>\r\n\t\t\t\t<div dojoAttachPoint="phone1Row" class="phoneNode" >\r\n\t\t\t\t\t<span dojoAttachPoint="phone1TypeNode">${Cellular}</span>: <span dojoAttachPoint="phone1Node"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoAttachPoint="phone2Row" class="phoneNode" >\r\n\t\t\t\t\t<span dojoAttachPoint="phone2TypeNode">${Cellular}</span>: <span dojoAttachPoint="phone2Node"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoAttachPoint="phone3Row" class="phoneNode" >\r\n\t\t\t\t\t<span dojoAttachPoint="phone3TypeNode">${Cellular}</span>: <span dojoAttachPoint="phone3Node"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoAttachPoint="phone4Row" class="phoneNode" >\r\n\t\t\t\t\t<span dojoAttachPoint="phone4TypeNode">${Cellular}</span>: <span dojoAttachPoint="phone4Node"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoAttachPoint="phone5Row" class="phoneNode" >\r\n\t\t\t\t\t<span dojoAttachPoint="phone5TypeNode">${Cellular}</span>: <span dojoAttachPoint="phone5Node"></span>\r\n\t\t\t\t</div>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t</table>\r\n\t<div class="linkContainer">\r\n\t\t<span class="wsLink" style="display:none" dojoAttachEvent="onclick: onClickView" dojoAttachPoint="viewContact">${View}</span>\r\n\t\t<span class="wsLink" dojoAttachEvent="onclick: onClickEdit"  dojoAttachPoint="editContact">${Edit}</span>\r\n\t\t<span class="pipe" dojoAttachPoint="seperator">|</span>\r\n\t\t<span class="wsLink deleteLink" dojoAttachEvent="onclick: onClickDelete" dojoAttachPoint="deleteLink">${Delete}</span>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,manager:null,model:null,contactPhoneTypes:["Undefined","Cellular","Fax","Home","Pager","Work"],startup:function(){if(!Settings.ShowPresenceIcon)this.buddyIcon.hide(),this.emptyBuddyIcon.style.display="";if(!Settings.ShowMobileIcon||!Settings.EnableAIMPanel)this.mobileLink.style.display="none";ws.html.setShowing(this.imLink,Settings.ShowPresenceIcon&&Settings.EnableAIMPanel);ws.html.setShowing(this.videoLink,Config.EnableVideoChat)},populate:function(a){this.contact=
this.model.getRow(a.gridRowIndex);return this.paint()},paint:function(){if(!this.contact)return!1;this.editContact.style.display="";this.deleteLink.style.display="";this.seperator.style.display="";this.viewContact.style.display="none";var a=function(a,c){ws.html.setShowing(a,!!c);ws.html.setInnerText(a,ws.string.summary(c||"",32))};a(this.nameNode,this.contact.name);a(this.screenNameNode,this.contact.screenName);a(this.email1Node,this.contact.email1);a(this.email2Node,this.contact.email2);this.imLink.className=
"imLinkDisabled";this.contact.screenName&&ws.io.rpc({action:"GetPresenceInfo",automatic:!1,content:{email:this.contact.screenName},load:b.hitch(this,function(a){if(ws.presence.ableToGetIM(a.presenceState))this.imLink.className="imLink"})});for(a=1;a<=5;a++){var c=this.contact["phone"+a];ws.html.setShowing(this["phone"+a+"Row"],c);ws.html.setInnerText(this["phone"+a+"TypeNode"],this.localizedPhoneType(this.contact["phone"+a+"Type"]));ws.html.setInnerText(this["phone"+a+"Node"],c)}this.buddyIcon.show(this.contact);
return!0},localizedPhoneType:function(a){switch(a){case this.contactPhoneTypes[5]:return Config.Strings.Work;case this.contactPhoneTypes[4]:return Config.Strings.Pager;case this.contactPhoneTypes[3]:return Config.Strings.Home;case this.contactPhoneTypes[2]:return Config.Strings.Fax;default:return Config.Strings.Cellular}},onClickIM:function(){this.contact.screenName&&ws.presence.launchIM(this.contact.screenName);this.manager.close()},onClickMobile:function(){ws.presence.launchIM(this.contact.screenName?
this.contact.screenName:"",!1,!0);this.manager.close()},onClickVideo:function(){this.manager.close()},onClickView:function(){this.contact.bType=="d"&&ws.WebSuite.editDistributionList(this.contact.uid);this.manager.close()},onClickEdit:function(){this.contact.bType=="c"?this.model.getContact({uid:this.contact.uid,load:b.hitch(this,function(a){ws.WebSuite.editContact(this.contact.uid,a,!0)}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.getContact-onClickEdit file:AddressListHoverCard.js");
ws.widget.Dialogs.ok(a||Config.Strings.ErrorLoadingContact)}}):this.contact.bType=="d"?ws.WebSuite.editDistributionList(this.contact.uid):this.contact.bType=="s"&&ws.WebSuite.sharedGroup(this.contact.name);this.manager.close()},onClickMail:function(){var a=this.contact.screenName||this.contact.email1||this.contact.email2||this.contact.composeValue;Config.ValidateEmailFormat&&(a=this.contact.email1||this.contact.email2||this.contact.composeValue||this.contact.screenName);this.startCompose(a)},onClickEmail1:function(){this.startCompose(this.contact.email1)},
onClickEmail2:function(){this.startCompose(this.contact.email2)},startCompose:function(a){a&&ws.WebSuite.getCompose(null,function(c){c.reset({to:a,backToString:"setFolder"})});this.manager.close()},onClickDelete:function(){this.contact.bType=="c"?this.model.getContact({uid:this.contact.uid,load:b.hitch(this,function(a){this.model.setUndoItem(a);this._deleteAddresses([this.contact.uid],!0)}),error:b.hitch(this,function(){this._confirmationDelete()})}):this.contact.bType=="d"?this.model.getDistributionList({uid:this.contact.uid,
load:b.hitch(this,function(a){this.model.setUndoItem(a);this._deleteAddresses([this.contact.uid],!0)}),error:b.hitch(this,function(){this._confirmationDelete()})}):this.contact.bType=="s"&&this._confirmationDelete();this.manager.close()},_confirmationDelete:function(){ws.widget.Dialogs.okCancel(Config.Strings.DeleteContactsConfirmationSingular,b.hitch(this,function(a){a&&this._deleteAddresses([this.contact.uid])}))},_deleteAddresses:function(a,c){this.model.deleteAddresses({uids:a,load:b.hitch(this,
function(){var a=c?b.hitch(this.model,"undoDeletedItem"):null;b.publish("WSFeedbackStart",[Config.Strings.ContactDeletedSingular,!0,a,b.hitch(this,function(){this.model.setUndoItem()})])}),error:b.hitch(this,function(a){this.model.setUndoItem();window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteAddresses-_deleteAddresses file:AddressListHoverCard.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorDeletingContactNotFound)})})}}));b._hasResource["ws.address.PeoplePanel"]||
(b._hasResource["ws.address.PeoplePanel"]=!0,b.provide("ws.address.PeoplePanel"),b.declare("ws.address.PeoplePanelGridModel",l.grid.data.Dynamic,{columns:{Name:0},constructor:function(a,c,d){this.model=d;b.connect(this.model,"modelUpdated",this,"modelUpdated")},modelUpdated:function(){},getDatum:function(a,c){var b=this.model.getRow(a);if(b==null)return Config.Strings.ContactError;switch(c){case this.columns.Name:return"<span style='white-space: nowrap;'>"+ws.string.escapeXml(b.name||b.email1||b.email2||
b.screenName||"")+"</span>"}},getRowCount:function(){return this.model.getRowCount()}}),b.declare("ws.address.PeoplePanel",ws.widget.ListView,{templateString:b.cache("ws.address","PeoplePanel.html",'<div style="overflow: hidden;">\r\n\t<div class="peoplePanel listView" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget">\r\n\t\t<div dojoType="ws.widget.Pane" layoutAlign="top">\r\n\t\t\t<div class="searchInputDiv">\r\n\t\t\t\t<span><input type="text" class="wsInput searchInput" dojoAttachPoint="searchInput" dojoAttachEvent="onkeyup: search, onclick: onFocusSearch, onblur: onBlurSearch"></span>\r\n\t\t\t\t<img src="${spacer}" dojoAttachPoint="clearSearchButton" class="clearSearchImg" dojoAttachEvent="onclick:clearSearch" style="display: none;">\r\n\t\t\t</div>\r\n\t\t\t<ul class="addLinks">\r\n\t\t\t\t<li><img src="${spacer}"></li>\r\n\t\t\t\t<li dojoAttachEvent="onclick: openAddContactCard" dojoAttachPoint="addContactLink">\r\n\t\t\t\t\t<span class="wsLink">${AddContact}</span>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li>|</li>\r\n\t\t\t\t<li dojoAttachEvent="onclick: openAddListCard" dojoAttachPoint="addListLink">\r\n\t\t\t\t\t<span class="wsLink">${AddList}</span>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t\t<div dojoType="ws.widget.Pane" layoutAlign="client">\r\n\t\t\t<div dojoType="dojox.Grid" dojoAttachPoint="grid" layoutAlign="client"></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},wrapperModelClass:ws.address.PeoplePanelGridModel,showHeader:!1,speedUp:!0,searchDefaultValue:Config.Strings.FindContacts,autosizeColumnId:"Name",startup:function(){this.setModel(new ws.address.AddressModel({sortable:!0,fullTextSearchable:!0,fetchDataOnInit:!0}));this.model.core.sortData(Settings.AddressNameSortOrder?Settings.AddressNameSortOrder:Config.DefaultAddressNameSortOrder,"Ascending");this.searchInput.value=this.searchDefaultValue;(new ws.widget.HoverCardManager(this.grid.domNode,
ws.address.AddressListHoverCard,"dojoxGrid-row",{model:this.model})).padding=[ws.widget.pointerWidth+7,-40];this.clearSearchButton.style.display="none";b.addClass(this.searchInput,"nickNameInputNew")},initView:function(){this.columns=[{id:"Name",name:Config.Strings.Name,width:"75px"}];this.inherited(arguments);b.connect(this.grid,"onRowContextMenu",this,"onContextMenu")},getRowClasses:function(a){var c=this.inherited(arguments);Config.TopContactsEnabled&&Settings.EnableTopContacts&&this.model.isTopContact(a)&&
c.push("row-top-contact");return c},openAddContactCard:function(){this.addContactCard?this.addContactCard.reset():(this.addContactCard=new ws.address.PeoplePanelAddContactCard({addressModel:this.model}),this.addContactCard.startup());this.addContactCard.open({around:this.addContactLink,orient:{TR:"TR"}})},openAddListCard:function(){this.addListCard?this.addListCard.reset():(this.addListCard=new ws.address.PeoplePanelAddListCard({addressModel:this.model}),this.addListCard.startup());this.addListCard.open({around:this.addListLink,
orient:{TR:"TR"}})},handleCellClick:function(a){if(!ws.WebSuite.isComposeInTransition()){var a=this.model.getRow(a.rowIndex),c=ws.WebSuite.isComposeOpen();if(a.screenName||a.email1||a.email2||a.composeValue){var b=a.email1||a.email2||a.composeValue||a.screenName;Config.ValidateEmailFormat&&(b=a.email1||a.email2||a.composeValue||a.screenName);ws.lang.setTimeout(this,function(){c?ws.WebSuite.reuseComposeWindow(b):ws.WebSuite.getCompose(null,function(a){a.reset({to:b,backToString:"setFolder",isDirty:!0})})},
0)}}},onResized:function(){this.inherited(arguments)},positionClearSearch:function(a){ws.html.setShowing(this.clearSearchButton,a)},onFocusSearch:function(){if(b.hasClass(this.searchInput,"nickNameInputNew"))this.searchInput.value="",b.removeClass(this.searchInput,"nickNameInputNew")},onBlurSearch:function(){if(this.searchInput.value=="")this.searchInput.value=Config.Strings.FindContacts,b.addClass(this.searchInput,"nickNameInputNew")},clearSearch:function(){this.searchInput.value="";this.search()},
search:function(){this.searchTimer&&clearTimeout(this.searchTimer);this.searchTimer=null;this._toggleClearButton();this.searchTimer=setTimeout(b.hitch(this,function(){this.model.search(this.searchInput.value)}),b.isIE==6?900:300)},_toggleClearButton:function(){this.positionClearSearch(!!this.searchInput.value)},getZeroRowsMessage:function(){var a="<div class='search'>"+Config.Strings.NoMatchesFound+"</div>";a+="<div class='z1'>";a+=ws.string.substituteParams('<div class="transferHeader">{0}</div><div class="mainLargeIcon"></div><div class="desc"><span class="tip">{1}</span><span>{2}</span><a href="{3}" class="transferLink" target="_blank">{4}</a><span>{5}</span></div><div class="btnRow"></div>',
Config.Strings.EasyTransferNoContacts,Config.Strings.TipWithColon,Config.Strings.EasyTransferText1,Config.EasyTransferUrl,Config.Strings.EasyTransfer,Config.Strings.EasyTransferText2);a+="</div><div class='z2'>";a+=Config.Strings.AddressBookEmpty+"</div>";return a},beforeShowZeroRowsMessage:function(){var a=b.query(".search",this.zeroRowsNode)[0],c=b.query(".z1",this.zeroRowsNode)[0],d=b.query(".z2",this.zeroRowsNode)[0];this.model.currentTextSearch?(this.zeroRowsNode.className="loading",ws.html.setShowing(c,
!1),ws.html.setShowing(d,!1),ws.html.setShowing(a,!0)):(!this.model.easyTransferShowing&&Config.ShowEasyTransfer?(this.zeroRowsNode.className="easyTransferContainer",ws.html.setShowing(c,!0),ws.html.setShowing(d,!1)):(ws.html.setShowing(c,!1),ws.html.setShowing(d,!0)),ws.html.setShowing(a,!1))},postCreateZeroRowsMessage:function(){},getErrorMessage:function(){return Config.Strings.ErrorLoadingAddressBook},onHide:function(){this.addContactCard&&this.addContactCard.isShowing()&&this.addContactCard.close()},
onContextMenu:function(a){var c=this.getRightClickMenu();c.isShowingNow&&c.close();this.rightClickMenu.rowIndex=a.rowIndex;this.rightClickMenu.contact=this.model.getRow(this.rightClickMenu.rowIndex);if(this.rightClickMenu.contact){var b=this.rightClickMenu.contact,e=b.screenName||b.email1||b.email2||b.composeValue,f=this.rightClickMenu.contact.screenName!=null,g=this.rightClickMenu.getChildren();g[3].setEnabled(e);g[4].setEnabled(f);Config.TopContactsEnabled&&Settings.EnableTopContacts&&g.length>=
10&&(b.bType=="d"?(g[8].setEnabled(!1),g[9].setEnabled(!1)):this.model.isUidTopContact(b.uid)?(g[8].setEnabled(!1),g[9].setEnabled(!0)):(g[8].setEnabled(!0),g[9].setEnabled(!1)));c.open(a.pageX,a.pageY,null,[]);a.preventDefault();a.stopPropagation()}},getRightClickMenu:function(){if(!this.rightClickMenu){var a=[{caption:Config.Strings.Edit,onClick:b.hitch(this,"editContact")},{caption:Config.Strings.Delete,onClick:b.hitch(this,"deleteContact")},{separator:!0},{caption:Config.Strings.SendEmail,onClick:b.hitch(this,
"sendEmail")},{caption:Config.Strings.SendIM,onClick:b.hitch(this,"sendIM")},{separator:!0},{caption:Config.Strings.NewContact,_onClick:b.hitch(this,"addContact")}];Config.TopContactsEnabled&&Settings.EnableTopContacts&&a.push({separator:!0},{caption:Config.Strings.TopContacts_AddToTopContacts,onClick:b.hitch(this,"addContactToTopContacts")},{caption:Config.Strings.TopContacts_RemoveFromTopContacts,onClick:b.hitch(this,"removeContactFromTopContacts")});this.rightClickMenu=ws.widget.createMenu(a)}return this.rightClickMenu},
addContact:function(a){a.stopPropagation();this.rightClickMenu.close();this.openAddContactCard()},deleteContact:function(){var a=this.rightClickMenu.contact;a.bType=="c"?this.model.getContact({uid:this.rightClickMenu.contact.uid,load:b.hitch(this,function(a){this.model.setUndoItem(a);this._deleteAddresses([this.rightClickMenu.contact.uid],!0)}),error:b.hitch(this,function(){this._confirmationDelete()})}):a.bType=="d"?this.model.getDistributionList({uid:this.rightClickMenu.contact.uid,load:b.hitch(this,
function(a){this.model.setUndoItem(a);this._deleteAddresses([this.rightClickMenu.contact.uid],!0)}),error:b.hitch(this,function(){this._confirmationDelete()})}):a.bType=="s"&&this._confirmationDelete()},_confirmationDelete:function(){ws.widget.Dialogs.okCancel(Config.Strings.DeleteContactsConfirmationSingular,b.hitch(this,function(a){a&&this._deleteAddresses([this.rightClickMenu.contact.uid])}))},_deleteAddresses:function(a,c){this.model.deleteAddresses({uids:a,load:b.hitch(this,function(a){a.isSuccess&&
(a=c?b.hitch(this.model,"undoDeletedItem"):null,b.publish("WSFeedbackStart",[Config.Strings.ContactDeletedSingular,!0,a,b.hitch(this,function(){this.model.setUndoItem()})]),Config.TopContactsEnabled&&Settings.EnableTopContacts&&this.model.topContactsEnabled()&&ws.WebSuite.theMailModel.resetCachedLists())}),error:b.hitch(this,function(a){this.model.setUndoItem();window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteAddresses-_deleteAddresses file:PeoplePanel.js");
ws.widget.Dialogs.ok(a||Config.Strings.ErrorDeletingContactNotFound)})})},sendIM:function(){this.rightClickMenu.contact.screenName&&ws.presence.launchIM(this.rightClickMenu.contact.screenName)},editContact:function(){var a=this.rightClickMenu.contact;a.bType=="c"?this.model.getContact({uid:a.uid,load:b.hitch(this,function(c){ws.WebSuite.editContact(a.uid,c,!0)}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.getContact-editContact file:PeoplePanel.js");
ws.widget.Dialogs.ok(a||Config.Strings.ErrorLoadingContact)}}):a.bType=="d"?ws.WebSuite.editDistributionList(a.uid):a.bType=="s"&&ws.WebSuite.sharedGroup(a.name)},addContactToTopContacts:function(){var a=this.rightClickMenu.contact;a.bType=="c"&&this.model.addContactToTopContacts({uid:a.uid,load:b.hitch(this,function(a){a.tcdluid?(ws.WebSuite.theMailModel.resetCachedLists(),b.publish("WSFeedbackStart",[Config.Strings.TopContacts_ContactAdded,!0])):ws.widget.Dialogs.ok(Config.Strings.TopContacts_ContactNotAdded)}),
error:b.hitch(this,function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.addContactToTopContacts-addContactToTopContacts file:PeoplePanel.js");ws.widget.Dialogs.ok(a||Config.Strings.TopContacts_ContactNotAdded)})})},removeContactFromTopContacts:function(){var a=this.rightClickMenu.contact;a.bType=="c"&&this.model.removeContactFromTopContacts({uid:a.uid,load:b.hitch(this,function(a){a.tcremoved?(ws.WebSuite.theMailModel.resetCachedLists(),
b.publish("WSFeedbackStart",[Config.Strings.TopContacts_ContactRemoved,!0])):ws.widget.Dialogs.ok(Config.Strings.TopContacts_ContactNotRemoved)}),error:b.hitch(this,function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.removeContactFromTopContacts-removeContactFromTopContacts file:PeoplePanel.js");ws.widget.Dialogs.ok(a||Config.Strings.TopContacts_ContactNotRemoved)})})},sendEmail:function(){var a=this.rightClickMenu.contact,b=a.email1||
a.email2||a.composeValue||a.screenName;Config.ValidateEmailFormat&&(b=a.email1||a.email2||a.composeValue);b&&ws.WebSuite.getCompose(null,function(a){a.reset({to:b,backToString:"setFolder"})})}}),b.declare("ws.address.PeoplePanelAddContactCard",[h._Widget,h._Templated],{templateString:b.cache("ws.address","PeoplePanelAddContactCard.html",'<div class="peoplePanelAddContactCard hoverCard">\r\n\t<img src="${spacer}" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick: close">\r\n\t<div class="contentDiv" dojoAttachPoint="contentDiv">\r\n\t\t<table dojoAttachPoint="inputTable">\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${Name}</td>\r\n\t\t\t\t<td colspan="2">\r\n\t\t\t\t\t<div dojoType="ws.widget.DefaultTextbox" className="nameInput ieFirstNameInput" dojoAttachPoint="firstNameInput" maxlength="255" defaultValue="${FirstName}" tabindex="200"></div>\r\n\t\t\t\t\t<div dojoType="ws.widget.DefaultTextbox" className="nameInput" dojoAttachPoint="lastNameInput" maxlength="255" defaultValue="${LastName}" tabindex="201"></div>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${Email}</td>\r\n\t\t\t\t<td colspan="2"><input type="text" maxlength="255" dojoAttachPoint="emailInput" class="wsInput emailInput" tabindex="202"></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${Phone}</td>\r\n\t\t\t\t<td style="width:130px"><input type="text" maxlength="255" dojoAttachPoint="phoneInput" class="wsInput" tabindex="203"></td>\r\n\t\t\t\t<td style="width:170px">\r\n\t\t\t\t\t<ul dojoType="ws.widget.WSSelect" dojoAttachPoint="phoneTypeSelect" style="margin-left:3px">\r\n\t\t\t\t\t\t<li value="Cellular">${Cellular}</li>\r\n\t\t\t\t\t\t<li value="Home">${Home}</li>\r\n\t\t\t\t\t\t<li value="Work">${Work}</li>\r\n\t\t\t\t\t\t<li value="Pager">${Pager}</li>\r\n\t\t\t\t\t\t<li value="Fax">${Fax}</li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t<td>\r\n\t\t\t\t<span class="wsLink moreDetailsLink" dojoAttachEvent="onclick: moreDetails">${MoreDetails2}</span>\r\n\t\t\t</td>\r\n\t\t\t<td colspan="2">\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick: checkRequiredFields">${AddContact}</div>\r\n\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,addressModel:null,isPopup:!1,open:function(a){a.popup=this;this.cachedArgs=a;ws.widget.popup(a);this.phoneTypeSelect.sizeMyself()},close:function(){ws.widget.popup.close(this)},moreDetails:function(){this.isPopup&&_ws_isOpenerWS()?opener.ws.WebSuite.editContact(0,this.getData(),!0):ws.WebSuite.editContact(0,this.getData(),!0);this.close()},isEmptyContact:function(){return this.firstNameInput.getValue()?!1:this.lastNameInput.getValue()?!1:!0},checkRequiredFields:function(){if(this.isEmptyContact()==
!0)ws.widget.Dialogs.ok(Config.Strings.EmptyContactMessageNoNickName);else{var a="";if(this.emailInput.value&&!this.isEmailAddress(this.emailInput.value))a=Config.Strings.ErrorEmailFormat2;a?(this.close(),ws.widget.Dialogs.ok(a,b.hitch(this,"open",this.cachedArgs))):this.addContact()}},isEmailAddress:function(a){a=a.match(/(.+)@(.+)\.(.+)/);return a!=null&&a.length==4},addContact:function(){var a=this.getData();a.category="General";a.uid=0;a.load=b.hitch(this,function(){b.publish("WSFeedbackStart",
[Config.Strings.ContactCreated,!0]);this.close()});a.error=function(a){if(a&&a.indexOf(Config.AddressBookFullCodeString)>=0)a=Config.Strings.ErrorAddressBookFull;ws.widget.Dialogs.ok(a||Config.Strings.ErrorSavingContactServerError)};this.addressModel.createOrModifyContact(a)},getData:function(){var a="",c="";this.firstNameInput.getValue()&&(a=b.trim(this.firstNameInput.getValue()));this.lastNameInput.getValue()&&(c=b.trim(this.lastNameInput.getValue()));return{firstName:a,lastName:c,email1:this.emailInput.value,
phone1:this.phoneInput.value,phone1Type:this.phoneTypeSelect.currentValue}},setData:function(a,b,d,e,f){a!=null&&this.firstNameInput.setValue(a);b!=null&&this.lastNameInput.setValue(b);if(d!=null)this.emailInput.value=d;if(e!=null)this.phoneInput.value=e;f!=null&&this.phoneTypeSelect.setOption(f)},setPointer:function(a,b){a!=null?(this.domNode.style.overflow="visible",ws.widget.setPointerLoc(this.domNode,b)):(this.domNode.style.overflow="auto",ws.widget.hidePointer(this.domNode))},reset:function(){this.firstNameInput.setValue();
this.lastNameInput.setValue();this.emailInput.value="";this.phoneInput.value="";this.phoneTypeSelect.setOption(0)}}),b.declare("ws.address.PeoplePanelAddListCard",[ws.address.PeoplePanelAddContactCard],{templateString:b.cache("ws.address","PeoplePanelAddListCard.html",'<div class="peoplePanelAddListCard hoverCard">\r\n\t<img src="${spacer}" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick: close">\r\n\t<div class="contentDiv" dojoAttachPoint="contentDiv">\r\n\t\t<table dojoAttachPoint="inputTable">\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${ListName}</td>\r\n\t\t\t\t<td><input type="text" maxlength="255" class="wsInput nameInput" dojoAttachPoint="createNameField" tabindex="201"></div>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${Contacts}</td>\r\n\t\t\t\t<td><div dojoType="ws.address.AddressField" fieldWidth="222px" minHeight="72" maxHeight="280" dojoAttachPoint="createAddressField" tabindex="202"></div></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td colspan="2"><div dojoType="ws.widget.Button" dojoAttachEvent="onClick: checkRequiredFields">${AddList}</div></td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n\t<span style="clear:both"></span>\r\n</div>\r\n'),
reset:function(){this.createNameField.value="";this.createAddressField.setValue()},createList:function(a){var c=ws.address.AddressBookUtil._mapAddressesToContacts(this.createAddressField,this.addressModel);this.listInfo={uid:0,name:a,contacts:c.contacts,addresses:c.addresses};this.saveList(!1,Config.Strings.DistributionListCreated,null,b.hitch(this,function(){ws.reporting.report("Edit DistList","Addresses");this.close()}))}}),b.extend(ws.address.PeoplePanelAddListCard,{checkRequiredFields:ws.address.DistributionListWidget.prototype.checkRequiredFields,
saveList:ws.address.DistributionListWidget.prototype.saveList}));b._hasResource["dojo.fx.Toggler"]||(b._hasResource["dojo.fx.Toggler"]=!0,b.provide("dojo.fx.Toggler"),b.declare("dojo.fx.Toggler",null,{node:null,showFunc:b.fadeIn,hideFunc:b.fadeOut,showDuration:200,hideDuration:200,constructor:function(a){b.mixin(this,a);this.node=a.node;this._showArgs=b.mixin({},a);this._showArgs.node=this.node;this._showArgs.duration=this.showDuration;this.showAnim=this.showFunc(this._showArgs);this._hideArgs=b.mixin({},
a);this._hideArgs.node=this.node;this._hideArgs.duration=this.hideDuration;this.hideAnim=this.hideFunc(this._hideArgs);b.connect(this.showAnim,"beforeBegin",b.hitch(this.hideAnim,"stop",!0));b.connect(this.hideAnim,"beforeBegin",b.hitch(this.showAnim,"stop",!0))},show:function(a){return this.showAnim.play(a||0)},hide:function(a){return this.hideAnim.play(a||0)}}));b._hasResource["dojo.fx"]||(b._hasResource["dojo.fx"]=!0,b.provide("dojo.fx"),function(){var a={_fire:function(a,b){this[a]&&this[a].apply(this,
b||[]);return this}},c=function(a){this._index=-1;this._animations=a||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;b.forEach(this._animations,function(a){this.duration+=a.duration;a.delay&&(this.duration+=a.delay)},this)};b.extend(c,{_onAnimate:function(){this._fire("onAnimate",arguments)},_onEnd:function(){b.disconnect(this._onAnimateCtx);b.disconnect(this._onEndCtx);this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=
this._animations[++this._index],this._onAnimateCtx=b.connect(this._current,"onAnimate",this,"_onAnimate"),this._onEndCtx=b.connect(this._current,"onEnd",this,"_onEnd"),this._current.play(0,!0))},play:function(a,c){if(!this._current)this._current=this._animations[this._index=0];if(!c&&this._current.status()=="playing")return this;var d=b.connect(this._current,"beforeBegin",this,function(){this._fire("beforeBegin")}),j=b.connect(this._current,"onBegin",this,function(){this._fire("onBegin",arguments)}),
k=b.connect(this._current,"onPlay",this,function(){this._fire("onPlay",arguments);b.disconnect(d);b.disconnect(j);b.disconnect(k)});this._onAnimateCtx&&b.disconnect(this._onAnimateCtx);this._onAnimateCtx=b.connect(this._current,"onAnimate",this,"_onAnimate");this._onEndCtx&&b.disconnect(this._onEndCtx);this._onEndCtx=b.connect(this._current,"onEnd",this,"_onEnd");this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var a=b.connect(this._current,"onPause",
this,function(){this._fire("onPause",arguments);b.disconnect(a)});this._current.pause()}return this},gotoPercent:function(a,c){this.pause();var d=this.duration*a;this._current=null;b.some(this._animations,function(a){if(a.duration<=d)return this._current=a,!0;d-=a.duration;return!1});this._current&&this._current.gotoPercent(d/this._current.duration,c);return this},stop:function(a){if(this._current){if(a){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);
this._current=this._animations[this._index]}var c=b.connect(this._current,"onStop",this,function(){this._fire("onStop",arguments);b.disconnect(c)});this._current.stop()}return this},status:function(){return this._current?this._current.status():"stopped"},destroy:function(){this._onAnimateCtx&&b.disconnect(this._onAnimateCtx);this._onEndCtx&&b.disconnect(this._onEndCtx)}});b.extend(c,a);b.fx.chain=function(a){return new c(a)};var d=function(a){this._animations=a||[];this._connects=[];this.duration=
this._finished=0;b.forEach(a,function(a){var c=a.duration;a.delay&&(c+=a.delay);if(this.duration<c)this.duration=c;this._connects.push(b.connect(a,"onEnd",this,"_onEnd"))},this);this._pseudoAnimation=new b.Animation({curve:[0,1],duration:this.duration});var c=this;b.forEach(["beforeBegin","onBegin","onPlay","onAnimate","onPause","onStop","onEnd"],function(a){c._connects.push(b.connect(c._pseudoAnimation,a,function(){c._fire(a,arguments)}))})};b.extend(d,{_doAction:function(a,c){b.forEach(this._animations,
function(b){b[a].apply(b,c)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(a,b){var c=this._pseudoAnimation;c[a].apply(c,b)},play:function(){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(a,c){var d=this.duration*a;b.forEach(this._animations,function(a){a.gotoPercent(a.duration<
d?1:d/a.duration,c)});this._call("gotoPercent",arguments);return this},stop:function(){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},destroy:function(){b.forEach(this._connects,b.disconnect)}});b.extend(d,a);b.fx.combine=function(a){return new d(a)};b.fx.wipeIn=function(a){var c=a.node=b.byId(a.node),d=c.style,j,a=b.animateProperty(b.mixin({properties:{height:{start:function(){j=d.overflow;d.overflow="hidden";if(d.visibility==
"hidden"||d.display=="none")return d.height="1px",d.display="",d.visibility="",1;else{var a=b.style(c,"height");return Math.max(a,1)}},end:function(){return c.scrollHeight}}}},a));b.connect(a,"onEnd",function(){d.height="auto";d.overflow=j});return a};b.fx.wipeOut=function(a){var c=(a.node=b.byId(a.node)).style,d,a=b.animateProperty(b.mixin({properties:{height:{end:1}}},a));b.connect(a,"beforeBegin",function(){d=c.overflow;c.overflow="hidden";c.display=""});b.connect(a,"onEnd",function(){c.overflow=
d;c.height="auto";c.display="none"});return a};b.fx.slideTo=function(a){var c=null,d=null,j=function(a){return function(){var e=b.getComputedStyle(a),j=e.position;c=j=="absolute"?a.offsetTop:parseInt(e.top)||0;d=j=="absolute"?a.offsetLeft:parseInt(e.left)||0;if(j!="absolute"&&j!="relative")e=b.position(a,!0),c=e.y,d=e.x,a.style.position="absolute",a.style.top=c+"px",a.style.left=d+"px"}}(a.node=b.byId(a.node));j();a=b.animateProperty(b.mixin({properties:{top:a.top||0,left:a.left||0}},a));b.connect(a,
"beforeBegin",a,j);return a}}());if(!b._hasResource["ws.dnd.DragAndDrop"])b._hasResource["ws.dnd.DragAndDrop"]=!0,b.provide("ws.dnd.DragAndDrop"),b.declare("ws.dnd.DragSource",null,{type:"",onDragEnd:function(){},onDragStart:function(){},onSelected:function(){},unregister:function(){ws.dnd.dragManager.unregisterDragSource(this)},reregister:function(){ws.dnd.dragManager.registerDragSource(this)}}),b.declare("ws.dnd.DragObject",null,{type:"",register:function(){var a=ws.dnd.dragManager;a.registerDragObject&&
a.registerDragObject(this)},onDragStart:function(){},onDragMove:function(){},onDragOver:function(){},onDragOut:function(){},onDragEnd:function(){}}),b.declare("ws.dnd.DropTarget",null,{constructor:function(){this.acceptedTypes=[]},acceptsType:function(a){if(b.indexOf(this.acceptedTypes,"*")==-1&&b.indexOf(this.acceptedTypes,a)==-1)return!1;return!0},accepts:function(a){if(b.indexOf(this.acceptedTypes,"*")==-1)for(var c=0;c<a.length;c++)if(b.indexOf(this.acceptedTypes,a[c].type)==-1)return!1;return!0},
unregister:function(){ws.dnd.dragManager.unregisterDropTarget(this)},onDragOver:function(){},onDragOut:function(){},onDragMove:function(){},onDropStart:function(){},onDrop:function(){},onDropEnd:function(){}}),ws.dnd.DragEvent=function(){this.target=this.dragObject=this.dragSource=null;this.eventStatus="success"},b.declare("ws.dnd.DragManager",null,{selectedSources:[],dragObjects:[],dragSources:[],registerDragSource:function(){},dropTargets:[],registerDropTarget:function(){},lastDragTarget:null,currentDragTarget:null,
onKeyDown:function(){},onMouseOut:function(){},onMouseMove:function(){},onMouseUp:function(){}});if(!b._hasResource["ws.dnd.HtmlDragManager"])b._hasResource["ws.dnd.HtmlDragManager"]=!0,b.provide("ws.dnd.HtmlDragManager"),b.declare("ws.dnd.HtmlDragManager",ws.dnd.DragManager,{disabled:!1,nestedTargets:!1,mouseDownTimer:null,dsCounter:0,dsPrefix:"dojoDragSource",dropTargetDimensions:[],currentDropTarget:null,previousDropTarget:null,_dragTriggered:!1,selectedSources:[],dragObjects:[],dragSources:[],
dropTargets:[],currentX:null,currentY:null,lastX:null,lastY:null,mouseDownX:null,mouseDownY:null,threshold:7,dropAcceptable:!1,cancelEvent:function(a){a.stopPropagation();a.preventDefault()},registerDragSource:function(a){if(a.domNode){var c=this.dsPrefix,d=c+"Idx_"+this.dsCounter++;a.dragSourceId=d;this.dragSources[d]=a;a.domNode.setAttribute(c,d);if(b.isIE)this.dragstartHandle=b.connect(a.domNode,"ondragstart",this.cancelEvent)}},unregisterDragSource:function(a){if(a.domNode){var c=this.dsPrefix,
d=a.dragSourceId;delete a.dragSourceId;delete this.dragSources[d];a.domNode.setAttribute(c,null);b.isIE&&b.disconnect(this.dragstartHandle)}},registerDropTarget:function(a){this.dropTargets.push(a)},unregisterDropTarget:function(a){a=b.indexOf(this.dropTargets,a,null,!0);a>=0&&this.dropTargets.splice(a,1)},getDragSource:function(a){a=a.target;if(a!==b.body()){for(var c=a.getAttribute(this.dsPrefix);!c&&a;){a=a.parentNode;if(!a||a===b.body())return;a.getAttribute&&(c=a.getAttribute(this.dsPrefix))}return this.dragSources[c]}},
onKeyDown:function(){},onMouseDown:function(a){if(a&&!this.disabled){if(b.isIE<9){if(a.button!=1)return}else if(a.which!=1)return;var c=a.target.nodeType==3?a.target.parentNode:a.target;if(b.indexOf(["button","textarea","input","select","option"],c.tagName.toLowerCase())==-1){var d=this.getDragSource(a);if(d)b.indexOf(this.selectedSources,d)==-1&&(this.selectedSources.push(d),d.onSelected()),this.mouseDownX=a.pageX,this.mouseDownY=a.pageY,this.mouseDownTarget=c,a.preventDefault(),this.mousemoveHandle=
b.connect(document,"onmousemove",this,"onMouseMove")}}},onMouseUp:function(a){if(a&&this.selectedSources.length!=0){this.mouseDownY=this.mouseDownX=null;this._dragTriggered=!1;a.dragSource=this.dragSource;if(!a.shiftKey&&!a.ctrlKey){if(this.currentDropTarget)this.currentDropTarget.onDropStart();b.forEach(this.dragObjects,function(c){var b=null;if(c){if(this.currentDropTarget){a.dragObject=c;var e=this.currentDropTarget.domNode.childNodes;if(e.length>0)for(a.dropTarget=e[0];a.dropTarget==c.domNode;)a.dropTarget=
a.dropTarget.nextSibling;else a.dropTarget=this.currentDropTarget.domNode;if(this.dropAcceptable)b=this.currentDropTarget.onDrop(a);else this.currentDropTarget.onDragOut(a)}a.dragStatus=this.dropAcceptable&&b?"dropSuccess":"dropFailure";setTimeout(function(){try{c.dragSource.onDragEnd(a)}catch(b){var d={},e;for(e in a)e=="type"?d.type="mouseup":d[e]=a[e];c.dragSource.onDragEnd(d)}},0);setTimeout(function(){c.onDragEnd(a)},0)}},this);this.selectedSources=[];this.dragObjects=[];this.dragSource=null;
if(this.currentDropTarget)this.currentDropTarget.onDropEnd()}b.disconnect(this.mousemoveHandle);this.currentDropTarget=null}},onScroll:function(){for(var a=0;a<this.dragObjects.length;a++)this.dragObjects[a].updateDragOffset&&this.dragObjects[a].updateDragOffset();this.dragObjects.length&&this.cacheTargetLocations()},_dragStartDistance:function(a,b){if(this.mouseDownX&&this.mouseDownX){var d=Math.abs(a-this.mouseDownX),e=Math.abs(b-this.mouseDownY);return parseInt(Math.sqrt(d*d+e*e),10)}},cacheTargetLocations:function(){this.dropTargetDimensions=
[];b.forEach(this.dropTargets,function(a){var c=a.domNode;if(c&&a.accepts([this.dragSource])){var d=b._abs(c),e=b.contentBox(c),c=b._getPadBorderExtents(c);this.dropTargetDimensions.push([[d.x,d.y],[d.x+e.w-c.w,d.y+e.h-c.h],a])}},this)},onMouseMove:function(a){if(a)if(b.isIE<9&&a.button!=1)this.currentDropTarget=null,this.onMouseUp(a,!0);else{if(this.selectedSources.length&&!this.dragObjects.length){var c,d;if(!this._dragTriggered){this._dragTriggered=this._dragStartDistance(a.pageX,a.pageY)>this.threshold;
if(!this._dragTriggered)return;c=a.pageX-this.mouseDownX;d=a.pageY-this.mouseDownY}this.dragSource=this.selectedSources[0];b.forEach(this.selectedSources,function(b){if(b){var e=b.onDragStart(a);if(e)e.onDragStart(a),e.dragOffset.y+=d,e.dragOffset.x+=c,e.dragSource=b,this.dragObjects.push(e)}},this);this.previousDropTarget=null;this.cacheTargetLocations()}b.forEach(this.dragObjects,function(b){if(b)b.onDragMove(a)});if(this.currentDropTarget)var e=b.position(this.currentDropTarget.domNode),e=[[e.x,
e.y],[e.x+e.w,e.y+e.h]];if(!this.nestedTargets&&e&&this.isInsideBox(a,e)){if(this.dropAcceptable)this.currentDropTarget.onDragMove(a,this.dragObjects)}else if(e=this.findBestTarget(a),e.target===null){if(this.currentDropTarget)this.currentDropTarget.onDragOut(a),this.previousDropTarget=this.currentDropTarget,this.currentDropTarget=null;this.dropAcceptable=!1}else if(this.currentDropTarget!==e.target){if(this.currentDropTarget)this.previousDropTarget=this.currentDropTarget,this.currentDropTarget.onDragOut(a);
this.currentDropTarget=e.target;a.dragObjects=this.dragObjects;this.dropAcceptable=this.currentDropTarget.onDragOver(a)}else if(this.dropAcceptable)this.currentDropTarget.onDragMove(a,this.dragObjects)}},findBestTarget:function(a){var c=this,d={target:null,points:null};b.every(this.dropTargetDimensions,function(b){if(!c.isInsideBox(a,b))return!0;d.target=b[2];d.points=b;return Boolean(c.nestedTargets)});return d},isInsideBox:function(a,b){if(a.pageX>b[0][0]&&a.pageX<b[1][0]&&a.pageY>b[0][1]&&a.pageY<
b[1][1])return!0;return!1},onMouseOver:function(){},onMouseOut:function(){}}),ws.dnd.dragManager=new ws.dnd.HtmlDragManager,function(){var a=document,c=ws.dnd.dragManager;b.connect(a,"onkeydown",c,"onKeyDown");b.connect(a,"onmouseover",c,"onMouseOver");b.connect(a,"onmouseout",c,"onMouseOut");b.connect(a,"onmousedown",c,"onMouseDown");b.connect(a,"onmouseup",c,"onMouseUp");b.connect(window,"onscroll",c,"onScroll")}();b._hasResource["ws.dnd.HtmlDragAndDrop"]||(b._hasResource["ws.dnd.HtmlDragAndDrop"]=
!0,b.provide("ws.dnd.HtmlDragAndDrop"),b.declare("ws.dnd.HtmlDragSource",ws.dnd.DragSource,{dragClass:"",constructor:function(a,c){a=b.byId(a);this.dragObjects=[];this.constrainToContainer=!1;if(a)this.dragObject=this.domNode=a,this.type=c||this.domNode.nodeName.toLowerCase(),ws.dnd.DragSource.prototype.reregister.call(this)},onDragStart:function(){var a=new ws.dnd.HtmlDragObject(this.dragObject,this.type);if(this.dragClass)a.dragClass=this.dragClass;this.constrainToContainer&&a.constrainTo(this.constrainingContainer||
this.domNode.parentNode);return a},setDragHandle:function(a){a=b.byId(a);ws.dnd.dragManager.unregisterDragSource(this);this.domNode=a;ws.dnd.dragManager.registerDragSource(this)},setDragTarget:function(a){this.dragObject=a},constrainTo:function(a){this.constrainToContainer=!0;if(a)this.constrainingContainer=a},onSelected:function(){for(var a=0;a<this.dragObjects.length;a++)ws.dnd.dragManager.selectedSources.push(new ws.dnd.HtmlDragSource(this.dragObjects[a]))},addDragObjects:function(){for(var a=
0;a<arguments.length;a++)this.dragObjects.push(b.byId(arguments[a]))}}),b.declare("ws.dnd.HtmlDragObject",ws.dnd.DragObject,{dragClass:"",opacity:0.5,createIframe:!0,disableX:!1,disableY:!1,constructor:function(a,c){this.domNode=b.byId(a);this.type=c;this.constrainToContainer=!1;this.dragSource=null;ws.dnd.DragObject.prototype.register.call(this)},createDragNode:function(){var a=this.domNode.cloneNode(!0);this.dragClass&&b.addClass(a,this.dragClass);this.opacity<1&&b.style(a,"opacity",this.opacity);
var c=a.tagName.toLowerCase(),d=c=="tr";if(d||c=="tbody"){var e=this.domNode.ownerDocument,c=e.createElement("table");d?(e=e.createElement("tbody"),c.appendChild(e),e.appendChild(a)):c.appendChild(a);e=(d?this.domNode:this.domNode.firstChild).childNodes;a=(d?a:a.firstChild).childNodes;for(d=0;d<e.length;d++)if(a[d]&&a[d].style)a[d].style.width=b.contentBox(e[d]).w+"px";a=c}if(b.isIE==6&&this.createIframe){with(a.style)left=top="0px";c=document.createElement("div");c.appendChild(a);c.id="dragNodeWrapper";
this.bgIframe=new h.BackgroundIframe(c);c.appendChild(this.bgIframe.iframe);a=c}a.style.zIndex=999;return a},onDragStart:function(a){ws.html.clearSelection();this.scrollOffset=b._docScroll();this.dragStartPosition=b._abs(this.domNode);this.dragOffset={y:this.dragStartPosition.y-a.pageY,x:this.dragStartPosition.x-a.pageX};if(this.dragClone=this.createDragNode()){this.containingBlockPosition=this.domNode.offsetParent?b._abs(this.domNode.offsetParent):{x:0,y:0};if(this.constrainToContainer)this.constraints=
this.getConstraints();try{with(this.dragClone.style)position="absolute",top=this.dragOffset.y+a.pageY+"px",left=this.dragOffset.x+a.pageX+"px";b.body().appendChild(this.dragClone);b.publish("dragStart",[{source:this}])}catch(c){}}},getConstraints:function(){if(this.constrainingContainer.nodeName.toLowerCase()=="body")var a=b.window.getBox(),c=a.w,a=a.h,d=b._docScroll().offset,e=d.x,d=d.y;else a=b.contentBox(this.constrainingContainer),c=a.w,a=a.h,d=b._getPadBorderExtents(this.constrainingContainer),
e=this.containingBlockPosition.x+d.l,d=this.containingBlockPosition.y+d.t;var f=b._getMarginSize(this.domNode);return{minX:e,minY:d,maxX:e+c-f.w,maxY:d+a-f.h}},updateDragOffset:function(){var a=b._docScroll();if(a.y!=this.scrollOffset.y){var c=a.y-this.scrollOffset.y;this.dragOffset.y+=c;this.scrollOffset.y=a.y}if(a.x!=this.scrollOffset.x)c=a.x-this.scrollOffset.x,this.dragOffset.x+=c,this.scrollOffset.x=a.x},onDragMove:function(a){this.updateDragOffset();var c=this.dragOffset.x+a.pageX,a=this.dragOffset.y+
a.pageY;if(this.constrainToContainer){if(c<this.constraints.minX)c=this.constraints.minX;if(a<this.constraints.minY)a=this.constraints.minY;if(c>this.constraints.maxX)c=this.constraints.maxX;if(a>this.constraints.maxY)a=this.constraints.maxY}this.setAbsolutePosition(c,a);b.publish("dragMove",[{source:this}])},setAbsolutePosition:function(a,b){if(this.dragClone){if(!this.disableY)this.dragClone.style.top=b+"px";if(!this.disableX)this.dragClone.style.left=a+"px"}},onDragEnd:function(a){if(this.dragClone){switch(a.dragStatus){case "dropSuccess":b._destroyElement(this.dragClone);
this.dragClone=null;break;case "dropFailure":b._abs(this.dragClone);var a=b.fx.slideTo({node:this.dragClone,left:this.dragStartPosition.x+1,top:this.dragStartPosition.y+1,duration:300}),c=this;b.connect(a,"onEnd",function(){b._destroyElement(c.dragClone);c.dragClone=null});a.play()}b.publish("dragEnd",[{source:this}])}},constrainTo:function(a){this.constrainToContainer=!0;this.constrainingContainer=a?a:this.domNode.parentNode}}),b.declare("ws.dnd.HtmlDropTarget",ws.dnd.DropTarget,{vertical:!1,constructor:function(a,
c){if(arguments.length!=0)this.domNode=b.byId(a),c&&b.isString(c)&&(c=[c]),this.acceptedTypes=c||[],ws.dnd.dragManager.registerDropTarget(this)},onDragOver:function(a){if(!this.accepts(a.dragObjects))return!1;this.childBoxes=[];for(var a=0,c;a<this.domNode.childNodes.length;a++)if(c=this.domNode.childNodes[a],c.nodeType==1){var d=b._abs(c),e=b.contentBox(c),f=b._getPadBorderExtents(c);this.childBoxes.push({top:d.y,bottom:d.y+e.h+f.h,left:d.x,right:d.x+e.w+f.w,height:e.h+f.h,width:e.w+f.w,node:c})}return!0},
_getNodeUnderMouse:function(a){for(var b=0;b<this.childBoxes.length;b++)with(this.childBoxes[b])if(a.pageX>=left&&a.pageX<=right&&a.pageY>=top&&a.pageY<=bottom)return b;return-1},createDropIndicator:function(){this.dropIndicator=document.createElement("div");var a=b._getPadBorderExtents(this.domNode);with(this.dropIndicator.style)position="absolute",zIndex=999,this.vertical?(borderLeftWidth="1px",borderLeftColor="black",borderLeftStyle="solid",height=b.contentBox(this.domNode).h+a.h+"px",top=b._abs(this.domNode).y+
"px"):(borderTopWidth="1px",borderTopColor="black",borderTopStyle="solid",width=b.contentBox(this.domNode).w+a.w+"px",left=b._abs(this.domNode,!0).x+"px")},onDragMove:function(a,c){var d=this._getNodeUnderMouse(a);this.dropIndicator||this.createDropIndicator();var e=this.vertical?this.gravity_WEST:this.gravity_NORTH,f=!1;if(d<0)this.childBoxes.length?(e&=this._gravity(this.childBoxes[0].node,a),e&&(f=!0)):e=!0;else{var g=this.childBoxes[d];e&=this._gravity(g.node,a);g.node===c[0].dragSource.domNode?
f=!0:(e?d>0?this.childBoxes[d-1]:g:d<this.childBoxes.length-1?this.childBoxes[d+1]:g).node===c[0].dragSource.domNode&&(f=!0)}f?this.dropIndicator.style.display="none":(this.dropIndicator.style.display="",this.placeIndicator(a,c,d,e),this.dropIndicator.parentNode||b.body().appendChild(this.dropIndicator))},_gravity:function(a,c){var a=b.byId(a),d=b._abs(a),e=b.contentBox(a),f=b._getPadBorderExtents(a);b._getBorderBox(a);return(c.pageX<d.x+(e.w+f.w)/2?this.gravity_WEST:this.gravity_EAST)|(c.pageY<d.y+
(e.h+f.h)/2?this.gravity_NORTH:this.gravity_SOUTH)},gravity_NORTH:1,gravity_SOUTH:2,gravity_EAST:4,gravity_WEST:8,placeIndicator:function(a,c,d,e){var a=this.vertical?"left":"top",f;d<0?this.childBoxes.length?f=e?this.childBoxes[0]:this.childBoxes[this.childBoxes.length-1]:this.dropIndicator.style[a]=b._abs(this.domNode)[this.vertical?"x":"y"]+"px":f=this.childBoxes[d];if(f)this.dropIndicator.style[a]=(e?f[a]:f[this.vertical?"right":"bottom"])+"px",this.vertical?(this.dropIndicator.style.height=f.height+
"px",this.dropIndicator.style.top=f.top+"px"):(this.dropIndicator.style.width=f.width+"px",this.dropIndicator.style.left=f.left+"px")},onDragOut:function(){this.dropIndicator&&(b._destroyElement(this.dropIndicator),delete this.dropIndicator)},onDrop:function(a){this.onDragOut(a);var b=this._getNodeUnderMouse(a),d=this.vertical?this.gravity_WEST:this.gravity_NORTH;if(b<0){if(this.childBoxes.length)return this._gravity(this.childBoxes[0].node,a)&d?this.insert(a,this.childBoxes[0].node,"before"):this.insert(a,
this.childBoxes[this.childBoxes.length-1].node,"after");return this.insert(a,this.domNode,"append")}b=this.childBoxes[b];return this._gravity(b.node,a)&d?this.insert(a,b.node,"before"):this.insert(a,b.node,"after")},insert:function(a,c,d){a=a.dragObject.domNode;if(d=="before")return b.place(a,c,"before");else if(d=="after")return b.place(a,c,"after");else if(d=="append")return c.appendChild(a),!0;return!1}}));if(!b._hasResource["ws.dnd.suite"])b._hasResource["ws.dnd.suite"]=!0,b.provide("ws.dnd.suite"),
ws.dnd.dragManager.onKeyDown=function(a){if(this.selectedSources.length!=0)switch(a.keyCode){case b.keys.ESCAPE:this.dropAcceptable=!1,this.onMouseUp(a,!0)}},b.declare("ws.dnd.GridDragSource",ws.dnd.HtmlDragSource,{constructor:function(a,b,d){this.dragObjectCtor=ws.dnd.GridDragObject;this.listView=d},onDragStart:function(){b.publish("dragStart",[{source:this}]);for(var a=ws.dnd.dragManager.mouseDownTarget;a!=null&&!b.hasClass(a,"dojoxGrid-row");)a=a.parentNode;if(a==null)return null;this.dragObject=
a;this.rowIndex=a.gridRowIndex;a=new this.dragObjectCtor(this.dragObject,this.type,this.listView);if(this.dragClass)a.dragClass=this.dragClass;this.constrainToContainer&&a.constrainTo(this.constrainingContainer||this.domNode.parentNode);return a},onDragEnd:function(){b.publish("dragEnd",[{source:this}])}}),b.declare("ws.dnd.GridDragObject",ws.dnd.HtmlDragObject,{constructor:function(a,b,d){this.listView=d},createDragNode:function(){var a=b.create("div",{className:"gridDragObjectNormal",id:"gridDragObjectNormal",
style:{zIndex:"10000"}});b.create("img",{src:Config.SpacerImageURL,align:"absmiddle"},a);var c=this.listView.getDragObjectLabel(this.domNode.gridRowIndex),c=c?ws.string.escapeXml(ws.string.summary(c,23)):Config.Strings.YourMessageNoCaps;b.create("span",{innerHTML:c,style:{padding:"5px 12px 5px 12px"}},a);new h.BackgroundIframe(a);return a},onDragStart:function(a){this.inherited(arguments);this.dragOffset={x:15,y:2};this.onDragMove(a)}}),b.declare("ws.dnd.NavigationDropTarget",ws.dnd.DropTarget,{constructor:function(a,
c,d,e){if(arguments.length!=0)this.domNode=b.byId(a),c&&b.isString(c)&&(c=[c]),this.acceptedTypes=c||[],this.parentWidget=d,this.itemid=e,this.dragObjectClone=null,ws.dnd.dragManager.registerDropTarget(this)},onDragOver:function(a){if(!a.dragObjects||!a.dragObjects[0])return!1;if(this.itemid=="myFolders")return a.dragObjects[0].dragClone.className="gridDragObjectNormal",this.parentWidget.expandMyFolders()&&ws.dnd.dragManager.cacheTargetLocations(),!1;if(!this.accepts(a.dragObjects,!0))return a.dragObjects[0].dragClone.className=
"gridDragObjectBadDrop",this.dragObjectClone=a.dragObjects[0].dragClone,!1;b.addClass(this.domNode,"navItemHover");a.dragObjects[0].dragClone.className="gridDragObjectGoodDrop";this.dragObjectClone=a.dragObjects[0].dragClone;return!0},onDragMove:function(){},onDragOut:function(){b.removeClass(this.domNode,"navItemHover");if(this.dragObjectClone)this.dragObjectClone.className="gridDragObjectNormal",this.dragObjectClone=null},accepts:function(a,c){var d=this.inherited(arguments);if(!c)return d&&b.every(a,
function(a){return a.type=="message"});return d&&b.every(a,function(a){return a.type=="message"})&&b.indexOf(this.parentWidget.mailModel.getFoldersCanMoveTo(),this.itemid)!=-1},onDrop:function(a){var b;switch(a.dragObject.type){case 0:case 1:case 2:b=this.onDropCalendar(a);break;case "message":b=this.onDropMessage(a);break;default:b=!1}this.onDragOut(a);return b},onDropCalendar:function(a){var b=a.dragObject.dragSource.componentInstance;if(b==null)return!1;a=this.parentWidget.calendarModel;b=a.components[b[a.indexEnum.id]];
if(this.itemid==b[a.componentEnum.calid])return!1;b=a.getComponentArgs(b);b.calid=this.itemid;a.saveComponent(b);return!0},onDropMessage:function(a){var c=this.parentWidget.mailModel,a=c.getDatum(a.dragObject.dragSource.rowIndex,c.columns.UID),d=c.isAllSelected(),e=c.isSelected(a)?c.getSelectedUids():[a],f=c.getOpSize(e),a=c.getFolderByName(this.itemid).displayName,g=h.byId("messageList");if(c.getCurrentFolder().type!="Deleted"&&this.itemid==Config.DeletedItemsFolderName){var j=null;a&&(j=f.opSize==
1?ws.string.substituteParams(Config.Strings.MessageMoved,a):ws.string.substituteParams(Config.Strings.MessagesMoved,f.opSize,a));g.maybePreviewNextMessage(e);c.deleteMessages({uids:e,reason:"drptrsh",checkUndo:!0,isAllSel:d,load:b.hitch(this,function(a){if(j){var g=null;!Config.UseOMS&&(Config.EnableRestoreButton||Settings.ViewNewOld)?g=a.canUndo?b.hitch(this,"_restoreMessages",c,e,f):null:a.responseUIDs&&(g=a.canUndo?b.hitch(c,"undoMoveMessages",a.responseUIDs,Config.DeletedItemsFolderName):null);
b.publish("WSFeedbackStart",[j,!0,g])}d&&(c.activeCachedList.Clear({preserveSort:!0}),c.setFolder(c.getCurrentFolder().name,null,null,null,null,"descending",!0))}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteMessages-onDropMessage file:dnd/suite.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorDeleting)}})}else c.getCurrentFolder().name==Config.SpamFolderName&&this.itemid!=Config.SpamFolderName?(g.maybePreviewNextMessage(e),
this._moveMessages(c,e,a,f)):this.itemid==Config.SpamFolderName?(g.maybePreviewNextMessage(e),this._reportSpamMessages(c,e,!0,f)):(g.maybePreviewNextMessage(e),this._moveMessages(c,e,a,f));return!0},_restoreMessages:function(a,c,d){a&&c&&a.restoreMessages({uids:c,folder:Config.DeletedItemsFolderName,load:b.hitch(this,function(){a.refetchFolderIndex(a.currentFolder);var c=d.opSize==1?Config.Strings.MessageRestored:ws.string.substituteParams(Config.Strings.MessagesRestored,d.opSize);b.publish("WSFeedbackStart",
[c,!0])}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.restoreMessages-_restoreMessages file:dnd/suite.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorRestoring)}})},_reportSpamMessages:function(a,c,d,e){a&&c&&a.reportSpamMessages({checkUndo:d,uids:c,isSpam:d,load:b.hitch(this,function(f){d&&(f=f.canUndo?b.hitch(a,"undoMoveMessages",f.responseUIDs,this.itemid):null,c.length==1?b.publish("WSFeedbackStart",[Config.Strings.MessageMarkedSpam,
!0,f]):b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.MessagesMarkedSpam,e.opSize),!0,f]))}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.reportSpamMessages-_reportSpamMessages file:dnd/suite.js");ws.widget.Dialogs.ok(a||Config.Strings.ReportSpamError)}})},_moveMessages:function(a,c,d,e){a&&c&&a.moveMessages({uids:c,destFolder:this.itemid,checkUndo:!0,load:b.hitch(this,function(f){d&&(f=f.canUndo?
b.hitch(a,"undoMoveMessages",f.responseUIDs,this.itemid):null,c.length==1?b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.MessageMoved,d),!0,f]):b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.MessagesMoved,e.opSize,d),!0,f]))}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.moveMessages-_moveMessages file:dnd/suite.js");ws.widget.Dialogs.ok(a||Config.Strings.MoveMessageError)}})}}),
b.declare("ws.dnd.PluginToolbarDragSource",ws.dnd.HtmlDragSource,{constructor:function(a,b,d){this.dragObjectCtor=ws.dnd.PluginToolbarDragObject;this.pluginContainer=d},onDragStart:function(){if(this.pluginContainer.shouldStartDrag()){this.pluginContainer.inDragMode=!0;for(var a=ws.dnd.dragManager.mouseDownTarget;a!=null&&!b.hasClass(a,"pluginIcon");)a=a.parentNode;if(a==null)return null;this.dragObject=a;this.pluginId=a.pluginId;this.pluginContainer.dragId=this.pluginId;this.pluginContainer.dragIdIdx=
b.indexOf(this.pluginContainer.myPrimaryPluginIDList,this.pluginId);a=new this.dragObjectCtor(this.dragObject,"plugin",this.pluginContainer,this.pluginId);if(this.dragClass)a.dragClass=this.dragClass;this.constrainToContainer&&a.constrainTo(this.constrainingContainer||this.domNode.parentNode);return a}},onDragEnd:function(){this.pluginContainer.inDragMode=!1;this.pluginContainer.dragId=null;this.pluginContainer.dragIdIdx=null}}),b.declare("ws.dnd.PluginToolbarDragObject",ws.dnd.HtmlDragObject,{constructor:function(a,
c,d,e){this.pluginContainer=d;this.pluginId=e;this.idxInToolbar=b.indexOf(this.pluginContainer.myPrimaryPluginIDList,e)},createDragNode:function(){var a=b.create("div",{className:this.pluginContainer.getDragObjectContainerClass(this.pluginId),style:{zIndex:"2000"},id:"pluginToolbarDragObject"});b.create("div",{className:this.pluginContainer.getDragObjectClass(this.pluginId)},a);b.create("img",{src:this.pluginContainer.getDragObjectImg(this.pluginId),align:"absmiddle"},a);new h.BackgroundIframe(a);
return a},onDragStart:function(a){this.inherited(arguments);this.dragOffset={x:0,y:10};this.onDragMove(a)}}),b.declare("ws.dnd.PluginToolbarDropTarget",ws.dnd.DropTarget,{constructor:function(a,c,d,e){if(arguments.length!=0)this.domNode=b.byId(a),c&&b.isString(c)&&(c=[c]),this.acceptedTypes=c||[],this.pluginContainer=d,this.itemid=e,this.dragObjectClone=null,ws.dnd.dragManager.registerDropTarget(this)},accepts:function(a){return this.inherited(arguments)&&b.every(a,function(a){return a.type=="plugin"})},
onDragOver:function(a){if(!a.dragObjects||!a.dragObjects[0])return!1;if(!this.accepts(a.dragObjects,!0))return!1;return!0},onDrop:function(a){this.onDragOut(a);var c=b._abs(this.domNode),d=b.contentBox(this.domNode),e=b._getPadBorderExtents(this.domNode);return a.pageX>=c.x&&a.pageX<=c.x+d.w+e.w&&a.pageY>=c.y&&a.pageY<=c.y+d.h+e.h?this.itemid=="toolbartray"?(b.addClass(el,"pluginToolbarTrayCol"),d=this.pluginContainer.toolbarTrayCol-1-Math.floor((a.pageX-c.x)/this.pluginContainer.iconWidth),c=Math.floor((a.pageY-
c.y)/this.pluginContainer.iconHeight),e=d*this.pluginContainer.toolbarTrayIconPerCol+c,e=d*this.pluginContainer.toolbarTrayIconPerCol+c,e+=this.pluginContainer.myPrimaryPluginIDList.length-this.pluginContainer._numIconsToHide,this.pluginContainer.movePlugin(a.dragObject.idxInToolbar,e)):this.itemid=="toolbar"?(e=Math.floor((a.pageY-c.y)/this.pluginContainer.iconHeight),this.pluginContainer.movePlugin(a.dragObject.idxInToolbar,e)):!1:!1}});b._hasResource["ws.mail.EditFolderDialog"]||(b._hasResource["ws.mail.EditFolderDialog"]=
!0,b.provide("ws.mail.EditFolderDialog"),b.declare("ws.mail.EditFolderDialog",[ws.widget.WSModalPane,h._Templated],{templateString:b.cache("ws.mail","EditFolderDialog.html",'<div class="WSModalPane editFolder">\r\n\t<div class="WSModalPaneInner">\r\n\t\t<img src="${spacer}" class="mainSprite wsCloseBtn" dojoattachevent="onclick: hide" />\r\n\t\t<div class="modalContainer">\r\n\t\t\t<div class="content" dojoattachpoint="content">\r\n\t\t\t\t<div class="header">${EditFolder}</div>\r\n\t\t\t\t<div dojoattachpoint="inputNameDiv" class="wsToolBar" dojotype="ws.widget.WSToolbar" viztype="Bare" style="width:340px">\r\n\t\t\t\t\t<div dojotype="ws.widget.DefaultTextbox" toolbarposition="left" dojoattachevent="onKeyUp: onKeyPressInputField"\tdojoattachpoint="renameInput" maxlength="32"></div>\r\n\t\t\t\t\t<div dojotype="ws.widget.Button" toolbarposition="left" dojoattachevent="onClick: renameFolder" style="margin-left:10px">${Save}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="info" dojoattachpoint="infoNode">\r\n\t\t\t\t\t<span dojoattachpoint="msgCountNode"></span>&nbsp;${Messages} &nbsp;|&nbsp; <span dojoattachpoint="sizeNode"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="actions">\r\n\t\t\t\t\t<span dojoattachpoint="emptyLink" class="wsLink" dojoattachevent="onclick: emptyFolder" style="visibility:hidden">${Empty}</span> <span class="pipe" dojoAttachPoint="linkSep" style="visibility:hidden">|</span> <span class="wsLink" dojoattachevent="onclick: checkFiltersBeforeDeleteFolder">${Delete}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,model:null,undoDeleteFolderCB:null,undoEmptyFolderCB:null,undoCallback:null,destroyOnClose:!1,listOfDeletedFilters:[],folderExistsInFilter:!1,show:function(a){for(var b=0;b<this.model.folders.length;b++)if(this.model.folders[b].name==a)this.folder=this.model.folders[b];this.renameInput.setValue(this.folder.displayName);this.getFolderInfo();this.inherited(arguments);this.inputNameDiv.layout();ws.widget.fixFFCursor(this.inputNameDiv);ws.reporting.reportAction("Edit Folder")},
getFolderInfo:function(){this.infoNode.style.visibility="hidden";this.model.getFolderInfo({name:this.folder.name,load:b.hitch(this,function(a){this.folder.count=a.count;a.count==0?(this.emptyLink.style.visibility="hidden",this.linkSep.style.visibility="hidden"):(this.emptyLink.style.visibility="visible",this.linkSep.style.visibility="visible");this.msgCountNode.innerHTML=a.count;this.sizeNode.innerHTML=Math.round(a.size/1024)+"KB";this.infoNode.style.visibility="visible"}),error:function(a){window.ws_ErrLgr&&
!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"Error Handler for model.getFolderInfo-getFolderInfo file:EditFolderDialog.js")}})},getAssociatedFiltersFolder:function(){this.folderExistsInFilter=!1;this.listOfDeletedFilters=[];var a=0,c=h.byId("FilterSettings");if(c)for(var d=0;d<c.filterList.size();d++){var e=c.filterList.get(d);if(e.moveToFolder==this.folder.name)this.listOfDeletedFilters[a]=e,this.folderExistsInFilter=!0,a++}else{var f=new ws.mail.MailFilters;f.loadFromRpc({load:b.hitch(this,function(b){if(b.isSuccess){f.clear();
f.addAll(b.filterList);for(b=0;b<f.size();b++){var c=f.get(b);if(c.moveToFolder==this.folder.name)this.listOfDeletedFilters[a]=c,this.folderExistsInFilter=!0,a++}}})})}},checkFiltersBeforeDeleteFolder:function(){ws.UserContext.MailboxType=="ANGELIA"&&this.getAssociatedFiltersFolder();this.deleteFolder()},deleteFolder:function(){this.hide();var a=this.folder.count==-1?"":this.folder.count,c=Config.EnableIMAPFolderHierarchy?ws.string.substituteParams(Config.Strings.DeleteHierarchyFolderConfirmation,
this.folder.displayName):ws.string.substituteParams(Config.Strings.DeleteFolderConfirmation,this.folder.displayName,a);this.folderExistsInFilter&&(c=this.folder.count==0?ws.string.substituteParams(Config.Strings.DeleteFolderInFilterConfirmation2,"<b>"+this.folder.displayName+"</b>"):ws.string.substituteParams(Config.Strings.DeleteFolderInFilterConfirmation,"<b>"+this.folder.displayName+"</b>",a));this.folder.count==0&&!this.folderExistsInFilter?(this.undoCallback=this.undoDeleteFolderCB?b.hitch(this,
function(){this.undoDeleteFolderCB({newName:this.folder.displayName,undo:!0})}):null,this._deleteFolder()):ws.widget.Dialogs.okCancel(c,b.hitch(this,function(a){a?(this.undoCallback=null,this._deleteFolder()):this.show(this.folder.name)}))},_deleteFolder:function(){this.model.deleteFolder({load:b.hitch(this,function(){this.folderListHandle=b.connect(this.model,"folderListChanged",this,"_showDelayedFeedback");if(ws.UserContext.MailboxType=="ANGELIA"&&this.listOfDeletedFilters.length>0){for(var a=[],
c=0;c<this.listOfDeletedFilters.length;c++)a.push(this.listOfDeletedFilters[c].filterId);this.listOfDeletedFilters[0].deleteFilter({filterIDs:a,load:b.hitch(this,function(a){if(a.isSuccess){var b=h.byId("FilterSettings");if(b){var c=new ws.mail.MailFilters;c.clear();c.addAll(a.filterList);b.filterList=c}}}),error:function(){}})}}),name:this.folder.name,error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteFolder-_deleteFolder file:EditFolderDialog.js");
ws.widget.Dialogs.ok(a||Config.Strings.DeleteFolderError)}})},_showDelayedFeedback:function(){b.disconnect(this.folderListHandle);ws.lang.setTimeout(this,function(){b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.FolderDeleted,this.folder.displayName),!0,this.undoCallback])},100)},emptyFolder:function(){this.hide();if(this.folder.count!=0){this.model.getCachedListForFolder(this.folder.name);var a=this.folder.type=="Deleted"?Config.Strings.PermDeleteSelectedConfirmation:ws.string.substituteParams(Config.Strings.EmptyFolderConfirmation,
"",this.folder.displayName);this.folder.type!="Deleted"&&this.folder.type!="Spam"?ws.widget.Dialogs.okCancel(a,b.hitch(this,function(a){a?this._emptyFolder(!0):this.show(this.folder.name)})):ws.widget.Dialogs.okCancel(a,b.hitch(this,function(a){a?this._emptyFolder():this.show(this.folder.name)}))}},_emptyFolder:function(a){this.model.emptyFolder({name:this.folder.name,fetchUIDs:a,load:b.hitch(this,function(c){var d=null;this.undoCallback=null;if(a&&c.responseUIDs)d=c.responseUIDs;!Config.UseOMS&&
(Config.EnableRestoreButton||Settings.ViewNewOld)?this.undoCallback=d&&d.length?b.hitch(this,function(){this.undoEmptyFolderCB(d)}):null:d&&d.length?(ma_uids={},ma_uids[this.folder.name]=d,this.undoCallback=b.hitch(this.model,"undoMoveMessages",ma_uids,Config.DeletedItemsFolderName,this.folder.name)):this.undoCallback=null;b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.FolderEmptied,this.folder.displayName),!0,this.undoCallback])}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,
"Dialogs.ok shown - Error Handler for model.emptyFolder-_emptyFolder file:EditFolderDialog.js");ws.widget.Dialogs.ok(a||Config.Strings.EmptyFolderError)}})},renameFolder:function(){this.hide();this.model.renameFolder({name:this.folder.name,newName:this.renameInput.getValue(),error:b.hitch(this,function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.renameFolder-renameFolder file:EditFolderDialog.js");ws.widget.Dialogs.ok(a||Config.Strings.FolderRenameError,
b.hitch(this,"show",this.folder.name))})})},onKeyPressInputField:function(a){a.keyCode==b.keys.ENTER&&(this.renameFolder(),a.preventDefault())}}));b._hasResource["ws.suite.MiniLogin"]||(b._hasResource["ws.suite.MiniLogin"]=!0,b.provide("ws.suite.MiniLogin"),b.declare("ws.suite.MiniLogin",[ws.widget.WSModalPane,h._Templated],{templateString:b.cache("ws.suite","MiniLogin.html",'<div class="WSModalPane miniLogin">\r\n\t<div class="WSModalPaneInner">\r\n\t\t<div class="modalContainer">\r\n\t\t\t<div dojoAttachPoint="logoArea" class="logoArea">\r\n\t\t\t\t<img dojoattachpoint="imageLogo" src="${spacer}">\r\n\t\t\t\t<div dojoattachpoint="textDomainLogo" style="display:none">\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class="messageArea" dojoAttachPoint="messageNode"></div>\r\n\t\t\t<iframe dojoAttachPoint="loginFrame" class="miniLoginSNSiFrame" frameborder="0" hspace="0" marginheight="0" marginwidth="0" vspace="0" scrolling="no" allowtransparency="true"></iframe>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},destroyOnClose:!1,snsHelpUrl:Config.SNSHelpPopupUrl,startup:function(){this.inherited(arguments)},show:function(a,c,d,e){this.inherited(arguments);c=ws.string.substituteParams(c,encodeURIComponent(e),d?"novl":"n");b.io.iframe.setSrc(this.loginFrame,c,!0);ws.html.setInnerText(this.messageNode,a||"")},moveOffscreen:function(){this.originalTop=this.domNode.style.top;this.domNode.style.top="-10000px"},moveOnscreen:function(){this.domNode.style.top=this.originalTop}}));b._hasResource["ws.layers.dojo3"]||
(b._hasResource["ws.layers.dojo3"]=!0,b.provide("ws.layers.dojo3"))}}});

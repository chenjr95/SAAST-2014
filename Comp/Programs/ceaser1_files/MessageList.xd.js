/* (C) 2012 AOL Inc. All Rights Reserved */
dojo._xdResourceLoaded(function(){return{depends:[["provide","ws.mail.MessageListView"],["provide","ws.layers.MessageList"]],defineResource:function(b,l,m){b._hasResource["ws.mail.MessageListView"]||(b._hasResource["ws.mail.MessageListView"]=!0,b.provide("ws.mail.MessageListView"),b.declare("ws.mail.MessageGridModel",m.grid.data.Dynamic,{columns:{Select:0,Type:1,FromTo:2,Hover:3,Attachment:4,Subject:5,Received:6,Flag:7,Folder:8,Size:9,Account:10},sortableCols:["FromTo","Attachment","Subject","Received",
"Flag","Size","Folder","Account"],reportFolderName:null,constructor:function(a,c,d){this.model=d;if(!Settings.ShowTodayAtSignIn)a=this.model.currentFolder,c=this.model.getFolderByName(a),ws.reporting.DL.startEvent("list_folder",a,{opData:c&&c.displayName?c.displayName:""}),this.model.trackdl("-MLV.Ca",a),this.reportFolderName=a;b.connect(this.model,"changeRow",this,"onChangeRow");b.connect(this.model,"modelUpdated",this,"modelUpdated")},modelUpdated:function(){},getRowCount:function(){return this.model.getRowCount()},
typeTips:{ANSWERED:Config.Strings.RepliedTip,OFFICIAL:Config.Strings.AOLOfficialMail,CERTIFIED:Config.Strings.AOLCertifiedMail,VOICEMAIL:Config.Strings.AOLVoiceMail},getDatum:function(a,c){if(this.model.getRowCount()==0)return"";var b=this.model.getRowData(a);if(b==null)return c==this.columns.Subject?"...":"";if(this.reportFolderName&&this.reportFolderName==this.model.currentFolder)this.model.trackdl("-MLV.GDz",this.reportFolderName),ws.reporting.DL.endEvent(this.reportFolderName,{opResult:"success",
msgCount:this.model.getRowCount()}),this.reportFolderName=null;var f=b[this.model.columns.UID],e="Invalid Column";switch(c){case this.columns.Select:e=[this.model.isSelected(f)?"ON":"OFF",Config.Strings.CheckboxTip];break;case this.columns.Type:b=this.model.getTypeName(b);e=[b,this.typeTips[b]];break;case this.columns.FromTo:e=b[this.model.columns.FromToAddress]||Config.Strings.None;f="";Config.UseOMS&&Config.FriendlyName&&b[this.model.columns.Description]!=null&&b[this.model.columns.Description]!=
""&&Settings.ShowSenderDisplayName==!0&&(f=" title='"+e+"'",e=ws.string.escapeXml(b[this.model.columns.Description]));e=this.markupSearchString(e,"fromto");e="<span"+f+" style='white-space:nowrap' class='fromAddress'>"+e+"</span>";break;case this.columns.Hover:e=this.getHoverColumnCB?this.getHoverColumnCB(a):"";break;case this.columns.Attachment:e=b[this.model.columns.Attachment]?"ATTACHMENT":"NONE";break;case this.columns.Subject:e=b[this.model.columns.Subject]||Config.Strings.NoSubject;e=ws.string.escapeXml(e);
b=b[this.model.columns.Fragment];e="<span title='"+(ws.WebSuite.heightMode!=4&&!ws.WebSuite.snippetsOn?ws.string.escapeXml(ws.string.summary(b,99)):"")+"' style='white-space: nowrap;'>"+this.markupSearchString(e,"subject")+"</span>";ws.WebSuite.heightMode==4&&b!=""?e+="<br><span class='frag'>"+b+"</span>":ws.WebSuite.snippetsOn&&(e+="<span class='frag frag2'> - "+b+"</span>");break;case this.columns.Received:e=ws.date.shortestDate(b[this.model.columns.Received],!0);break;case this.columns.Flag:e=
b[this.model.columns.Flag]?["FLAGGED",Config.Strings.FlaggedTip]:["NONE",Config.Strings.FlagTip];break;case this.columns.Size:e=this.getDisplaySize(b[this.model.columns.Size]);break;case this.columns.Folder:if(e=b[this.model.columns.Folder])b=this.model.getFolderByName(e),e=b.type=="Aggregated"||b.type=="Inbox"?Config.Strings.Folder_Inbox:b.displayName;break;case this.columns.Account:b=b[this.model.columns.Account],e=this.model.getIdentities(),e=[e[b][3],e[b][0]==e[b][1]?e[b][0]:e[b][0]+"  "+e[b][1]]}return e},
getDisplaySize:function(a){a<1024&&(a=1024);if(a<1048576)return Math.round(a/1024)+Config.Strings.KilobytesShort;if(a<1073741824)return Math.round(a/1048576)+Config.Strings.MegabytesShort;return Math.round(a/1073741824)+Config.Strings.GigabytesShort},getSortColumnIndex:function(a){var c="";switch(a){case this.columns.Type:c="Info";break;case this.columns.FromTo:c="FromToAddress";break;case this.columns.Hover:c="QuickAction";break;case this.columns.Attachment:c="Attachment";break;case this.columns.Subject:c=
"Subject";break;case this.columns.Received:c="Received";break;case this.columns.Flag:c="Flag";break;case this.columns.Size:c="Size";break;case this.columns.Folder:c="Folder";break;case this.columns.Account:c="Account"}return c},markupSearchString:function(a,c){var b=this.model.getSearchString(),f=this.model.getSearchIn();if(b&&(f==c||f=="alltext"))if(b=ws.string.escapeXml(b),a.toLowerCase().indexOf(b.toLowerCase())!=-1){for(var f=a,e=f.toLowerCase(),g=b.length,b=b.toLowerCase(),h=[],i=e.indexOf(b);i!=
-1;)h.push(f.substr(0,i)),h.push("<span class='searchTerm'>",f.substr(i,g),"</span>"),f=f.substr(i+g),e=e.substr(i+g),i=e.indexOf(b);h.push(f);a=h.join("")}return a},onChangeRow:function(a){this.rowChange(null,a)},canSort:function(a){a=Math.abs(a)-1;return b.some(this.sortableCols,function(c){return a==this.columns[c]},this)},sort:function(a){var c=this.getSortColumnIndex(Math.abs(a)-1);ws.reporting.report("Sort Messages - "+c,"Mail");this.model.sort(c,a<0?"descending":"ascending")}}),b.declare("ws.mail.MessageListView",
ws.widget.ListView,{templateString:b.cache("ws.mail","MessageListView.html",'<div>\r\n\t<div dojoType="ws.widget.WSSplitContainer" style="height: 100%; width: 100%;" dojoAttachPoint="splitContainer" sizerWidth="9" orientation="vertical" persist="false">\r\n\t\t<div class="listView messageListView" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget">\r\n            <div dojoType="ws.widget.SingleLineNotification" dojoAttachPoint="notification" class="notification" layoutalign="top" style="display:none"></div>\r\n\t\t\t<div dojoType="ws.widget.WSToolbar" dojoAttachPoint="toolbar" layoutAlign="top" vizType="Controls">\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachPoint="restoreButton" iconClassName="restoreIcon" dojoAttachEvent="onClick: onClickRestore" title="${RestoreButton}">${RestoreButton}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachPoint="keepNewButton" iconClassName="keepNewIcon" dojoAttachEvent="onClick: markMessagesUnread" title="${MsgListKeepAsNewTip}" tip="${KeepAsNewActionLabel} <span>(${KeyMailKeepAsNew})</span>">${KeepAsNewActionLabel}</div>\r\n\t\t\t\t<div style="display:none" dojoType="ws.widget.Button" dojoAttachEvent="onClick: editDraft, onMouseDown: savePreviewPaneSelection" dojoAttachPoint="editDraftButton" iconClassName="editDraftIcon" title="${EditDraft}">${EditDraft}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick: reply, onMouseDown: savePreviewPaneSelection" dojoAttachPoint="replyButton" iconClassName="replyIcon" title="${DisplayReply} (${KeyMailReply})" tip="${DisplayReply} <span>(${KeyMailReply})</span>">${DisplayReply}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick: replyAll, onMouseDown: savePreviewPaneSelection" dojoAttachPoint="replyAllButton" iconClassName="replyAllIcon" title="${DisplayReplyAll} (${KeyMailReplyAll})" tip="${DisplayReplyAll} <span>(${KeyMailReplyAll})</span>">${DisplayReplyAll}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick: forward, onMouseDown: savePreviewPaneSelection" dojoAttachPoint="forwardButton" iconClassName="forwardIcon" title="${DisplayForward} (${KeyMailForward})" tip="${DisplayForward} <span>(${KeyMailForward})</span>">${DisplayForward}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachPoint="restartIMButton" dojoAttachEvent="onClick: restartIM" iconClassName="iconIM" title="${DisplayIM}">${DisplayIM}</div>\r\n\t\t\t\t<div dojoType="ws.widget.DropDownButton" dojoAttachPoint="comboIMButton" iconClassName="imIcon" title="${SendIM}">${SendIMPrefix}</div>\r\n\t\t\t\t<div dojoType="ws.widget.DropDownButton" dojoAttachPoint="actionButton" iconClassName="actionIcon" tip="${ActionButtonTip}" title="${ActionButtonTip}">${ActionButton}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachPoint="deleteButton" iconClassName="delIcon" dojoAttachEvent="onClick:onClickDelete" tip="${DeleteButton} <span>(${DeleteKey})</span>">${DeleteButton}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachPoint="spamButton" iconClassName="spamIcon" dojoAttachEvent="onClick: reportSpam" title="${MsgListSpamTip}" tip="${ReportSpamTooltip}">${ReportSpamButton}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachPoint="notSpamButton" iconClassName="notSpamIcon" dojoAttachEvent="onClick: reportNotSpam" title="${NotSpamButton}">${NotSpamButton}</div>\r\n\t\r\n\t\t\t\t<\!-- \r\n\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachPoint="topContactsButton" dojoAttachEvent="onClick: onClickTopContactsBtn">\r\n\t\t\t\t<span>${TopContacts_DisplayName}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t--\>\r\n\t\t\t\t<div toolbarPosition="right" dojoType="ws.widget.Pane" class="msgListTbRight">\r\n\t\t\t\t\t<div dojoType="ws.widget.DropDownButton" dojoAttachPoint="filterButton" widgetId="filterDropDown"></div>\r\n\t\t\t\t\t<div dojoType="ws.widget.DropDownButton" dojoAttachPoint="customizeButton">${Customize}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" dojoAttachPoint="searchInfoPane" class="searchInfo" layoutAlign="top" style="display:none">\r\n\t\t\t\t<div class="searchData">\r\n\t\t\t\t\t<span dojoAttachPoint="searchResultsNode"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoType="ws.widget.DropDownButton" type="Bare" dojoAttachPoint="fsButton" title="${FilterSearchTip}" size="Large">${FilterSearch}</div>\r\n\t\t\t\t<div class="mainSprite wsCloseBtn" dojoAttachEvent="onclick:clearSearch"></div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" dojoAttachPoint="forwardingInfoPane" class="searchInfo" layoutAlign="top" style="display: none;">\r\n\t\t\t\t<div style="float:left">\r\n\t\t\t\t\t<span dojoAttachPoint="forwardingInfoNode"></span>\r\n\t\t\t\t\t&nbsp;&nbsp;\r\n\t\t\t\t\t<span class="wsLink" dojoAttachEvent="onclick: openPremiumSettings" title="${PremiumForwardingOnTitle}">${Edit}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" layoutAlign="client">\r\n\t\t\t\t<div dojoAttachPoint="grid" dojoType="dojox.Grid"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},hoverColumnHtml:'<div class="hoverControl trashHover" title="'+Config.Strings.DeleteMessageTip+'"></div>',speedUp:!0,quickActionCol:3,wrapperModelClass:ws.mail.MessageGridModel,currentSearchIn:"alltext",dragType:"message",autosizeColumnId:"Subject",origPrefsWidth:{},columnDefaults:null,cookiePrefs:null,prefsVer:1.1,lastClickTime:0,lastClickUid:0,postCreate:function(){b.subscribe("DisplayMessage/deleteMessage",b.hitch(this,"deleteMessages"));b.subscribe("ListSpacingResize",
b.hitch(this,function(){this.grid.update()}))},initView:function(){this.initColumns();this.defineMenus();this.inherited(arguments);this.defSort=-(this.columnDefaults.Received.order-1);b.connect(this.model,"modelUpdated",this,"modelUpdated");b.connect(this.model,"folderListChanged",this,"updateActionMenu");b.connect(this.toolbar,"wrap",this,"wrapToolbar");b.connect(this.model,"search",b.hitch(this,function(){this.onSelectionChange(!0)}));b.connect(this.model,"onSelectionChange",this,"onSelectionChange");
this.filterButton.getMenu();this.customizeButton.getMenu();b.subscribe("Settings/hide",b.hitch(this,function(){var a=this.notification;a&&a.isInternalNotification&&Settings.AwayMessageType!=null&&Settings.AwayMessageType=="Disabled"&&a.isShowing()&&(a.hide(),this.onResized())}));b.connect(ws.WebSuite,"processKeyPress",this,"onKeyPress");b.connect(this.grid,"onCellDblClick",this,"handleCellDblClick");this.subscribe("toolbarLayoutUpdate","resize");this.subscribe("snippetViewUpdate",function(){ws.WebSuite.snippetsOn=
!ws.WebSuite.snippetsOn;this.grid.update()});this.deleteButton.domNode.title=ws.string.substituteParams(Config.Strings.DeleteTip,Settings.DeletedFolderDisplayName);Config.UseOMS&&Config.CrossFolderSearch?this.showFilterSearchMenu():this.hideFilterSearchMenu();this.initSplitContainer();Config.EnablePreviewPane&&(Settings.EnablePreviewPane||!Settings.PreviewPaneIntroSeen)?(!Settings.PreviewPaneIntroSeen&&Settings.EnablePreviewPane&&this.savePreviewPaneSettings({PreviewPaneIntroSeen:!0}),this.setPreviewPaneEnabled(!0)):
this.setPreviewPaneEnabled(!1);ws.WebSuite.SidePanel.setupAdScroll(this.grid.views.views[0].scrollboxNode,"mlist")},initColumns:function(a){this.columnDefaults={Select:{order:0,width:36,hidden:!1},Account:{order:1,width:16,hidden:!0},FromTo:{order:2,width:150,min:75,max:250,hidden:!1},Type:{order:3,width:16,hidden:!1},Attachment:{order:4,width:16,hidden:!1},Subject:{order:5,width:250,min:100,max:400,hidden:!1},Received:{order:6,width:72,min:72,max:250,hidden:!1},Hover:{order:7,width:16,hidden:!1},
Flag:{order:8,width:16,hidden:!1},Size:{order:9,width:45,hidden:!0}};this.cookieKeyMap={FromTo:"f",Subject:"s",Received:"r"};if(Config.UseOMS&&Config.CrossFolderSearch)this.columnDefaults.Folder={order:9,width:60,min:60,max:250,hidden:!0},this.columnDefaults.Size={order:10,width:45,hidden:!0};this.columns=[];var c=b.fromJson(Settings.MessageListPrefs),d=!0,f;for(f in c){d=!1;break}f=!1;if(!d&&(!c.version||c.version<this.prefsVer))f=a=!0;if(a||!c||c==""||d)c=ws.lang.shallowCopy(this.columnDefaults,
!0);if(!this.cookiePrefs&&b.cookie.isSupported())this.cookiePrefs=ws.io._getObjectCookie("WSCliSettings","=");d=null;if(this.cookiePrefs&&this.cookiePrefs.cw)for(var e={},g=this.cookiePrefs.cw.split(","),h=0;h<g.length;h++){var i=g[h].split(":");i.length>1&&(e[i[0]]=i[1],d=e)}var e={},j;for(j in this.columnDefaults)if(e[j]=c[j]?ws.lang.shallowCopy(c[j],!0):ws.lang.shallowCopy(this.columnDefaults[j],!0),e[j].width=e[j].width?e[j].width:this.columnDefaults[j].width,this.origPrefsWidth[j]=e[j].width,
!a&&d&&this.cookieKeyMap[j]&&d[this.cookieKeyMap[j]])e[j].width=d[this.cookieKeyMap[j]];this.autoWidthSizedTo=0;if(e&&e.Subject&&e.Subject.width&&e.Subject.width!=this.columnDefaults.Subject.width)this.autoWidthSizedTo=e.Subject.width;try{var k={Select:"<div class='gridIcon ws_image_chkOffIcon'></div>",Type:"<div class='gridIcon ws_image_typeIcon'></div>",FromTo:Config.Strings.From,Hover:" ",Attachment:"<div class='gridIcon ws_image_attachIcon'></div>",Subject:Config.Strings.Subject,Received:Config.Strings.Date,
Flag:"<div class='gridIcon ws_image_flagIcon'></div>",Size:Config.Strings.Size,Folder:Config.Strings,Account:"<div class='gridIcon ws_image_AcctIcon'></div>"};this.columns[e.Select.order]={id:"Select",name:k.Select,width:this.columnDefaults.Select.width+"px",hidden:e.Select.hidden,noresize:!0,formatter:b.hitch(this,"formatSprite",this.baseSprites.chkBox)};this.columns[e.Type.order]={id:"Type",name:k.Type,classes:"gridColType",width:this.columnDefaults.Type.width+"px",hidden:e.Type.hidden,noresize:!0,
formatter:b.hitch(this,"formatSprite",this.sprites.type)};this.columns[e.FromTo.order]={id:"FromTo",name:k.FromTo,classes:"gridColFrom",width:e.FromTo.width+"px",hidden:e.FromTo.hidden};this.columns[e.Hover.order]={id:"Hover",name:k.Hover,classes:"gridColHov",width:this.columnDefaults.Hover.width+"px",hidden:e.Hover.hidden,noresize:!0};this.columns[e.Attachment.order]={id:"Attachment",name:k.Attachment,classes:"gridColAttach",width:this.columnDefaults.Attachment.width+"px",hidden:e.Attachment.hidden,
noresize:!0,formatter:b.hitch(this,"formatSprite",this.sprites.attach)};this.columns[e.Subject.order]={id:"Subject",name:k.Subject,classes:"gridColSub",width:e.Subject.width+"px",hidden:e.Subject.hidden};this.columns[e.Received.order]={id:"Received",name:k.Received,width:e.Received.width+"px",hidden:e.Received.hidden};this.columns[e.Flag.order]={id:"Flag",name:k.Flag,classes:"gridColFlag",width:this.columnDefaults.Flag.width+"px",hidden:e.Flag.hidden,noresize:!0,formatter:b.hitch(this,"formatSprite",
this.sprites.flag)};this.columns[e.Size.order]={id:"Size",name:k.Size,width:e.Size.width+"px",hidden:e.Size.hidden,noresize:!0};this.columns[e.Account.order]={id:"Account",name:k.Account,classes:"gridColAct",width:this.columnDefaults.Account.width+"px",hidden:e.Account.hidden,noresize:!0,formatter:b.hitch(this,"formatAcctSprite",this.sprites.account)};if(Config.UseOMS&&Config.CrossFolderSearch){var l=this.columnDefaults.Folder;this.columns[l.order]={id:"Folder",name:"Folder",width:l.width+"px",hidden:l.hidden};
this.columnMenuSpec=[{caption:Config.Strings.ColumnInfo,checked:!1,onClick:b.hitch(this,"toggleColumn","Type")},{caption:Config.Strings.From,checked:!1,onClick:b.hitch(this,"toggleColumn","FromTo")},{caption:Config.Strings.ColumnQuick,checked:!1,onClick:b.hitch(this,"toggleColumn","Hover")},{caption:Config.Strings.Attachments,checked:!1,onClick:b.hitch(this,"toggleColumn","Attachment")},{caption:Config.Strings.Subject,checked:!1,onClick:b.hitch(this,"toggleColumn","Subject")},{caption:Config.Strings.Date,
checked:!1,onClick:b.hitch(this,"toggleColumn","Received")},{caption:Config.Strings.ColumnFlag,checked:!1,onClick:b.hitch(this,"toggleColumn","Flag")},{caption:Config.Strings.Account,checked:!1,onClick:b.hitch(this,"toggleColumn","Account")},{caption:Config.Strings.Size,checked:!1,onClick:b.hitch(this,"toggleColumn","Size")},{separator:!0},{caption:Config.Strings.ColumnReset,onClick:b.hitch(this,"toggleColumn","RESET")}]}else this.columnMenuSpec=[{caption:Config.Strings.ColumnInfo,checked:!1,onClick:b.hitch(this,
"toggleColumn","Type")},{caption:Config.Strings.From,checked:!1,onClick:b.hitch(this,"toggleColumn","FromTo")},{caption:Config.Strings.ColumnQuick,checked:!1,onClick:b.hitch(this,"toggleColumn","Hover")},{caption:Config.Strings.Attachments,checked:!1,onClick:b.hitch(this,"toggleColumn","Attachment")},{caption:Config.Strings.Subject,checked:!1,onClick:b.hitch(this,"toggleColumn","Subject")},{caption:Config.Strings.Date,checked:!1,onClick:b.hitch(this,"toggleColumn","Received")},{caption:Config.Strings.ColumnFlag,
checked:!1,onClick:b.hitch(this,"toggleColumn","Flag")},{caption:Config.Strings.Size,checked:!1,onClick:b.hitch(this,"toggleColumn","Size")},{separator:!0},{caption:Config.Strings.ColumnReset,onClick:b.hitch(this,"toggleColumn","RESET")}];var m=b.filter(this.columns,function(a){return!a.hidden});this.grid.sortInfo=-(ws.lang.findByProp(m,"id","Received")+1);a&&this.grid.setStructure([{cells:[this.columns]}]);if(f)this.onHeaderColumnChange(null,!1)}catch(n){a||this.initColumns(!0)}},formatAcctSprite:function(a,
c){if(c){var b=c.sort&&c[1]||"",c=c.sort&&c[0]||c;return ws.string.substituteParams("<div class='gridIcon %{0}' title='%{1}'></div>",a&&a[c]?a[c]:a.generic,b)}},onHeaderColumnChange:function(a,c){if(!this.columnDefaults.Folder||this.columnDefaults.Folder.hidden){var d={version:this.prefsVer};this.cookiePrefs=this.cookiePrefs||{cw:""};this.cookiePrefs.cw="";if(c)for(var f in this.columnDefaults){if(f!="Folder"){var e=this.columnDefaults[f],g={},h;for(h in e)h!="min"&&h!="max"&&(h=="width"?(this.columns[e.order].noresize||
(this.cookiePrefs.cw+=this.cookieKeyMap[f]+":"+e[h]+","),g[h]=this.origPrefsWidth[f]):g[h]=e[h]);d[f]=g}}else{f=this.columns;e=this.grid.views.views[0].structure.rows[0];for(g=0;g<f.length;g++)if(h=f[g],h.id!="Folder"){var i=ws.lang.findByProp(e,"id",h.id),i=parseInt(i==-1?h.width:e[i].unitWidth);b.isWebKit&&(i-=this.cellWidthPad);h.id=="Subject"&&(i=this.autoWidthSizedTo?i:this.columnDefaults.Subject.width);d[h.id]={order:g,hidden:h.hidden,width:this.origPrefsWidth[h.id]};h.noresize||(this.cookiePrefs.cw+=
this.cookieKeyMap[h.id]+":"+i+",")}}b.cookie.isSupported()&&ws.io._setObjectCookie(this.cookiePrefs,"WSCliSettings",null,"/",730);ws.settings.saveSoon({MessageListPrefs:d})}},onHeaderContextMenu:function(a){b.stopEvent(a);ws.lang.ensureLayersLoaded(b.hitch(this,"_onHeaderContextMenu",a.pageX,a.pageY))},_onHeaderContextMenu:function(a,c){if(!this.columnMenu)this.columnMenu=ws.widget.createMenu(this.columnMenuSpec),this.columnMenu.startup();var b=this.gridModel.columns,f=this.columnMenu.getChildren();
f[0].setChecked(b.Type!=-1);f[1].setChecked(b.FromTo!=-1);f[2].setChecked(b.Hover!=-1);f[3].setChecked(b.Attachment!=-1);f[4].setChecked(b.Subject!=-1);f[5].setChecked(b.Received!=-1);f[6].setChecked(b.Flag!=-1);f[7].setChecked(b.Account!=-1);f[8].setChecked(b.Size!=-1);this.columnMenu.open(a,c)},modelUpdated:function(){this.updateFilterButton();this.model.trackdl("-MLV.MUa",this.reportFolderName);this.updateSearchInfo();this.updateColumnCaptions();this.onSelectionChange();this.updateAwayMessageNotification();
ws.WebSuite.SidePanel.setupAdScroll(this.grid.views.views[0].scrollboxNode,"mlist")},updateToolbarState:function(){if(this.model){var a=this.model.getCurrentFolder(),c=a?a.name.toLowerCase():"inbox",a=a?a.type:"Inbox";this.buttonViz=b.map((c in Config.FolderButtons?Config.FolderButtons[c]:Config.FolderButtons.other).split(","),function(a){return b.trim(a)=="true"});this.spamButton.setShowing(this.buttonViz[4]&&Config.EnableSpamButton);this.notSpamButton.setShowing(this.buttonViz[5]);this.restoreButton.setShowing(this.buttonViz[8]||
a=="Deleted"&&Settings.ViewNewOld);this.keepNewButton.setShowing(this.buttonViz[12]&&Settings.ViewNewOld);c=a=="Drafts";a=Settings.EnablePreviewPane||!Settings.PreviewPaneIntroSeen;this.replyButton.setShowing(a&&!c);this.replyAllButton.setShowing(a&&!c);this.forwardButton.setShowing(a&&!c);this.editDraftButton.setShowing(c);this.filterButton.setShowing(this.model.getSearchString()==null);this.filterButton.containerNode.innerHTML||this.updateFilterButton();this.restartIMButton.setShowing(this.previewPane&&
this.model.currentUid&&this.previewPane.restartIMButton&&this.previewPane.restartIMButton.isShowing());c=this.previewPane&&this.model.currentUid&&this.previewPane.comboIMButton&&this.previewPane.comboIMButton.isShowing();this.comboIMButton.setShowing(c);c&&ws.widget.updateIMButton(this.comboIMButton);this.domNode.style.display!="none"&&this.toolbar.layout()}},updateColumnCaptions:function(){var a=this.gridModel.columns.FromTo;if(a!=-1){var c=this.model.getCurrentFolder()||{},b=c.type,c=b=="Sent"||
b=="Drafts"||b=="AutoSavedSent"||c.name==Config.IMFolderName?Config.Strings.To:Config.Strings.From;if(this.model.getSearchString()&&Config.UseOMS&&Config.CrossFolderSearch)c=Config.Strings.FromTo;this.grid.views.views[0].structure.rows[0][a].name=c;this.grid.views.views[0].renderHeader()}},displayFolder:function(a,b,d,f,e){var g=this.model.getFolderByName(a);ws.reporting.DL.startEvent("list_folder",a,{opData:g&&g.displayName?g.displayName:""});this.model.trackdl("-MLV.DFa",a);this.gridModel.reportFolderName=
a;this.prevPaneDelayTimeoutId=null;this.grid.rows.setOverRow(0);this._unselect0row=!1;(g=this.model.sortIndices[this.gridModel.getSortColumnIndex(Math.abs(this.grid.sortInfo)-1)])||(g="received");this.model.setFolder(a,b,d,f,g,this.grid.sortInfo<0?"descending":"ascending",!1,e);this.scrollIntoView(0);this.model.trackdl("-MLV.DFz",a)},clearSearch:function(){this.model.search(null);Config.UseOMS&&Config.CrossFolderSearch&&this.toggleColumn("Folder",!0);ws.WebSuite.goToPreClearTab();ws.WebSuite.clearSearch();
ws.WebSuite.Navigation.searchActive(!1,this.searchInfoPane.domNode);b.publish("WSFeedbackEnd",[Config.Strings.Loading])},updateSearchInfo:function(){this.model.trackdl("-MLV.USa","search_mail");if(ws.WebSuite.getCurrentViewId()=="messageList"){var a=this.model.getSearchString(),b=a,d=this.searchInfoPane.isShowing();if(a&&!this.model.isLoading()){this.model.getSearchIn();Config.UseOMS&&Config.CrossFolderSearch?(b=this.model.getDisplayableSearchHeaderStr(!0),this.searchResultsNode.innerHTML=b,this.showFilterSearchMenu()):
(b=this.model.getDisplayableSearchHeaderStr(),this.searchResultsNode.innerHTML=b,this.hideFilterSearchMenu());this.forwardingInfoPane.isShowing()&&this.forwardingInfoPane.hide();this.searchInfoPane.show();ws.WebSuite.Navigation.searchActive(!0,this.searchInfoPane);ws.WebSuite.Navigation.hiliteCurrentApp();d||this.layoutWidget.layout();if(Config.UseOMS&&Config.CrossFolderSearch&&this.columnDefaults.Folder.hidden)this.columnDefaults.Folder.hidden=!1,this.toggleColumn("Folder",!1);Config.UseOMS&&Config.CrossFolderSearch&&
!this.model.sSubSearch&&this.updateSearchFilterMenu();a=Config.DLReportSearchResult?b:"";this.model.getErrCode()!=null?(this.model.trackdl("-MLV.USb"+a,"search_mail"),ws.reporting.DL.endEvent("search_mail",{opResult:"fail",errType:"api",errCode:this.model.getErrCode(),sessionID:Settings.SessionID})):(this.model.trackdl("-MLV.USc"+a,"search_mail"),ws.reporting.DL.endEvent("search_mail",{opResult:"success",sessionID:Settings.SessionID}))}else{this.model.trackdl("-MLV.USd","search_mail");this.searchInfoPane.hide();
ws.WebSuite.Navigation.searchActive(!1,this.searchInfoPane);ws.WebSuite.Navigation.hiliteCurrentApp();this.updateForwardingInfo();if(Config.UseOMS&&Config.CrossFolderSearch&&!this.columnDefaults.Folder.hidden)this.columnDefaults.Folder.hidden=!0,this.toggleColumn("Folder",!0);d&&this.layoutWidget.layout()}}},limitStr:function(a,b){if(!b||a.length<=b)return a;return a.substring(0,b)+"&hellip;"},showFilterSearchMenu:function(){this.fsButton.show();b.addClass(this.searchInfoPane.domNode,"filterButtonVisible")},
hideFilterSearchMenu:function(){this.fsButton.hide();b.removeClass(this.searchInfoPane.domNode,"filterButtonVisible")},updateSearchFilterMenu:function(){var a=this.model.activeCachedList.data.searchCounts;if(a){this.showFilterSearchMenu();var c=1,d="sfm"+c++,f,e=[{id:d,caption:ws.string.substituteParams("%{0}<span class='fsItemCount'>%{1}</span>",Config.Strings.FSAllResults,this.model.getRowCount()),onClick:b.hitch(this,"filterSearch",d)},{separator:!0}],g;if(Settings.HasAggregatedAccount&&a.accts){e.push({isLabel:!0,
caption:Config.Strings.FSAcctTitle});for(g=0;g<a.accts.length;g++)d="sfm"+c++,f=a.accts[g].n.toLowerCase()==this.model.getIdentities()[0][1]?"Inbox":a.accts[g].n,e.push({id:d,caption:ws.string.substituteParams("%{0}<span class='fsItemCount'>%{1}</span>",this.limitStr(a.accts[g].fn,22),a.accts[g].cnt),onClick:b.hitch(this,"filterSearch",d,"d:"+f)});e.push({separator:!0})}if(a.folders){e.push({isLabel:!0,caption:Config.Strings.FSFolderTitle});for(g=0;g<a.folders.length;g++)d="sfm"+c++,e.push({id:d,
caption:ws.string.substituteParams("%{0}<span class='fsItemCount'>%{1}</span>",this.limitStr(a.folders[g].fn,22),a.folders[g].cnt),onClick:b.hitch(this,"filterSearch",d,"f:"+a.folders[g].n)});e.push({separator:!0})}if(a.senders){e.push({isLabel:!0,caption:Config.Strings.FSSenderTitle});for(g=0;g<a.senders.length;g++)d="sfm"+c++,e.push({id:d,caption:ws.string.substituteParams("%{0}<span class='fsItemCount'>%{1}</span>",this.limitStr(a.senders[g].fn,22),a.senders[g].cnt),onClick:b.hitch(this,"filterSearch",
d,"s:"+a.senders[g].n)})}if(a.sent>0||a.att>0)e.push({separator:!0}),e.push({isLabel:!0,caption:Config.Strings.FSMsgTypeTitle}),a.sent>0&&(d="sfm"+c++,e.push({id:d,caption:ws.string.substituteParams("%{0}<span class='fsItemCount'>%{1}</span>",Config.Strings.FSMsgsSent,a.sent?a.sent:0),onClick:b.hitch(this,"filterSearch",d,"m:")})),a.att>0&&(d="sfm"+c++,e.push({id:d,caption:ws.string.substituteParams("%{0}<span class='fsItemCount'>%{1}</span>",Config.Strings.FSMsgsAtt,a.att?a.att:0),onClick:b.hitch(this,
"filterSearch",d,"a:")}));this.fsButton.setMenuDefinition(e);this.fsButton.createMenu();this.showFilterSearchMenu();b.query("#sfm1",this.fsButton.menu.domNode).addClass("wsMenuItemDefault")}else this.hideFilterSearchMenu()},filterSearch:function(a,c){c?this.model.subSearch(c):this.model.search(this.model.getSearchString(),this.model.getSearchIn());b.query(".wsMenuItem",this.fsButton.menu.domNode).removeClass("wsMenuItemDefault");b.query("#"+a,this.fsButton.menu.domNode).addClass("wsMenuItemDefault")},
addItem:function(a,b,d,f){a[b]?a[b].cnt++:a[b]={cnt:1,fn:d,n:f}},openPremiumSettings:function(){ws.WebSuite.openSettings("premiumSettings")},getForwardingInfo:function(){ws.io.rpc({action:"ForwardAction",content:{forwardAction:"Get"},load:b.hitch(this,function(a){if(a.isSuccess)ws.WebSuite.mailForwardingRPCMade=!0,ws.WebSuite.mailForwardingEmail=a.email,ws.WebSuite.mailForwardingLocalCopy=a.localCopy,this.updateForwardingInfo()}),error:function(){}})},updateForwardingInfo:function(){if(Config.MFMsgListEnabled&&
Config.EnablePremiumSettings&&Settings.MailboxTier.length>0&&!this.searchInfoPane.isShowing())ws.WebSuite.mailForwardingRPCMade?(ws.WebSuite.mailForwardingEmail&&ws.WebSuite.mailForwardingEmail.length>0?(this.forwardingInfoNode.innerHTML=ws.string.substituteParams(Config.Strings.PremiumForwardingOn,ws.WebSuite.mailForwardingEmail),this.forwardingInfoPane.show()):this.forwardingInfoPane.hide(),this.layoutWidget.layout()):this.getForwardingInfo()},onFilterMenu:function(a,b,d){this.model.setFilter(a,
b,d);ws.reporting.report("Filter Messages - "+a,"Mail")},updateFilterButton:function(){var a=this.model.filter,b=this.model.getRowCount(),d={all:Config.Strings.FilterAll,unread:Config.Strings.FilterUnread,read:Config.Strings.FilterRead,flagged:Config.Strings.FilterFlagged,unflagged:Config.Strings.FilterUnflagged,answered:Config.Strings.FilterAnswered,unanswered:Config.Strings.FilterUnanswered,tag:Config.Strings.FilterIdentity},f="";f+=a=="tag"?ws.string.substituteParams(d[a],b,this.model.identity):
ws.string.substituteParams(d[a],b);this.filterButton.setLabel(f);this.domNode.style.display!="none"&&this.toolbar.layout()},updateActionMenu:function(){var a=this.actionButton.menu;if(a){var c=a.getChildren();if(!("initialChildCount"in a))a.initialChildCount=c.length;var d=this.model.getCurrentFolder().type,f=d!="Drafts"&&d!="Deleted"&&this.model.canChangeMessageReadState(),e=this.model.getFoldersCanMoveTo().length>0,g=d!="Drafts"&&(ws.UserContext.MailboxType=="ANGELIA"?Config.ShowMessageStatus&&
Config.UseOMS:Config.ShowMessageStatus),d=d!="Drafts"&&d!="Sent"&&Config.EnableFiltersSettings;c[0].setCaption(Settings.ViewNewOld?Config.Strings.KeepAsNewActionLabel:Config.Strings.MarkUnreadActionLabel);c[0].setShowing(f);c[1].setShowing(f);c[2].setShowing(f);c[3].setShowing(!0);c[4].setShowing(!0);c[5].setShowing(!0);c[6].setShowing(d);c[7].onClick=b.hitch(this,"onClickShowStatus",this.model.currentFolder);c[7].setShowing(g);c[8].setShowing(e&&g);for(var h,f=c.length-1;f>=a.initialChildCount;f--)h=
c[f],a.removeChild(h),h!=this.newFolderSeparator&&h!=this.newFolderMenu&&h!=this.newFolderInputMenu&&h.destroy();if(e){h=new ws.widget.WSMenuItem({caption:Config.Strings.MoveActionLabel,isLabel:!0});h.setShowing(e);a.addChild(h);b.forEach(this.model.folders,b.hitch(this,function(c){if(b.indexOf(this.model.getFoldersCanMoveTo(),c.name)!=-1){var d=this.getDisplayName(c);h=new ws.widget.WSMenuItem({caption:d});h.onClick=b.hitch(this,"moveMessages",c.name,c.displayName);a.addChild(h);h.startup()}}));
if(!this.newFolderSeparator)this.newFolderSeparator=new ws.widget.WSMenuSeparator,this.newFolderSeparator.startup(),this.newFolderMenu=new ws.widget.WSMenuItem({caption:Config.Strings.NewFolder}),this.newFolderMenu._onClick=b.hitch(this,"newFolder"),this.newFolderMenu.startup();a.addChild(this.newFolderSeparator);a.addChild(this.newFolderMenu);if(!a._setAboutToShow)a.aboutToShow=b.hitch(this,function(){if(this.newFolderInputMenu){var a=this.actionButton.menu;if(a)a._setAboutToShow=!0;this.newFolderInputMenu.restore()}})}}},
filterMenuMap:{all:0,unread:2,read:3,flagged:5,unflagged:6},updateFilterMenu:function(){var a=this.filterButton.menu;if(a){var b=a.getChildren();if(!("initialChildCount"in a))a.initialChildCount=b.length;var d=this.filterMenuMap[this.model.filter];d!=null&&a.setChecked([d],!0);d=this.model.getCurrentFolder().type!="Drafts";b[this.filterMenuMap.unread].setShowing(d);b[this.filterMenuMap.read].setShowing(d);b[4].setShowing(d);for(d=b.length-1;d>=a.initialChildCount;d--)a.removeChild(b[d])}},getDisplayName:function(a){var b=
a.displayName,d=Config.ImapStoreFolderDepthStartAt;if(Config.EnableIMAPFolderHierarchy){var b=Config.FolderHierarchyDelimiter,f="",e;for(e=d;e<a.depth;e++)f+="&nbsp;";for(e=d;e<a.depth;e++)f+=b;b=f+a.displayName}return ws.string.escapeXml(b)},checkNullUid:function(a,b,d){if(ws.lang.undefinedOrNull(b)){var b=this.model.getUidForRow(d),d=this.model.getRowData(d),f="";window.ws_ErrLgr&&(f=ws.lang.undefinedOrNull(b)?"index":ws.lang.undefinedOrNull(d)?"row":"rowData",ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,
a+" got null uid ("+f+"): file:MessageListView.js"));return!1}return!0},handleCellClick:function(a){if(ws.WebSuite.isRecordTimingData)ws.WebSuite.messageReadTimerStart=new Date;var c=this.model.getDatum(a.rowIndex,this.model.columns.UID);if(this.checkNullUid("handleCellClick",c,a.rowIndex)){var d=!this.model.getDatum(a.rowIndex,this.model.columns.Flag),f=null;Config.UseOMS&&Config.CrossFolderSearch&&(f=this.model.getDatum(a.rowIndex,this.model.columns.Folder));switch(a.cellIndex){case this.gridModel.columns.Flag:this.model.flagMessages({uids:[c],
load:function(){d?b.publish("WSFeedbackStart",[Config.Strings.MessageFlagged,!0]):b.publish("WSFeedbackStart",[Config.Strings.MessageUnflagged,!0])},flag:d});break;default:var a=a.timeStamp?a.timeStamp:(new Date).getTime(),e=Settings.ReadInPopup?2500:500;if(this.lastClickUid==c&&a-this.lastClickTime<e){this.lastClickUid=c;ws.WebSuite.lastReadPopUp&&ws.WebSuite.lastReadPopUp.focus();break}this.lastClickTime=a;this.lastClickUid=c;b.isIE<=7&&Settings.ReadInPopup?ws.lang.setTimeout(this,"openMessage",
300,c,!1,!1,!1,!1,f,!0):this.openMessage(c,!1,!1,!1,!1,f,!0)}}},handleCellDblClick:function(a){ws.html.clearSelection();var b=this.model.getDatum(a.rowIndex,this.model.columns.UID);if(this.checkNullUid("handleCellDblClick",b,a.rowIndex)&&(Settings.EnablePreviewPane||!Settings.PreviewPaneIntroSeen)&&Settings.PreviewPaneVisible){var d=null;Config.UseOMS&&Config.CrossFolderSearch&&(d=this.model.getDatum(a.rowIndex,this.model.columns.Folder));this.openMessage(b,!1,!0,!1,!1,d)}},openMessage:function(a,
c,d,f,e,g,h){ws.WebSuite.lastReadPopUp=null;var i=!1;if(g)i=g=="Drafts";else if(this.model.getCurrentFolder())i=this.model.getCurrentFolder().type=="Drafts",g=this.model.getCurrentFolder().name;var j=this.model.screenName;if(this.previewPane)this.previewPane.skipPreviewReporting=d;(Settings.EnablePreviewPane||!Settings.PreviewPaneIntroSeen)&&Settings.PreviewPaneVisible&&!d&&!c?this.previewMessage(a,f,e,!1,g,h):(d=this.model.getSelectedUids(),(this.model.allSelected||d.length>1)&&this.model.deselectAll(),
i?this.getComposeCB(b.hitch(this,function(b){b.openDraft(this.model.currentFolder,a)}),c):this.openMessageCB&&this.openMessageCB(g,a,c,j))},checkMessageReadState:function(a,b){this.model.checkMessageReadState(null,{folder:a,uid:b})},previewMessage:function(a,c,d,f,e,g){ws.lang.ensureLayersLoadedExtra(b.hitch(this,function(){try{b.isWebKit||this.grid.views.views[0].focus()}catch(h){}var i=this.model.getSelectedUids();(this.model.allSelected||i.length>1)&&this.model.deselectAll();ws.lang.setTimeout(this,
function(){this.model.setCurrentUid(a)},b.isFF&&g?500:0);this.prevPaneDelayTimeoutId==null?(this.__previewMessage(a,c,d,f,e),this.prevPaneDelayTimeoutId=ws.lang.setTimeout(this,function(){this.prevPaneDelayTimeoutId=null},500)):(clearTimeout(this.prevPaneDelayTimeoutId),this.prevPaneDelayTimeoutId=ws.lang.setTimeout(this,"__previewMessage",500,a,c,d,f,e))}),{layers:["DisplayMessage"]})},__previewMessage:function(a,b,d,f,e){this.prevPaneDelayTimeoutId=null;this.createPreviewPane();this.previewPane.displayMessage(e||
this.model.currentFolder,a,null,!1,!0);Settings.PreviewPaneIntroSeen||this.savePreviewPaneSettings({PreviewPaneIntroSeen:!0,EnablePreviewPane:!0})},setCurrentRow:function(a){var b=this.model.getUidForRow(a),d=null;Config.UseOMS&&Config.CrossFolderSearch&&(d=this.model.getDatum(a,this.model.columns.Folder));b&&this.previewMessage(b,!1,!1,!1,d)},maybePreviewNextMessage:function(a,b,d){this.previewPane&&a&&a.length==1&&(b?(this.model.checkMessageLocal(this.model.currentFolder,b)&&d&&(this.previewPane.previewPaneUidBucket[b]=
!0),this.previewMessage(b)):this.model.currentUid==a[0]&&this.previewMessage(this.previewPane.getNextUid()))},onSelectionChange:function(a){var b=this.model.getSelectedUids().length;b&&this.model.setCurrentUid(null);b=this.getPreviewPaneBody(b,a);if(this.previewPane&&(!this.model.currentUid||a))this.previewPane.showBodyPrompt(b);else if(this.fakePreviewPane)this.fakePreviewPane.domNode.innerHTML="<div>"+b+"</div>";this.updateHeader()},onSplitterClick:function(){var a=this.fakePreviewPane||this.previewPane;
a&&(a.sizeShare==0?this.openPreviewPane():(this.closePreviewPane(),ws.html.clearSelection()))},openPreviewPane:function(){var a=this.fakePreviewPane||this.previewPane;if(a){a.sizeMin=70;if(Settings.PreviewPaneHeight<=0||Settings.PreviewPaneHeight>100)Settings.PreviewPaneHeight=50;a.sizeShare=Settings.PreviewPaneHeight;this.layoutWidget.sizeShare=100-Settings.PreviewPaneHeight;this.splitContainer._forceGrow=!0;this.splitContainer.layout();this.splitContainer._forceGrow=!1;this.savePreviewPaneSettings({PreviewPaneVisible:!0});
ws.WebSuite.previewPaneToLastReadMsg(this);b.query(".dijitSplitContainerSizerV .thumb",this.domNode).removeClass("openThumb")}},updateAwayMessageNotification:function(){this.notification&&this.notification.isInternalNotification&&(this.model.currentFolder=="Inbox"||this.model.currentFolder=="NewMail"?!this.notification.isShowing()&&this.notification.msg.innerHTML!=""&&(this.notification.show(),this.onResized()):this.notification.isShowing()&&(this.notification.hide(),this.onResized()))},closePreviewPane:function(){this._closePreviewPane();
this.savePreviewPaneSettings({PreviewPaneVisible:!1})},_closePreviewPane:function(){this.model.setCurrentUid(null);var a=this.fakePreviewPane||this.previewPane;if(a)a.sizeMin=a.sizeShare=0,this.splitContainer.layout(),b.query(".dijitSplitContainerSizerV .thumb",this.domNode).addClass("openThumb")},setPreviewPaneEnabled:function(a){if(a)this.createFakePreviewPane(),this.onSelectionChange();else{var c=this.fakePreviewPane||this.previewPane;if(c){try{this.splitContainer.removeChild(c),c.destroyRecursive()}catch(d){l.registry.remove(c.id)}this.fakePreviewPane=
this.previewPane=null;if(b.isIE)this.layoutWidget.domNode.style.zoom="1",this.layoutWidget.domNode.style.zoom="",this.layoutWidget.resize()}this.model.setCurrentUid(null)}c=this.customizeButton.menu;c.setUnchecked([(a?1:0)+1]);c.setChecked([(a?0:1)+1]);this.updateToolbarState()},togglePreviewPane:function(){var a=!(Settings.EnablePreviewPane||!Settings.PreviewPaneIntroSeen);Settings.PreviewPaneIntroSeen?this.savePreviewPaneSettings({EnablePreviewPane:a}):this.savePreviewPaneSettings({EnablePreviewPane:a,
PreviewPaneIntroSeen:!0});this.setPreviewPaneEnabled(a);ws.reporting.reportAction((a?"Show":"Hide")+" Reading Pane")},showPreviewPane:function(){var a={EnablePreviewPane:!0};if(!Settings.PreviewPaneIntroSeen)a.PreviewPaneIntroSeen=!0;this.savePreviewPaneSettings(a);this.setPreviewPaneEnabled(!0);ws.reporting.reportAction("Show Reading Pane")},hidePreviewPane:function(){var a={EnablePreviewPane:!1};if(!Settings.PreviewPaneIntroSeen)a.PreviewPaneIntroSeen=!0;this.savePreviewPaneSettings(a);this.setPreviewPaneEnabled(!1);
ws.reporting.reportAction("Hide Reading Pane")},setWebFonts:function(a){if(typeof a!="undefined"){var c=window._g_WS_WebFont.fontMode;if(c!=a){var d=this.customizeButton.menu,f={0:16,2:17};d.setChecked([f[a]]);d.setUnchecked([f[c]]);_wsLoadWebFonts(a,function(a){if(Settings.FontMode!=a)Settings.FontMode=a,ws.settings.saveNow({FontMode:a});window._g_WS_WebFont.fontMode=a;b.addClass(b.body(),window._g_WS_WebFont.webFontsMap[a]);b.removeClass(b.body(),window._g_WS_WebFont.webFontsMap[c]);b.publish("toolbarLayoutUpdate")},
function(){window._g_WS_WebFont.fontMode=c;d.setChecked([f[c]]);d.setUnchecked([f[a]])})}}},setSpacing:function(a){if(typeof a!="undefined"){var c=ws.WebSuite.heightMode;if(ws.WebSuite.isAutoSpacingEnabled&&a!=0||a!=c){var d=this.customizeButton.menu;d.setChecked([a+5]);d.setUnchecked([(ws.WebSuite.isAutoSpacingEnabled&&a!=0?0:c)+5]);ws.WebSuite.isAutoSpacingEnabled=a==0;Settings.ListSpacingType=a;ws.settings.saveSoon({ListSpacingType:a});ws.WebSuite.isAutoSpacingEnabled&&(a=ws.WebSuite.getAutoSpacingType());
ws.WebSuite.heightMode=a;b.removeClass(b.body(),"spacing"+c);b.addClass(b.body(),"spacing"+a);b.publish(["ListSpacingResize"])}}},showButtonLabels:function(){b.addClass(b.body(),"btnLabelsOn2");b.publish("toolbarLayoutUpdate");Settings.ToolbarButtonType=2;ws.settings.saveSoon({ToolbarButtonType:2});var a=this.customizeButton.menu;a.setUnchecked([13]);a.setChecked([12])},hideButtonLabels:function(){b.removeClass(b.body(),"btnLabelsOn2");b.publish("toolbarLayoutUpdate");Settings.ToolbarButtonType=3;
ws.settings.saveSoon({ToolbarButtonType:3});var a=this.customizeButton.menu;a.setUnchecked([12]);a.setChecked([13])},savePreviewPaneSettings:function(a){if(a){if(typeof a.EnablePreviewPane!="undefined"&&!a.EnablePreviewPane)a.PreviewPaneHeight=50,a.PreviewPaneVisible=!0;for(var b in a)Settings[b]=a[b];ws.settings.saveSoon(a)}},getPreviewPaneBody:function(a,c){var d="",f=this.model.isAllInViewSelected(),e=this.model.getOpSize();if(a==0)a=e.opSize;if(a||f)f=a==1?Config.Strings.PreviewPane_OneSelected:
f?Config.Strings.PreviewPane_AllSelected:ws.string.substituteParams(Config.Strings.PreviewPane_NSelected,a),d+="<div class='PreviewPane_emptyTipHeader'>"+f+"</div>",d+='<div class="PreviewPane_tipIcon"><img src="'+Config.SpacerImageURL+'"></div>',d+=ws.string.substituteParams("<div class='PreviewPane_tip'><span class='tipPrefix'>{0}</span> {1}</div>",Config.Strings.PreviewPane_Tip,Config.Strings.PreviewPane_SelectedTipMsg1);else if(this.model.getRowCount()==0&&Settings.PreviewPaneIntroSeen&&!c)d=
"";else if(Settings.PreviewPaneIntroSeen){if(!this._previewPaneEmptyMsgCount){f=1;for(e=this.model.getFolderByType("Deleted").displayName;;){if(!Config.Strings["PreviewPane_EmptyTipMsg"+f])break;f++}Config.Strings.PreviewPane_EmptyTipMsg3=ws.string.substituteParams(Config.Strings.PreviewPane_EmptyTipMsg3,e);Config.Strings.PreviewPane_EmptyTipMsg1=ws.string.substituteParams(Config.Strings.PreviewPane_EmptyTipMsg1,"<span class='wsLink' onclick='ws.WebSuite.openSettings()'>","</span>");this._previewPaneEmptyMsgCount=
f-1;this._lastEmptyMsgRotate=0;this._lastEmptyMsgR=1}if(this._previewPaneEmptyMsgCount){f=(new Date).getTime();if(f-this._lastEmptyMsgRotate<2E3)e=this._lastEmptyMsgR;else{e=Math.floor(Math.random()*this._previewPaneEmptyMsgCount)+1;if(e>this._previewPaneEmptyMsgCount)e=this._previewPaneEmptyMsgCount;this._lastEmptyMsgRotate=f;this._lastEmptyMsgR=e}d+="<div class='PreviewPane_emptyTipHeader'>"+Config.Strings.PreviewPane_EmptyTipHeader+"</div>";d+='<div class="PreviewPane_tipIcon"><img src="'+Config.SpacerImageURL+
'"></div>';d+=ws.string.substituteParams("<div class='PreviewPane_tip'><span class='tipPrefix'>{0}</span> {1}</div>",Config.Strings.PreviewPane_Tip,Config.Strings["PreviewPane_EmptyTipMsg"+e])}}else d="<div class='PreviewPane_introTip'><div class='PreviewPane_introTipHeader'>"+Config.Strings.PreviewPane_IntroHeader+"</div>",d+="<div class='PreviewPane_offPreviewPane'>"+Config.Strings.PreviewPane_NoThanks+" <span class='wsLink' onclick='if(ws.WebSuite&&ws.WebSuite.msgLstTogglePreviewPane)ws.WebSuite.msgLstTogglePreviewPane()'>"+
Config.Strings.PreviewPane_Off+"</span></div>",ws.WebSuite.msgLstTogglePreviewPane=b.hitch(this,"togglePreviewPane");return d},createFakePreviewPane:function(){if(!this.fakePreviewPane&&!this.previewPane){var a=new ws.widget.Pane;a.domNode.className="fakePreviewPane";a.domNode.style.width="0px";a.domNode.style.height="0px";var b=this.getPreviewPaneBody();a.domNode.innerHTML="<div>"+b+"</div>";this.addPreviewPane(a);ws.WebSuite.SidePanel.setupAdScroll(a.domNode,"preview")}},createPreviewPane:function(){if(!this.previewPane){var a=
{id:"previewPane",model:this.model,getComposeCB:this.getComposeCB,backToListCB:b.hitch(this,function(){}),getAddEditWidgetCB:b.hitch(ws.WebSuite,"getAddEditWidget"),showFullMessageCB:b.hitch(this,"openMessageCB"),showFullMessageLink:!0,showNewWindowLink:!1,calendarModel:ws.WebSuite.theCalendarModel,beaconSuffix:"Preview Pane",showToolbar:!1,enableKeyboardShortcuts:!1,isPreviewPane:!0};this.previewPane=new ws.mail.DisplayMessageWidget(a);this.previewPane._presenceResponse=b.hitch(this,"_presenceResponse");
this.previewPane.show();this.pPaneConctors=[];this.pPaneConctors.push(b.connect(this.previewPane,"messageReceived",this,"updateToolbarState"));this.pPaneConctors.push(b.connect(this.model,"preUpdateExistingDraft",this,"preSaveMessage"));this.addPreviewPane(this.previewPane)}},preSaveMessage:function(a,b){if(a&&this.previewPane){var d=this.model.getCurrentFolder().type=="Drafts",f=a==this.previewPane.uid,f=f&&this.previewPane.uid==this.model.currentUid;d&&f&&this.previewPane.bodyPane.domNode.style.display!=
"none"&&b&&this.previewMessage(b,!0,!0)}},_presenceResponse:function(a){a.response.statusCode==200&&(ws.widget.updateIMButton(this.comboIMButton,a.response.data.users,"messageList"),this.toolbar.layout())},addPreviewPane:function(a){if(Settings.PreviewPaneHeight<=0||Settings.PreviewPaneHeight>100)Settings.PreviewPaneHeight=50;this.layoutWidget.sizeShare=100-Settings.PreviewPaneHeight;a.sizeShare=Settings.PreviewPaneHeight;a.collapsable=!0;if(this.fakePreviewPane)l.layout._LayoutWidget.prototype.removeChild.apply(this.splitContainer,
[this.fakePreviewPane]),l.layout._LayoutWidget.prototype.addChild.apply(this.splitContainer,[a]),this.splitContainer._setupChild(a),this.isShowing()&&this.splitContainer.layout(),this.fakePreviewPane=null;else if(this.splitContainer.addChild(a),this.splitContainer.addClickFunc(b.hitch(this,"onSplitterClick")),a!=this.previewPane)this.fakePreviewPane=a;Settings.PreviewPaneVisible||this._closePreviewPane();ws.lang.setTimeout(this,"setPreviewPaneMinSize",0)},setPreviewPaneMinSize:function(){var a=this.previewPane||
this.fakePreviewPane;if(a&&this.domNode.offsetHeight>0){var c=b._getMarginSize(this.toolbar.domNode).h,d=b._getMarginSize(this.notification.domNode).h,f=b._getMarginSize(this.searchInfoPane.domNode).h+b._getMarginSize(this.forwardingInfoPane.domNode).h;this.layoutWidget.sizeMin=c+d+f+66;a.sizeMin=70}},initSplitContainer:function(){b.connect(this.splitContainer,"layout",this,"setPreviewPaneMinSize");b.connect(this.splitContainer,"beginSizing",b.hitch(this,function(){var a=this.fakePreviewPane||this.previewPane;
this.beginSizingFrom0=a.sizeActual==0?!0:!1;ws.html.setShowing(this.closePHandle,a.sizeActual>0)}));b.connect(this.splitContainer,"endSizing",b.hitch(this,function(){var a=this.fakePreviewPane||this.previewPane;ws.html.setShowing(this.closePHandle,a.sizeActual>0);ws.html.setShowing(this.openPHandle,!(a.sizeActual>0));var b=Math.round(100*(a.sizeActual/(this.layoutWidget.sizeActual+a.sizeActual)));if(this.beginSizingFrom0&&a.sizeActual>0){if(b<0||b>100)b=50;this.savePreviewPaneSettings({PreviewPaneHeight:b,
PreviewPaneVisible:!0});ws.WebSuite.previewPaneToLastReadMsg(this)}!this.beginSizingFrom0&&a.sizeActual==0&&(this.savePreviewPaneSettings({PreviewPaneVisible:!1}),this.model.setCurrentUid(null))}))},restartIM:function(){this.previewPane&&this.previewPane.restartIM()},reply:function(){this._respond("reply")},replyAll:function(){this._respond("replyAll")},forward:function(){this._respond("forward")},_respond:function(a,c,d){(c=this.getMessageActionUids(c))&&c.length==1?(a=="forward"&&this.model.forwardMessages({uids:c}),
d&&d.preventDefault(),this.previewPane&&c[0]==this.model.currentUid?this.previewPane.composeResponse(a):this.getComposeCB(b.hitch(this,function(b){b.fetchAndRespond(this.model.currentFolder,c[0],a)}))):this.model.deselectAll()},savePreviewPaneSelection:function(){this.previewPane&&this.previewPane.saveSelection()},viewMessageSource:function(a,b){var d=ws.string.substituteParams("%{0}ViewSource.aspx?user=%{1}&folder=%{2}&uid=%{3}",Config.BaseMailPagesURL,encodeURIComponent(ws.io.getUserUid()),encodeURIComponent(a),
encodeURIComponent(b));ws.io.openWindow(d,"","status=yes,resizable=yes,menubar=yes,scrollbars=yes");ws.reporting.report("Message Source","Mail")},deleteMessages:function(a,c,d){var f=this.model.isAllSelected();a&&a.length&&(f=!1);var e=this.model.getSearchString()!=null;if(!f&&(a=this.getMessageActionUids(a,!1,!0),!a))return;this.model.getCurrentFolder().type=="Deleted"||this.model.getCurrentFolder().type=="Spam"?ws.widget.Dialogs.okCancel(Config.Strings.PermDeleteSelectedConfirmation,b.hitch(this,
function(b){b&&this._deleteMessages(a,null,!1,d,e?!1:f)})):!c&&this.model.isAllSelReal()?ws.widget.Dialogs.okCancel(ws.string.substituteParams(Config.Strings.DeleteAllMessages,this.model.getCurrentFolder().displayName,"<b>","</b>"),b.hitch(this,function(b){b&&this._deleteMessages(a,null,!0,d,e?!1:f)})):this._deleteMessages(a,null,!1,d,e?!1:f)},_deleteMessages:function(a,c,d,f,e){var g="",h=this.model.getOpSize(a),g=!c||typeof c!="string"?h.opSize==1?Config.Strings.MessageDeleted:e&&!h.havexuids?Config.Strings.MessagesDeletedAll:
ws.string.substituteParams(Config.Strings.MessagesDeleted,h.opSize):h.opSize==1?ws.string.substituteParams(Config.Strings.MessageMoved,c):e&&!h.havexuids?ws.string.substituteParams(Config.Strings.MessagesMovedAll,c):ws.string.substituteParams(Config.Strings.MessagesMoved,h.opSize,c);f||(f="unknown");if(!a||!(a.length==1&&this.model.currentUid&&this.model.currentUid!=a[0]))c=this.model.getAdjacentMessageUid(this.model.currentUid,1),this.model.setCurrentUid(c),window.clearTimeout(this._previewTO),this._previewTO=
window.setTimeout(b.hitch(this,"maybePreviewNextMessage",a,c,!0),100);this.model.deleteMessages({uids:a,reason:f,checkUndo:!0,isAllSel:e,load:b.hitch(this,function(a){var c=null;!Config.UseOMS&&(Config.EnableRestoreButton||Settings.ViewNewOld)&&a.responseUIDs?c=a.canUndo?b.hitch(this.model,"undoRestoreMessages",a.responseUIDs):null:a.responseUIDs&&(c=a.canUndo?b.hitch(this.model,"undoMoveMessages",a.responseUIDs,Config.DeletedItemsFolderName):null);d&&(c=null);e&&(this.model.activeCachedList.Clear({preserveSort:!0}),
this.model.setFolder(this.model.getCurrentFolder().name,null,null,null,null,"descending",!0));ws.lang.setTimeout(this,function(){b.publish("WSFeedbackStart",[g,!0,c])},200)}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteMessages-_deleteMessages file:MessageListView.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorDeleting)}})},onClickDelete:function(){this.deleteMessages(null,!1,"delebtn")},restoreMessages:function(a){if(a=
this.getMessageActionUids(a)){this.maybePreviewNextMessage(a);var c=this.model.getOpSize(a);this.model.restoreMessages({uids:a,folder:Config.DeletedItemsFolderName,load:b.hitch(this,function(){this.model.refetchFolderIndex(this.model.currentFolder);var a=c.opSize==1?Config.Strings.MessageRestored:this.model.isAllSelected()&&!c.havexuids?Config.Strings.MessagesRestoredAll:ws.string.substituteParams(Config.Strings.MessagesRestored,c.opSize);b.publish("WSFeedbackStart",[a,!0])}),error:function(a){window.ws_ErrLgr&&
!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.restoreMessages-restoreMessages file:MessageListView.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorRestoring)}})}},onClickRestore:function(){this.restoreMessages()},moveMessages:function(a,c){var d=this.model.getSearchString()!=null?!1:this.model.isAllSelected(),f=this.getMessageActionUids(null);if(f){var e=this.model.getOpSize(f);this.model.getCurrentFolder().type!="Deleted"&&a==Config.DeletedItemsFolderName?
this._deleteMessages(f,c,!1,"movtrsh",d):a==Config.SpamFolderName?this.spamAction(!0,f):(this.maybePreviewNextMessage(f),this.model.moveMessages({uids:f,destFolder:a,checkUndo:!0,isAllSel:d,load:b.hitch(this,function(f){var h=null;f.canUndo&&f.responseUIDs&&!ws.lang.isEmptyObject(f.responseUIDs)&&!d&&(h=b.hitch(this.model,"undoMoveMessages",f.responseUIDs,a));e.opSize==1?b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.MessageMoved,c),!0,h]):d&&!e.havexuids?b.publish("WSFeedbackStart",
[ws.string.substituteParams(Config.Strings.MessagesMovedAll,c),!0,h]):b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.MessagesMoved,e.opSize,c),!0,h]);if(d)this.model.allSelected=!1,this.model.activeCachedList.Clear({preserveSort:!0}),this.model.setFolder(this.model.getCurrentFolder().name,null,null,null,null,"descending",!0)}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.moveMessages-moveMessages file:MessageListView.js");
ws.widget.Dialogs.ok(a||Config.Strings.MoveMessageError)}}))}},moveToNewFolder:function(a){if(a&&a.newName){var c=b.hitch(this,"moveMessages");this.model.createFolder({newName:a.newName,load:b.hitch(this,function(d){b.publish("WSFeedbackStart",[Config.Strings.FolderCreated,!0]);c(ws.UserContext.MailboxType=="ANGELIA"?d.iName:Config.NewFolderPrefix+a.newName,a.newName)}),error:function(b){window.ws_ErrLgr&&!b&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.createFolder-moveToNewFolder file:MessageListView.js");
ws.widget.Dialogs.ok(b?b:ws.string.substituteParams(Config.Strings.ErrorCreatingFolder,a.newName))}})}},newFolder:function(a){a&&a.stopPropagation();var c=this.actionButton.menu;if(c){this.newFolderMenu.hide();if(!this.newFolderInputMenu)this.newFolderInputMenu=new ws.widget.WSInputableMenuItem({okCB:b.hitch(this,"moveToNewFolder"),defaultValue:Config.Strings.NewFolder,originalMenuItem:this.newFolderMenu,maxlength:ws.mail.folderName.MaxLength});ws.lang.setTimeout(this,function(){c.addChild(this.newFolderInputMenu);
this.newFolderInputMenu.show();this.newFolderInputMenu.initializeText(Config.Strings.NewFolder);b.window.scrollIntoView(this.newFolderInputMenu.domNode)},0)}},reportNotSpam:function(){this.spamAction(!1)},reportSpam:function(){this.spamAction(!0)},spamAction:function(a,c){if(c=this.getMessageActionUids(c)){var d=this.model.getAdjacentMessageUid(this.model.currentUid,1);this.model.setCurrentUid(d);window.clearTimeout(this._previewTO);this._previewTO=window.setTimeout(b.hitch(this,"maybePreviewNextMessage",
c,d,!0),100);var f=this.model.getOpSize(c),e=this.model.isAllSelected();this.model.reportSpamMessages({checkUndo:a,uids:c,isSpam:a,load:b.hitch(this,function(c){if(a){var d;d=this.model.isInboxNewOld(this.model.currentFolder)?b.hitch(this.model,"undoReportSpamMessages",c.responseUIDs):b.hitch(this.model,"undoMoveMessages",c.responseUIDs,Config.SpamFolderName);undoCallback=c.canUndo?d:null;c=f.opSize==1?Config.Strings.MessageMarkedSpam:e&&!f.havexuids?Config.Strings.MessagesMarkedSpamAll:ws.string.substituteParams(Config.Strings.MessagesMarkedSpam,
f.opSize);b.publish("WSFeedbackStart",[c,!0,undoCallback])}}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.reportSpamMessages-spamAction file:MessageListView.js");ws.widget.Dialogs.ok(a||Config.Strings.ReportSpamError)}})}},markMessagesRead:function(){this.changeMessagesReadState(!0)},markMessagesUnread:function(){this.changeMessagesReadState(!1)},changeMessagesReadState:function(a,c){if(c=this.getMessageActionUids(c)){var d=
this.model.getCurrentFolder().type;(a&&Config.EnableMoveForMarkSeen&&d=="NewMail"||!a&&Config.EnableMoveForMarkUnseen&&d=="OldMail")&&this.maybePreviewNextMessage(c);var f=this.model.getOpSize(c),e=this.model.isAllSelected();this.model.changeMessagesReadState({uids:c,read:a,load:b.hitch(this,function(){var c="",c=f.opSize==1?a?Config.Strings.MessageMarkedRead:Config.Strings.MessageMarkedNew:e&&!f.havexuids?a?Config.Strings.MessagesMarkedReadAll:Config.Strings.MessagesMarkedNewAll:ws.string.substituteParams(a?
Config.Strings.MessagesMarkedRead:Config.Strings.MessagesMarkedNew,f.opSize);b.publish("WSFeedbackStart",[c,!0])}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.changeMessagesReadState-changeMessagesReadState file:MessageListView.js");ws.widget.Dialogs.ok(a||Config.Strings.MarkReadError)}})}},flagMessages:function(a,c){if(c=this.getMessageActionUids(c)){var d=this.model.getOpSize(c),f=this.model.isAllSelected();this.model.flagMessages({uids:c,
flag:a,load:function(){var c="",c=d.opSize==1?a?Config.Strings.MessageFlagged:Config.Strings.MessageUnflagged:f&&!d.havexuids?a?Config.Strings.MessagesFlaggedAll:Config.Strings.MessagesUnflaggedAll:ws.string.substituteParams(a?Config.Strings.MessagesFlagged:Config.Strings.MessagesUnflagged,d.opSize);b.publish("WSFeedbackStart",[c,!0])},error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.flagMessages-flagMessages file:MessageListView.js");
ws.widget.Dialogs.ok(a||Config.Strings.ErrorSettingFlag)}})}},onClickShowStatus:function(){var a=this.getMessageActionUids(null);a&&(this.model.isAllSelected()||a.length>10?ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.TooManyItemsSelect,10)):this.showStatus(this.model.currentFolder,a))},showStatus:function(a,c){ws.lang.ensureLayersLoaded(b.hitch(this,function(){if(!this.statusDialog)this.statusDialog=new ws.mail.MessageStatusDialog({model:this.model}),b.body().appendChild(this.statusDialog.domNode),
this.statusDialog.startup();this.statusDialog.show(a,c);ws.reporting.reportAction("Message Status")}))},onClickFlag:function(){this.flagMessages(!0)},onClickUnflag:function(){this.flagMessages(!1)},createFilter:function(a){ws.lang.ensureLayersLoaded(b.hitch(this,function(){var c={};if((a=this.getMessageActionUids(a,!0))&&a.length==1){var d=this.model.getUidData(a[0]);c.from=d&&d[this.model.columns.FromToAddress]||""}else if(d=this.model.getSearchString(),this.currentSearchIn=="subject")c.subject=
d||"";else if(this.currentSearchIn=="fromto")c.from=d||"";c.moveToFolder=this.model.currentFolder;c=new ws.mail.MailFilterModalPane(c);b.body().appendChild(c.domNode);c.startup()}))},getRowClasses:function(a){var b=this.inherited(arguments),d=this.model.getRowData(a);if(d){var f=Settings.ViewNewOld&&this.model.getCurrentFolder().type=="NewMail"?this.model.columns.Read:this.model.columns.Seen;d[f]&&b.push("row-read");d[this.model.columns.Official]&&b.push("row-official")}return b},handleHoverControlClick:function(a){var c=
this.model.getDatum(a.rowIndex,this.model.columns.UID);b.hasClass(a.target,"trashHover")?this.deleteMessages([c],!0,"clktrsh"):this.inherited(arguments)},handleQuickAction:function(a,b){var d=this.model.getDatum(this.quickActionRow,this.model.columns.UID),f;switch(a){case "changeMessagesReadState":this.changeMessagesReadState(!this.model.getDatum(this.quickActionRow,this.model.columns.Seen),[d]);break;case "searchSubject":d=this.model.getDatum(this.quickActionRow,this.model.columns.Subject);d=ws.WebSuite.Navigation.removeSpecialCharacters(this.model.getBaseSubject(d));
ws.WebSuite.setFolderHistory();this.model.search(d,"subject");break;case "searchFrom":ws.WebSuite.setFolderHistory();f=ws.WebSuite.Navigation.removeSpecialCharacters(this.model.getDatum(this.quickActionRow,this.model.columns.FromToAddress));this.model.search(f,"fromto");break;case "searchTo":f=this.model.getDatum(this.quickActionRow,this.model.columns.FromToAddress);Config.UseOMS&&Config.CrossFolderSearch?this.model.search(f,"fromto"):this.model.search(f,"to");break;case "reply":case "replyAll":case "forward":this._respond(a,
[d]);break;case "spam":this.spamAction(!0,[d]);break;case "notSpam":this.spamAction(!1,[d]);break;case "restore":this.restoreMessages([d]);break;case "openInNewWindow":this.openMessage(d,!0);break;case "viewMessageSource":this.viewMessageSource(this.model.currentFolder,d);break;case "flagMessage":this.flagMessages(!this.model.getDatum(this.quickActionRow,this.model.columns.Flag),[d]);break;case "delete":this.deleteMessages([d],!1,"clckdel");break;case "addToCalendar":this.addToCalendar(this.model.currentFolder,
d);break;case "addSenderToContact":f=this.model.getDatum(this.quickActionRow,this.model.columns.FromToAddress);(d=this.isContactExist(f))?this.editContact(d):this.addContact(f);break;case "addRecipientToContact":f=this.model.getDatum(this.quickActionRow,this.model.columns.FromToAddress);(d=this.isContactExist(f))?this.editContact(d):this.addContact(f);break;case "showStatus":this.showStatus(this.model.currentFolder,[d]);break;case "createFilter":this.createFilter([d])}ws.reporting.reportAction((b?
"Right Click Drop Down":"Action Drop Down")+" - "+a)},isContactExist:function(a){if(!a)return null;a=a.toLowerCase();return ws.WebSuite.theAddressModel.getRecordByEmail(a)},addContact:function(){},editContact:function(){},addToCalendar:function(){},onMouseOverRow:function(a){if(!this._unselect0row&&(this._unselect0row=!0,a.rowIndex!=0))this._overRow=-1,this.grid.updateRow(0);this.inherited(arguments)},setupZeroRowsMessage:function(a,b){this.inherited(arguments);if(b)this.model.trackdl("-MLV.ZRa",
this.reportFolderName),ws.reporting.DL.endEvent(this.gridModel.reportFolderName,{opResult:"fail",errType:"api",errCode:this.model.getErrCode(),sessionID:Settings.SessionID}),this.gridModel.reportFolderName=null;else if(!a)this.model.trackdl("-MLV.ZRb",this.reportFolderName),ws.reporting.DL.endEvent(this.gridModel.reportFolderName,{opResult:"success"}),this.gridModel.reportFolderName=null},getZeroRowsMessage:function(){var a;a=Config.UseOMS&&Config.CrossFolderSearch?"<div class='search'>"+Config.Strings.SearchMessageNoMatchNoFolder+
"</div>":"<div class='search'>"+Config.Strings.SearchMessageNoMatch+"</div>";a+="<div class='zero'><div class='zeroRowHeader'>"+Config.Strings.FolderEmptyList+"</div><div class='mainLargeIcon sunIcon'></div>";Config.EnableTodayCurtain&&(a+="<div class='zeroTodayPromo'>"+ws.string.substituteParams(Config.Strings.GetLatestFromTodayOnAOL,"<a href='#' class='wsLink' onclick=ws.WebSuite.showTodayPage()>",Config.Strings.TodayOnAOL,"</a>")+"</div>");a+="</div>";return a},beforeShowZeroRowsMessage:function(){var a=
b.query(".search",this.zeroRowsNode)[0],c=b.query(".zero",this.zeroRowsNode)[0];this.model.getSearchString()||this.model.filter!="all"?(ws.html.setShowing(c,!1),ws.html.setShowing(a,!0)):(ws.html.setShowing(c,!0),ws.html.setShowing(a,!1))},getLoadingMessage:function(){var a=this.model.searchInProgress?Config.Strings.Searching:Config.Strings.Loading;this.model.searchInProgress=!1;return a},getErrorMessage:function(){return ws.string.substituteParams(Config.Strings.ErrorRetrievingMessages,"<a href='#' onclick='"+
('dijit.byId("'+this.id+'").retryFetch()')+"' class='wsLink'>","</a>")},retryFetch:function(){this.model.setFolder(this.model.currentFolder)},getDragObjectLabel:function(a){var b=this.model.getOpSize(this.getMessageActionUids(null,!0)),b=this.model.isSelected(this.model.getDatum(a,this.model.columns.UID))?b.opSize:1;return b==1?this.model.getDatum(a,this.model.columns.Subject):ws.string.substituteParams(Config.Strings.NMessages,b)},getMessageActionUids:function(a,b){if(a&&a.length)return a;else if(this.model.currentUid)return[this.model.currentUid];
else if(this.model.allSelected&&this.model.SearchString==null)return[];else{var d=this.model.getSelectedUids();return d.length?d:(b||ws.widget.Dialogs.ok(Config.Strings.NoMessagesCheckedErrorMsg),null)}},sprites:{type:{NONE:"",SEEN:"ws_image_fSeen",OFFICIAL:"ws_image_fOfficial",CERTIFIED:"ws_image_fCertified",VOICEMAIL:"ws_image_fVoicemail",ANSWERED:"ws_image_fAnswered"},attach:{NONE:"",ATTACHMENT:"ws_image_fAttachment"},flag:{NONE:"ws_image_fUnflagged",FLAGGED:"ws_image_fFlagged"},account:{aol:"iconSaol",
att:"iconSatt",hotmail:"iconShotmail",yahoo:"iconSyahoo",gmail:"iconSgmail",generic:"iconSgeneric"}},defineMenus:function(){this.quickActionMenuDefinition={Inbox:[{caption:"",onClick:b.hitch(this,"handleQuickAction","changeMessagesReadState")},{caption:Config.Strings.SearchForSubject,onClick:b.hitch(this,"handleQuickAction","searchSubject")},{caption:Config.Strings.SearchForFromTo,onClick:b.hitch(this,"handleQuickAction","searchFrom")},{caption:Config.Strings.DisplayReply,onClick:b.hitch(this,"handleQuickAction",
"reply"),shortCutKey:Config.Strings.KeyMailReply},{caption:Config.Strings.DisplayReplyAll,onClick:b.hitch(this,"handleQuickAction","replyAll"),shortCutKey:Config.Strings.KeyMailReplyAll},{caption:Config.Strings.DisplayForward,onClick:b.hitch(this,"handleQuickAction","forward"),shortCutKey:Config.Strings.KeyMailForward},{caption:Config.Strings.ReportSpam,onClick:b.hitch(this,"handleQuickAction","spam")},{caption:Config.Strings.ShowMessageStatus,onClick:b.hitch(this,"handleQuickAction","showStatus")},
{caption:Config.Strings.MailFilter_CreateFilter,onClick:b.hitch(this,"handleQuickAction","createFilter")},{caption:Config.Strings.ViewMessageSource,onClick:b.hitch(this,"handleQuickAction","viewMessageSource")}],Drafts:[{caption:Config.Strings.SearchForSubject,onClick:b.hitch(this,"handleQuickAction","searchSubject")},{caption:Config.Strings.SearchForTo,onClick:b.hitch(this,"handleQuickAction","searchTo")}],Sent:[{caption:Config.Strings.SearchForSubject,onClick:b.hitch(this,"handleQuickAction","searchSubject")},
{caption:Config.UseOMS&&Config.CrossFolderSearch?Config.Strings.SearchForFromTo:Config.Strings.SearchForTo,onClick:b.hitch(this,"handleQuickAction","searchTo")},{caption:Config.Strings.DisplayReply,onClick:b.hitch(this,"handleQuickAction","reply"),shortCutKey:Config.Strings.KeyMailReply},{caption:Config.Strings.DisplayReplyAll,onClick:b.hitch(this,"handleQuickAction","replyAll"),shortCutKey:Config.Strings.KeyMailReplyAll},{caption:Config.Strings.DisplayForward,onClick:b.hitch(this,"handleQuickAction",
"forward"),shortCutKey:Config.Strings.KeyMailForward},{caption:Config.Strings.ShowMessageStatus,onClick:b.hitch(this,"handleQuickAction","showStatus")}],Spam:[{caption:Config.Strings.NotSpamButton,onClick:b.hitch(this,"handleQuickAction","notSpam")},{caption:Config.Strings.SearchForSubject,onClick:b.hitch(this,"handleQuickAction","searchSubject")},{caption:Config.Strings.SearchForFromTo,onClick:b.hitch(this,"handleQuickAction","searchFrom")},{caption:Config.Strings.DisplayReply,onClick:b.hitch(this,
"handleQuickAction","reply"),shortCutKey:Config.Strings.KeyMailReply},{caption:Config.Strings.DisplayReplyAll,onClick:b.hitch(this,"handleQuickAction","replyAll"),shortCutKey:Config.Strings.KeyMailReplyAll},{caption:Config.Strings.DisplayForward,onClick:b.hitch(this,"handleQuickAction","forward"),shortCutKey:Config.Strings.KeyMailForward},{caption:Config.Strings.MailFilter_CreateFilter,onClick:b.hitch(this,"handleQuickAction","createFilter")},{caption:Config.Strings.ViewMessageSource,onClick:b.hitch(this,
"handleQuickAction","viewMessageSource")}],Deleted:[{caption:Config.Strings.RestoreButton,onClick:b.hitch(this,"handleQuickAction","restore")},{caption:Config.Strings.SearchForSubject,onClick:b.hitch(this,"handleQuickAction","searchSubject")},{caption:Config.Strings.SearchForFromTo,onClick:b.hitch(this,"handleQuickAction","searchFrom")},{caption:Config.Strings.DisplayReply,onClick:b.hitch(this,"handleQuickAction","reply"),shortCutKey:Config.Strings.KeyMailReply},{caption:Config.Strings.DisplayReplyAll,
onClick:b.hitch(this,"handleQuickAction","replyAll"),shortCutKey:Config.Strings.KeyMailReplyAll},{caption:Config.Strings.DisplayForward,onClick:b.hitch(this,"handleQuickAction","forward"),shortCutKey:Config.Strings.KeyMailForward},{caption:Config.Strings.MailFilter_CreateFilter,onClick:b.hitch(this,"handleQuickAction","createFilter")},{caption:Config.Strings.ViewMessageSource,onClick:b.hitch(this,"handleQuickAction","viewMessageSource")}]};this.filterButton.menuDefinition=[{caption:Config.Strings.FilterAllMenuItem,
onClick:b.hitch(this,"onFilterMenu","all")},{separator:!0},{caption:Config.Strings.FilterUnreadMenuItem,onClick:b.hitch(this,"onFilterMenu","unread")},{caption:Config.Strings.FilterReadMenuItem,onClick:b.hitch(this,"onFilterMenu","read")},{separator:!0},{caption:Config.Strings.FilterFlaggedMenuItem,onClick:b.hitch(this,"onFilterMenu","flagged")},{caption:Config.Strings.FilterUnflaggedMenuItem,onClick:b.hitch(this,"onFilterMenu","unflagged")}];this.customizeButton.menuDefinition=[{caption:Config.Strings.PreviewPane_Label,
isLabel:!0},{caption:"<span class='mainSprite menuItemIcon iconReadPaneOn'></span> <span class='menuIconLabel'>"+Config.Strings.PreviewPane_Show+"</span>",onClick:b.hitch(this,"showPreviewPane")},{caption:"<span class='mainSprite menuItemIcon iconReadPaneOff'></span> <span class='menuIconLabel'>"+Config.Strings.PreviewPane_Hide+"</span>",onClick:b.hitch(this,"hidePreviewPane")},{separator:!0},{caption:Config.Strings.MsgSpacing,isLabel:!0},{caption:"<span class='mainSprite menuItemIcon iconSpace0'></span> <span class='menuIconLabel'>"+
Config.Strings.MsgSpacingMode0+"</span>",onClick:b.hitch(this,"setSpacing",0),checked:Settings.ListSpacingType==0},{caption:"<span class='mainSprite menuItemIcon iconSpace1'></span> <span class='menuIconLabel'>"+Config.Strings.MsgSpacingMode1+"</span>",onClick:b.hitch(this,"setSpacing",1),checked:Settings.ListSpacingType==1},{caption:"<span class='mainSprite menuItemIcon iconSpace2'></span> <span class='menuIconLabel'>"+Config.Strings.MsgSpacingMode2+"</span>",onClick:b.hitch(this,"setSpacing",2),
checked:Settings.ListSpacingType==2},{caption:"<span class='mainSprite menuItemIcon iconSpace3'></span> <span class='menuIconLabel'>"+Config.Strings.MsgSpacingMode3+"</span>",onClick:b.hitch(this,"setSpacing",3),checked:Settings.ListSpacingType==3},{caption:"<span class='mainSprite menuItemIcon iconSpace4'></span> <span class='menuIconLabel'>"+Config.Strings.MsgSpacingMode4+"</span>",onClick:b.hitch(this,"setSpacing",4),checked:Settings.ListSpacingType==4},{separator:!0},{caption:Config.Strings.Labels,
isLabel:!0},{caption:"<div class='sampleTbBtn'><div class='mainSprite icon sendIcon'></div><div class='sampleTbBtnLabel'>"+Config.Strings.Button_Label_Send+"</div></div><div class='sampleTbBtn'><div class='mainSprite icon composeIcon'></div><div class='sampleTbBtnLabel'>"+Config.Strings.New+"</div></div> <span class='menuIconLabel'>"+Config.Strings.ShowLabels+"</span>",onClick:b.hitch(this,"showButtonLabels"),className:"menuItemShowLabel",checked:b.hasClass(b.body(),"btnLabelsOn2")},{caption:"<div class='sampleTbBtn sampleTbBtnNoLabel'><div class='mainSprite icon sendIcon'></div><div class='sampleTbBtnLabel'>"+
Config.Strings.Button_Label_Send+"</div></div><div class='sampleTbBtn sampleTbBtnNoLabel'><div class='mainSprite icon composeIcon'></div><div class='sampleTbBtnLabel'>"+Config.Strings.New+"</div></div> <span class='menuIconLabel'>"+Config.Strings.HideLabels+"</span>",className:"menuItemHideLabel",onClick:b.hitch(this,"hideButtonLabels"),checked:!b.hasClass(b.body(),"btnLabelsOn2")},{separator:!0},{caption:Config.Strings.Fonts,isLabel:!0},{caption:b.isMac?"<div class='mainSprite helveticaMenuItem'></div>":
"<div class='mainSprite arialMenuItem'></div>",onClick:b.hitch(this,"setWebFonts",0),checked:window._g_WS_WebFont.fontMode==0},{caption:"<div class='mainSprite museoSansMenuItem'></div>",onClick:b.hitch(this,"setWebFonts",2),checked:window._g_WS_WebFont.fontMode==2}];this.actionButton.menuDefinition=[{caption:Settings.ViewNewOld?Config.Strings.KeepAsNewActionLabel:Config.Strings.MarkUnreadActionLabel,onClick:b.hitch(this,"changeMessagesReadState",!1)},{caption:Config.Strings.MarkReadActionLabel,onClick:b.hitch(this,
"changeMessagesReadState",!0)},{separator:!0},{caption:Config.Strings.FlagQuickActionLabel,onClick:b.hitch(this,"onClickFlag")},{caption:Config.Strings.ClearFlag,onClick:b.hitch(this,"onClickUnflag")},{separator:!0},{caption:Config.Strings.MailFilter_CreateFilter,onClick:b.hitch(this,"createFilter")},{caption:Config.Strings.ShowMessageStatus,onClick:b.hitch(this,"onClickShowStatus")},{separator:!0}];this.rightClickMenuDefinition={Inbox:[{caption:Config.Strings.OpenInNewWindow,onClick:b.hitch(this,
"handleQuickAction","openInNewWindow",!0),shortCutKey:Config.Strings.KeyMailPopout},{separator:!0},{caption:Config.Strings.DisplayReply,onClick:b.hitch(this,"handleQuickAction","reply",!0),shortCutKey:Config.Strings.KeyMailReply},{caption:Config.Strings.DisplayReplyAll,onClick:b.hitch(this,"handleQuickAction","replyAll",!0),shortCutKey:Config.Strings.KeyMailReplyAll},{caption:Config.Strings.DisplayForward,onClick:b.hitch(this,"handleQuickAction","forward",!0),shortCutKey:Config.Strings.KeyMailForward},
{separator:!0},{caption:"",onClick:b.hitch(this,"handleQuickAction","changeMessagesReadState",!0)},{caption:"",onClick:b.hitch(this,"handleQuickAction","flagMessage",!0)},{caption:Config.Strings.Delete,onClick:b.hitch(this,"handleQuickAction","delete",!0)},{caption:Config.Strings.ReportSpam,onClick:b.hitch(this,"handleQuickAction","spam",!0)},{caption:Config.Strings.ShowMessageStatus,onClick:b.hitch(this,"handleQuickAction","showStatus",!0)},{caption:Config.Strings.MailFilter_CreateFilter1,onClick:b.hitch(this,
"handleQuickAction","createFilter",!0)},{separator:!0},{caption:Config.Strings.SearchForFromTo,onClick:b.hitch(this,"handleQuickAction","searchFrom",!0)},{caption:Config.Strings.SearchForSubject,onClick:b.hitch(this,"handleQuickAction","searchSubject",!0)},{separator:!0},{caption:"",onClick:b.hitch(this,"handleQuickAction","addSenderToContact",!0)},{caption:Config.Strings.AddMessageToCalendar,onClick:b.hitch(this,"handleQuickAction","addToCalendar",!0)},{separator:!0},{caption:Config.Strings.ViewMessageSource,
onClick:b.hitch(this,"handleQuickAction","viewMessageSource",!0)}],Drafts:[{caption:Config.Strings.OpenInNewWindow,onClick:b.hitch(this,"handleQuickAction","openInNewWindow",!0),shortCutKey:Config.Strings.KeyMailPopout},{separator:!0},{caption:"",onClick:b.hitch(this,"handleQuickAction","flagMessage",!0)},{caption:Config.Strings.Delete,onClick:b.hitch(this,"handleQuickAction","delete",!0)}],Sent:[{caption:Config.Strings.OpenInNewWindow,onClick:b.hitch(this,"handleQuickAction","openInNewWindow",!0),
shortCutKey:Config.Strings.KeyMailPopout},{separator:!0},{caption:Config.Strings.DisplayReply,onClick:b.hitch(this,"handleQuickAction","reply",!0),shortCutKey:Config.Strings.KeyMailReply},{caption:Config.Strings.DisplayReplyAll,onClick:b.hitch(this,"handleQuickAction","replyAll",!0),shortCutKey:Config.Strings.KeyMailReplyAll},{caption:Config.Strings.DisplayForward,onClick:b.hitch(this,"handleQuickAction","forward",!0),shortCutKey:Config.Strings.KeyMailForward},{separator:!0},{caption:"",onClick:b.hitch(this,
"handleQuickAction","changeMessagesReadState",!0)},{caption:"",onClick:b.hitch(this,"handleQuickAction","flagMessage",!0)},{caption:Config.Strings.Delete,onClick:b.hitch(this,"handleQuickAction","delete",!0)},{caption:Config.Strings.ShowMessageStatus,onClick:b.hitch(this,"handleQuickAction","showStatus",!0)},{separator:!0},{caption:Config.UseOMS&&Config.CrossFolderSearch?Config.Strings.SearchForFromTo:Config.Strings.SearchForTo,onClick:b.hitch(this,"handleQuickAction","searchTo")},{caption:Config.Strings.SearchForSubject,
onClick:b.hitch(this,"handleQuickAction","searchSubject",!0)},{separator:!0},{caption:"",onClick:b.hitch(this,"handleQuickAction","addRecipientToContact",!0)}],Spam:[{caption:Config.Strings.OpenInNewWindow,onClick:b.hitch(this,"handleQuickAction","openInNewWindow",!0),shortCutKey:Config.Strings.KeyMailPopout},{separator:!0},{caption:Config.Strings.DisplayReply,onClick:b.hitch(this,"handleQuickAction","reply",!0),shortCutKey:Config.Strings.KeyMailReply},{caption:Config.Strings.DisplayReplyAll,onClick:b.hitch(this,
"handleQuickAction","replyAll",!0),shortCutKey:Config.Strings.KeyMailReplyAll},{caption:Config.Strings.DisplayForward,onClick:b.hitch(this,"handleQuickAction","forward",!0),shortCutKey:Config.Strings.KeyMailForward},{separator:!0},{caption:"",onClick:b.hitch(this,"handleQuickAction","changeMessagesReadState",!0)},{caption:"",onClick:b.hitch(this,"handleQuickAction","flagMessage",!0)},{caption:Config.Strings.Delete,onClick:b.hitch(this,"handleQuickAction","delete",!0)},{caption:Config.Strings.NotSpamButton,
onClick:b.hitch(this,"handleQuickAction","notSpam",!0)},{separator:!0},{caption:Config.Strings.SearchForFromTo,onClick:b.hitch(this,"handleQuickAction","searchFrom",!0)},{caption:Config.Strings.SearchForSubject,onClick:b.hitch(this,"handleQuickAction","searchSubject",!0)},{separator:!0},{caption:Config.Strings.ViewMessageSource,onClick:b.hitch(this,"handleQuickAction","viewMessageSource",!0)}],Deleted:[{caption:Config.Strings.OpenInNewWindow,onClick:b.hitch(this,"handleQuickAction","openInNewWindow",
!0),shortCutKey:Config.Strings.KeyMailPopout},{separator:!0},{caption:Config.Strings.DisplayReply,onClick:b.hitch(this,"handleQuickAction","reply",!0),shortCutKey:Config.Strings.KeyMailReply},{caption:Config.Strings.DisplayReplyAll,onClick:b.hitch(this,"handleQuickAction","replyAll",!0),shortCutKey:Config.Strings.KeyMailReplyAll},{caption:Config.Strings.DisplayForward,onClick:b.hitch(this,"handleQuickAction","forward",!0),shortCutKey:Config.Strings.KeyMailForward},{separator:!0},{caption:Config.Strings.RestoreButton,
onClick:b.hitch(this,"handleQuickAction","restore",!0)},{caption:"",onClick:b.hitch(this,"handleQuickAction","changeMessagesReadState",!0)},{caption:"",onClick:b.hitch(this,"handleQuickAction","flagMessage",!0)},{caption:Config.Strings.Delete,onClick:b.hitch(this,"handleQuickAction","delete",!0)},{caption:Config.Strings.ReportSpam,onClick:b.hitch(this,"handleQuickAction","spam",!0)},{separator:!0},{caption:Config.Strings.SearchForFromTo,onClick:b.hitch(this,"handleQuickAction","searchFrom",!0)},{caption:Config.Strings.SearchForSubject,
onClick:b.hitch(this,"handleQuickAction","searchSubject",!0)},{separator:!0},{caption:"",onClick:b.hitch(this,"handleQuickAction","addSenderToContact",!0)},{caption:Config.Strings.AddMessageToCalendar,onClick:b.hitch(this,"handleQuickAction","addToCalendar",!0)},{separator:!0},{caption:Config.Strings.ViewMessageSource,onClick:b.hitch(this,"handleQuickAction","viewMessageSource",!0)}]};b.connect(this.actionButton,"updateMenu",this,"updateActionMenu");b.connect(this.filterButton,"updateMenu",this,"updateFilterMenu")},
createQuickActionMenu:function(a){var c=this.quickActionMenuDefinition[a];if(!c)c=this.quickActionMenuDefinition.Inbox;this.quickActionMenu[a]=ws.widget.createMenu(c);b.connect(this.quickActionMenu[a],"onClose",b.hitch(this,function(){this.grid.updateRow(this.quickActionRow);this.updateToolbarState()}));return this.quickActionMenu[a]},getQuickActionMenu:function(a){if(!this.quickActionMenu)this.quickActionMenu={};var b=this.model.getFolderByName(this.model.currentFolder),b=b?b.type:"Inbox";this.quickActionMenuDefinition[b]||
(b=this.model.currentFolder=="SavedIMs"?"Sent":"Inbox");var d=this.quickActionMenu[b];!d&&!a&&(d=this.createQuickActionMenu(b));return d},updateQuickActionMenu:function(a){var c=a.getChildren(),d=Config.FolderButtons[Config.DeletedItemsFolderName.toLowerCase()],d=b.map(d.split(","),function(a){return b.trim(a)=="true"});if(a==this.quickActionMenu.Inbox){var f=Settings.ViewNewOld?Config.Strings.KeepAsNewActionLabel:Config.Strings.MarkUnreadActionLabel,e=Config.Strings.MarkReadActionLabel,g=this.model.getDatum(this.quickActionRow,
this.model.columns.Seen);c[0].setCaption(g?f:e);c[0].setShowing(this.model.canChangeMessageReadState());c[6].setShowing(Config.EnableSpamButton);c[7].setShowing(ws.UserContext.MailboxType=="ANGELIA"?Config.ShowMessageStatus&&Config.UseOMS:Config.ShowMessageStatus);c[8].setShowing(Config.EnableFiltersSettings)}a==this.quickActionMenu.Sent&&c[5].setShowing(ws.UserContext.MailboxType=="ANGELIA"?Config.ShowMessageStatus&&Config.UseOMS:Config.ShowMessageStatus);a==this.quickActionMenu.Spam&&(c[0].setShowing(Config.EnableSpamButton),
c[6].setShowing(Config.EnableFiltersSettings));a==this.quickActionMenu.Deleted&&(c[0].setShowing(d[8]||Settings.ViewNewOld),c[6].setShowing(Config.EnableFiltersSettings));this.model.getSearchString()&&Config.UseOMS&&Config.CrossFolderSearch?c[2].setCaption(Config.Strings.SearchForFromTo):a==this.quickActionMenu.Sent||a==this.quickActionMenu.Drafts?c[1].setCaption(Config.Strings.SearchForTo):a==this.quickActionMenu.Deleted?c[2].Caption==Config.Strings.SearchForSender||c[2].Caption==Config.Strings.SearchForTo?
c[2].setCaption(Config.Strings.SearchForSender):(c[1].Caption==Config.Strings.SearchForSender||c[1].Caption==Config.Strings.SearchForTo)&&c[1].setCaption(Config.Strings.SearchForSender):c[2].setCaption(Config.Strings.SearchForSender)},createRightClickMenu:function(a){var c=this.rightClickMenuDefinition[a];if(!c)c=this.rightClickMenuDefinition.Inbox;this.rightClickMenu[a]=ws.widget.createMenu(c);b.connect(this.rightClickMenu[a],"close",b.hitch(this,function(){var a=this.quickActionRow;this.gridModel.columns.Hover!=
-1&&this.grid.update(a,this.gridModel.columns.Hover)}));return this.rightClickMenu[a]},getRightClickMenu:function(a){if(!this.rightClickMenu)this.rightClickMenu={};var c=this.model.getFolderByName(this.model.currentFolder).type;this.rightClickMenuDefinition[c]||(c=c=="SavedIMs"?"Sent":"Inbox");var d=this.rightClickMenu[c];!d&&!a&&(d=this.createRightClickMenu(c),b.connect(d,"onClose",this,"OnCloseContextMenu"));return d},updateRightClickMenu:function(a){var b=null,d=null,f=null,e=a.getChildren();e[0].setShowing(ws.settings.allowPopups());
e[1].setShowing(ws.settings.allowPopups());if(a==this.rightClickMenu.Inbox||a==this.rightClickMenu.Spam||a==this.rightClickMenu.Sent)b=e[6],d=e[7];a==this.rightClickMenu.Inbox&&(f=e[16],e[9].setShowing(Config.EnableSpamButton),e[10].setShowing(ws.UserContext.MailboxType=="ANGELIA"?Config.ShowMessageStatus&&Config.UseOMS:Config.ShowMessageStatus),e[11].setShowing(Config.EnableFiltersSettings));a==this.rightClickMenu.Sent&&(f=e[14],e[9].setShowing(ws.UserContext.MailboxType=="ANGELIA"?Config.ShowMessageStatus&&
Config.UseOMS:Config.ShowMessageStatus));a==this.rightClickMenu.Deleted&&(b=e[7],d=e[8],f=e[15],e[6].setShowing(Config.EnableRestoreButton||Settings.ViewNewOld),e[10].setShowing(Config.EnableSpamButton));a==this.rightClickMenu.Drafts&&(d=e[2]);a==this.rightClickMenu.Spam&&e[9].setShowing(Config.EnableSpamButton);if(b){var a=Settings.ViewNewOld?Config.Strings.KeepAsNewActionLabel:Config.Strings.MarkUnreadActionLabel,g=Config.Strings.MarkReadActionLabel,h=this.model.getDatum(this.quickActionRow,this.model.columns.Seen);
b.setCaption(h?a:g);b.setShowing(this.model.canChangeMessageReadState())}d&&(b=this.model.getDatum(this.quickActionRow,this.model.columns.Flag),d.setCaption(b?Config.Strings.ClearFlag:Config.Strings.FlagForFollowUp));f&&(d=this.model.getDatum(this.quickActionRow,this.model.columns.FromToAddress),f.setCaption(this.isContactExist(d)?Config.Strings.EditContact:Config.Strings.AddToContact));this.model.getSearchString()&&Config.UseOMS&&Config.CrossFolderSearch&&e[13].setCaption(Config.Strings.SearchForFromTo)},
onEnterKeyPress:function(a){var b=this.model.getDatum(a,this.model.columns.UID);if(this.checkNullUid("onEnterKeyPress",b,a)){var d=null;Config.UseOMS&&Config.CrossFolderSearch&&(d=this.model.getDatum(a,this.model.columns.Folder));this.openMessage(b,!1,!0,!1,!1,d)}},onDelKeyPress:function(a){var c;this.model.isAllSelected()?a=null:b.isArray(a)?c=!1:(a=[this.model.getDatum(a,this.model.columns.UID)],c=!0);this.deleteMessages(a,c,"delekey")},onKeyPress:function(a){this.isShowing()&&this._onKeyPress(a)},
onOtherKeyPress:function(a,c){if(typeof c=="undefined"||c==null)c=-1;var d=c>-1?c:this.grid.rows.overRow;if(!(d<0)&&Config.EnableKeyboardShortcuts&&a.keyChar&&b.isString(a.keyChar)&&!a.ctrlKey&&!a.altKey&&!a.metaKey){var f=this.getQuickActionMenu(!0);f&&f.close();f=this.model.getDatum(d,this.model.columns.UID);if(this.checkNullUid("onOtherKeyPress",f,d))switch(a.keyChar.toLowerCase()){case Config.Strings.KeyMailReply:this._respond("reply",[f],a);break;case Config.Strings.KeyMailReplyAll:this._respond("replyAll",
[f],a);break;case Config.Strings.KeyMailForward:this._respond("forward",[f],a);break;case Config.Strings.KeyMailKeepAsNew:this.changeMessagesReadState(!1,[f])}}},onResized:function(){this.splitContainer.resize()},wrapToolbar:function(){this.toolbar.skipLayout=!0;this.layoutWidget.resize()},onShow:function(){ws.bubbleConfig.showPinBubble("CustomizeMenu",this.customizeButton.domNode,!0);(Settings.EnablePreviewPane||!Settings.PreviewPaneIntroSeen)!=!(!this.fakePreviewPane&&!this.previewPane)&&ws.lang.setTimeout(this,
"setPreviewPaneEnabled",0,Settings.EnablePreviewPane);if(this.previewPane)this.previewPane.onShow();this.updateForwardingInfo();this.inherited(arguments)},onHide:function(){ws.bubbleConfig.hidePinBubble("CustomizeMenu",!0);this.inherited(arguments)},editDraft:function(){var a=this.getMessageActionUids();a&&a.length==1?this.openMessage(a[0],!1,!0):this.model.deselectAll()}}));b._hasResource["ws.layers.MessageList"]||(b._hasResource["ws.layers.MessageList"]=!0,b.provide("ws.layers.MessageList"))}}});

/* (C) 2012 AOL Inc. All Rights Reserved */
dojo._xdResourceLoaded(function(){return{depends:[["provide","ws.suite.WelcomeDialog"],["provide","ws.suite.UpgradeDialog"],["provide","ws.suite.FriendlyNameDialog"],["provide","ws.suite.GetZipDialog"],["provide","ws.widget.SmileyPalette"],["provide","ws.widget.ColorPalette"],["provide","ws.widget.LinkEditor"],["provide","ws.mail.funmail"],["provide","ws.widget.LayoutContainer"],["provide","ws.widget.WSEditor"],["provide","ws.AboutMe"],["provide","ws.suite.SignatureDialog"],["provide","ws.widget.BubblePin"],
["provide","ws.widget.BubbleManager"],["provide","ws.layers.StartupPromoDlgs"]],defineResource:function(c,k){c._hasResource["ws.suite.WelcomeDialog"]||(c._hasResource["ws.suite.WelcomeDialog"]=!0,c.provide("ws.suite.WelcomeDialog"),c.declare("ws.suite.WelcomeDialog",[ws.widget.WSModalPane,k._Templated],{widgetsInTemplate:!0,templateString:c.cache("ws.suite","WelcomeDialog.html",'<div class="WSModalPane welcomeDlg">\r\n\t<div class="WSModalPaneInner" dojoattachpoint="WSModalPaneInner">\r\n\t\t<div dojoattachpoint="welcomeContent" class="modalContainer welcomeContent">\r\n\t\t\t<div class="welcomeDlgFirstLogin" dojoattachpoint="welcomeDlgFirstLogin">\r\n\t\t\t\t<div dojoattachpoint="dlg_title" class="dlg_title">\r\n\t\t\t\t\t${WlcmDlg_Title}</div>\r\n\t\t\t\t<div dojoattachpoint="subTitle" class="subTitle">\r\n\t\t\t\t\t${WlcmDlg_SubTitle}</div>\r\n\t\t\t\t<div class="tipInfo">\r\n\t\t\t\t\t<img src="${spacer}" class="pinsSprite pin" dojoattachevent="onclick:getStarted"><span dojoattachpoint="tipInfo"> ${WlcmDlg_TipInfo}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="startBtnHolder">\r\n\t\t\t\t\t<div class="startBtn" dojotype="ws.widget.Button" size="Large" dojoattachpoint="startBtn" dojoattachevent="onClick:getStarted">\r\n\t\t\t\t\t\t${WlcmDlg_StartBtn}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n'),
css:{templateString:""},firstTime2newUX:!1,vertSizeForScroll:220,horzSizeForScroll:440,startup:function(){this.inherited(arguments);if(Settings.FeatureNoticeVer==4)this.vertSizeForScroll=260,this.horzSizeForScroll=500,this.welcomeDlgFirstLogin.style.width="480px",this.dlg_title.innerHTML=Config.Strings.WlcmDlg2UX_Title,this.subTitle.innerHTML=Config.Strings.WlcmDlg2UX_SubTitle,this.tipInfo.innerHTML=Config.Strings.WlcmDlg2UX_TipInfo;else if(Settings.FeatureNoticeVer==5)this.vertSizeForScroll=220,
this.horzSizeForScroll=460,this.welcomeDlgFirstLogin.style.width="440px",this.dlg_title.innerHTML=Config.Strings.WlcmDlgExistingUX_Title,this.subTitle.innerHTML=Config.Strings.WlcmDlgExistingUX_SubTitle,this.tipInfo.innerHTML=Config.Strings.WlcmDlgExistingUX_TipInfo;this.checkSize();this.show()},checkSize:function(){if(this.domNode&&this.domNode.style.display!="none"){var a=c.window.getBox(),d=c._getMarginSize(this.domNode),e=(a.w-d.w)/2,d=(a.h-d.h)/2;a.w<this.horzSizeForScroll?(e=20,this.domNode.style.width=
Math.max(a.w-40,0)+"px"):this.domNode.style.width="auto";a.h<this.vertSizeForScroll?(d=20,this.domNode.style.height=Math.max(a.h-40,0)+"px",this.WSModalPaneInner.style.height=Math.max(a.h-40,0)+"px",this.welcomeContent.style.height=Math.max(a.h-80,0)+"px",this.welcomeContent.style.overflowY="auto"):(this.domNode.style.height="auto",this.WSModalPaneInner.style.height="auto",this.welcomeContent.style.height="auto",this.welcomeContent.style.overflowY="hidden");this.domNode.style.left=e+"px";this.domNode.style.top=
d+"px";this.bg.style.width=Math.max(a.w,0)+"px";this.bg.style.height=Math.max(a.h,0)+"px"}},getStarted:function(){this.hide();ws.bubbleConfig.openFirstBubble(!0)}}));c._hasResource["ws.suite.UpgradeDialog"]||(c._hasResource["ws.suite.UpgradeDialog"]=!0,c.provide("ws.suite.UpgradeDialog"),c.declare("ws.suite.UpgradeDialog",[ws.widget.WSModalPane,k._Templated],{widgetsInTemplate:!0,templateString:c.cache("ws.suite","UpgradeDialog.html",'<div class="WSModalPane upgradeDlg">\r\n\t<div class="WSModalPaneInner">\r\n\t\t<img src="${spacer}" class="wsSmallCoolCloseButton" dojoAttachEvent="onclick:hideDlg">\r\n\t\t<div class="modalContainer">\r\n\t\t\t<div class="content" dojoAttachPoint="content">\r\n\t\t\t\t<div dojoAttachPoint="upgradeTitle" class="upgradeTitle">${UpgradeDlg_title1}</div>\r\n\t\t\t\t<div dojoAttachPoint="subtext" class="subtext">${UpgradeDlg_message1}</div>\r\n\t\t\t</div>\r\n\t\t\t<img src="${spacer}" class="blueMonster">\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},startup:function(){this.inherited(arguments);var a="webmail-redesign-upgrade";if(c.isFF<=2||c.isIE<=6){a="webmail-redesign-upgrade-browser";this.upgradeTitle.innerHTML=Config.Strings.UpgradeDlg_title2;this.subtext.innerHTML=ws.string.substituteParams(Config.Strings.UpgradeDlg_message2,'<span class="wsLink upgradeLink">',"</spam>");var d=c.query("span",this.subtext);this.domNode.style.width="483px";if(d&&d.length)d[0].onclick=c.hitch(this,function(){ws.io.openWindow(Config.UpgradeDlgLandingURL,
"","")})}this.show();ws.reporting.reportAction(a)},hideDlg:function(){Settings.UpgradeDlgDisplayed=!0;ws.settings.saveSoon({UpgradeDlgDisplayed:!0});this.hide()}}));c._hasResource["ws.suite.FriendlyNameDialog"]||(c._hasResource["ws.suite.FriendlyNameDialog"]=!0,c.provide("ws.suite.FriendlyNameDialog"),c.declare("ws.suite.FriendlyNameDialog",[ws.widget.WSModalPane,k._Templated],{widgetsInTemplate:!0,templateString:c.cache("ws.suite","FriendlyNameDialog.html",'<div class="WSModalPane friendlyNameDlg">\r\n\t<div class="WSModalPaneInner">\r\n\t\t<img src="${spacer}" class="mainSprite wsCloseBtn" dojoattachevent="onclick:hideDlg">\r\n\t\t<div class="modalContainer">\r\n\t\t\t<div class="content">\r\n\t\t\t\t<div dojoattachpoint="friendlyNameTitle" class="friendlyNameTitle">${FriendlyNameDlgTitle1}</div>\r\n\t\t\t\t<div dojoattachpoint="subText" class="subtext">${FriendlyNameDesc1}</div>\r\n\t\t\t\t<div class="confirmLine" dojoattachpoint="confirmLine">\r\n\t\t\t\t\t<span dojoattachpoint="confirmName"></span>&nbsp;&nbsp;&nbsp;<span dojoattachevent="onclick:changeToEdit" class="chngLnk wsLink">${Change}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="inputLine" dojoattachpoint="inputLine" style="display:none">\r\n\t\t\t\t\t<div dojotype="ws.widget.DefaultTextbox" dojoattachevent="onFocus:txtBoxEvnt,onBlur:txtBoxEvnt,onKeyUp:txtBoxEvnt" dojoattachpoint="fromNameInput" maxlength="255" defaultvalue="${FriendlyNameDefaultText}" tabindex="1"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="btn" dojotype="ws.widget.Button" dojoattachpoint="saveBtn" dojoattachevent="onClick:saveBtnClick" tabindex="2">&nbsp;&nbsp;&nbsp;&nbsp;${OK}&nbsp;&nbsp;&nbsp;&nbsp;</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},fromName:null,prepopulate:"populated",startup:function(){this.inherited(arguments);this.subText.innerHTML=ws.string.substituteParams(Config.Strings.FriendlyNameDesc1,"<span style='font-weight:bold;' >"+Settings.ActiveUserEmailAddress+"</span>");this.fromName?(this.friendlyNameTitle.innerHTML=Config.Strings.FriendlyNameDlgTitle2,this.fromNameInput.setValue(this.fromName),this.confirmName.innerHTML=this.fromName,this.prepopulate="populated"):(this.saveBtn.disable(),this.prepopulate=
"",this._changeToEdit());this.txtBoxEvnt();this.show();ws.reporting.reportAction("Friendly Name Promotion Dialog Displayed "+this.prepopulate)},saveBtnClick:function(){this.fromName=this.fromNameInput.getValue();ws.WebSuite.theMailModel.saveDisplayName(ws.UserContext.UserAddress,this.fromName);Settings.IsFriendlyNameDlgDisplayed=!0;ws.settings.saveSoon({IsFriendlyNameDlgDisplayed:!0});ws.reporting.reportAction("Friendly Name Promotion Dialog Saved and Done "+this.prepopulate);this.hide()},hideDlg:function(){Settings.IsFriendlyNameDlgDisplayed=
!0;ws.settings.saveSoon({IsFriendlyNameDlgDisplayed:!0});ws.reporting.reportAction("Friendly Name Promotion Dialog Dismissed "+this.prepopulate);this.hide()},changeToEdit:function(){this._changeToEdit();this.fromNameInput.textbox.focus()},_changeToEdit:function(){this.confirmLine.style.display="none";this.inputLine.style.display="block";this.resize();this.show()},txtBoxEvnt:function(a){this.fromNameInput.getValue()!=""?(this.saveBtn.enable(),a&&a.type=="keyup"&&a.keyCode==c.keys.ENTER&&this.saveBtnClick()):
this.saveBtn.disable()}}));c._hasResource["ws.suite.GetZipDialog"]||(c._hasResource["ws.suite.GetZipDialog"]=!0,c.provide("ws.suite.GetZipDialog"),c.declare("ws.suite.GetZipDialog",[ws.widget.WSModalPane,k._Templated],{widgetsInTemplate:!0,templateString:c.cache("ws.suite","GetZipDialog.html",'<div class="WSModalPane getZipDlg">\r\n\t<div class="WSModalPaneInner">\r\n\t\t<img src="${spacer}" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick:hideDlg">\r\n\t\t<div class="modalContainer">\r\n\t\t\t<div class="content" dojoAttachPoint="content" >\r\n\t\t\t\t<div class="getZipTitle">${GetZipDlg_title}</div>\r\n\t\t\t\t<div class="subtext">${GetZipDlg_message}</div>\r\n\t\t\t\t\r\n\t\t\t\t<div  class="wsToolBar" dojoType="ws.widget.WSToolbar" vizType="Bare">\r\n\t\t\t\t\t<div dojoType="ws.widget.DefaultTextbox" toolbarposition="left" dojoAttachEvent="onFocus:txtBoxEvnt,onBlur:txtBoxEvnt,onKeyUp:txtBoxEvnt" dojoAttachPoint="zipInput" maxLength=5 defaultValue="${GetZipDlg_prompt}" tabindex="1"></div>\r\n\t\t\t\t\t<div dojoType="dijit._Widget" toolbarposition="left" class="spacer"></div>\r\n\t\t\t\t\t<div class="btn" dojoType="ws.widget.Button" toolbarposition="left" dojoAttachPoint="saveBtn" dojoAttachEvent="onClick:saveBtnClick" tabindex="2">${Save}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoAttachPoint="error" class="error">${GetZipDlg_error}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class="content" dojoAttachPoint="contentErr" style="display: none" >\r\n\t\t\t\t<div class="getZipTitle">${GetZipDlg_titleErr}</div>\r\n\t\t\t\t<div class="subtext">${GetZipDlg_messageErr}</div>\r\n\t\t\t\t\r\n\t\t\t\t<div  class="wsToolBar" dojoType="ws.widget.WSToolbar" vizType="Bare">\r\n\t\t\t\t\t<div class="btn" dojoType="ws.widget.Button" toolbarposition="left" dojoAttachEvent="onClick:hideDlg" tabindex="2">${Close}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},currentZip:"",reqInProg:!1,startup:function(){this.inherited(arguments);this.initialZip?(this.currentZip=this.initialZip.match(/.+\|[A-Z]{2}/)?this.initialZip.replace(/(.+)\|([A-Z]{2})/,"$1"):this.initialZip,this.zipInput.setValue(this.currentZip),ws.reporting.reportAction("GetZipDialog Displayed/pre-populated ")):ws.reporting.reportAction("GetZipDialog Displayed/unpopulated ");this.txtBoxEvnt();this.show();this.zipInput.textbox.focus()},makeRequest:function(a,d,e){if(!this.reqInProg){this.reqInProg=
!0;window[e]&&(window[e]=null);if(this.scrptElem)try{try{this.scrptElem.getAttribute("src")&&delete this.scrptElem.src,this.scrptElem.getAttribute("type")&&delete this.scrptElem.type}catch(f){this.scrptElem.getAttribute("src")&&(this.scrptElem.src=null),this.scrptElem.getAttribute("type")&&(this.scrptElem.type=null)}this.scrptElem.onload=null;this.scrptElem.onerror=null;this.scrptElem.onreadystatechange=null;document.getElementsByTagName("head")[0].removeChild(this.scrptElem)}catch(g){}this.scrptElem=
document.createElement("script");this.scrptElem.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(this.scrptElem);this.scrptElem.src=a;this.scrptElem.onload=d;var j=c.hitch(this,function(){this.reqInProg=!1;window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ExternalErr,"No resp:"+a+" file:GetZipDialog.js");this.showError("external")});this.scrptElem.onreadystatechange=function(){if(this.readyState=="loaded"||this.readyState=="complete"){if(this.readyState=="loaded")this._wasLoaded=
!0;if(this.readyState=="complete")this._wasComplete=!0;if(window[e]&&!this._madeCall)this._madeCall=!0,d();this._wasLoaded&&this._wasComplete&&!this._madeCall&&j()}};this.scrptElem.onerror=j}},showError:function(a){switch(a){case "invalid":this.error.style.display="block";this.zipInput.textbox.select();break;case "external":this.error.style.display="none";this.content.style.display="none";this.contentErr.style.display="block";break;case "none":this.error.style.display="none"}},saveBtnClick:function(){this.showError("none");
var a=this.zipInput.getValue(),d=RegExp(Config.ZipCode.regex);if(a.search(d)==-1)this.showError("invalid");else{var a=a.replace(d,Config.ZipCode.replace),d=ws.string.substituteParams(Config.GetCityFromZipURL,a),e=c.hitch(this,function(){this.reqInProg=!1;if(window.wsSrv_zipMapResults)if(typeof window.wsSrv_zipMapResults.city=="undefined")this.showError("invalid");else{var d=ws.string.substituteParams(Config.SetHomeLocationURL,a+"|"+Config.ZipCode.country),e=c.hitch(this,function(){this.reqInProg=
!1;if(window.wsSrv_setZipResults)window.wsSrv_setZipResults.status&&wsSrv_setZipResults.status=="ok"?(a==this.currentZip?ws.reporting.reportAction("GetZipDialog saved/pre-populated"):(ws.UserContext.Zip=a,ws.reporting.reportAction("GetZipDialog saved/new-value"),c.publish("locationZipUpdated")),Settings.GetZipDlgDisplayed=!0,ws.settings.saveSoon({GetZipDlgDisplayed:!0}),this.hide()):(window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ExternalErr,"err resp from setHomeLocation file:GetZipDialog.js"),
this.showError("external"))});this.makeRequest(d,e,"wsSrv_setZipResults")}});this.makeRequest(d,e,"wsSrv_zipMapResults")}},hideDlg:function(){ws.reporting.reportAction("GetZipDialog dismissed");Settings.GetZipDlgDisplayed=!0;ws.settings.saveSoon({GetZipDlgDisplayed:!0});this.hide()},txtBoxEvnt:function(a){this.zipInput.getValue()!=""?(this.saveBtn.enable(),a&&a.type=="keyup"&&a.keyCode==c.keys.ENTER&&this.saveBtnClick()):this.saveBtn.disable()}}));c._hasResource["ws.widget.SmileyPalette"]||(c._hasResource["ws.widget.SmileyPalette"]=
!0,c.provide("ws.widget.SmileyPalette"),c.declare("ws.widget.SmileyPalette",[k._Widget,k._Templated],{templateString:"<div class='wsMenu' style='width:103px;height:89px;overflow:hidden;background: #fff url(${images}smileyPalette.png)!important;cursor:pointer;display:none' dojoAttachEvent='onmousedown:onClick'></div>",imageNames:[["smile","wink","kiss","bigkiss"],["cry","frown","indecision","shame"],["grin","greed","shock","yell"],["cool","foot","halo","tongue"]],altTexts:[[":-)",";-)",":-*",":-X"],
[":'(",":-(",":-\\",":-["],[":-D",":-$","=-O",">:O"],["8-)",":-!","O:-)",":-P"]],onClick:function(a){var d=c._abs(this.domNode),e=Math.floor((a.pageY-d.y)/this.smileyHeight),f=Math.floor((a.pageX-d.x)/this.smileyWidth);e>3&&(e=3);f>3&&(f=3);d=this.altTexts[e][f];e=Config.SmileyImageURL+this.imageNames[e][f]+Config.SmileyImageExt;c.stopEvent(a);this.onSmileyClicked(d,e)},smileyHeight:25,smileyWidth:25,onSmileyClicked:function(){}}));c._hasResource["ws.widget.ColorPalette"]||(c._hasResource["ws.widget.ColorPalette"]=
!0,c.provide("ws.widget.ColorPalette"),c.declare("ws.widget.ColorPalette",[k._Widget,k._Templated],{templateString:"<div class='wsMenu' style='width:206px;height:130px;overflow:hidden;background: #fff url(${baseimages}common/colors7x10.png)!important;cursor:pointer;display:none' dojoAttachEvent='onclick:onClick'></div>",colorNames:[["white","seashell","cornsilk","lemonchiffon","lightyellow","palegreen","paleturquoise","lightcyan","lavender","plum"],["lightgrey","pink","bisque","moccasin","khaki",
"lightgreen","lightseagreen","lightskyblue","cornflowerblue","violet"],["silver","lightcoral","sandybrown","orange","palegoldenrod","chartreuse","mediumturquoise","skyblue","mediumslateblue","orchid"],["gray","red","orangered","darkorange","yellow","limegreen","darkseagreen","royalblue","slateblue","mediumorchid"],["dimgray","crimson","chocolate","coral","gold","forestgreen","seagreen","blue","blueviolet","darkorchid"],["darkslategray","firebrick","saddlebrown","sienna","olive","green","darkcyan",
"mediumblue","darkslateblue","darkmagenta"],["black","darkred","maroon","brown","darkolivegreen","darkgreen","midnightblue","navy","indigo","purple"]],onClick:function(a){var d=c._abs(this.domNode),e=Math.floor((a.pageY-d.y)/this.colorHeight),a=Math.floor((a.pageX-d.x)/this.colorWidth);e>6&&(e=6);a>9&&(a=9);this.onPaletteClicked(this.colorNames[e][a]);ws.widget.popup.close(this)},colorHeight:20,colorWidth:20,onPaletteClicked:function(){}}));c._hasResource["ws.widget.LinkEditor"]||(c._hasResource["ws.widget.LinkEditor"]=
!0,c.provide("ws.widget.LinkEditor"),c.declare("ws.widget.LinkEditor",[k._Widget,k._Templated],{templateString:c.cache("ws.widget","LinkEditor.html",'<div class="wsMenu" style="background:#fff;width:290px;padding:8px 5px">\r\n  <img src="${spacer}" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick: handleCloseX">\r\n  <div class="contentDiv" dojoAttachPoint="contentDiv">\r\n\t<table dojoAttachPoint="inputTable">\r\n\t  <tbody>\r\n\t\t<tr>\r\n\t\t  <td>${LinkText}</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t  <td><div dojoType="ws.widget.DefaultTextbox" maxlength="255" fieldWidth="250px" dojoAttachPoint="linkText" tabindex="232"></div></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t  <td>${LinkTo}:&nbsp;<br style="display:none">\r\n\t\t\t<input name="scheme" value="${WebSite}" tabindex="233" type="radio" checked>&nbsp;${WebSite}\r\n\t\t\t<input name="scheme" value="${EmailAddress}" tabindex="234" type="radio">&nbsp;${EmailAddress}\r\n\t\t  </td>\r\n\t  </tr>\r\n\t\t<tr>\r\n\t\t  <td><div dojoType="ws.widget.DefaultTextbox" maxlength="1024" fieldWidth="250px" dojoAttachPoint="link" tabindex="235"></div></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t  <td style="margin-top:2px"><div dojoType="ws.widget.Button" toolbarPosition="right" style="float: right;" tabindex="236" dojoAttachPoint="okButton">${OK}</div></td>\r\n\t\t</tr>\r\n\t  </tbody>\r\n\t</table>\r\n  </div>\r\n</div>\r\n\r\n'),
widgetsInTemplate:!0,_earlyTemplatedStartup:!0,callbackFunc:null,startup:function(a){this.bookmark=a;c.toggleClass(this.linkText.textbox,"wsInputDefault",!1);this.linkText.textbox.style.paddingLeft="2px";this.linkText._updateClass=function(){};this.linkText._onFocus=function(){};c.toggleClass(this.link.textbox,"wsInputDefault",!1);this.link.textbox.style.paddingLeft="2px";this.link._updateClass=function(){};this.link._onFocus=function(){}},show:function(a,d){this.destroyOnClose=!0;this.editorWindow=
a;c.isWebKit&&a.focus();this.editorDoc=a.document;this.selection=c.isIE?this.editorDoc.selection:this.editorWindow.getSelection();this.range=this.createRange();this.schemes=c.query('[name="scheme"]',this.domNode);this.schemes.every(c.hitch(this,function(a){c.connect(a,"onclick",c.hitch(this,"schemeChosen"));return!0}));this.url=this.email="";var e=null,e=c.isIE?this.selection.type=="Control"?"":this.range.text:this.range.toString();this.linkText.textbox.value=e;this.currentScheme=0;var f=this.findAnchorNode();
if(f){this.link.textbox.value=f.href;if(f.href.match(/mailto:/i)&&this.schemes)this.schemes[1].checked=!0,this.currentScheme=1;if(e=="")this.linkText.textbox.value=c.isIE?f.innerText:f.textContent}ws.widget.popup({popup:this,around:d,padding:[0,0]});(Config.PageLocale=="fi-fi"||Config.PageLocale=="ru-ru")&&c.query("br",this.domNode).style("display","block");e?this.link.textbox.focus():this.linkText.textbox.focus();this.link.connect(this.link,"onKeyPress",c.hitch(this,"keyPressed",f));this.okButton.connect(this.okButton.domNode,
"ondijitclick",c.hitch(this,"createOrCancelLink",f,1));c.publish("popup/open",[])},schemeChosen:function(){if(this.schemes[0].checked){if(this.currentScheme==1)this.currentScheme=0,this.email=this.link.textbox.value,this.link.textbox.value="",this.link.textbox.value=this.url}else if(this.currentScheme==0)this.currentScheme=1,this.url=this.link.textbox.value,this.link.textbox.value="",this.link.textbox.value=this.email;this.link.textbox.focus()},keyPressed:function(a,d){d.keyCode==13&&this.createOrCancelLink(a,
1)},onClose:function(){this.destroyRecursive()},close:function(a){ws.widget.popup.close(this);this.callbackFunc&&this.callbackFunc(a)},handleCloseX:function(){c.isIE&&this.range&&this.range.select();this.close(!0)},createOrCancelLink:function(a,d){switch(d){case 1:var e=this.link.textbox.value;if(e==""){this.createOrCancelLink(a,2);this.close();break}!this.schemes||this.schemes[0].checked?e.match(/^http:/i)||(e="http://"+e):e.match(/^mailto:/i)||(e="mailto:"+e);if(a)a.href=e;var f=this.linkText.textbox.value;
f==""&&this.selection.type!="Control"&&(f=e,f.match(/^mailto:/)&&(f=f.replace(/^mailto:/,"")));if(c.isIE){if(this.editorWindow.lastSelType=="Control")this.range.execCommand("createlink",!1,e);else if(f!="")if(this.range.text==f)this.range.execCommand("createlink",!1,e);else if(this.range.text)a?a.innerHTML=f:(this.range.text=f,this.range.moveStart("character",-f.length),this.range.select(),this.range.execCommand("createlink",!1,e),this.range.collapse(!1),this.range.select());else{if(!this.editorWindow.lastSelRange)this.bookmark?
(this.range=this.editorDoc.body.createTextRange(),this.range.moveToBookmark(this.bookmark)):(this.editorWindow.focus(),this.range=this.editorDoc.selection.createRange());this.range.text=f;this.range.moveStart("character",-f.length);this.range.select();this.range.execCommand("createlink",!1,e)}this.editorWindow.lastSelType!="Control"&&(this.range.collapse(!1),this.range.select())}else f==this.range.toString()?a||(this.editorDoc.execCommand("createlink",!1,e),this.selection.collapseToEnd()):a?a.innerHTML=
f:(a=this.editorWindow.document.createElement("a"),a.href=e,this.range.deleteContents(),e=this.editorDoc.createTextNode(f),a.appendChild(e),this.range.insertNode(a)),a&&this.selection.selectAllChildren(a),this.selection.collapseToEnd(),this.range.detach(),this.editorDoc.execCommand("unlink",!1,null);this.close();break;case 2:if(a)if(c.isIE)this.range.select(),this.editorDoc.execCommand("unlink"),this.editorDoc.execCommand("unselect"),this.selection.type!="Control"&&(this.range.collapse(!1),this.range.select());
else try{for(var e=a.childNodes.length,f=a.parentNode,g=0;g<e;g++)f.insertBefore(a.firstChild,a);f.removeChild(a)}catch(j){}}},createRange:function(){if(!this.selection)return null;var a;if(c.isIE)a=this.editorWindow.lastSelRange?this.editorWindow.lastSelRange:this.selection.createRange();else try{a=this.selection.getRangeAt(0)}catch(d){a=this.editorDoc.createRange()}return a},findAnchorNode:function(){var a=null;if(c.isIE)if(this.editorWindow.lastSelType=="None"){if(a=this.detectAnchorAtPoint())this.range.moveToElementText(a),
this.range.select()}else if(this.editorWindow.lastSelType=="Control")a=this.editorWindow.lastSelNode.parentNode,a.href||(a=null);else{if(this.editorWindow.lastSelType=="Text"){var d=this.range.htmlText.match(/href="(.+?)"/i);d&&d.length>1&&this.range.findText(this.range.text,0,0);this.range.collapse(!0);a=this.detectAnchorAtPoint();if(!a)this.range=this.selection.createRange(),this.range.collapse(!1),a=this.detectAnchorAtPoint();this.range=this.selection.createRange()}}else{var d=this.editorDoc.body,
e=this.range.startContainer;do if(e.nodeName.toLowerCase()=="a"){a=e;break}while(e!=d&&(e=e.parentNode));if(!a&&!this.range.collapsed){e=this.range.endContainer;do if(e.nodeName.toLowerCase()=="a"){a=e;break}while(e!=d&&(e=e.parentNode))}!a&&!this.range.collapsed&&this.range.commonAncestorContainer.childNodes.length>0&&c.query("a",this.range.commonAncestorContainer).every(c.hitch(this,function(d){if(this.selection.containsNode(d,!0))return a=d,!1;return!0}))}return a},detectAnchorAtPoint:function(){var a=
null;this.range.pasteHTML('<span id="le:tmp.id"></span>');var d=c.byId("le:tmp.id",this.editorDoc);if(d){a=d.parentNode;for(d.parentNode.removeChild(d);a&&a.tagName.toLowerCase()!="a";)a=a.tagName.toLowerCase()=="body"?null:a.parentNode}return a}}));if(!c._hasResource["ws.mail.funmail"]){c._hasResource["ws.mail.funmail"]=!0;c.provide("ws.mail.funmail");var i=function(){this.init()};i.prototype.init=function(){this._type=this._document=null;this._xmlHttp=new XmlHttp;this._savedContentMap=null};i.prototype.setDocument=
function(a){this._document=a};i.prototype.setStationery=function(a){this._xmlHttp.fetchAsynchronous(a,this.createDelegate(this,this.stationeryHandler))};i.prototype.setPostcard=function(a){this._xmlHttp.fetchAsynchronous(a,this.createDelegate(this,this.postcardHandler))};i.prototype.setPhotoAlbum=function(a){this._xmlHttp.fetchAsynchronous(a,this.createDelegate(this,this.photoAlbumHandler))};i.prototype.getFinalizedDocument=function(){var a=null;this._document&&(a=this._document.cloneNode(!0))&&this.finalizeNode(a.body);
return a};i.prototype.finalizeNode=function(a){if(a){var d=a.id;if(d&&(d=d.toLowerCase(),d.search(/^role_/)==0||d.search(/^rolx_/)==0))a.removeAttribute("contentEditable"),a.removeAttribute("id"),this.isContentVolatile(a)&&(a.removeAttribute("comp_state"),a.removeAttribute("comp_original_text"));for(d=0;d<a.childNodes.length;d++){var c=a.childNodes[d];c&&this.finalizeNode(c)}}};i.prototype.createDelegate=function(a,d){return function(){return d.apply(a,arguments)}};i.prototype.cleanupRoleAttributes=
function(a){try{a.removeAttribute("comp_role")}catch(d){}for(var c=0;c<a.childNodes.length;c++){var f=a.childNodes[c];f&&this.cleanupRoleAttributes(f)}};i.prototype.loadTemplateForDocument=function(a,d,c){if(a&&(a=a.body,this.loadTemplateForNode(a,c),d==1)){this.cleanupRoleAttributes(a);for(var f in c){var d=c[f],a=d.getAttribute("contentEditable"),g=this.innerText(d);a!=null&&a.toLowerCase()=="true"&&g!=""&&(d.setAttribute("comp_state","volatile"),d.setAttribute("comp_original_text",g))}}};i.prototype.loadTemplateForNode=
function(a,d){if(a&&!(a.nodeType==3||a.nodeType==8)){var c=a.getAttribute("comp_role"),f=null;if(c)f="role_"+c,a.id=f,a.removeAttribute("comp_role");if(f!="role_ornament")if(f&&f!="role_layout")d[f]=a;else for(c=0;c<a.childNodes.length;c++)(f=a.childNodes[c])&&this.loadTemplateForNode(f,d)}};i.prototype.stationeryHandler=function(a){this.applyTemplate(a,0)};i.prototype.postcardHandler=function(a){this.applyTemplate(a,1)};i.prototype.saveContentForNode=function(a,d){if(a){var c=a.id?a.id.toLowerCase():
"";if(c.search(/^role_/)!=-1)if(c=="role_ornament"||c=="role_document"||c=="role_title")return;else if(c!="role_layout"&&c!="role_document"){var f=a.innerHTML;f&&this.isContentVolatile(a)&&!this.isContentModified(a)&&(f="<DIV>&nbsp;</DIV>");d[c]=f;return}for(c=0;c<a.childNodes.length;c++)(f=a.childNodes[c])&&this.saveContentForNode(f,d)}};i.prototype.saveContentForDocument=function(a,d){if(a){this.saveContentForNode(a.body,d);var c=!1;for(key in d){c=!0;break}if(!c)d.role_body=a.body.innerHTML}};
i.prototype.applyTemplate=function(a,d){this._savedContentMap=[];this.saveContentForDocument(this._document,this._savedContentMap);if(a)a=a.replace(/(\r|\n)/g,""),a=a.replace(/.*<body[^>]*>/i,""),a=a.replace(/<\/body>.*/i,""),this._document.body.innerHTML=a;this._document.body.setAttribute("contentEditable","false");this._document.body.setAttribute("unselectable","on");var e=[];this.loadTemplateForDocument(this._document,d,e);if(typeof e.role_body!="undefined")e.role_body.innerHTML=d!=1?"<DIV>&nbsp;</DIV>":
"",this.moveContent(this._savedContentMap,e),e=c.isIE?400:0,ws.lang.setTimeout(c.hitch(this,function(){this.moveCursorToBodyRole(this._document);if(c.isIE)this._document.body.scrollTop=0}),e)};i.prototype.moveContent=function(a,d){for(toElementId in d)if(!(toElementId=="role_ornament"||toElementId=="role_layout")&&typeof a[toElementId]!="undefined"&&a[toElementId]!=""){var c=d[toElementId].innerHTML;d[toElementId].innerHTML=a[toElementId];this.isWhitespace(this.innerText(d[toElementId]))&&d[toElementId].getElementsByTagName("img").length==
0?d[toElementId].innerHTML=c:(d[toElementId].removeAttribute("comp_state"),d[toElementId].removeAttribute("comp_original_text"))}};i.prototype.moveCursorToBodyRole=function(a,d,c){if(a){var d=!!d,f=a.getElementById("role_body");if(f)if(typeof window!="undefined"&&window.getSelection)f.focus(),this.isContentVolatile(f)&&!this.isWhitespace(this.innerText(f))?(c=a.defaultView?a.defaultView.getSelection():a.parentWindow.getSelection(),a=a.createRange(),a.selectNodeContents(f),c.removeAllRanges(),c.addRange(a)):
(c=a.defaultView?a.defaultView.getSelection():a.parentWindow.getSelection(),c.collapseToStart());else{d||a.selection.empty();a=a.body.createTextRange();a.moveToElementText(f);c?a.collapse(!1):this.isContentVolatile(f)&&!this.isWhitespace(this.innerText(f))?a.select():a.collapse(!0);try{f.focus()}catch(g){if(f.childNodes.length>0)try{f.childNodes[0].focus()}catch(j){}}}}};i.prototype.isContentVolatile=function(a){if(!a)return!1;return a.getAttribute("comp_state")=="volatile"};i.prototype.isContentModified=
function(a){if(!a)return!0;var d=a.getAttribute("comp_original_text");return this.innerText(a)!=d};i.prototype.isWhitespace=function(a){return a.search(/^(\s|\xA0)*$/)==0};i.prototype.cleanupDocument=function(){};i.prototype.innerText=function(a){return typeof a.innerHTML!="undefined"?a.innerHTML:null};c.declare("ws.mail.funmail",[i],{init:function(){this._savedContentMap=this._type=this._document=null},loadTemplateForNode:function(){this.inherited(arguments);c.query("div",this._document.body).forEach(function(a){a.style.outline=
"none"})},finalizeTemplate:function(){this.finalizeNode(this._document.body)}})}c._hasResource["ws.widget.LayoutContainer"]||(c._hasResource["ws.widget.LayoutContainer"]=!0,c.provide("ws.widget.LayoutContainer"),c.declare("ws.widget.LayoutContainer",k.layout.LayoutContainer,{layout:function(){this.layoutChildren(this.domNode,this._contentBox,this.getChildren())},capitalize:function(a){return a.substring(0,1).toUpperCase()+a.substring(1)},size:function(a,d){a.resize?a.resize(d):c.marginBox(a.domNode,
d);c.mixin(a,c.marginBox(a.domNode));c.mixin(a,d)},layoutChildren:function(a,d,e,f,g){d=c.mixin({},d);c.addClass(a,"dijitLayoutContainer");e=c.filter(e,function(a){return a.region!="center"&&a.layoutAlign!="client"}).concat(c.filter(e,function(a){return a.region=="center"||a.layoutAlign=="client"}));c.forEach(e,function(a){var e=a.domNode,h=a.region||a.layoutAlign,l=e.style,i=0;a.domNode.getAttribute("offsetY")&&!isNaN(a.domNode.getAttribute("offsetY"))&&(i=parseInt(a.domNode.getAttribute("offsetY")));
d.t+=i;d.h-=i;l.left=d.l+"px";l.top=d.t+"px";l.bottom=l.right="auto";c.addClass(e,"dijitAlign"+this.capitalize(h));e={};f&&f==a.id&&(e[a.region=="top"||a.region=="bottom"?"h":"w"]=g);h=="top"||h=="bottom"?(e.w=d.w,this.size(a,e),d.h-=a.h,h=="top"?d.t+=a.h:l.top=d.t+d.h+"px"):h=="left"||h=="right"?(e.h=d.h,this.size(a,e),d.w-=a.w,h=="left"?d.l+=a.w:l.left=d.l+d.w+"px"):(h=="client"||h=="center")&&this.size(a,d)},this)}}));if(!c._hasResource["ws.widget.WSEditor"])c._hasResource["ws.widget.WSEditor"]=
!0,c.provide("ws.widget.WSEditor"),ws.widget.fontOptions=[{value:"Arial, Helvetica, sans-serif",display:'<b style="font-weight: normal; font-family: Arial,Helvetica,sans-serif">Arial</b>',selected:!0,checked:!0},{value:"Comic Sans MS, sans-serif",display:'<b style="font-weight: normal; font-family: Comic Sans MS, sans-serif">Comic Sans MS</b>'},{value:"Courier New, Courier, mono",display:'<b style="font-weight: normal; font-family: Courier New, Courier, mono">Courier New</b>'},{value:"Georgia, Times New Roman, Times, Serif",
display:'<b style="font-weight: normal; font-family: Georgia, Times New Roman, Times, Serif">Georgia</b>'},{value:"impact, sans-serif",display:'<b style="font-weight: normal; font-family: impact, sans-serif">Impact</b>'},{value:"Tahoma, Arial, Helvetica, sans-serif",display:'<b style="font-weight: normal; font-family: Tahoma, Arial, Helvetica, sans-serif">Tahoma</b>'},{value:"Times New Roman, Times, serif",display:'<b style="font-weight: normal; font-family: Times New Roman, Times, serif">Times New Roman</b>'},
{value:"Verdana, Arial, Helvetica, sans-serif",display:'<b style="font-weight: normal; font-family: Verdana, Arial, Helvetica, sans-serif">Verdana</b>'},{value:"WingDings",display:'<b style="font-weight: normal;">WingDings</b>'}],c.isFF>=3&&ws.widget.fontOptions.splice(ws.widget.fontOptions.length-1,1),ws.widget.fontSizePicker=[{value:"1",display:"<span style='font-size:8pt;'>8 pt</span>",safari:"10px",other:"8pt"},{value:"2",display:"<span style='font-size:10pt;'>10 pt</span>",safari:"13px",other:"10pt",
selected:!0,checked:!0},{value:"3",display:"<span style='font-size:12pt;'>12 pt</span>",safari:"16px",other:"12pt"},{value:"4",display:"<span style='font-size:14pt;'>14 pt</span>",safari:"18px",other:"14pt"},{value:"5",display:"<span style='font-size:18pt;'>18 pt</span>",safari:"24px",other:"18pt"},{value:"6",display:"<span style='font-size:24pt;'>24 pt</span>",safari:"32px",other:"24pt"},{value:"7",display:"<span style='font-size:36pt;'>36 pt</span>",safari:"48px",other:"36pt"}],c.declare("ws.widget.WSEditor",
[k._Widget,k._Templated],{templateString:c.cache("ws.widget","WSEditor.html",'<div style="height:100%;width:100%;">\r\n<div class="wsEditor" dojoType="ws.widget.LayoutContainer" dojoAttachPoint="layoutWidget">\r\n    <div dojoType="ws.widget.Pane" dojoAttachPoint="toolbarPaneParent" layoutAlign="top" class="toolbarContainer">\r\n        <div class="toolbar" dojoAttachPoint="toolbarPane">\r\n            <\!-- we need to use &nbsp; as innerHTML for the anchor tags otherwise, IE8/7 will show the text overlayed on top of the icons. Using transparent css color\r\n            for the text does not work neither --\>\r\n            <a href="#" class="attachBtn" dojoAttachPoint="attachButton" title="${ChooseFileTooltip}" dojoAttachEvent="onClick: openAttachFileDialog"></a>\r\n            <\!-- Insert Pictures button is dynamically inserted here, by PictureEditor.js --\>\r\n            <a href="#" class="wsLink enableRTE" dojoAttachPoint="richTextButton" title="${Basic_SwitchToRichEditor}" dojoAttachEvent="onclick: enableRichText"><span class="wsLink">${Basic_SwitchToRichEditor}</span></a>\r\n            <a href="#" dojoType="ws.widget.WSSelect" dojoAttachPoint="fontPicker" disableMouseStates="true" title="${FontType}" className="fontfamilyIcon" >&nbsp;</a>\r\n            <a href="#" dojoType="ws.widget.WSSelect" dojoAttachPoint="fontSizePicker" disableMouseStates="true" title="${FontSize}" className="fontsizeIcon" >&nbsp;</a>\r\n            <a href="#" dojoAttachPoint="boldItem" title="${Bold}" dojoAttachEvent="onclick: boldClick" class="boldIcon">&nbsp;</a>\r\n            <a href="#" dojoAttachPoint="italicItem" title="${Italic}" dojoAttachEvent="onclick: italicClick" class="italicIcon">&nbsp;</a>\r\n            <a href="#" dojoAttachPoint="underlineItem" title="${Underline}" dojoAttachEvent="onclick: underlineClick" class="underlineIcon">&nbsp;</a>\r\n            <a href="#" dojoAttachPoint="forecolorItem" title="${FontColor}" dojoAttachEvent="onclick: fontColorClick" class="forecolorIcon" dojoAttachPoint="forecolorButton">&nbsp;</a>\r\n            <a href="#" dojoAttachPoint="hilitecolorItem" title="${BackgroundColor}" dojoAttachEvent="onclick: backgroundColorClick" class="hilitecolorIcon">&nbsp;</a>\r\n            <a href="#" dojoType="ws.widget.WSSelect" dojoAttachPoint="justifyPicker" disableMouseStates="true" title="${Alignment}" className="justifyIcon" >&nbsp;</a>\r\n            <a href="#" dojoType="ws.widget.WSSelect" dojoAttachPoint="listPicker" disableMouseStates="true" title="${Lists}" className="insertListIcon" >&nbsp;</a>\r\n            <a href="#" dojoType="ws.widget.WSSelect" dojoAttachPoint="indentPicker" disableMouseStates="true" title="${Indentation}" className="indentPickerIcon" >&nbsp;</a>\r\n            <a href="#" title="${HorizontalRule}" dojoAttachEvent="onclick: horizontalRuleClick" class="insertHorizontalRuleIcon">&nbsp;</a>\r\n            <a href="#" title="${InsertSmiley}" dojoAttachEvent="onclick: smileyClick" class="smileyIcon" dojoAttachPoint="smileyButton">&nbsp;</a>\r\n            <a href="#" title="${InsertLink}" dojoAttachEvent="onclick: linkClick" class="linkIcon" dojoAttachPoint="linkButton">&nbsp;</a>\r\n            <\!-- Stationery button is dynamically inserted here, by WSEditor.js --\>\r\n            <a href="#" dojoAttachPoint="htmlmodeItem" title="${ViewHTMLSource}" dojoAttachEvent="onclick: htmlModeClick" class="htmlmodeIcon">&nbsp;</a>\r\n        </div>\r\n    </div>\r\n\t<div class="wsInput iframePane" dojoType="ws.widget.Pane" layoutAlign="client" dojoAttachPoint="iframePane">\r\n\t\t<iframe border="none" frameBorder="0" dojoAttachPoint="iframe" width="100%" height="100%" src="about:blank" tabindex="${tabindex}" name="${id}_body" allowtransparency="true" dojoAttachEvent="onload: onIframeLoaded"></iframe>\r\n\t</div>\r\n\t<div class="wsInput textareaPane" dojoType="ws.widget.Pane" layoutAlign="client" dojoAttachPoint="textareaPane" style="display: none; overflow: hidden;">\r\n\t\t<textarea class="wsInputBare" dojoAttachPoint="textarea" tabindex="105"></textarea>\r\n\t</div>\r\n</div>\r\n</div>\r\n'),
css:{templateString:""},bodyCss:{templateString:c.cache("ws.widget","WSEditorDocument.css",'html, body {padding: 0 0 0 0; margin: 0; border: none; background-color: transparent; font-family: Helvetica,Arial,sans-serif; font-size: 10pt;}body {padding: 15px 15px 15px 15px;}p {margin: 0; padding: 0;}a.spell {padding-bottom: 2px; background: yellow url("${images}bg_spellingErr.gif") bottom left repeat-x; color: #000; text-decoration: none; cursor: pointer;}a.spell:hover {color: #b00;}img.wsThumbnail {display: none;}img.wsPlaceholder {background: #F4F4F4 url("${baseimages}common/progressAnimation_lg.gif") center center no-repeat; border: 1px solid #DADAD6 !important;}.AOLPicturesFullSizeLink {height: 1px; width: 1px; overflow: hidden;}\r\n')},
widgetsInTemplate:!0,_earlyTemplatedStartup:!0,rng:null,currentCommand:null,htmlMode:!1,isStationeryMode:!1,showAttachFile:!1,showRichTextButton:!0,blankLine:"",tabindex:500,doForceRichMode:!1,addNewLinesToRichContent:!0,addDefaultFontStyles:!0,auxDirty:!1,fontPicker:null,fontSizePicker:null,justifyPicker:null,listPicker:null,indentPicker:null,startup:function(){if(!this._started){this._started=!0;this.connect(this.fontPicker,"valueChanged","changeFont");this.connect(this.fontPicker.domNode,"onmousedown",
"setRange");this.connect(this.fontSizePicker,"valueChanged","changeFontSize");this.connect(this.fontSizePicker.domNode,"onmousedown","setRange");this.connect(this.justifyPicker,"valueChanged","changeJustify");this.connect(this.justifyPicker.domNode,"onmousedown","setRange");this.connect(this.listPicker,"valueChanged","changeList");this.connect(this.listPicker.domNode,"onmousedown","setRange");this.connect(this.indentPicker,"valueChanged","changeIndent");this.connect(this.indentPicker.domNode,"onmousedown",
"setRange");this.connect(this.textarea,"onfocus","onFocusHandler");if(!this.showAttachFile||!Config.HasLocalFileSystem)this.attachButton.style.display="none";this.richTextButton.style.display="none";if(!Config.ShowRichTextHtml)this.htmlmodeItem.style.display="none";this.fontPicker.setOptions(ws.widget.fontOptions);if(typeof Settings.ComposeFont!="undefined")for(var a=0;a<this.fontPicker.options.length;a++)if(this.compareFontFamilyStr(this.fontPicker.options[a].value,Settings.ComposeFont)){for(var d=
0;d<this.fontPicker.options.length;d++)this.fontPicker.options[d].checked=!1;this.fontPicker.options[a].checked=!0;break}this.fontSizePicker.setOptions(ws.widget.fontSizePicker);if(typeof Settings.ComposeFontSize!="undefined")for(a=0;a<this.fontSizePicker.options.length;a++)if(this.fontSizePicker.options[a].value==Settings.ComposeFontSize){for(d=0;d<this.fontSizePicker.options.length;d++)this.fontSizePicker.options[d].checked=!1;this.fontSizePicker.options[a].checked=!0;break}this.justifyPicker.setOptions([{value:"justifyleft",
display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="justifyleftIcon"><span>'+Config.Strings.JustifyLeft+"</span></div>",selected:!0,checked:!0},{value:"justifycenter",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="justifycenterIcon"><span>'+Config.Strings.JustifyCenter+"</span></div>"},{value:"justifyright",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="justifyrightIcon"><span>'+Config.Strings.JustifyRight+
"</span></div>"}]);this.connect(this.justifyPicker,"createMenu",function(){c.addClass(this.justifyPicker.menu.domNode,"iconMenu");c.toggleClass(this.justifyPicker.domNode,"activated",!0)});this.listPicker.setOptions([{value:"insertorderedlist",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="insertorderedlistIcon"><span>'+Config.Strings.OrderedList+"</span></div>"},{value:"insertunorderedlist",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="insertunorderedlistIcon"><span>'+
Config.Strings.BulletedList+"</span></div>"}]);this.connect(this.listPicker,"createMenu",function(){c.addClass(this.listPicker.menu.domNode,"iconMenu")});this.indentPicker.setOptions([{value:"outdent",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="indentIcon"><span>'+Config.Strings.DecreaseIndent+"</span></div>"},{value:"indent",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="outdentIcon"><span>'+Config.Strings.IncreaseIndent+"</span></div>"}]);
this.resizeToolBar()}},resizeToolBar:function(a){if(c.isIE==7&&(this.richMode||a)){a=c.query(">*",this.toolbarPane);this.toolbarPane.style.visibility="hidden";var d=[],e=[];a.forEach(function(a){c.hasClass(a,"rttLabel")?a.style.display!="none"&&e.push(a):a.style.display!="none"&&d.push(a)});for(var a=d.length*32+d.length*2,f=0,g=0,g=0;g<e.length;g++)f+=c.coords(e[g]).w+2;this.toolbarPane.style.width=a+f-1+"px";this.toolbarPane.style.visibility="visible";this.toolbarPane.style.display="none";this.toolbarPane.style.display=
""}},setAuxDirty:function(a){this.auxDirty=a},isAuxDirty:function(){return this.auxDirty},fixWebKitContentInit:function(){if(c.isWebKit){this.doc().body&&!this.doc().body.firstChild&&this.doc().body.appendChild(document.createTextNode(""));var a=this.doc().createRange();a.selectNode(this.doc().body.firstChild);a.collapse(!0);var d=this.win().getSelection();d.removeAllRanges();d.addRange(a)}},setContent:function(a,d,e,f,g,j){this.updateMode();if(this.richMode)if(this.designModeEnabled){this.doc().body.innerHTML=
a;this.fixWebKitContentInit();if(!c.isIE)this.doc().designMode="off",this.doc().designMode="on";this.updateToolbar(null,!0);(!j||j&&!this.isStationeryMode)&&this.fixEditorForStationery();d&&d()}else this.enableDesignMode(a,d);else this.textarea.value=f?a:e?a:ws.html.getText(a),d&&d();this.win().lastSelType=null;this.win().lastSelRange=null;this.ieEditorBookmark=this.win().lastSelNode=null;this.setAuxDirty(!1)},_setup:function(){},getStationeryDefaults:function(){var a=Settings.StationeryDefaults;
if(a&&!c.isObject(a))Settings.StationeryDefaults=c.fromJson(a);return Settings.StationeryDefaults?Settings.StationeryDefaults:null},hasStationeryDefaults:function(){var a=Settings.StationeryDefaults;return a&&a.pluginId&&a.name},enableDesignMode:function(a,d){var e=c.hitch(this,function(){this._enableDesignMode(a);d&&d()});c.isIE||this.iframe._loaded?ws.lang.setTimeout(e,10):this.iframe.onload=e},_enableDesignMode:function(a){var d=this.win(),e=this.doc();try{e.body.innerHTML=a,this.bodyCss.templateString?
c.withGlobal(d,"insertCssText",ws.widget,[this.bodyCss.templateString,!0]):c.withGlobal(d,"insertCssText",ws.widget,[c._getText(this.bodyCss.templatePath),!0])}catch(f){}if(c.isIE)e.body.contentEditable="true",this.connect(e,"onbeforedeactivate","onBeforeDeactivate");else try{e.designMode="on"}catch(g){c.isMoz&&ws.lang.setTimeout(c.hitch(this,function(){this.enableDesignMode(a)}),10);return}ws.widget.popup.registerWin(this.win());e=this.doc();c.isFF?this.connect(e,"onfocus","onFocusHandler"):this.connect(d,
"onfocus","onFocusHandler");this.connect(e,"onkeyup","updateToolbar");this.connect(e,"onmouseup","updateToolbar");c.isIE?this.connect(e,"onkeydown","ieKeyDown"):c.isMoz?this.connect(e,"onkeypress","geckoKeyPress"):c.isWebKit&&this.connect(e,"onkeydown","webkitKeyPress");this.connect(e,"onclick",function(a){c.publish("WSEditor/BodyClick",[{event:a}])});this.connect(e,"ondblclick",function(a){c.publish("WSEditor/BodyDblClick",[{event:a}])});if(c.isWebKit)this.webkitCursorFixFocus=this.connect(this.win(),
"onfocus","fixWebKitCursor");this.designModeEnabled=!0;this.reset(null,!1);if(c.isWebKit)e.designMode="off",e.designMode="on",e.body.setAttribute("contentEditable","true"),e.body.setAttribute("unselectable","off"),e.body.innerHTML=a,this.fixWebKitContentInit(),this.focus()},fixWebKitCursor:function(){var a=this.doc();if(a.body.contentEditable=="false"){if((a=c.query("[contenteditable=true]",a.body))&&a.length!=0&&a[0].innerHTML=="<span></span>")a[0].innerHTML="",this.disconnect(this.webkitCursorFixFocus)}else if(a.body.innerHTML==
"<span></span>")a.body.innerHTML="",this.disconnect(this.webkitCursorFixFocus)},isEmpty:function(){if(c.isWebKit)if(this.richMode){var a=this.doc().body.innerHTML;if(a==""||a=="<span>&nbsp;</span>"||a=="<span></span>")return!0}else if(!c.trim(this.textarea.value))return!0;return!1},getEmptyHtml:function(){return c.isWebKit?"<span></span>":""},openAttachFileDialog:function(){},enableRichText:function(){},showAttachFileButtonInToolBar:function(){if(Config.HasLocalFileSystem&&(c.query(">",this.toolbarPane).forEach(function(a){a.style.display=
"none"},this),this.showAttachFile))this.attachButton.style.display=""},showAllInToolBar:function(){Config.HasLocalFileSystem&&(c.query(">",this.toolbarPane).forEach(function(a){if((a!=this.htmlmodeItem||Config.ShowRichTextHtml)&&(a!=this.richTextButton||this.showRichTextButton)&&(a!=this.attachButton||this.showAttachFile))a.style.display=""},this),this.positionAttachFileButton(!1))},positionAttachFileButton:function(){},positionRichTextButton:function(){},updateMode:function(){if(this.richMode=this.useRichMode()){this.textareaPane.hide();
this.showAllInToolBar();if(c.isIE>=9)this.iframePane.domNode.style.overflow="hidden";this.iframePane.show()}else this.textareaPane.show(),this.showAttachFileButtonInToolBar(),this.iframePane.hide();this.toolbarPaneParent.domNode.style.height="26px";this.positionRichTextButton();this.onResized()},useRichMode:function(){if(this.doForceRichMode)return!0;if(!Settings.UseRichEditor)return!1;return!(c.isIE&&ws.browser.ns8)},getBlankLine:function(){if(!this.blankLine)this.blankLine=c.isFF>=9?"<br>":c.isMoz?
"<div> <br></div>":c.isIE>=9?"<div></div>":"<br>";return this.useRichMode()?this.blankLine:"<br>"},getRichContent:function(){var a="";if(this.htmlMode)a=ws.html.renderedTextContent(this.doc().body);else if(c.isIE&&Config&&Config.IESanitizeTagsForSend&&Config.IESanitizeTagsForSend.length>0){var d=this.doc().body;if(d){var a=d.innerHTML,e=/([^"'\s>]+)\=(('[^']*')|("[^"]*")|([^"'\s>]+))/g,f=Config.IESanitizeTagsForSend.split(","),g=[];c.forEach(f,function(a){g=g.concat(c.query(a,d))});c.forEach(g,function(d){var c=
d.outerHTML.toLowerCase(),f=c.indexOf("<"+d.nodeName.toLowerCase());if(f>=0&&(c=c.indexOf(">"),c>=0&&c>f)){for(var f=d=d.outerHTML.slice(f,c+1),c=null,g=0;(c=e.exec(d))!=null;)if(c.length>=5&&c[2]&&c[2].length>0&&c[2].charAt(0)!="'"&&c[2].charAt(0)!='"'){var j=c.index+c[1].length+1+g,f=f.slice(0,j)+'"'+f.slice(j);g++;j+=c[2].length+1;f=f.slice(0,j)+'"'+f.slice(j);g++}f!=d&&(c=a.indexOf(d),c>=0&&(a=a.slice(0,c)+f+a.slice(c+d.length)))}})}}else a=this.doc().body.innerHTML;var f="<font",j=!1;typeof Settings.ComposeColor!=
"undefined"&&(j=!0,f+=" color='"+Settings.ComposeColor+"'");typeof Settings.ComposeFontSize!="undefined"&&(j=!0,f+=" size='"+Settings.ComposeFontSize+"'");typeof Settings.ComposeFont!="undefined"&&(j=!0,f+=" face='"+Settings.ComposeFont+"'");f+=">";this.addDefaultFontStyles&&j&&(a=f+a+"</font>");a=a.replace(/<p /gi,"<div ").replace(/<p>/gi,"<div>").replace(/<\/p>/gi,"</div>");this.addNewLinesToRichContent&&(a=a.replace(/<div/gi,"\n<div").replace(/<\/div>/gi,"</div>\n").replace(/<br>/gi,"<br>\n"));
c.isIE&&(a=a.replace(/alt=">:O"/gi,'alt="&gt;:O"'));return a},getPlainContent:function(a){if(this.richMode){a||(a=!1);var c=this.isStationeryMode?this.doc().getElementById("role_body"):this.doc().body;(a=ws.html.renderedTextContent(c,a))&&a.length>0&&(a=a.replace(/\u00a0/g," "));return a}else return this.textarea.value},getStationeryContent:function(){if(this.isStationeryMode){var a=this.doc().getElementById("role_body");if(a)return a.innerHTML}return this.getContent()},getContent:function(){return this.richMode?
this.getRichContent():this.getPlainContent()},processBeforeSend:function(){return!1},boldClick:function(a){a.preventDefault();this.command("bold")},italicClick:function(a){a.preventDefault();this.command("italic")},underlineClick:function(a){a.preventDefault();this.command("underline")},horizontalRuleClick:function(a){a.preventDefault();this.command("inserthorizontalrule")},fontColorClick:function(a){a.preventDefault();this.dlgColorPalette("forecolor")},backgroundColorClick:function(a){a.preventDefault();
this.dlgColorPalette("hilitecolor")},smileyClick:function(a){a.preventDefault();this.dlgSmileyPalette()},linkClick:function(a){a.preventDefault();this.linkEditor=new ws.widget.LinkEditor({callbackFunc:c.hitch(this,this.linkEditorDone)});this.linkEditor.startup(this.ieEditorBookmark);this.linkEditor.show(this.win(),this.linkButton);ws.reporting.reportAction("Link Click")},linkEditorDone:function(a){a||this.setAuxDirty(!0);this.updateToolbar();this.refocusAfterPopup()},command:function(a,d,e,f){var g=
this.win();if(c.isMoz)try{g.document.execCommand("useCSS",!1,!0),(a=="hilitecolor"||a=="indent"||a=="outdent")&&g.document.execCommand("useCSS",!1,!1)}catch(j){}try{g.focus(),c.isIE&&this.isStationeryMode&&!f&&this.getFunmail().moveCursorToBodyRole(this.doc(),!0),g.document.execCommand(a,!1,d),g.focus()}catch(i){if(c.isFF==3&&this.isStationeryMode&&(a=="indent"||a=="outdent"||a.indexOf("justify")==0||a.indexOf("orderedlist")!=-1)&&i&&i.result==2147500037){var h=this.win().getSelection().getRangeAt(0),
d=g.document.createElement("br");d.style.lineHeight="0px";for(h=h.startContainer.parentNode;h&&h.contentEditable!="true";)h=h.parentNode;if(!h)throw"Selected node is not editable!";h.insertBefore(d,h.childNodes[0]);g.document.execCommand(a,!1,null);d.parentNode.removeChild(d)}}this._fixMe(a,f);e||(this.updateToolbar(),this.setAuxDirty(!0));return!0},changeFont:function(){c.isIE&&this.rng&&this.rng.select();this.fontPicker.menu&&this.fontPicker.menu.setChecked([this.fontPicker.currentIndex],!0);this.command("fontname",
this.fontPicker.currentValue)},changeFontSize:function(){c.isIE&&this.rng&&this.rng.select();this.fontSizePicker.menu&&this.fontSizePicker.menu.setChecked([this.fontSizePicker.currentIndex],!0);this.command("fontsize",this.fontSizePicker.currentValue)},changeJustify:function(){c.isIE&&this.rng&&this.rng.select();this.justifyPicker.menu.setChecked([this.justifyPicker.currentIndex],!0);this.command(this.justifyPicker.currentValue)},changeList:function(){c.isIE&&this.rng&&this.rng.select();this.listPicker.menu.setChecked([this.listPicker.currentIndex],
!0);this.command(this.listPicker.currentValue)},changeIndent:function(){c.isIE&&this.rng&&this.rng.select();this.command(this.indentPicker.currentValue)},htmlModeClick:function(){if(this.htmlMode){if(c.isIE){var a=escape(this.doc().body.innerText),a=a.replace("%3CP%3E%0D%0A%3CHR%3E","%3CHR%3E"),a=a.replace("%3CHR%3E%0D%0A%3C/P%3E","%3CHR%3E");this.doc().body.innerHTML=unescape(a)}else{var a=this.doc(),d=a.body.ownerDocument.createRange();d.selectNodeContents(a.body);a.body.innerHTML=d.toString()}this.htmlMode=
!1;c.removeClass(this.htmlmodeItem,"activated");if(this.isStationeryMode)this.doc().designMode="Off"}else if(d=this.getRichContent(),c.isIE?this.doc().body.innerText=d:(a=this.doc(),d=a.createTextNode(d),a.body.innerHTML="",a.body.appendChild(d)),this.htmlMode=!0,c.addClass(this.htmlmodeItem,"activated"),this.isStationeryMode)this.doc().designMode="On";this.focus()},dlgSmileyPalette:function(){this.setRange();if(!this.smileyPalette)this.smileyPalette=new ws.widget.SmileyPalette,this._supportingWidgets.push(this.smileyPalette),
this.smileyPalette.startup(),this.connect(this.smileyPalette,"onSmileyClicked","insertSmiley");this.smileyPalette.isShowing()?ws.widget.popup.close(this.smileyPalette):ws.widget.popup({popup:this.smileyPalette,around:this.smileyButton})},insertSmiley:function(a,d){ws.widget.popup.close(this.smileyPalette);var e=Config.SmileyImageExt==".gif"?19:25;this.insertHTML("<img src='"+d+"' alt='"+a+"' height="+e+" width="+e+">",c.isWebKit?!0:!1)},dlgColorPalette:function(a){this.setRange();this.palette=this[a+
"Palette"];if(!this.palette)this.palette=this[a+"Palette"]=new ws.widget.ColorPalette,this._supportingWidgets.push(this.palette),this.palette.startup(),this.connect(this.palette,"onPaletteClicked","setColor");this.palette.isShowing()?ws.widget.popup.close(this.palette):(ws.widget.popup({popup:this.palette,around:this[a+"Item"]}),this.currentCommand=a)},setColor:function(a){var d=this.currentCommand;if(c.isIE){d=="hilitecolor"&&(d="backcolor");var e=this.win();if(e.lastSelRange&&e.lastSelType!="Control")e=
e.lastSelRange,e.select(),this.command(d,a),e.collapse(!1),e.select()}else this.command(d,a)},createStationeryBtn:function(){if(Config.HasLocalFileSystem&&!this.stationaryItem)this.stationaryItem=c.create("a",{title:Config.Strings.StationeryTooltip,id:"stationeryBtn",className:"stationeryIcon rttLabel"},this.linkButton,"after"),c.create("div",{className:"rttIcon"},this.stationaryItem),c.create("span",{innerHTML:Config.Strings.Stationery,className:"rttLabel2"},this.stationaryItem),this.connect(this.stationaryItem,
"onclick","onClickStationeryBtn"),this.subscribe("stationery/close","onClickStationeryBtn"),c.publish("WSEditor/StationeryBtnCreated",[])},onClickStationeryBtn:function(a,c){this.loadServicePlugin({serviceId:"stationery",pluginId:"STATIONERY_AOL",apiMessage:"selectStationery",apiArgs:{name:c}})},updateServiceBtn:function(){},loadServicePlugin:function(a){if(a||a.pluginId)ws.WebSuite.SidePanel.showStationery()?c.addClass(this.stationaryItem,"activated"):c.removeClass(this.stationaryItem,"activated")},
initStationery:function(){this.subscribe("WSEditor/BodyClick",function(a){if(this.isStationeryMode&&a.event.target.contentEditable!="true"){var a=!0,d,e=null;if(c.isIE){if(d=this.doc().selection)try{var f=d.createRange(),e=d.type=="Control"?"":f.text}catch(g){}}else(d=this.win().getSelection())&&(e=d.toString());e!=null&&e!=""&&(a=!1);if(a)this._bodyClickTO=setTimeout(c.hitch(this,function(){this.getFunmail().moveCursorToBodyRole(this.doc())}),400)}});this.subscribe("WSEditor/BodyDblClick",function(){clearTimeout(this._bodyClickTO)})},
getFunmail:function(){if(!this.funmail)this.funmail=new ws.mail.funmail,this.funmail.setDocument(this.doc());return this.funmail},handleFeaturesDraft:function(){this.convertPicturesInMail();this.handleStationeryDraft()},handleStationeryDraft:function(){this.getContent();var a=c.query("table#role_layout",this.doc()),d=!1;a&&(a=a[0]);if(a)try{var e=a.parentNode.parentNode,d=c.query("> div",e.parentNode)[0]==e}catch(f){}if(d)this.isStationeryMode=!0,this.fixEditorForStationery(),this.getFunmail().postcardHandler(this.doc().body.innerHTML),
Config.UseOMS&&(a=this.doc().getElementById("role_body"))&&a.setAttribute("contentEditable","true"),ws.lang.setTimeout(this,"updateToolbar",500)},resetStationeryState:function(){this.isStationeryMode=!1;this.stationeryState=null},clearStationery:function(){if(this.hasStationeryDefaults())Settings.StationeryDefaults={name:null,swatchUrl:null,pluginId:null},ws.settings.saveNow({StationeryDefaults:Settings.StationeryDefaults});var a=this.getStationeryContent();this.resetStationeryState();this.setContent(a,
null,!1,!1,"");this.setAuxDirty(!0)},resetPlugins:function(a){if(this.richMode){var d=this.doc(),e;if(!c.isFF)this.focus(),d.body.scrollTop=0,d.body.scrollLeft=0,d.queryCommandState("bold")&&this.command("bold",null,!0),d.queryCommandState("italic")&&this.command("italic",null,!0),d.queryCommandState("underline")&&this.command("underline",null,!0),d.queryCommandState("justifyRight")?this.command("justifyRight",null,!0):d.queryCommandState("justifyCenter")&&this.command("justifyCenter",null,!0),d.queryCommandState("insertOrderedList")?
this.command("insertOrderedList",null,!0):d.queryCommandState("insertUnorderedList")&&this.command("insertUnorderedList",null,!0);if(a.ComposeFontSize)for(e=0;e<this.fontSizePicker.options.length;e++){if(this.fontSizePicker.options[e].value==a.ComposeFontSize){e=c.isSafari?this.fontSizePicker.options[e].safari:this.fontSizePicker.options[e].other;d.body.style.fontSize=e.replace(/ /g,"");break}}else e=c.isSafari?this.fontSizePicker.options[0].safari:this.fontSizePicker.options[0].other,d.body.style.fontSize=
e.replace(/ /g,"");d.body.style.fontFamily=a.ComposeFont?a.ComposeFont:this.fontPicker.options[0].value;d.body.style.color=a.ComposeColor?a.ComposeColor:"rgb(0, 0, 0)";c.isFF||(this.command(c.isIE?"backcolor":"hilitecolor","transparent",!0),this.updateToolbar(null,!0),this.setAuxDirty(!1))}},resetCursor:function(a){a==void 0&&(a=!1);var d=this.doc(),e;e=this.win();if(this.richMode)if(c.isIE)e=d.body.createTextRange(),e.collapse(a),e.select();else{var f=e.getSelection();e=d.createRange();if((b=d.body||
d.getElementsByTagName("body"))&&b.length)e.selectNode(b[0]),e.collapse(a),f.removeAllRanges(),f.addRange(e)}else if(!(c.isIE&&c.isIE<=8)&&(d=this.textarea)&&d.style.display!="none")this.textarea.focus(),a?this.textarea.setSelectionRange(0,0):(a=d.value.length)?this.textarea.setSelectionRange(--a,a):this.textarea.setSelectionRange(0,0)},reset:function(a,d){var e=a?a:Settings;if(this.richMode)this.resetPlugins(e);else{if(c.isIE==7)this.toolbarPane.style.width=c.coords(this.richTextButton).w+34+"px";
this.richTextButton.style.borderRightWidth=0}d&&this.resetCursor(!0);this.resizeToolBar()},insertStationery:function(a){if(a.url=="")return this.clearStationery();c.xhrGet({url:Config.BasePagesURL+"common/proxy.aspx/stationery",content:{url:a.url},timeout:5E3,handleAs:"text",load:c.hitch(this,function(c){this._loadStationeryTemplate(c,a)}),error:function(){}})},_loadStationeryTemplate:function(a,c){this.isStationeryMode=!0;this.stationeryState=c;this.fixEditorForStationery();this.getFunmail().postcardHandler(a);
this.setAuxDirty(!0);ws.lang.setTimeout(this,"updateToolbar",500)},fixEditorForStationery:function(){try{if(this.isStationeryMode){this.doc().body.style.padding="0";if(c.isIE){if(!this.win().lastSelRange){var a=this.doc().getElementById("role_body");a&&(a.focus(),this.onBeforeDeactivate())}}else this.doc().designMode="on",this.doc().designMode="off";this.doc().body.setAttribute("contentEditable","false");this.doc().body.setAttribute("unselectable","on")}else{this.doc().body.style.padding="15px 15px 15px 15px";
if(!c.isIE)this.doc().designMode="off",this.doc().designMode="on";this.doc().body.setAttribute("contentEditable","true");this.doc().body.setAttribute("unselectable","off")}}catch(d){}},insertHTML:function(a,d,e){var f=this.win();f.focus();c.isIE?(this.isStationeryMode&&!d&&this.getFunmail().moveCursorToBodyRole(this.doc(),!0,!0),f=d&&f.lastSelRange?f.lastSelRange:f.document.selection.createRange(),this.win().lastSelType!="Control"&&(f.pasteHTML(a),f.collapse(!1),f.select())):(this.isStationeryMode&&
(!c.isWebKit||!d)&&this.doc().getElementById("role_body").focus(),e&&!c.isFF?(d=f.getSelection(),d.isCollapsed||d.deleteFromDocument(),d=d.getRangeAt(0),!d.collapsed&&d.collapse(),a.charAt(0)!="<"&&(a="<span>"+a+"</span>"),a=c._toDom(a,f.document),e=a.firstChild.firstChild,d.insertNode(a.firstChild),d.selectNode(e),f=f.getSelection(),f.removeAllRanges(),f.addRange(d),f.collapseToEnd()):f.document.execCommand("insertHTML",!1,a));this.setAuxDirty(!0);this.updateToolbar(null,!0,!0);this.refocusAfterPopup()},
refocusAfterPopup:function(){c.isWebKit?ws.lang.setTimeout(c.hitch(this,function(){document.body.focus();ws.lang.setTimeout(c.hitch(this,function(){this.win().focus()}),100)}),100):c.isFF>=3&&this.win().focus()},setRange:function(){var a=this.win();this.focus();if(c.isIE){if(a=a.document.selection,a!=null)this.rng=a.createRange()}else a=a.getSelection(),this.rng=a.getRangeAt(a.rangeCount-1).cloneRange();return this.rng},onBeforeDeactivate:function(){this.ieEditorBookmark=null;var a=this.doc().selection,
c=a.createRange();a.type=="Control"?this.win().lastSelNode=c.item(0):this.ieEditorBookmark=c.getBookmark();this.win().lastSelType=a.type;this.win().lastSelRange=c},ieKeyDown:function(){var a=this.win().event,d=!1;if(a.keyCode==8){var e=this.doc().selection;e&&e.type=="Control"&&((d=e.createRange().item(0))&&d.parentNode&&d.parentNode.removeChild(d),d=!0)}if(a.ctrlKey&&a.keyCode==13)this.sendMessage(),d=!0;else if(a.altKey&&a.keyCode==187)this.spellCheck(),d=!0;else if(a.altKey)switch(String.fromCharCode(a.keyCode).toLowerCase()){case Config.Strings.KeyComposeClose:this.cancel(),
d=!0}else if(a.ctrlKey&&a.keyCode>=65&&a.keyCode<=90)switch(String.fromCharCode(a.keyCode).toLowerCase()){case Config.Strings.KeyComposeBold:this.command("bold",null);d=!0;break;case Config.Strings.KeyComposeItalic:this.command("italic",null);d=!0;break;case Config.Strings.KeyComposeUnderline:this.command("underline",null),d=!0}else if(a.keyCode==13&&c.isIE==9){var e=this.doc().selection,f=(e=e.createRange())?e.parentElement():null;f&&f.tagName=="P"&&!f.firstChild&&(e.pasteHTML("<br />"),d=!0)}else!a.shiftKey&&
a.keyCode===c.keys.TAB&&(this.insertTab(),d=!0);if(d)return a.cancelBubble=!0,a.returnValue=!1},webkitKeyPress:function(a){var d=!1,e=ws.html.fixKeyCodeForMac(a);a.ctrlKey?e==c.keys.ENTER&&(this.sendMessage(),d=!0):a.altKey&&(e==187?(this.spellCheck(),d=!0):e==88&&(this.cancel(),d=!0));d&&c.stopEvent(a)},geckoKeyPress:function(a){var d=!1;if(a.ctrlKey){switch(String.fromCharCode(a.charCode).toLowerCase()){case Config.Strings.KeyComposeBold:this.command("bold",null);d=!0;break;case Config.Strings.KeyComposeItalic:this.command("italic",
null);d=!0;break;case Config.Strings.KeyComposeUnderline:this.command("underline",null),d=!0}if(a.keyCode==13||a.keyCode==77&&c.isMac)this.sendMessage(),d=!0}else if(a.altKey)switch(a.keyChar.toLowerCase()){case Config.Strings.KeyComposeClose:this.cancel();d=!0;break;case "=":this.spellCheck(),d=!0}else!a.shiftKey&&a.keyCode===c.keys.TAB&&(this.insertTab(),d=!0);d&&(a.preventDefault(),a.stopPropagation())},insertTab:function(){this.insertHTML("&nbsp;&nbsp;&nbsp;&nbsp;",!1)},cancel:function(){},sendMessage:function(){},
updateToolbar:function(a,d){var e=!1;a&&a.type=="mouseup"&&(e=!0);var f=ws.WebSuite.SidePanel;this.stationaryItem&&f&&(f.isSelectedPanel(f.stationery)?c.addClass(this.stationaryItem,"activated"):c.removeClass(this.stationaryItem,"activated"));this.updateToolbarTimeout&&clearTimeout(this.updateToolbarTimeout);d?this._updateToolbar(e):this.updateToolbarTimeout=ws.lang.setTimeout(c.hitch(this,"_updateToolbar",e),300)},compareFontFamilyStr:function(a,d){var e=a.toLowerCase().split(","),f=d.toLowerCase().split(","),
g=c.trim(e[0]),j=c.trim(f[0]);if(g==j)return!0;else if(g=="arial"&&f[1]&&c.trim(f[1])==g&&j=="helvetica"&&e[1]&&c.trim(e[1])==j)return!0;else if(g=="helvetica"&&f[1]&&c.trim(f[1])==g&&j=="arial"&&e[1]&&c.trim(e[1])==j)return!0;return!1},_updateToolbar:function(a){try{var d=this.doc(),e=!0,f,g=null;if(c.isIE){if(f=this.doc().selection)var j=f.createRange(),g=f.type=="Control"?"":j.text}else(f=this.win().getSelection())&&(g=f.toString());g!=null&&g!=""&&(e=!1);var i=d.queryCommandValue("fontname");
f=!1;g=0;if(i)for(var h=0;h<this.fontPicker.options.length;h++)this.fontPicker.options[h].checked=!1,!f&&this.compareFontFamilyStr(this.fontPicker.options[h].value,i)&&(g=h,f=!0);if(!f){if(typeof Settings.ComposeFont!="undefined")for(h=0;h<this.fontPicker.options.length;h++)if(this.compareFontFamilyStr(this.fontPicker.options[h].value,Settings.ComposeFont)){g=h;break}this.addDefaultFontStyles&&e&&this.command("fontname",this.fontPicker.options[g].value,!0,a)}this.fontPicker.setOption(g);this.fontPicker.menu?
this.fontPicker.menu.setChecked([g],!0):(this.fontPicker.options[0].checked=!1,this.fontPicker.options[g].checked=!0);var k=d.queryCommandValue("fontsize");f=!1;var m=this.isStationeryMode?2:1;if(!(k==null||k==""))for(h=0;h<this.fontSizePicker.options.length;h++){this.fontSizePicker.options[h].checked=!1;var p=c.isSafari?this.fontSizePicker.options[h].safari:this.fontSizePicker.options[h].value;!f&&k==p&&(m=h,f=!0)}if(!f&&typeof Settings.ComposeFontSize!="undefined")for(h=0;h<this.fontSizePicker.options.length;h++)if(this.fontSizePicker.options[h].value==
Settings.ComposeFontSize){m=h;break}this.fontSizePicker.setOption(m);!f&&this.addDefaultFontStyles&&e&&this.command("fontsize",this.fontSizePicker.currentValue,!0,a);this.fontSizePicker.menu?this.fontSizePicker.menu.setChecked([m],!0):(this.fontSizePicker.options[1].checked=!1,this.fontSizePicker.options[m].checked=!0);a=["justifyleft","justifycenter","justifyright"];this.justifyPicker.menu&&this.justifyPicker.menu.setUnchecked();for(h=0;h<a.length;h++)if(d.queryCommandState(a[h])){this.justifyPicker.menu&&
this.justifyPicker.menu.setChecked([h],!0);this.justifyPicker.domNode.className="wsSelect "+a[h]+"Icon";break}else this.justifyPicker.menu&&this.justifyPicker.menu.setChecked([0],!0),this.justifyPicker.domNode.className="wsSelect justifyleftIcon";c.toggleClass(this.justifyPicker.domNode,"activated",!0);h=["bold","italic","underline"];for(a=0;a<h.length;a++){var o=this[h[a]+"Item"],n=d.queryCommandState(h[a]);c.toggleClass(o,"activated",n)}o=["insertorderedlist","insertunorderedlist"];this.listPicker.menu&&
this.listPicker.menu.setUnchecked();for(n=0;n<o.length;n++)if(d.queryCommandState(o[n])){this.listPicker.menu&&this.listPicker.menu.setChecked([n],!0);this.listPicker.domNode.className="wsSelect "+o[n]+"Icon";c.toggleClass(this.listPicker.domNode,"activated",!0);break}else c.toggleClass(this.listPicker.domNode,"activated",!1)}catch(q){}},onResized:function(){this.inherited(arguments);if(this.stationaryItem&&this.richMode)if(ws.WebSuite.widthMode==1)c.style(this.stationaryItem,"display","none");else{c.style(this.stationaryItem,
"display","");var a=c.marginBox(this.toolbarPaneParent.domNode).w,d=c.marginBox(this.toolbarPane).w;this.stationaryLabelNode=this.stationaryLabelNode||c.query(".rttLabel2",this.stationaryItem)[0];this.stationeryButtonWidth=this.stationeryButtonWidth||c.marginBox(this.stationaryItem).w;if(this.stationaryLabelNode.style.display!="none"){if(a-d<=0)this.stationaryLabelNode.style.display="none",c.replaceClass(this.stationaryItem,"rttLabelOff","rttLabel")}else if(a-(d-32+this.stationeryButtonWidth)>0)c.replaceClass(this.stationaryItem,
"rttLabel","rttLabelOff"),this.stationaryLabelNode.style.display=""}this.resizeToolBar();this.richMode||(d=c.coords(this.textarea.parentNode),a=d.w-(c.isFF?18:28),d=d.h-15,c.isFF&&(d-=10),c.style(this.textarea,{width:(a<=0?0:a)+"px",height:(d<=0?0:d)+"px",margin:"0",padding:"15px 10px",overflow:"auto",fontFamily:"Helvetica,Arial,sans-serif"}))},focus:function(){this.richMode?this.win().focus():this.textarea.focus()},onFocusHandler:function(){c.publish("WSEditor/focus",[])},selectNode:function(a){if(a)if(c.isIE){var d=
this.doc().body.createTextRange();try{d.moveToElementText(a),d.collapse(!0),d.select()}catch(e){}}else{var f=this.win().getSelection(),d=this.doc().createRange();d.selectNode(a);d.collapse(!0);f.removeAllRanges();f.addRange(d)}},_fixMe:function(a,d){c.isIE&&this.isStationeryMode&&!d&&this.getFunmail().moveCursorToBodyRole(this.doc(),!0)},win:function(){return this.iframe.contentWindow},doc:function(){return c.io.iframe.doc(this.iframe)},onIframeLoaded:function(){this.iframe._loaded=!0}});if(!c._hasResource["ws.AboutMe"])c._hasResource["ws.AboutMe"]=
!0,c.provide("ws.AboutMe"),ws.AboutMe={alreadySeenMap:{},clearSeenTimer:null,ownerCheckDone:!1,ownerHasProfile:!1,ownerProfile:null,search:function(a,d,e){if(!this.clearSeenTimer)this.clearSeenTimer=setInterval(function(){ws.AboutMe.alreadySeenMap={}},Config.AboutMeExcludeTimeout*1E3);for(var f=[],g={},j=0;j<a.length;j++){var i=a[j].toLowerCase();if(!this.alreadySeenMap[i]&&!g[i]&&(g[i]=!0,f.push(i),f.length>=Config.AboutMeMaxEmailReq))break}this.ownerCheckDone||(f=[Settings.ActiveUserEmailAddress].concat(f));
f.length==0?d&&d(null):(a=f.join(","),c.io.script.get({callbackParamName:"callback",timeout:e?Config.AboutMeRPCLongTimeout:Config.AboutMeRPCTimeout,url:Config.AboutMeJSONPurl,content:{email:a},load:c.hitch(this,function(a){a&&a.status==200&&a.result?this.processResults(a.result,d):d&&d(null)}),error:function(){d&&d(null)}}))},addToSeenMap:function(a){a&&(this.alreadySeenMap[a]=!0)},processResults:function(a,c){if(!this.ownerCheckDone){this.ownerCheckDone=!0;for(var e=Settings.ActiveUserEmailAddress.toLowerCase(),
f=0;f<a.length;f++)if(a[f].email_address&&a[f].email_address==e){this.ownerHasProfile=!0;this.ownerProfile=a[f];a.splice(f,1);break}}for(f=0;f<a.length;f++)e=a[f],e.thumbnail1==null&&e.thumbnail2==null&&a.splice(f,1);c&&c(a)}};c._hasResource["ws.suite.SignatureDialog"]||(c._hasResource["ws.suite.SignatureDialog"]=!0,c.provide("ws.suite.SignatureDialog"),c.declare("ws.suite.SignatureDialog",[ws.widget.WSModalPane,k._Templated],{widgetsInTemplate:!0,_earlyTemplatedStartup:!0,templateString:c.cache("ws.suite",
"SignatureDialog.html",'<div class="WSModalPane signatureDlg">\r\n\t<div class="WSModalPaneInner">\r\n\t\t<img src="${spacer}" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick:hideDlg">\r\n\t\t<div class="modalContainer">\r\n\t\t\t<div class="content" dojoAttachPoint="content" >\r\n\t\t\t\t<div  dojoAttachPoint="signatureTitle" class="signatureTitle">${SignatureDlg_title}</div>\r\n\t\t\t\t<div class="subtext">${SignatureDlg_subTitle}</div>\r\n\t\t\t\t\r\n\t\t\t\t<div dojoType="ws.widget.WSEditor" dojoAttachPoint="SignatureTextarea" addDefaultFontStyles="false" addNewLinesToRichContent="false" showAttachFile="false" showRichTextButton="false" doForceRichMode="true" isStationeryMode="false" style="height:120px"></div>\r\n\t\t\t\t<div dojoAttachPoint="addAboutMeLink" dojoAttachEvent="onclick:addOrGetAboutMe" class="addAboutMeLink wsLink">${SignatureDlg_addAboutMeLink}</div>\r\n\t\t\t\t<div dojoAttachPoint="tbPlaceHolder" class="tbPlaceHolder">&nbsp</div>\r\n\t\t\t\t<div  dojoAttachPoint="sgDgToolbar" class="wsToolBar" dojoType="ws.widget.WSToolbar" vizType="Bare" style="display:none">\r\n\t\t\t\t\t<div class="btn" dojoType="ws.widget.Button" toolbarposition="right" dojoAttachPoint="saveBtn" dojoAttachEvent="onClick:saveBtnClick" tabindex="2">&nbsp;&nbsp;&nbsp;${SignatureDlg_saveSig}&nbsp;&nbsp;&nbsp;</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},aboutMeLinksToCreate:!1,addReportDone:!1,OmnitureCustRep:"sig-promo-",OmnitureRepState:"",startup:function(){this.inherited(arguments);Settings.UserHash>=Config.SignatureDlgThreshold&&Settings.UserHash>=Config.AboutMeThreshold?ws.AboutMe.search([],c.hitch(this,this._startup),!0):Settings.UserHash>=Config.SignatureDlgThreshold&&this._startup(null)},_startup:function(){var a=!1,d=c.trim(Settings.Signature||"");d.toLowerCase()=="<br>"&&(d="");Settings.SignatureEnabled&&d&&(a=
!0);d=function(a){if(a.search(/<[^>]*>/gi)==-1){if(c.isWebKit||c.isFF)a=a.replace(/\r/g,"");a=a.replace(/\n/g,"<br/>")}return a}(d);if(ws.AboutMe.ownerCheckDone)if(a&&!ws.AboutMe.ownerHasProfile){ws.reporting.reportAction(this.OmnitureCustRep+"nomatch-sig-skipped");this._hideDlg();return}else!a&&ws.AboutMe.ownerHasProfile?(Settings.FromDisplayName&&(d+=Settings.FromDisplayName+"<br>"),d+=Settings.ActiveUserEmailAddress+"<br>",d+=this.getAboutMeProfile(),this.OmnitureRepState="match-nosig-"):a&&ws.AboutMe.ownerHasProfile?
(this.signatureTitle.innerHTML=Config.Strings.SignatureDlg_title2,d+="<br>"+this.getAboutMeProfile(),this.OmnitureRepState="match-sig-"):(this.addAboutMeLink.innerHTML=Config.Strings.SignatureDlg_createAboutMe,this.aboutMeLinksToCreate=!0,Settings.FromDisplayName&&(d+=Settings.FromDisplayName+"<br>"),d+=Settings.ActiveUserEmailAddress+"<br>",this.OmnitureRepState="nomatch-nosig-"),ws.reporting.reportAction(this.OmnitureCustRep+this.OmnitureRepState+"displayed");else if(a){ws.reporting.reportAction(this.OmnitureCustRep+
"sig-skipped");this._hideDlg();return}else this.addAboutMeLink.style.visibility="hidden",Settings.FromDisplayName&&(d+=Settings.FromDisplayName+"<br>"),d+=Settings.ActiveUserEmailAddress+"<br>",this.OmnitureRepState="nosig-",ws.reporting.reportAction(this.OmnitureCustRep+this.OmnitureRepState+"displayed");this.resize();this.show();this.SignatureTextarea.setContent(d,c.hitch(this,"_init"))},_init:function(){this.tbPlaceHolder.style.display="none";this.sgDgToolbar.domNode.style.display="block";var a=
this.SignatureTextarea.doc();if(a)a.body.style.paddingTop="18px";this.sgDgToolbar.resize();this.SignatureTextarea.resize()},saveBtnClick:function(){var a=this.SignatureTextarea.getRichContent()||"";Settings.Signature=a;Settings.SignatureEnabled=!0;Settings.SignatureDlgDisplayed=!0;ws.settings.saveSoon({SignatureDlgDisplayed:!0,SignatureEnabled:!0,Signature:a});ws.reporting.reportAction(this.OmnitureCustRep+this.OmnitureRepState+"saved");this.hide()},addOrGetAboutMe:function(){if(this.aboutMeLinksToCreate){var a=
ws.io.openWindow(Config.AboutMeCreateUrl,null,"");a&&a.focus();ws.reporting.reportAction(this.OmnitureCustRep+this.OmnitureRepState+"create");this._hideDlg()}else{if(!this.addReportDone)this.addReportDone=!0,ws.reporting.reportAction(this.OmnitureCustRep+this.OmnitureRepState+"added");this.addAboutMeProfile()}},getAboutMeProfile:function(){var a="";if(ws.AboutMe.ownerProfile&&ws.AboutMe.ownerProfile.profile)a=ws.AboutMe.ownerProfile.profile,a.toLowerCase().substr(0,7)=="http://"&&(a=a.substr(7)),
a=ws.string.substituteParams(Config.Strings.SignatureDlg_findMe,"<a style='color:#336699;text-decoration:none' target='_blank' href='"+ws.AboutMe.ownerProfile.profile+"'>"+a+"</>");return a},addAboutMeProfile:function(){var a=this.getAboutMeProfile(),c=this.SignatureTextarea.getRichContent()||"";a&&this.SignatureTextarea.setContent(c+"<br>"+a)},hideDlg:function(){ws.reporting.reportAction(this.OmnitureCustRep+this.OmnitureRepState+"cancelled");this._hideDlg()},_hideDlg:function(){Settings.SignatureDlgDisplayed=
!0;ws.settings.saveSoon({SignatureDlgDisplayed:!0});this.hide()}}));c._hasResource["ws.widget.BubblePin"]||(c._hasResource["ws.widget.BubblePin"]=!0,c.provide("ws.widget.BubblePin"),c.declare("ws.widget.BubblePin",[k._Widget,k._Templated],{templateString:c.cache("ws.widget","BubblePin.html",'<div class="BubblePin ${className}" dojoattachpoint="BubblePin" dojoattachevent="onclick: onClick" style="display: none">\r\n\t<div dojoattachpoint="bubblePart">\r\n\t\t<div class="padBox" dojoattachpoint="padBox">\r\n\t\t\t<div class="message" dojoattachpoint="message">\r\n\t\t\t</div>\r\n\t\t\t<button class="mainSprite wsCloseBtn" dojoAttachPoint="closeButton" dojoAttachEvent="onclick: closeTip"></button>\r\n\t\t\t<span class=\'hideTips\' dojoattachpoint="hideTips" dojoattachevent="onclick: closeVisiblePins" >${PinBubble_HideTheseQT}</span>\r\n\t\t\t<div dojoattachpoint="balloonArrowNode">\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="pinsSprite pin" dojoattachpoint="pin" dojoattachevent="onclick: expandTip" style="display: none">\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,name:"",content:"",delayOnShow:10,className:"",isPinBubble:!1,visBitMap:0,dimensions:{w:264,h:null},transSteps:[0,0.1,0.2,0.3,0.4,0.5,0.6,0.8,0.9,1],positionOverNode:document.body,offset:{x:0,y:0},arrowPosition:"top",distanceArrowFromEdge:10,saveAsSeenOnClose:!0,startup:function(){this.hide(0);this.className="BubblePin";this.arrowPosition=="top"?c.addClass(this.pin,"pinUp"):c.addClass(this.pin,"pinDown");this.positionOverNode&&
this.connect(window,"onresize","placeOnScreen");this.message.style.width=this.dimensions.w+"px";if(this.dimensions.height)this.message.style.height=this.dimensions.h+"px";if(this.balloonArrowNode!=null){var a=this.arrowPosition;c.isIE<=9&&this.arrowPosition=="top"&&(a="topIE7_9");c.addClass(this.balloonArrowNode,"pinsSprite balloonArrow "+a);this.setArrowPos()}if(this.message)this.message.innerHTML=this.content,c.forEach(c.query("a",this.message),function(a){c.addClass(a,"wsLink")});this.load&&this.load(this);
a=null;if(this.isPinBubble)this.pinTip(null,!0);else{if(this.message)this.message.style.padding="18px 33px 20px 20px";this.hideTips.style.display="none";this.expandTip(null,!0)}a=c.hitch(this,function(){this.show(0);this.placeOnScreen()});setTimeout(a,this.delayOnShow);if(c.isIE<=7)this.domNode.style.backgroundImage="url('"+Config.SpacerImageURL+"')",this.domNode.style.backgroundRepeat="repeat"},setArrowPos:function(){if(this.balloonArrowNode!=null)this.balloonArrowNode.style.left=this.distanceArrowFromEdge+
"px",this.pin.style.left=this.distanceArrowFromEdge-2+"px"},placeOnScreen:function(){if(this.domNodeUpdateFunc)if(this.domNodeUpdateFunc()){this.hide(2);return}else this.show(2);if(this.positionOverNode){var a=c.position(this.positionOverNode),d=this.offset.x,e=this.offset.y;this.arrowPosition=="bottom"&&this.domNode.style.display!="none"&&(e=-c.coords(this.domNode).h-14+this.offset.y);e=a.y+e;a=a.x+d;a<0?this.hide(1):this.show(1);k.placeOnScreen(this.domNode,{x:a,y:e},["TL"])}},hide:function(a){if(typeof a==
"number"&&(this.visBitMap|=Math.pow(2,a),a))this.dg=!0;this.inherited(arguments)},show:function(a){typeof a=="number"?(this.visBitMap&=~Math.pow(2,a),this.visBitMap===0&&this.inherited(arguments)):this.inherited(arguments)},isVisShowing:function(a){a=Math.pow(2,a);return!(this.visBitMap&a)==a},closeTip:function(){ws.widget.bubbleManager.closePinBubble(this,this.isPinBubble)},closeVisiblePins:function(){ws.widget.bubbleManager.closeVisiblePins()},setElementVis:function(a,c){a.style.visibility=c?"visible":
"hidden"},doTransStep:function(){c.style(this.bubblePart,"opacity",this.transSteps[this.transStep]);c.style(this.balloonArrowNode,"opacity",this.transSteps[this.transStep]);var a=this.transSteps.length-this.transStep;c.isIE<9&&(a=Math.max(0,a-3));c.style(this.pin,"opacity",this.transSteps[a]);this.transStep++;this.transStep<this.transSteps.length?setTimeout(c.hitch(this,this.doTransStep),50):this.setElementVis(this.pin,!1)},expandTip:function(a,c){this.transStep=5;this.isPinBubble&&(ws.widget.bubbleManager.pinAllTip(),
ws.reporting.reportAction("Onboarding-pin-"+this.name));this.pinned=!1;this.setElementVis(this.padBox,!0);this.setElementVis(this.message,!0);this.setElementVis(this.balloonArrowNode,!0);this.setElementVis(this.closeButton,!0);this.setElementVis(this.domNode,!0);this.domNode.style.zIndex="955";this.isPinBubble&&this.doTransStep();c||this.placeOnScreen()},pinTip:function(a,d){this.pinned=!0;c.style(this.bubblePart,"opacity",1);c.style(this.pin,"opacity",1);this.setElementVis(this.padBox,!1);this.setElementVis(this.message,
!1);this.setElementVis(this.balloonArrowNode,!1);this.setElementVis(this.closeButton,!1);this.setElementVis(this.domNode,!1);this.setElementVis(this.pin,!0);this.domNode.style.zIndex="950";this.pin.style.display="";d||this.placeOnScreen()},onClick:function(a){a.target.tagName=="A"&&this.closeTip()},isExisting:function(){return this.domNode}}));if(!c._hasResource["ws.widget.BubbleManager"]){c._hasResource["ws.widget.BubbleManager"]=!0;c.provide("ws.widget.BubbleManager");c.declare("ws.widget.BubbleManager",
null,{currentlyOpenFTUTip:null,requestedPins:{},activePins:{},upddateTimerHndl:null,setUp:function(){var a=document.getElementById("ws_application");a&&c.connect(a,"onscroll",this,this.updateAllPinsLocation);c.subscribe("toolbarLayoutUpdate",c.hitch(this,this.updateAllPinsLocation));c.subscribe("ListSpacingResize",c.hitch(this,this.updateAllPinsLocation))},upddateTimer:function(){this.upddateTimerHndl&&ws.bubbleConfig.allPinsSeen()?(clearInterval(this.upddateTimerHndl),this.upddateTimerHndl=null):
this.updateAllPinsLocation()},closePinBubble:function(a,c){ws.bubbleConfig.saveAsSeen(a.name);a.hide(0);c&&ws.bubbleConfig.allPinsSeen()&&this.showAllPinsClosedBubble()},closeVisiblePins:function(){ws.reporting.reportAction("Onboarding-pins-Hide-Pins");ws.bubbleConfig.setAllPinsHistory(!1);for(var a in ws.bubbleConfig.requestedPins)ws.bubbleConfig.requestedPins.hasOwnProperty(a)&&ws.bubbleConfig.hidePinBubble(a);ws.bubbleConfig.pinBubblesEnabled=!1;ws.bubbleConfig.allPinsSeen()&&this.showAllPinsClosedBubble();
ws.bubbleConfig.saveHistory()},showPinBubble:function(a,d){if(!this.upddateTimerHndl)this.upddateTimerHndl=setInterval(c.hitch(this,this.upddateTimer),300);var e=null;if(this.activePins[a])e=this.activePins[a],e.pinTip(),e.show(0),e.placeOnScreen();else{var e=null,f="top",g="",i=null,k=null,h=null,l=0,m=null;if(Config.BubblePins[a]&&Config.Strings["PinBubble_"+a]&&(e=Config.Strings["PinBubble_"+a])){Settings.FeatureNoticeVer==4&&Config.Strings["PinBubble_"+a+"2"]?e=Config.Strings["PinBubble_"+a+"2"]:
Settings.FeatureNoticeVer==5&&Config.Strings["PinBubble_"+a+"3"]&&(e=Config.Strings["PinBubble_"+a+"3"]);h={};if(e.indexOf("{TB}"!=-1))h.TB="<div class='bubbleTitle'>",h.TE="</div>";e=ws.string.substituteParams(e,h);Config.BubblePins[a].url&&(e+="<div class='watchVideDiv'><img class='pinsSprite videoIcon' src='"+Config.SpacerImageURL+"'><span class='BubblePin_videoLink'>"+Config.Strings.PinBubble_WatchVideo+"</span></div>");h=c.hitch(this,function(a){var d=c.query(".BubblePin_videoLink",a.message);
if(d.length)d[0].onclick=c.hitch(a,function(){var c=Config.BubblePins[a.name].url;ws.reporting.reportAction("Onboarding-pins-Watch-Video-"+a.name);window.open(c)})});switch(a){case "NewImTextBtns":g=7;i={w:220};k={x:3,y:48};m=function(){var a=ws.WebSuite.Navigation;if(a)this.positionOverNode=a.isMini?a.navToolbar:a.controlsPaneBtns};break;case "OptionsMenu":g=255;i={w:255};k={x:-252,y:30};break;case "MiniMods":g=0;f="bottom";i={w:365};k={x:0,y:0};l=200;m=function(){var a=ws.WebSuite.Navigation,d=
null;if(a)if(a.isMini){if(a.mnAppsDiv)d=a.mnAppsDiv,this.offset={x:1,y:12},this.distanceArrowFromEdge=6,this.setArrowPos()}else if(ws.WebSuite.Navigation&&ws.WebSuite.Navigation.splitContainer&&ws.WebSuite.Navigation.splitContainer.sizers[0]&&(a=c.query(".thumb",ws.WebSuite.Navigation.splitContainer.sizers[0]),a[0]))d=a[0],this.offset={x:-51,y:0},this.distanceArrowFromEdge=40,this.setArrowPos();if(d)this.positionOverNode=d;else return!0};break;case "MiniNavNub":g=30;i={w:300};k={x:-32,y:50};l=200;
m=function(){var a=ws.widget.bubbleManager.getPinByName("NewImTextBtns");if(a&&a.isShowing()&&!a.pinned)return!0;var a=c.byId("navCollapser"),d=ws.WebSuite.Navigation;if(d&&a&&!d.isMini&&!d.navCollapserHidden)return this.positionOverNode=a,!1;return!0};break;case "CustomizeMenu":g=225,i={w:240},k={x:-214,y:47},l=100}}e&&i&&(e=new ws.widget.BubblePin({isPinBubble:!0,name:a,delayOnShow:l,content:e,positionOverNode:d,arrowPosition:f,distanceArrowFromEdge:g,dimensions:i,offset:k,load:h,domNodeUpdateFunc:m}),
c.body().appendChild(e.domNode),this.activePins[a]=e,e.startup(),a==ws.bubbleConfig.openedPinId&&ws.bubbleConfig.openedPinNeeded&&e.expandTip())}},showAllPinsClosedBubble:function(){if(ws.bubbleConfig.isShowable("_ALL_CLOSED")){ws.reporting.reportAction("Onboarding-pins-All-Seen+Closed");var a=new ws.widget.BubblePin({name:"_ALL_CLOSED",content:Config.Strings.PinBubble_ClosedAllReminder,positionOverNode:ws.WebSuite.HatWidget.megaMenuNode,arrowPosition:"top",distanceArrowFromEdge:200,dimensions:{w:200},
offset:{x:-200,y:30}});c.body().appendChild(a.domNode);a.startup();ws.bubbleConfig.saveAsSeen("_ALL_CLOSED");this.allClosedBubble=a}},hidePinBubble:function(a){this.activePins[a]&&this.activePins[a].hide(0)},updatePinLocation:function(a){this.activePins[a]&&this.activePins[a].isVisShowing(0)&&this.activePins[a].placeOnScreen()},updateAllPinsLocation:function(){for(var a in this.activePins)this.activePins[a]&&this.activePins[a].isVisShowing(0)&&this.activePins[a].placeOnScreen()},getPinByName:function(a){if(this.activePins[a])return this.activePins[a];
return null},pinAllTip:function(){for(var a in this.activePins)this.activePins.hasOwnProperty(a)&&this.activePins[a].pinTip()}});ws.widget._bubbleManager=null;i=ws.widget;if(!ws.widget._bubbleManager)ws.widget._bubbleManager=new ws.widget.BubbleManager;i.bubbleManager=ws.widget._bubbleManager}c._hasResource["ws.layers.StartupPromoDlgs"]||(c._hasResource["ws.layers.StartupPromoDlgs"]=!0,c.provide("ws.layers.StartupPromoDlgs"))}}});

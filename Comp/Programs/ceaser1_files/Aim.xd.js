/* (C) 2012 AOL Inc. All Rights Reserved */
dojo._xdResourceLoaded(function(){return{depends:[["provide","ws.im.AddBuddyCard"],["provide","ws.im.EditGroupCard"],["provide","ws.im.BuddyList"],["provide","dojo.dnd.common"],["provide","dojo.dnd.autoscroll"],["provide","dojo.dnd.Mover"],["provide","dojo.dnd.Moveable"],["provide","dijit._CssStateMixin"],["provide","dijit.form._FormWidget"],["provide","dijit._HasDropDown"],["provide","dijit.form.Button"],["provide","dijit.form.ToggleButton"],["provide","dijit.layout.StackController"],["provide",
"dojox.layout.ResizeHandle"],["provide","ws.im.KnockKnock"],["provide","ws.im.Im"],["provide","ws.im.ImGroup"],["provide","ws.im.ImPanel"],["provide","ws.layers.Aim"]],defineResource:function(b,e,l){b._hasResource["ws.im.AddBuddyCard"]||(b._hasResource["ws.im.AddBuddyCard"]=!0,b.provide("ws.im.AddBuddyCard"),b.declare("ws.im.AddBuddyCard",[e._Widget,e._Templated],{templateString:b.cache("ws.im","AddBuddyCard.html",'<div class="addBuddyCard" dojoAttachEvent="onkeypress: onKeyPress" style="display: none;">\r\n\t<div class="addBuddyTitle" dojoAttachPoint="addBuddyTitle">${AddBuddyTitle}</div>\r\n\t<input class="wsInput" dojoAttachPoint="screenNameTextbox" value="${ScreenName}" tabindex="1"></input>\r\n\t<div dojoType="ws.widget.DefaultTextbox" tabindex="2" defaultValue="${IM_Nickname}" dojoAttachPoint="nickTextbox" class="nickname"></div>\r\n\t<div class="addNickExample">${IM_Nickname_Example}</div>\r\n\t<div dojoType="ws.widget.DropDownButton" dojoAttachPoint="groupSelect" class="groupSelect"></div>\r\n\t<div dojoType="ws.widget.Button" dojoAttachPoint="addButton" class="addButton" dojoAttachEvent="onClick: onClickAddButton">${Add}</div>\r\n\t<div class="wsLink" dojoAttachPoint="cancelBtn">${AddBuddy_Cancel}</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,edit:!1,_earlyTemplatedStartup:!0,newGroupInputMenu:null,startup:function(){this.groupSelect.dyn=!0},onOpen:function(){var a=[],c=null;b.forEach(ws.im.wim.groups,function(d){ws.im.wim.isEditableGroup(d)&&(c||(c=d),a.push({caption:ws.string.escapeXml(d.displayName),onClick:b.hitch(this,"setGroup",d.name,d.displayName)}))},this);a.push({separator:!0});a.push({className:"newGroupItem",caption:Config.Strings.Menu_AddGroup,_onClick:b.hitch(this,"newGroup")});
this.edit?this.setGroup(this.group,ws.im.wim.getGroup(this.group).displayName):c&&this.setGroup(c.name,c.displayName);this.groupSelect.setMenuDefinition(a);this.groupSelect.createMenu();this.newGroupInputMenu=null;this.edit?(this.screenNameTextbox.value=this.buddy.aimId,this.nickTextbox.setValue(this.buddy.friendly||"")):(this.screenNameTextbox.value=Config.Strings.AIM_ScreenName,this.nickTextbox.setValue(""),b.isMoz?(this.screenNameTextbox.style.overflow="hidden",ws.lang.setTimeout(this,function(){this.screenNameTextbox.style.overflow=
"auto";ws.html.selectInputText(this.screenNameTextbox)},0)):ws.html.selectInputText(this.screenNameTextbox));ws.lang.setTimeout(this,function(){this.edit?this.nickTextbox.textbox.focus():this.screenNameTextbox.focus();b.isMoz||ws.html.selectInputText(this.screenNameTextbox)},0);ws.reporting.reportAction("Add Buddy Win Open")},setupEdit:function(){this.edit=!0;this.screenNameTextbox.readOnly=!0;this.addButton.setLabel(Config.Strings.OK);this.addBuddyTitle.innerHTML=Config.Strings.EditBuddyTitle},setData:function(a,
c){this.buddy=a;this.group=c},setGroup:function(a,c){this._group=a;this.groupSelect.setLabel(c);this.groupSelect.resize()},setGroupCB:function(a){a=a.newName.substr(0,48);ws.lang.encode(a).length>48?(ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!0),ws.widget.Dialogs.ok(Config.Strings.AddGroup_Label_GroupNameTooLong),ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!1)):ws.lang.findByProp(ws.im.wim.groups,"displayName",a)!=-1?(ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,
"manual",!0),ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.AddGroup_Label_DuplicateGroupName,a)),ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!1)):this.setGroup(a,a)},newGroup:function(a){a&&a.stopPropagation();var c=this.groupSelect.menu;if(c){this.newGroupMenu=e.byNode(b.query(".newGroupItem",c.domNode)[0]);this.newGroupMenu.hide();if(this.newGroupInputMenu==null)this.newGroupInputMenu=new ws.widget.WSInputableMenuItem({okCB:b.hitch(this,"setGroupCB"),defaultValue:" ",
originalMenuItem:this.newGroupMenu,maxlength:48}),c.addChild(this.newGroupInputMenu);ws.lang.setTimeout(this,function(){this.newGroupInputMenu.show();if(b.isFF==2)c.domNode.style.minWidth="152px";this.newGroupInputMenu.initializeText("")},0)}},onCancel:function(){},onKeyPress:function(a){if(a.keyCode==b.keys.ENTER)this.onClickAddButton(a)},onClickAddButton:function(){if(this.edit){var a=this.nickTextbox.getValue(),c=this._group!=this.group;ws.im.wim.editBuddy({bn:this.buddy.aimId,dn:a!=this.buddy.friendly?
a:null,og:c?this.group:null,ng:c?this._group:null})}else c=this.screenNameTextbox.value,a=this.nickTextbox.getValue(),!c||c==Config.Strings.AIM_ScreenName?(ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!0),ws.widget.Dialogs.ok(Config.Strings.AddBuddy_Label_NoScreenName),ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!1)):(ws.im.wim.addBuddy(c,this._group,a),ws.WebSuite.Navigation.aim.addBuddy(),ws.reporting.reportAction("Add Buddy"))}}));b._hasResource["ws.im.EditGroupCard"]||
(b._hasResource["ws.im.EditGroupCard"]=!0,b.provide("ws.im.EditGroupCard"),b.declare("ws.im.EditGroupCard",[e._Widget,e._Templated],{templateString:b.cache("ws.im","EditGroupCard.html",'<div class="editGroupCard" style="display: none;">\r\n\t<input type="text" class="wsInput" maxlength="128" dojoAttachPoint="groupNameTextbox">\r\n\t<div class="buddyCount"><span dojoAttachPoint="buddyCount"></span></div>\r\n\t<div class="deleteIcon" dojoAttachPoint="deleteBtn"></div>\r\n\t<div dojoType="ws.widget.Button" dojoAttachPoint="saveButton" dojoAttachEvent="onClick: onClickSaveButton">${Save}</div>\r\n\t<div dojoAttachPoint="cancelBtn" class="wsLink cancelButton">${Cancel}</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,delHandler:null,setGroup:function(a){this._group=a},onOpen:function(){if(!this.delHandler)this.delHandler=this.connect(this.deleteBtn,"onclick","onClickDelete");var a=ws.lang.findByProp(ws.im.wim.groups,"name",this._group);if(a=ws.im.wim.groups[a])a=ws.string.substituteParams(Config.Strings.IM_Group_Buddycount,a.buddies.length),ws.html.setInnerText(this.buddyCount,a);this.groupNameTextbox.style.width=b._getMarginSize(this.domNode).w-52+"px";this.groupNameTextbox.focus();
this.groupNameTextbox.value=this._group;ws.html.selectInputText(this.groupNameTextbox)},onClickSaveButton:function(){ws.lang.encode(this.groupNameTextbox.value).length>48?(ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!0),ws.widget.Dialogs.ok(Config.Strings.AddGroup_Label_GroupNameTooLong),ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!1)):this.groupNameTextbox.value!=this._group&&(ws.im.wim.renameGroup(this._group,this.groupNameTextbox.value),ws.WebSuite.Navigation.aim.backToList())},
onClickDelete:function(){var a=ws.lang.findByProp(ws.im.wim.groups,"name",this._group),a=ws.im.wim.groups[a];ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!0);ws.widget.Dialogs.yesNo(ws.string.substituteParams(Config.Strings.DeleteGroup_Label,this._group,a.buddies.length),b.hitch(this,function(a){a&&(ws.im.wim.removeGroup(this._group),ws.WebSuite.Navigation.aim.backToList())}));ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!1);return!1}}));b._hasResource["ws.im.BuddyList"]||
(b._hasResource["ws.im.BuddyList"]=!0,b.provide("ws.im.BuddyList"),b.declare("ws.im.BuddyList",[e._Widget,e._Templated],{templateString:'<div class="buddyList">\t<div dojoAttachPoint="buddyListDisplay"></div>\t<div dojoAttachPoint="noMatchesNode" class="noMatches" style="display: none;">${NoMatchesFound}</div></div>',css:{templateString:""},buddyListDisplay:null,htmlIdMap:{},defIcon:Config.BaseImagesURL+"aimpanel/online.gif",currentBI:null,startup:function(){if(!this._started)this._started=!0,this._setOffline(),
ws.im.wim.listeners.push(this),b.subscribe("aimWimGroupNodeClicked",this,"groupNodeClicked"),b.subscribe("aimWimGroupNodeEdit",this,"groupNodeEdit"),b.subscribe("aimWimBuddyNodeClicked",this,"buddyNodeClicked"),b.subscribe("aimWimGroupNodeSignin",this,"groupNodeSignin"),b.subscribe("aimBuddyInfoClicked",this,"showBuddyInfo"),this.connect(this.domNode,"oncontextmenu","onContextMenu")},attachListEvents:function(){for(var a=b.query(".groupTitle",this.buddyListDisplay),c=0;c<a.length;c++)b.connect(a[c],
"onmouseover",b.hitch(this,this.onMouseOverItem,a[c])),b.connect(a[c],"onmouseout",b.hitch(this,this.onMouseOutItem,a[c]))},onContextMenu:function(a){b.stopEvent(a);var c=ws.widget.getEventTarget(a,"buddy","buddiesList");if(c&&c.id){this.contextMenu||this.createContextMenu();this.buddyData=this.htmlIdMap[c.id];var c=ws.im.wim.blockedBuddies[this.buddyData.aimId],d=this.contextMenu.getChildren();d[1].setShowing(!c);d[2].setShowing(c);this.contextMenu.open(a.pageX,a.pageY)}},onSessionEnd:function(){this._setOffline()},
onBuddyListLoad:function(){try{var a=ws.im.wim.groups,c=["<ul class='groupList'>"];if(a)for(var b=0;b<a.length;b++)c.push(this._getGroupHtml(a[b]));c.push("</ul>");this.buddyListDisplay.innerHTML=c.join("");this.attachListEvents()}catch(f){}},onMouseOverItem:function(a){a=b.query(".groupEdit",a);if(a.length>0)a[0].style.display=""},onMouseOutItem:function(a){a=b.query(".groupEdit",a);if(a.length>0)a[0].style.display="none"},onPresenceChanged:function(a){this.updateBuddy(a.aimId,a.oldValues);b.hasClass(this.domNode,
"buddyListQuickFind")&&e.registry.byClass("ws.im.ImPanel").first().quickFind()},onGroupRemoved:function(){b.publish("WSFeedbackStart",[Config.Strings.IM_Notice_GroupDeleted,!0])},onGroupRenamed:function(){b.publish("WSFeedbackStart",[Config.Strings.IM_Notice_GroupRenamed,!0])},onBuddyAdded:function(){b.publish("WSFeedbackStart",[Config.Strings.IM_Notice_BuddyAdded,!0])},onBuddyRemoved:function(){b.publish("WSFeedbackStart",[Config.Strings.IM_Notice_BuddyDeleted,!0])},groupNodeClicked:function(a){if((a=
ws.dom.findAncestorByClass(a,"groupItem"))&&!b.hasClass(a,"groupItemMatched")){var c=b.query(".buddiesList",a,"ul");c[0]&&(b.toggleClass(c[0],"buddiesCollapsed"),(c=ws.im.wim.getGroup(this.htmlIdMap[a.id].groupName))&&!c.isOfflineGroup&&ws.im.wim.setGroupCollapsed(c.name,!c.collapsed));(a=b.query(".groupTwisty",a))&&b.toggleClass(a[0],"groupTwistyClosed")}},groupNodeEdit:function(a){e.registry.byClass("ws.im.ImPanel").first().editGroup(this.htmlIdMap[a.parentNode.parentNode.id].groupName)},groupNodeSignin:function(){var a=
ws.im.wim.getServiceConfig("facebook")||{online:!1};a&&a.associated&&(a.notAuthorized||a.unableToConnect)?(a=ws.im.wim.getServiceUrls("facebook"))&&ws.io.openWindow(a.association,""):ws.im.wim.setServiceConnection("facebook",!0)},buddyNodeClicked:function(a){b.publish("aimWimBuddyClicked",[this.htmlIdMap[a.parentNode.id]])},_getGroupHtml:function(a){var c=[],b=ws.im.wim.getServiceConfig("facebook")||{online:!1},f=a.buddies,h=this.makeHtmlId(a.name),e=a.isOfflineGroup||a.collapsed,j=a.service&&!b.online?
" offlineService":"",i=ws.im.wim.isEditableGroup(a)?'<span class="groupEdit" onclick="dojo.publish(\'aimWimGroupNodeEdit\', [this]); return false;" style="display: none;">'+Config.Strings.Label_GroupEdit+"</span>":"";a.service&&!b.online&&(i='<span class="groupEdit" onclick="dojo.publish(\'aimWimGroupNodeSignin\', [this]); return false;" style="display: none;">'+Config.Strings.Label_Signin+"</span>");c.push('<li class="groupItem'+j+'" id="'+h+'"><h2 class="groupTitle" onmouseover="dojo.publish(\'aimBuddyInfoClicked\', [this, true]); dojo.stopEvent(event); return true;"><span class="groupLabel" id="'+
h+'-groupLink" onclick="dojo.publish(\'aimWimGroupNodeClicked\', [this]); return false;">','<img class="mainSprite groupTwisty',e?" groupTwistyClosed":"",'" src="'+Config.SpacerImageURL+'" border="0"/> ',ws.string.escapeXml(a.displayName),"</span>"+i+"</h2>");c.push(this._getBuddiesHtml(f,a,e));c.push("</li>");return c.join("")},_getBuddiesHtml:function(a,c,b){var f=[];if(a){var h=ws.im.wim.buddies;f.push('<ul id="'+this.makeHtmlId(c.name)+'-buddiesList" class="buddiesList '+(c.isOfflineGroup?" offlineGroup":
"")+(b?" buddiesCollapsed":"")+'">');for(b=0;b<a.length;b++)f.push(this._getBuddyHtml(h[a[b]],c));f.push("</ul>")}return f.join("")},_getBuddyHtml:function(a,c){var b="",f="onmouseover";a.service&&(b='<div class="mainSprite FBIcon"></div>',f="onclick");return['<li id="',this.makeHtmlId(c.name,a.aimId,a.friendly),'" class="buddy ',ws.im.wim.isStateOffline(a.state)?"buddy-offline":"",'"><h3 href="#" onclick="dojo.publish(\'aimWimBuddyNodeClicked\', [this]); return false;" onmouseover="dojo.publish(\'aimBuddyInfoClicked\', [this, true]); dojo.stopEvent(event); return true;"><img src="',
ws.im.wim.getMiniIconUrl(a),'" class="mainSprite icon buddyShadow" align="absmiddle" onerror="ws.im.BuddyList.prototype.miniIconFailed(this, \'',a.aimId,"')\">",a.service?"":'<div class="biStatus '+this.makePresenceStyle(a)+'"></div>','<span class="name">',ws.string.escapeXml(ws.im.wim.getDisplayId(a.aimId)),"</span>",'<div class="mainSprite biInfoIcon" '+f+"=\"dojo.publish('aimBuddyInfoClicked', [this]); dojo.stopEvent(event); return true;\"></div>",b,"</h3></li>"].join("")},updateBuddy:function(a){var c=
ws.im.wim.buddies[a];this._isGroupClosed(ws.im.wim._offlineGroupName);b.forEach(c.groups||[],function(d){if(d=b.byId(this.makeHtmlId(d,a,c.friendly))){var f="";d.className.match(/buddyMatched/i)!=null&&(f="buddyMatched ");d.className="buddy "+f+(ws.im.wim.isStateOffline(c.state)?"buddy-offline":"");if(f=b.query(".biStatus",d)[0])f.className="biStatus "+this.makePresenceStyle(c);b.query(".name",d)[0].innerHTML=c.friendly||c.displayId;b.query(".icon",d)[0].src=ws.im.wim.getMiniIconUrl(c);this.buddyInfo&&
d==this.currentBI&&this.buddyInfo.populate(d)}},this)},showBuddyInfo:function(a,c){var b=a?c?a.parentNode:a.parentNode.parentNode:this.domNode;if(!c||!this.buddyInfo||!(this.currentBI&&this.currentBI==b))if(c)ws.widget.popup.close(this.buddyInfo);else{this.currentBI=b;this.aimId=this.htmlIdMap[b.id].aimId;var f=ws.im.wim.buddies[this.aimId];if(f&&f.service)(b=ws.im.wim.getServiceUrls(ws.im.wim.buddies[this.aimId].service))&&ws.io.openWindow(b.profile+this.aimId,"");else{if(!this.buddyInfo)this.buddyInfo=
new ws.im.BuddyListHoverCard,this.buddyInfo.startup(),this.buddyInfo.buddyList=this;this.buddyInfo.populate(b);ws.widget.popup.close(this.contextMenu);ws.widget.popup({popup:this.buddyInfo,around:b,orient:{TR:"TL"},padding:[10,0]})}}},miniIconFailed:function(a,c){var b=ws.im.wim.buddies[c];if(!b.service&&b.userType!="icq")return this.defIcon;return Config.SpacerImageURL},makePresenceStyle:function(a){return"status-"+(ws.im.wim.isBuddyAllowed(a.aimId)?a.state:"blocked")},makeHtmlId:function(a,c,b){function f(a){return"_"+
a.charCodeAt(0).toString()}var h=(c||"").toLowerCase().replace(/\W/g,f),e=(a||"").toLowerCase().replace(/\W/g,f),b=(b||"").toLowerCase(),h="aimWim-"+e+"-"+h;this.htmlIdMap[h]={groupName:a,aimId:c,friendly:b};return h},_isGroupClosed:function(a){var a=b.byId(this.makeHtmlId(a)+"-buddiesList"),c=!a;a&&(c=b.hasClass(a,"buddiesCollapsed"));return c},_setOffline:function(){this.buddyListDisplay.innerHTML=""},quickFind:function(a){a=a.toLowerCase();b.toggleClass(this.domNode,"buddyListQuickFind",!!a);if(a){var c=
!1;b.forEach(ws.im.wim.groups,function(a){a.quickFindMatch=!1});for(var d=b.filter(this.buddyListDisplay.getElementsByTagName("li"),function(a){return a.className.indexOf("buddy")!=-1}),f=0;f<d.length;f++){var h=d[f],e=this.htmlIdMap[h.id],j=ws.im.wim.buddies[e.aimId],i=ws.im.wim.getGroup(e.groupName),k=j.state=="offline",k=i.isOfflineGroup?k:!k,e=!j.service&&e.aimId.indexOf(a)!=-1||e.friendly.indexOf(a)!=-1;b.toggleClass(h,"buddyMatched",k&&e);i.quickFindMatch=i.quickFindMatch||e&&k;c=c||e&&k}d=
b.filter(this.buddyListDisplay.getElementsByTagName("li"),function(a){return a.className.indexOf("groupItem")!=-1});for(f=0;f<d.length;f++)h=d[f],e=this.htmlIdMap[h.id],i=ws.im.wim.getGroup(e.groupName),b.toggleClass(h,"groupItemMatched",i.quickFindMatch);ws.html.setShowing(this.buddyListDisplay,c);ws.html.setShowing(this.noMatchesNode,!c)}else b.query(".groupItem",this.buddyListDisplay).removeClass("groupItemMatched"),b.query(".buddy",this.buddyListDisplay).removeClass("buddyMatched"),this.buddyListDisplay.style.display=
"",this.noMatchesNode.style.display="none"},createContextMenu:function(){var a=[{caption:Config.Strings.Label_GroupEdit,onClick:b.hitch(this,function(){ws.widget.popup.close(this.contextMenu);this.buddyData&&e.registry.byClass("ws.im.ImPanel").first().editBuddy(ws.im.wim.buddies[this.buddyData.aimId],this.buddyData.groupName)})},{caption:Config.Strings.KnockKnock_Label_Block,onClick:b.hitch(this,function(){ws.widget.popup.close(this.contextMenu);this.buddyData&&ws.im.wim.blockBuddy(this.buddyData.aimId)})},
{caption:Config.Strings.KnockKnock_Label_Unblock,onClick:b.hitch(this,function(){ws.widget.popup.close(this.contextMenu);this.buddyData&&ws.im.wim.unblockBuddy(this.buddyData.aimId)})},{caption:Config.Strings.Delete,onClick:b.hitch(this,function(){ws.widget.popup.close(this);var a=this,d=ws.im.wim.buddies[this.buddyData.aimId];ws.widget.Dialogs.yesNo(ws.string.substituteParams(Config.Strings.DeleteBuddy_Label,d.friendly||d.displayId),b.hitch(this,function(d){d&&(a.buddyData.groupName=="Offline"?b.forEach(ws.im.wim.buddies[a.buddyData.aimId].groups,
function(b){b!="Offline"&&ws.im.wim.removeBuddy(a.buddyData.aimId,b)}):ws.im.wim.removeBuddy(a.buddyData.aimId,a.buddyData.groupName));e.registry.byClass("ws.im.ImPanel").first().quickFind()}))})}];this.contextMenu=ws.widget.createMenu(a)}}),b.declare("ws.im.BuddyListHoverCard",[e._Widget,e._Templated],{templateString:b.cache("ws.im","BuddyListHoverCard.html",'<div class="buddyListHoverCard">\r\n\t<div class="aimId" dojoAttachPoint="aimIdNode"></div>\r\n\t<span class="biMsg" dojoAttachPoint="biMsg"></span> \r\n\t<div class="delete" dojoAttachPoint="biActions">\r\n\t\t<span class="wsLink" dojoAttachPoint="blockLink" dojoAttachEvent="onclick: onClickBlock">${KnockKnock_Label_Block}</span>\r\n\t\t<span class="wsLink" dojoAttachPoint="unblockLink" dojoAttachEvent="onclick: onClickUnblock">${KnockKnock_Label_Unblock}</span>\r\n\t\t<span class="pipe">&nbsp;</span><span class="wsLink edit" dojoAttachEvent="onclick: editBuddy" dojoAttachPoint="editLink">${Label_GroupEdit}</span>\r\n\t\t<span class="pipe">&nbsp;</span><span class="wsLink" dojoAttachPoint="deleteLink" dojoAttachEvent="onclick: onClickDelete">${Delete}</span>\r\n\t</div>\r\n\t<div class="mainSprite buddyInfoClose" dojoAttachEvent="onclick: closeInfo"></div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,buddyList:null,FBiconset:!1,startup:function(){if(!Config.EnableDeleteBuddy)this.deleteLink.style.display="none"},populate:function(a){this.hoverNode=a;this.aimId=this.buddyList.htmlIdMap[a.id].aimId;this.groupName=this.buddyList.htmlIdMap[a.id].groupName;var a=ws.im.wim.buddies[this.aimId],c=ws.im.wim.blockedBuddies[this.aimId],d=ws.im.wim.getDisplayId(this.aimId);ws.html.setShowing(this.aimIdNode,d&&!a.service);ws.html.setInnerText(this.aimIdNode,
this.aimId);ws.html.setShowing(this.biActions,!0);d=ws.im.wim.replaceMsgTokens(a.statusMsg||a.awayMsg||"").replace(/^\<div\>/,"").replace(/\<\/div\>$/,"");d.length==0?this.biMsg.style.display="none":(this.biMsg.style.display="",this.biMsg.innerHTML=d,this.biMsg.title=d.substr(0,80));b.query(".delete",this.domNode);d=!1;a.service&&(d=a.service=="facebook",ws.html.setShowing(this.biActions,!1));ws.html.setShowing(b.query(".FBProfile",this.domNode)[0],d);ws.html.setShowing(this.blockLink,!c);ws.html.setShowing(this.unblockLink,
c);return!0},onClickBlock:function(){ws.widget.popup.close(this);ws.im.wim.blockBuddy(this.aimId)},onClickUnblock:function(){ws.widget.popup.close(this);ws.im.wim.unblockBuddy(this.aimId)},onClickDelete:function(){ws.widget.popup.close(this);var a=this,c=ws.im.wim.buddies[this.aimId];ws.widget.Dialogs.yesNo(ws.string.substituteParams(Config.Strings.DeleteBuddy_Label,c.friendly||c.displayId),b.hitch(this,function(c){c&&(a.groupName=="Offline"?b.forEach(ws.im.wim.buddies[a.aimId].groups,function(c){c!=
"Offline"&&ws.im.wim.removeBuddy(a.aimId,c)}):ws.im.wim.removeBuddy(a.aimId,a.groupName));e.registry.byClass("ws.im.ImPanel").first().quickFind()}))},onClickProfile:function(){ws.widget.popup.close(this);var a=ws.im.wim.getServiceUrls(ws.im.wim.buddies[this.aimId].service);a&&ws.io.openWindow(a.profile+this.aimId,"")},editBuddy:function(){ws.widget.popup.close(this);e.registry.byClass("ws.im.ImPanel").first().editBuddy(ws.im.wim.buddies[this.aimId],this.groupName)},onOpen:function(){if(!this.arrow)this.arrow=
b.create("div",{className:"mainSprite buddyInfoArrow"},b.body());var a=b.position(this.hoverNode);b.marginBox(this.arrow,{l:a.x+a.w,t:a.y-4+a.h/2});this.arrow.style.display="block"},onClose:function(){this.arrow.style.display="none"},closeInfo:function(){ws.widget.popup.close(this)}}));if(!b._hasResource["dojo.dnd.common"])b._hasResource["dojo.dnd.common"]=!0,b.provide("dojo.dnd.common"),b.getObject("dnd",!0,b),b.dnd.getCopyKeyState=b.isCopyKey,b.dnd._uniqueId=0,b.dnd.getUniqueId=function(){var a;
do a=b._scopeName+"Unique"+ ++b.dnd._uniqueId;while(b.byId(a));return a},b.dnd._empty={},b.dnd.isFormElement=function(a){a=a.target;if(a.nodeType==3)a=a.parentNode;return" button textarea input select option ".indexOf(" "+a.tagName.toLowerCase()+" ")>=0};if(!b._hasResource["dojo.dnd.autoscroll"])b._hasResource["dojo.dnd.autoscroll"]=!0,b.provide("dojo.dnd.autoscroll"),b.getObject("dnd",!0,b),b.dnd.getViewport=b.window.getBox,b.dnd.V_TRIGGER_AUTOSCROLL=32,b.dnd.H_TRIGGER_AUTOSCROLL=32,b.dnd.V_AUTOSCROLL_VALUE=
16,b.dnd.H_AUTOSCROLL_VALUE=16,b.dnd.autoScroll=function(a){var c=b.window.getBox(),d=0,f=0;if(a.clientX<b.dnd.H_TRIGGER_AUTOSCROLL)d=-b.dnd.H_AUTOSCROLL_VALUE;else if(a.clientX>c.w-b.dnd.H_TRIGGER_AUTOSCROLL)d=b.dnd.H_AUTOSCROLL_VALUE;if(a.clientY<b.dnd.V_TRIGGER_AUTOSCROLL)f=-b.dnd.V_AUTOSCROLL_VALUE;else if(a.clientY>c.h-b.dnd.V_TRIGGER_AUTOSCROLL)f=b.dnd.V_AUTOSCROLL_VALUE;window.scrollBy(d,f)},b.dnd._validNodes={div:1,p:1,td:1},b.dnd._validOverflow={auto:1,scroll:1},b.dnd.autoScrollNodes=function(a){for(var c=
a.target;c;){if(c.nodeType==1&&c.tagName.toLowerCase()in b.dnd._validNodes){var d=b.getComputedStyle(c);if(d.overflow.toLowerCase()in b.dnd._validOverflow){var f=b._getContentBox(c,d),d=b.position(c,!0),h=Math.min(b.dnd.H_TRIGGER_AUTOSCROLL,f.w/2),e=Math.min(b.dnd.V_TRIGGER_AUTOSCROLL,f.h/2),j=a.pageX-d.x,i=a.pageY-d.y,k=d=0;if(b.isWebKit||b.isOpera)j+=b.body().scrollLeft,i+=b.body().scrollTop;j>0&&j<f.w&&(j<h?d=-h:j>f.w-h&&(d=h));i>0&&i<f.h&&(i<e?k=-e:i>f.h-e&&(k=e));f=c.scrollLeft;h=c.scrollTop;
c.scrollLeft+=d;c.scrollTop+=k;if(f!=c.scrollLeft||h!=c.scrollTop)return}}try{c=c.parentNode}catch(l){c=null}}b.dnd.autoScroll(a)};b._hasResource["dojo.dnd.Mover"]||(b._hasResource["dojo.dnd.Mover"]=!0,b.provide("dojo.dnd.Mover"),b.declare("dojo.dnd.Mover",null,{constructor:function(a,c,d){this.node=b.byId(a);var f=c.touches?c.touches[0]:c;this.marginBox={l:f.pageX,t:f.pageY};this.mouseButton=c.button;c=this.host=d;a=a.ownerDocument;this.events=[b.connect(a,"onmousemove",this,"onFirstMove"),b.connect(a,
"ontouchmove",this,"onFirstMove"),b.connect(a,"onmousemove",this,"onMouseMove"),b.connect(a,"ontouchmove",this,"onMouseMove"),b.connect(a,"onmouseup",this,"onMouseUp"),b.connect(a,"ontouchend",this,"onMouseUp"),b.connect(a,"ondragstart",b.stopEvent),b.connect(a.body,"onselectstart",b.stopEvent)];if(c&&c.onMoveStart)c.onMoveStart(this)},onMouseMove:function(a){b.dnd.autoScroll(a);var c=this.marginBox,d=a.touches?a.touches[0]:a;this.host.onMove(this,{l:c.l+d.pageX,t:c.t+d.pageY},a);b.stopEvent(a)},
onMouseUp:function(a){(b.isWebKit&&b.isMac&&this.mouseButton==2?a.button==0:this.mouseButton==a.button)&&this.destroy();b.stopEvent(a)},onFirstMove:function(a){var c=this.node.style,d,f=this.host;switch(c.position){case "relative":case "absolute":d=Math.round(parseFloat(c.left))||0;c=Math.round(parseFloat(c.top))||0;break;default:c.position="absolute";c=b.marginBox(this.node);d=b.doc.body;var e=b.getComputedStyle(d),g=b._getMarginBox(d,e),e=b._getContentBox(d,e);d=c.l-(e.l-g.l);c=c.t-(e.t-g.t)}this.marginBox.l=
d-this.marginBox.l;this.marginBox.t=c-this.marginBox.t;if(f&&f.onFirstMove)f.onFirstMove(this,a);b.disconnect(this.events.shift());b.disconnect(this.events.shift())},destroy:function(){b.forEach(this.events,b.disconnect);var a=this.host;if(a&&a.onMoveStop)a.onMoveStop(this);this.events=this.node=this.host=null}}));b._hasResource["dojo.dnd.Moveable"]||(b._hasResource["dojo.dnd.Moveable"]=!0,b.provide("dojo.dnd.Moveable"),b.declare("dojo.dnd.Moveable",null,{handle:"",delay:0,skip:!1,constructor:function(a,
c){this.node=b.byId(a);c||(c={});this.handle=c.handle?b.byId(c.handle):null;if(!this.handle)this.handle=this.node;this.delay=c.delay>0?c.delay:0;this.skip=c.skip;this.mover=c.mover?c.mover:b.dnd.Mover;this.events=[b.connect(this.handle,"onmousedown",this,"onMouseDown"),b.connect(this.handle,"ontouchstart",this,"onMouseDown"),b.connect(this.handle,"ondragstart",this,"onSelectStart"),b.connect(this.handle,"onselectstart",this,"onSelectStart")]},markupFactory:function(a,c){return new b.dnd.Moveable(c,
a)},destroy:function(){b.forEach(this.events,b.disconnect);this.events=this.node=this.handle=null},onMouseDown:function(a){if(!this.skip||!b.dnd.isFormElement(a)){if(this.delay){this.events.push(b.connect(this.handle,"onmousemove",this,"onMouseMove"),b.connect(this.handle,"ontouchmove",this,"onMouseMove"),b.connect(this.handle,"onmouseup",this,"onMouseUp"),b.connect(this.handle,"ontouchend",this,"onMouseUp"));var c=a.touches?a.touches[0]:a;this._lastX=c.pageX;this._lastY=c.pageY}else this.onDragDetected(a);
b.stopEvent(a)}},onMouseMove:function(a){var c=a.touches?a.touches[0]:a;if(Math.abs(c.pageX-this._lastX)>this.delay||Math.abs(c.pageY-this._lastY)>this.delay)this.onMouseUp(a),this.onDragDetected(a);b.stopEvent(a)},onMouseUp:function(a){for(var c=0;c<2;++c)b.disconnect(this.events.pop());b.stopEvent(a)},onSelectStart:function(a){(!this.skip||!b.dnd.isFormElement(a))&&b.stopEvent(a)},onDragDetected:function(a){new this.mover(this.node,a,this)},onMoveStart:function(a){b.publish("/dnd/move/start",[a]);
b.addClass(b.body(),"dojoMove");b.addClass(this.node,"dojoMoveItem")},onMoveStop:function(a){b.publish("/dnd/move/stop",[a]);b.removeClass(b.body(),"dojoMove");b.removeClass(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(a,c){this.onMoving(a,c);var b=a.node.style;b.left=c.l+"px";b.top=c.t+"px";this.onMoved(a,c)},onMoving:function(){},onMoved:function(){}}));b._hasResource["dijit._CssStateMixin"]||(b._hasResource["dijit._CssStateMixin"]=!0,b.provide("dijit._CssStateMixin"),b.declare("dijit._CssStateMixin",
[],{cssStateNodes:{},hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);b.forEach(["onmouseenter","onmouseleave","onmousedown"],function(a){this.connect(this.domNode,a,"_cssMouseEvent")},this);b.forEach(["disabled","readOnly","checked","selected","focused","state","hovering","active"],function(a){this.watch(a,b.hitch(this,"_setStateClass"))},this);for(var a in this.cssStateNodes)this._trackMouseState(this[a],this.cssStateNodes[a]);this._setStateClass()},_cssMouseEvent:function(a){if(!this.disabled)switch(a.type){case "mouseenter":case "mouseover":this._set("hovering",
!0);this._set("active",this._mouseDown);break;case "mouseleave":case "mouseout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":this._set("active",!0);this._mouseDown=!0;var c=this.connect(b.body(),"onmouseup",function(){this._mouseDown=!1;this._set("active",!1);this.disconnect(c)})}},_setStateClass:function(){function a(a){c=c.concat(b.map(c,function(c){return c+a}),"dijit"+a)}var c=this.baseClass.split(" ");this.isLeftToRight()||a("Rtl");this.checked&&a("Checked");this.state&&
a(this.state);this.selected&&a("Selected");this.disabled?a("Disabled"):this.readOnly?a("ReadOnly"):this.active?a("Active"):this.hovering&&a("Hover");this._focused&&a("Focused");var d=this.stateNode||this.domNode,f={};b.forEach(d.className.split(" "),function(a){f[a]=!0});"_stateClasses"in this&&b.forEach(this._stateClasses,function(a){delete f[a]});b.forEach(c,function(a){f[a]=!0});var e=[],g;for(g in f)e.push(g);d.className=e.join(" ");this._stateClasses=c},_trackMouseState:function(a,c){function d(){var d=
"disabled"in j&&j.disabled||"readonly"in j&&j.readonly;b.toggleClass(a,c+"Hover",f&&!e&&!d);b.toggleClass(a,c+"Active",e&&!d);b.toggleClass(a,c+"Focused",g&&!d)}var f=!1,e=!1,g=!1,j=this,i=b.hitch(this,"connect",a);i("onmouseenter",function(){f=!0;d()});i("onmouseleave",function(){e=f=!1;d()});i("onmousedown",function(){e=!0;d()});i("onmouseup",function(){e=!1;d()});i("onfocus",function(){g=!0;d()});i("onblur",function(){g=!1;d()});this.watch("disabled",d);this.watch("readOnly",d)}}));b._hasResource["dijit.form._FormWidget"]||
(b._hasResource["dijit.form._FormWidget"]=!0,b.provide("dijit.form._FormWidget"),b.declare("dijit.form._FormWidget",[e._Widget,e._Templated,e._CssStateMixin],{name:"",alt:"",value:"",type:"text",tabIndex:"0",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,attributeMap:b.delegate(e._Widget.prototype.attributeMap,{value:"focusNode",id:"focusNode",tabIndex:"focusNode",alt:"focusNode",title:"focusNode"}),postMixInProperties:function(){this.nameAttrSetting=this.name?'name="'+this.name.replace(/'/g,
"&quot;")+'"':"";this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onmousedown","_onMouseDown")},_setDisabledAttr:function(a){this._set("disabled",a);b.attr(this.focusNode,"disabled",a);this.valueNode&&b.attr(this.valueNode,"disabled",a);e.setWaiState(this.focusNode,"disabled",a);a?(this._set("hovering",!1),this._set("active",!1),a="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"focusNode",b.forEach(b.isArray(a)?a:[a],function(a){a=this[a];
b.isWebKit||e.hasDefaultTabStop(a)?a.setAttribute("tabIndex","-1"):a.removeAttribute("tabIndex")},this)):this.tabIndex!=""&&this.focusNode.setAttribute("tabIndex",this.tabIndex)},setDisabled:function(a){b.deprecated("setDisabled("+a+") is deprecated. Use set('disabled',"+a+") instead.","","2.0");this.set("disabled",a)},_onFocus:function(){this.scrollOnFocus&&b.window.scrollIntoView(this.domNode);this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&b.style(this.domNode,
"display")!="none"},focus:function(){this.disabled||e.focus(this.focusNode)},compare:function(a,c){return typeof a=="number"&&typeof c=="number"?isNaN(a)&&isNaN(c)?0:a-c:a>c?1:a<c?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(a,c){if(this._lastValueReported==void 0&&(c===null||!this._onChangeActive))this._resetValue=this._lastValueReported=a;this._pendingOnChange=this._pendingOnChange||typeof a!=typeof this._lastValueReported||this.compare(a,this._lastValueReported)!=0;if((this.intermediateChanges||
c||c===void 0)&&this._pendingOnChange)if(this._lastValueReported=a,this._pendingOnChange=!1,this._onChangeActive)this._onChangeHandle&&clearTimeout(this._onChangeHandle),this._onChangeHandle=setTimeout(b.hitch(this,function(){this._onChangeHandle=null;this.onChange(a)}),0)},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(clearTimeout(this._onChangeHandle),this.onChange(this._lastValueReported));this.inherited(arguments)},setValue:function(a){b.deprecated("dijit.form._FormWidget:setValue("+
a+") is deprecated.  Use set('value',"+a+") instead.","","2.0");this.set("value",a)},getValue:function(){b.deprecated(this.declaredClass+"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},_onMouseDown:function(a){if(!a.ctrlKey&&b.mouseButtons.isLeft(a)&&this.isFocusable())var c=this.connect(b.body(),"onmouseup",function(){this.isFocusable()&&this.focus();this.disconnect(c)})}}),b.declare("dijit.form._FormValueWidget",e.form._FormWidget,{readOnly:!1,attributeMap:b.delegate(e.form._FormWidget.prototype.attributeMap,
{value:"",readOnly:"focusNode"}),_setReadOnlyAttr:function(a){b.attr(this.focusNode,"readOnly",a);e.setWaiState(this.focusNode,"readonly",a);this._set("readOnly",a)},postCreate:function(){this.inherited(arguments);b.isIE&&this.connect(this.focusNode||this.domNode,"onkeydown",this._onKeyDown);if(this._resetValue===void 0)this._lastValueReported=this._resetValue=this.value},_setValueAttr:function(a,c){this._handleOnChange(a,c)},_handleOnChange:function(a){this._set("value",a);this.inherited(arguments)},
undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=!1;this._setValueAttr(this._resetValue,!0)},_onKeyDown:function(a){if(a.keyCode==b.keys.ESCAPE&&!a.ctrlKey&&!a.altKey&&!a.metaKey){var c;if(b.isIE)a.preventDefault(),c=document.createEventObject(),c.keyCode=b.keys.ESCAPE,c.shiftKey=a.shiftKey,a.srcElement.fireEvent("onkeypress",c)}},_layoutHackIE7:function(){if(b.isIE==7)for(var a=this.domNode,c=a.parentNode,d=a.firstChild||a,f=d.style.filter,e=this;c&&
c.clientHeight==0;)(function(){var a=e.connect(c,"onscroll",function(){e.disconnect(a);d.style.filter=(new Date).getMilliseconds();setTimeout(function(){d.style.filter=f},0)})})(),c=c.parentNode}}));b._hasResource["dijit._HasDropDown"]||(b._hasResource["dijit._HasDropDown"]=!0,b.provide("dijit._HasDropDown"),b.declare("dijit._HasDropDown",null,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:0,dropDownPosition:["below",
"above"],_stopClickEvents:!0,_onDropDownMouseDown:function(){if(!this.disabled&&!this.readOnly)this._docHandler=this.connect(b.doc,"onmouseup","_onDropDownMouseUp"),this.toggleDropDown()},_onDropDownMouseUp:function(a){a&&this._docHandler&&this.disconnect(this._docHandler);var c=this.dropDown,d=!1;if(a&&this._opened){var f=b.position(this._buttonNode,!0);if(!(a.pageX>=f.x&&a.pageX<=f.x+f.w)||!(a.pageY>=f.y&&a.pageY<=f.y+f.h)){for(f=a.target;f&&!d;)b.hasClass(f,"dijitPopup")?d=!0:f=f.parentNode;if(d){f=
a.target;if(c.onItemClick){for(var h;f&&!(h=e.byNode(f));)f=f.parentNode;if(h&&h.onClick&&h.getParent)h.getParent().onItemClick(h,a)}return}}}this._opened&&c.focus&&c.autoFocus!==!1&&window.setTimeout(b.hitch(c,"focus"),1)},_onDropDownClick:function(a){this._stopClickEvents&&b.stopEvent(a)},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var a={after:this.isLeftToRight()?
"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";b.addClass(this._arrowWrapperNode||this._buttonNode,"dijit"+a+"ArrowButton")},postCreate:function(){this.inherited(arguments);this.connect(this._buttonNode,"onmousedown","_onDropDownMouseDown");this.connect(this._buttonNode,"onclick","_onDropDownClick");this.connect(this.focusNode,"onkeypress","_onKey")},destroy:function(){this.dropDown&&
(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown);this.inherited(arguments)},_onKey:function(a){if(!this.disabled&&!this.readOnly){var c=this.dropDown,d=a.target;if(c&&this._opened&&c.handleKey&&c.handleKey(a)===!1)b.stopEvent(a);else if(c&&this._opened&&a.charOrCode==b.keys.ESCAPE)this.closeDropDown(),b.stopEvent(a);else if(!this._opened&&(a.charOrCode==b.keys.DOWN_ARROW||(a.charOrCode==b.keys.ENTER||a.charOrCode==" ")&&((d.tagName||"").toLowerCase()!=="input"||d.type&&
d.type.toLowerCase()!=="text")))this.toggleDropDown(),(c=this.dropDown)&&c.focus&&setTimeout(b.hitch(c,"focus"),1),b.stopEvent(a)}},_onBlur:function(){this.closeDropDown(e._curFocus&&this.dropDown&&b.isDescendant(e._curFocus,this.dropDown.domNode));this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(a){a()},toggleDropDown:function(){!this.disabled&&!this.readOnly&&(this._opened?this.closeDropDown():this.isLoaded()?this.openDropDown():this.loadDropDown(b.hitch(this,"openDropDown")))},
openDropDown:function(){var a=this.dropDown,c=a.domNode,d=this._aroundNode||this.domNode,f=this;if(!this._preparedNode){this._preparedNode=!0;if(c.style.width)this._explicitDDWidth=!0;if(c.style.height)this._explicitDDHeight=!0}if(this.maxHeight||this.forceWidth||this.autoWidth){var h={display:"",visibility:"hidden"};if(!this._explicitDDWidth)h.width="";if(!this._explicitDDHeight)h.height="";b.style(c,h);h=this.maxHeight;if(h==-1)var h=b.window.getBox(),g=b.position(d,!1),h=Math.floor(Math.max(g.y,
h.h-(g.y+g.h)));a.startup&&!a._started&&a.startup();e.popup.moveOffScreen(a);var g=b._getMarginSize(c),j=h&&g.h>h;b.style(c,{overflowX:"hidden",overflowY:j?"auto":"hidden"});j?(g.h=h,"w"in g&&(g.w+=16)):delete g.h;this.forceWidth?g.w=d.offsetWidth:this.autoWidth?g.w=Math.max(g.w,d.offsetWidth):delete g.w;b.isFunction(a.resize)?a.resize(g):b.marginBox(c,g)}a=e.popup.open({parent:this,popup:a,around:d,orient:e.getPopupAroundAlignment(this.dropDownPosition&&this.dropDownPosition.length?this.dropDownPosition:
["below"],this.isLeftToRight()),onExecute:function(){f.closeDropDown(!0)},onCancel:function(){f.closeDropDown(!0)},onClose:function(){b.attr(f._popupStateNode,"popupActive",!1);b.removeClass(f._popupStateNode,"dijitHasDropDownOpen");f._opened=!1}});b.attr(this._popupStateNode,"popupActive","true");b.addClass(f._popupStateNode,"dijitHasDropDownOpen");this._opened=!0;return a},closeDropDown:function(a){if(this._opened)a&&this.focus(),e.popup.close(this.dropDown),this._opened=!1}}));b._hasResource["dijit.form.Button"]||
(b._hasResource["dijit.form.Button"]=!0,b.provide("dijit.form.Button"),b.declare("dijit.form.Button",e.form._FormWidget,{label:"",showLabel:!0,iconClass:"",type:"button",baseClass:"dijitButton",templateString:b.cache("dijit.form","templates/Button.html",'<span class="dijit dijitReset dijitInline"\r\n\t><span class="dijitReset dijitInline dijitButtonNode"\r\n\t\tdojoAttachEvent="ondijitclick:_onButtonClick"\r\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdojoAttachPoint="titleNode,focusNode"\r\n\t\t\trole="button" aria-labelledby="${id}_label"\r\n\t\t\t><span class="dijitReset dijitInline dijitIcon" dojoAttachPoint="iconNode"></span\r\n\t\t\t><span class="dijitReset dijitToggleButtonIconChar">&#x25CF;</span\r\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid="${id}_label"\r\n\t\t\t\tdojoAttachPoint="containerNode"\r\n\t\t\t></span\r\n\t\t></span\r\n\t></span\r\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen"\r\n\t\tdojoAttachPoint="valueNode"\r\n/></span>\r\n'),
attributeMap:b.delegate(e.form._FormWidget.prototype.attributeMap,{value:"valueNode"}),_onClick:function(a){if(this.disabled)return!1;this._clicked();return this.onClick(a)},_onButtonClick:function(a){if(this._onClick(a)===!1)a.preventDefault();else if(this.type=="submit"&&!(this.valueNode||this.focusNode).form)for(var c=this.domNode;c.parentNode;c=c.parentNode){var b=e.byNode(c);if(b&&typeof b._onSubmit=="function"){b._onSubmit(a);break}}else this.valueNode&&(this.valueNode.click(),a.preventDefault())},
buildRendering:function(){this.inherited(arguments);b.setSelectable(this.focusNode,!1)},_fillContent:function(a){a&&(!this.params||!("label"in this.params))&&this.set("label",a.innerHTML)},_setShowLabelAttr:function(a){this.containerNode&&b.toggleClass(this.containerNode,"dijitDisplayNone",!a);this._set("showLabel",a)},onClick:function(){return!0},_clicked:function(){},setLabel:function(a){b.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",
a)},_setLabelAttr:function(a){this._set("label",a);this.containerNode.innerHTML=a;if(this.showLabel==!1&&!this.params.title)this.titleNode.title=b.trim(this.containerNode.innerText||this.containerNode.textContent||"")},_setIconClassAttr:function(a){b.replaceClass(this.iconNode,a||"dijitNoIcon",this.iconClass||"dijitNoIcon");this._set("iconClass",a)}}),b.declare("dijit.form.DropDownButton",[e.form.Button,e._Container,e._HasDropDown],{baseClass:"dijitDropDownButton",templateString:b.cache("dijit.form",
"templates/DropDownButton.html",'<span class="dijit dijitReset dijitInline"\r\n\t><span class=\'dijitReset dijitInline dijitButtonNode\'\r\n\t\tdojoAttachEvent="ondijitclick:_onButtonClick" dojoAttachPoint="_buttonNode"\r\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdojoAttachPoint="focusNode,titleNode,_arrowWrapperNode"\r\n\t\t\trole="button" aria-haspopup="true" aria-labelledby="${id}_label"\r\n\t\t\t><span class="dijitReset dijitInline dijitIcon"\r\n\t\t\t\tdojoAttachPoint="iconNode"\r\n\t\t\t></span\r\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tdojoAttachPoint="containerNode,_popupStateNode"\r\n\t\t\t\tid="${id}_label"\r\n\t\t\t></span\r\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonInner"></span\r\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonChar">&#9660;</span\r\n\t\t></span\r\n\t></span\r\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen"\r\n\t\tdojoAttachPoint="valueNode"\r\n/></span>\r\n'),
_fillContent:function(){if(this.srcNodeRef){var a=b.query("*",this.srcNodeRef);e.form.DropDownButton.superclass._fillContent.call(this,a[0]);this.dropDownContainer=this.srcNodeRef}},startup:function(){if(!this._started){if(!this.dropDown&&this.dropDownContainer){var a=b.query("[widgetId]",this.dropDownContainer)[0];this.dropDown=e.byNode(a);delete this.dropDownContainer}this.dropDown&&e.popup.hide(this.dropDown);this.inherited(arguments)}},isLoaded:function(){var a=this.dropDown;return!!a&&(!a.href||
a.isLoaded)},loadDropDown:function(){var a=this.dropDown;if(a)if(this.isLoaded())this.openDropDown();else{var c=b.connect(a,"onLoad",this,function(){b.disconnect(c);this.openDropDown()});a.refresh()}},isFocusable:function(){return this.inherited(arguments)&&!this._mouseDown}}),b.declare("dijit.form.ComboButton",e.form.DropDownButton,{templateString:b.cache("dijit.form","templates/ComboButton.html",'<table class="dijit dijitReset dijitInline dijitLeft"\r\n\tcellspacing=\'0\' cellpadding=\'0\' role="presentation"\r\n\t><tbody role="presentation"><tr role="presentation"\r\n\t\t><td class="dijitReset dijitStretch dijitButtonNode" dojoAttachPoint="buttonNode" dojoAttachEvent="ondijitclick:_onButtonClick,onkeypress:_onButtonKeyPress"\r\n\t\t><div id="${id}_button" class="dijitReset dijitButtonContents"\r\n\t\t\tdojoAttachPoint="titleNode"\r\n\t\t\trole="button" aria-labelledby="${id}_label"\r\n\t\t\t><div class="dijitReset dijitInline dijitIcon" dojoAttachPoint="iconNode" role="presentation"></div\r\n\t\t\t><div class="dijitReset dijitInline dijitButtonText" id="${id}_label" dojoAttachPoint="containerNode" role="presentation"></div\r\n\t\t></div\r\n\t\t></td\r\n\t\t><td id="${id}_arrow" class=\'dijitReset dijitRight dijitButtonNode dijitArrowButton\'\r\n\t\t\tdojoAttachPoint="_popupStateNode,focusNode,_buttonNode"\r\n\t\t\tdojoAttachEvent="onkeypress:_onArrowKeyPress"\r\n\t\t\ttitle="${optionsTitle}"\r\n\t\t\trole="button" aria-haspopup="true"\r\n\t\t\t><div class="dijitReset dijitArrowButtonInner" role="presentation"></div\r\n\t\t\t><div class="dijitReset dijitArrowButtonChar" role="presentation">&#9660;</div\r\n\t\t></td\r\n\t\t><td style="display:none !important;"\r\n\t\t\t><input ${!nameAttrSetting} type="${type}" value="${value}" dojoAttachPoint="valueNode"\r\n\t\t/></td></tr></tbody\r\n></table>\r\n'),
attributeMap:b.mixin(b.clone(e.form.Button.prototype.attributeMap),{id:"",tabIndex:["focusNode","titleNode"],title:"titleNode"}),optionsTitle:"",baseClass:"dijitComboButton",cssStateNodes:{buttonNode:"dijitButtonNode",titleNode:"dijitButtonContents",_popupStateNode:"dijitDownArrowButton"},_focusedNode:null,_onButtonKeyPress:function(a){if(a.charOrCode==b.keys[this.isLeftToRight()?"RIGHT_ARROW":"LEFT_ARROW"])e.focus(this._popupStateNode),b.stopEvent(a)},_onArrowKeyPress:function(a){if(a.charOrCode==
b.keys[this.isLeftToRight()?"LEFT_ARROW":"RIGHT_ARROW"])e.focus(this.titleNode),b.stopEvent(a)},focus:function(a){this.disabled||e.focus(a=="start"?this.titleNode:this._popupStateNode)}}),b.declare("dijit.form.ToggleButton",e.form.Button,{baseClass:"dijitToggleButton",checked:!1,attributeMap:b.mixin(b.clone(e.form.Button.prototype.attributeMap),{checked:"focusNode"}),_clicked:function(){this.set("checked",!this.checked)},_setCheckedAttr:function(a,c){this._set("checked",a);b.attr(this.focusNode||
this.domNode,"checked",a);e.setWaiState(this.focusNode||this.domNode,"pressed",a);this._handleOnChange(a,c)},setChecked:function(a){b.deprecated("setChecked("+a+") is deprecated. Use set('checked',"+a+") instead.","","2.0");this.set("checked",a)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}}));b._hasResource["dijit.form.ToggleButton"]||(b._hasResource["dijit.form.ToggleButton"]=!0,b.provide("dijit.form.ToggleButton"));b._hasResource["dijit.layout.StackController"]||
(b._hasResource["dijit.layout.StackController"]=!0,b.provide("dijit.layout.StackController"),b.declare("dijit.layout.StackController",[e._Widget,e._Templated,e._Container],{templateString:"<span role='tablist' dojoAttachEvent='onkeypress' class='dijitStackController'></span>",containerId:"",buttonWidget:"dijit.layout._StackButton",constructor:function(){this.pane2button={};this.pane2connects={};this.pane2watches={}},buildRendering:function(){this.inherited(arguments);e.setWaiRole(this.domNode,"tablist")},
postCreate:function(){this.inherited(arguments);this.subscribe(this.containerId+"-startup","onStartup");this.subscribe(this.containerId+"-addChild","onAddChild");this.subscribe(this.containerId+"-removeChild","onRemoveChild");this.subscribe(this.containerId+"-selectChild","onSelectChild");this.subscribe(this.containerId+"-containerKeyPress","onContainerKeyPress")},onStartup:function(a){b.forEach(a.children,this.onAddChild,this);if(a.selected)this.onSelectChild(a.selected)},destroy:function(){for(var a in this.pane2button)this.onRemoveChild(e.byId(a));
this.inherited(arguments)},onAddChild:function(a,c){var d=new (b.getObject(this.buttonWidget))({id:this.id+"_"+a.id,label:a.title,dir:a.dir,lang:a.lang,showLabel:a.showTitle,iconClass:a.iconClass,closeButton:a.closable,title:a.tooltip});e.setWaiState(d.focusNode,"selected","false");var f=["label","showLabel","iconClass","closeButton","title"];this.pane2watches[a.id]=b.map(["title","showTitle","iconClass","closable","tooltip"],function(c,b){return a.watch(c,function(a,c,e){d.set(f[b],e)})});this.pane2connects[a.id]=
[this.connect(d,"onClick",b.hitch(this,"onButtonClick",a)),this.connect(d,"onClickCloseButton",b.hitch(this,"onCloseButtonClick",a))];this.addChild(d,c);this.pane2button[a.id]=d;a.controlButton=d;if(!this._currentChild)d.focusNode.setAttribute("tabIndex","0"),e.setWaiState(d.focusNode,"selected","true"),this._currentChild=a;!this.isLeftToRight()&&b.isIE&&this._rectifyRtlTabList&&this._rectifyRtlTabList()},onRemoveChild:function(a){if(this._currentChild===a)this._currentChild=null;b.forEach(this.pane2connects[a.id],
b.hitch(this,"disconnect"));delete this.pane2connects[a.id];b.forEach(this.pane2watches[a.id],function(a){a.unwatch()});delete this.pane2watches[a.id];var c=this.pane2button[a.id];c&&(this.removeChild(c),delete this.pane2button[a.id],c.destroy());delete a.controlButton},onSelectChild:function(a){if(a){if(this._currentChild){var c=this.pane2button[this._currentChild.id];c.set("checked",!1);e.setWaiState(c.focusNode,"selected","false");c.focusNode.setAttribute("tabIndex","-1")}c=this.pane2button[a.id];
c.set("checked",!0);e.setWaiState(c.focusNode,"selected","true");this._currentChild=a;c.focusNode.setAttribute("tabIndex","0");a=e.byId(this.containerId);e.setWaiState(a.containerNode,"labelledby",c.id)}},onButtonClick:function(a){e.byId(this.containerId).selectChild(a)},onCloseButtonClick:function(a){e.byId(this.containerId).closeChild(a);this._currentChild&&(a=this.pane2button[this._currentChild.id])&&e.focus(a.focusNode||a.domNode)},adjacent:function(a){if(!this.isLeftToRight()&&(!this.tabPosition||
/top|bottom/.test(this.tabPosition)))a=!a;var c=this.getChildren(),d=b.indexOf(c,this.pane2button[this._currentChild.id]);return c[(d+(a?1:c.length-1))%c.length]},onkeypress:function(a){if(!this.disabled&&!a.altKey){var c=null;if(a.ctrlKey||!a._djpage){var d=b.keys;switch(a.charOrCode){case d.LEFT_ARROW:case d.UP_ARROW:a._djpage||(c=!1);break;case d.PAGE_UP:a.ctrlKey&&(c=!1);break;case d.RIGHT_ARROW:case d.DOWN_ARROW:a._djpage||(c=!0);break;case d.PAGE_DOWN:a.ctrlKey&&(c=!0);break;case d.HOME:case d.END:var f=
this.getChildren();if(f&&f.length)f[a.charOrCode==d.HOME?0:f.length-1].onClick();b.stopEvent(a);break;case d.DELETE:if(this._currentChild.closable)this.onCloseButtonClick(this._currentChild);b.stopEvent(a);break;default:if(a.ctrlKey)if(a.charOrCode===d.TAB)this.adjacent(!a.shiftKey).onClick(),b.stopEvent(a);else if(a.charOrCode=="w"){if(this._currentChild.closable)this.onCloseButtonClick(this._currentChild);b.stopEvent(a)}}c!==null&&(this.adjacent(c).onClick(),b.stopEvent(a))}}},onContainerKeyPress:function(a){a.e._djpage=
a.page;this.onkeypress(a.e)}}),b.declare("dijit.layout._StackButton",e.form.ToggleButton,{tabIndex:"-1",buildRendering:function(){this.inherited(arguments);e.setWaiRole(this.focusNode||this.domNode,"tab")},onClick:function(){e.focus(this.focusNode)},onClickCloseButton:function(a){a.stopPropagation()}}));b._hasResource["dojox.layout.ResizeHandle"]||(b._hasResource["dojox.layout.ResizeHandle"]=!0,b.provide("dojox.layout.ResizeHandle"),b.experimental("dojox.layout.ResizeHandle"),b.declare("dojox.layout.ResizeHandle",
[e._Widget,e._Templated],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'<div dojoAttachPoint="resizeHandle" class="dojoxResizeHandle"><div></div></div>',postCreate:function(){this.connect(this.resizeHandle,
"onmousedown","_beginSizing");if(this.activeResize)this.animateSizing=!1;else if(this._resizeHelper=e.byId("dojoxGlobalResizeHelper"),!this._resizeHelper)this._resizeHelper=(new l.layout._ResizeHelper({id:"dojoxGlobalResizeHelper"})).placeAt(b.body()),b.addClass(this._resizeHelper.domNode,this.activeResizeClass);if(!this.minSize)this.minSize={w:this.minWidth,h:this.minHeight};if(this.constrainMax)this.maxSize={w:this.maxWidth,h:this.maxHeight};this._resizeX=this._resizeY=!1;var a=b.partial(b.addClass,
this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(a){if(this._isSizing)return!1;b.publish(this.startTopic,[this]);this.targetDomNode=(this.targetWidget=e.byId(this.targetId))?this.targetWidget.domNode:b.byId(this.targetId);if(this.targetContainer)this.targetDomNode=this.targetContainer;if(!this.targetDomNode)return!1;
if(!this.activeResize){var c=b.position(this.targetDomNode,!0);this._resizeHelper.resize({l:c.x,t:c.y,w:c.w,h:c.h});this._resizeHelper.show()}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};var d=this.targetWidget?b.marginBox(this.targetDomNode):b.contentBox(this.targetDomNode);this.startSize={w:d.w,h:d.h};if(this.fixedAspect)d.w>d.h?(c="w",d=d.w/d.h):(c="h",d=d.h/d.w),this._aspect={prop:c},this._aspect[c]=d;this._pconnects=[];this._pconnects.push(b.connect(b.doc,"onmousemove",this,"_updateSizing"));
this._pconnects.push(b.connect(b.doc,"onmouseup",this,"_endSizing"));b.stopEvent(a)},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var c=this._getNewCoords(a);if(c===!1)return;this._resizeHelper.resize(c)}a.preventDefault()},_getNewCoords:function(a){try{if(!a.clientX||!a.clientY)return!1}catch(c){return!1}this._activeResizeLastEvent=a;var b=this.isLeftToRight()?this.startPoint.x-a.clientX:a.clientX-this.startPoint.x,a=this.startPoint.y-a.clientY;return this._checkConstraints(this.startSize.w-
(this._resizeX?b:0),this.startSize.h-(this._resizeY?a:0))},_checkConstraints:function(a,c){if(this.minSize){var b=this.minSize;if(a<b.w)a=b.w;if(c<b.h)c=b.h}if(this.constrainMax&&this.maxSize){b=this.maxSize;if(a>b.w)a=b.w;if(c>b.h)c=b.h}this.fixedAspect&&(b=this._aspect[this._aspect.prop],a<c?c=a*b:c<a&&(a=c*b));return{w:a,h:c}},_changeSizing:function(a){var c=this._getNewCoords(a);if(c!==!1&&(this.targetWidget&&b.isFunction(this.targetWidget.resize)?this.targetWidget.resize(c):this.animateSizing?
b.fx[this.animateMethod]([b.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:c.w}},duration:this.animateDuration}),b.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:c.h}},duration:this.animateDuration})]).play():b.style(this.targetDomNode,{width:c.w+"px",height:c.h+"px"}),this.intermediateChanges))this.onResize(a)},_endSizing:function(a){b.forEach(this._pconnects,b.disconnect);var c=b.partial(b.publish,this.endTopic,[this]);
this.activeResize?c():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(c,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(){}}),b.declare("dojox.layout._ResizeHelper",e._Widget,{show:function(){b.fadeIn({node:this.domNode,duration:120,beforeBegin:function(a){b.style(a,"display","")}}).play()},hide:function(){b.fadeOut({node:this.domNode,duration:250,onEnd:function(a){b.style(a,"display","none")}}).play()},resize:function(a){b.marginBox(this.domNode,a)}}));
b._hasResource["ws.im.KnockKnock"]||(b._hasResource["ws.im.KnockKnock"]=!0,b.provide("ws.im.KnockKnock"),b.declare("ws.im.KnockKnock",[e._Widget,e._Templated],{templateString:b.cache("ws.im","KnockKnock.html",'<div class="knockKnock">\r\n\t<div dojoType="ws.widget.Pane">\r\n\t\t<div dojoAttachPoint="promptSN" class="promptSN"></div>\r\n\t\t<div class="promptMsg">${KnockKnock_Label_Prompt}</div>\r\n\t</div>\r\n\t<div dojoAttachPoint="toolbar" dojoType="ws.widget.WSToolbar" vizType="Bare">\r\n\t\t<div dojoType="ws.widget.Pane" toolbarPosition="center">\r\n\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick: onClickAccept">${KnockKnock_Label_Accept}</div>\r\n\t\t\t<div dojoAttachPoint="DeclineBtn" class="wsLink">${KnockKnock_Label_Decline}</div>\r\n\t\t\t<span>|</span>\r\n\t\t\t<div dojoAttachPoint="BlockBtn" class="wsLink">${KnockKnock_Label_Block}</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,buddyAimId:"",startup:function(){this.promptSN.innerHTML=ws.im.wim.getDisplayId(this.buddyAimId);this.toolbar.centerNode.style.cssText="";this.connect(this.DeclineBtn,"onclick","onClickDecline");this.connect(this.BlockBtn,"onclick","onClickBlock")},onClickAccept:function(){ws.im.wim.acceptedBuddies[this.buddyAimId]=!0},onClickDecline:function(){ws.im.wim.declinedBuddies[this.buddyAimId]=!0},onClickBlock:function(){ws.im.wim.blockBuddy(this.buddyAimId)}}));
b._hasResource["ws.im.Im"]||(b._hasResource["ws.im.Im"]=!0,b.provide("ws.im.Im"),b.declare("ws.im.Im",[e._Widget,e._Templated,e._Contained],{templateString:b.cache("ws.im","Im.html",'<div>\r\n\t<div class="imWidget" dojoType="dijit.layout.StackContainer" dojoAttachPoint="stackWidget">\r\n\t\t<div class="mainPane" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="mainPane">\r\n\t\t\t<div dojoAttachPoint="newPhonePane" dojoType="ws.widget.Pane" layoutAlign="top" class="newPhonePane" style="display: none;">\r\n\t\t\t\t<div class="mainSprite phoneIcon"></div>\r\n\t\t\t\t<input type="text" dojoAttachPoint="newPhoneInput" class="wsInput" dojoAttachEvent="onkeypress: onPhoneKeyPress, onblur: onBlurTextarea" tabindex="200">\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" class="screenNameContainer" layoutAlign="top" style="display: none;">\r\n\t\t\t\t<span dojoAttachPoint="screenNameLabel">${To}:</span>\r\n\t\t\t\t<input type="text" dojoType="ws.widget.DefaultTextbox" defaultValue="${AIM_ScreenName}" dojoAttachPoint="screenNameTextbox" dojoAttachEvent="onBlur: onBlurScreenName" tabindex="200">\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" dojoAttachPoint="conversationPane" layoutAlign="client" class="conversation"></div>\r\n\t\t\t<div dojoType="ws.widget.Pane" class="onlinePane" layoutAlign="bottom" dojoAttachPoint="onlinePane">\r\n\t\t\t\t<div dojoType="ws.widget.Pane" class="typing" dojoAttachPoint="typingIndicator" layoutAlign="bottom"></div>\r\n\t\t\t\t<div dojoAttachPoint="phonePane" dojoType="ws.widget.Pane" layoutAlign="bottom" class="phonePane" style="display: none;">\r\n\t\t\t\t\t<div class="mainSprite phoneIcon"></div>\r\n\t\t\t\t\t<input type="text" dojoAttachPoint="phoneInput" class="wsInput" dojoAttachEvent="onkeypress: onPhoneKeyPress, onblur: onBlurTextarea" tabindex="200">\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoType="ws.widget.Pane" layoutAlign="bottom" class="inputContainer">\r\n\t\t\t\t\t<textarea dojoAttachPoint="messageInput" class="wsInput" dojoAttachEvent="onkeyup: onKeyUp, onkeypress: onKeyPress, onblur: onBlurTextarea" tabindex="201"></textarea>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoAttachPoint="offlinePane" dojoType="ws.widget.Pane" layoutAlign="bottom" class="offlinePane" style="display: none;">\r\n\t\t\t\t<div dojoType="ws.widget.WSToolbar" dojoAttachPoint="promptToolbar" class="promptToolbar" defaultWidth="250" vizType="Bare">\r\n\t\t\t\t\t<div dojoType="ws.widget.Pane" toolbarPosition="center">\r\n\t\t\t\t\t\t<span class="prompt" dojoAttachPoint="promptNode" ></span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoType="ws.widget.WSToolbar" dojoAttachPoint="signToolbar" class="signToolbar" defaultWidth="250" vizType="Bare">\r\n\t\t\t\t\t<div dojoType="ws.widget.Pane" toolbarPosition="center">\r\n\t\t\t\t\t\t<img dojoAttachPoint="aimLogo" class="mainSprite aimLogo"  src="${spacer}">\r\n\t\t\t\t\t\t<span class="wsLink" dojoAttachPoint="signinBtn">${SignInToContinue}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,imGroup:null,buddyAimId:"",invalidFolders:[Config.DraftsFolderName,Config.SentItemsFolderName,Config.SpamFolderName,Config.DeletedItemsFolderName,Config.IMFolderName,Config.InboxFolderName,Config.NewFolderName,Config.OldFolderName],phoneMode:!1,isService:!1,addrModel:null,contactRec:null,newFolderInputMenu:null,SmsRoutingServiceDetailCodes:{Ok:1E3,GenericError:2E3,NoDetail:2001,InvalidNumber:3001,NumberBlockedByUser:3002,NoPathToCarrier:3003,
LandLine:3004,UnknownNumber:3005,InternationalNumber:3006,InvalidServiceParam:4001,MissingNumber:4002},startup:function(){ws.im.wim.listeners.push(this);this.addrModel=new ws.address.AddressModel;this._updateTypingInterval=window.setInterval(b.hitch(this,"_updateTypingStatus"),3E3);this._showSavedConversation();var a=e.byNode(b.query(".screenNameContainer",this.mainPane.domNode)[0]),c=e.byNode(b.query(".newPhonePane",this.mainPane.domNode)[0]);this.isAnon()?a.show():(this.mainPane.removeChild(a),
a.destroyRecursive(),this.mainPane.removeChild(c),c.destroyRecursive());ws.lang.setTimeout(this.mainPane,"resize",0);this.connect(this.signinBtn,"onclick","onClickSignIn");if(this.buddyAimId.charAt(0)=="+"||this.buddyAimId.match(RegExp(/^\+?[\(\)\-\.0-9]*$/)))this.phoneInput.value=this.buddyAimId;if(!this.title)this.title=this.getImTitleHtml();!ws.im.wim.isInBuddyList(this.buddyAimId)&&!this.isAnon()&&!ws.im.wim.acceptedBuddies[this.buddyAimId]&&!this.isUserInitiated&&ws.lang.setTimeout(this,"setupKnockKnock",
0);if(a=ws.im.wim.buddies[this.buddyAimId])if(this.friendly=ws.im.wim.getDisplayId(this.buddyAimId),a.service)this.isService=!0;ws.im.wim.user&&this.showIfUserIsOffline();this.serviceOn=(a=ws.im.wim.getServiceConfig("facebook"))&&a.online==1;if(b.isFF&&b.isFF==3&&navigator.appVersion.indexOf("Macintosh")!=-1)this.messageInput.style.height="58px";ws.lang.setTimeout(this,"setFocus",100);if(ws.im.wim.user)if(this.serviceOn)this.onSessionStart();else this.onFBEnd();else this.onSessionEnd()},setFocus:function(){this.isAnon()?
ws.browser.focus(b.query(".screenNameContainer .wsInput",this.domNode)[0]):ws.browser.focus(this.messageInput)},isAnon:function(){return this.buddyAimId.indexOf(this.imGroup.anonIdPrefix)==0},close:function(){this.getParent().closeChild(this)},_showSavedConversation:function(){var a=ws.im.wim.buddies[this.buddyAimId];if(a&&a.im){for(var a=a.im,c="",b=0;b<a.length;b++)c+=this._formatMessage(a[b],!0);this.conversationPane.domNode.innerHTML=c;ws.html.targetLinksToNewWindow(this.conversationPane.domNode);
this.scrollToEnd()}},clearWindow:function(){var a=ws.im.wim.buddies[this.buddyAimId];if(a)a.im=[];this.conversationPane.domNode.innerHTML=""},addMessage:function(a){ws.im.wim._storeIm(this.buddyAimId,a);a.senderAimId==this.buddyAimId&&this.typingChanged("none");this._appendToConversationDisplay(this._formatMessage(a,!1));b.removeClass(this.conversationPane.domNode,"conversationDisabled")},onKeyUp:function(){this.phoneMode&&ws.html.setInnerText(this.typingIndicator.domNode,ws.string.substituteParams(Config.Strings.IM_Notice_SMS_size,
130-this.messageInput.value.length))},onKeyPress:function(a){if(a&&(a.keyCode==b.keys.ENTER||a.keyIdentifier=="Enter")&&!a.shiftKey){if(a.preventDefault(),ws.im.wim.user)this.onInputSubmit()}else if(this.phoneMode){var c=130-this.messageInput.value.length;a&&c<=0&&(a.keyCode>47||a.keyCode==b.keys.SPACE||a.charCode)&&a.preventDefault()}else this._lastKeyPress=new Date,this._updateTypingStatus()},onPhoneKeyPress:function(){},_updateTypingStatus:function(){if(ws.im.wim.user&&!this.phoneMode){var a="none";
this.messageInput.value&&(a=new Date-this._lastKeyPress>3E3?"typed":"typing");if(a!=this._lastTypingStatus)ws.im.wim.setTyping(this.buddyAimId,a),this._lastTypingStatus=a}},_lastTypingStatus:"none",uninitialize:function(){ws.im.wim.user&&this.buddyAimId&&ws.im.wim.setTyping(this.buddyAimId,"none");window.clearInterval(this._updateTypingInterval)},onBlurTextarea:function(){},onInputSubmit:function(){if(ws.im.wim.user)if(this.phoneMode)this.onSMSSubmit();else{if(this.isAnon()){var a=this.screenNameTextbox.getValue(),
a=b.trim(a||""),c=ws.im.wim.getBuddyByNick(a);if(c)a=c.aimId;a=ws.im.wim.normalize(a);if(!a){ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!0);ws.widget.Dialogs.ok(Config.Strings.IM_Label_NoRecipient);ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!1);return}this.imGroup.updateImGroup(this,this.buddyAimId,a);this.buddyAimId=a;this.updateTitle();this.cleanupNewWidgets();this.mainPane.resize()}this._lastTypingStatus="none";a=b.trim(this.messageInput.value||"");this.messageInput.value=
"";ws.browser.focus(this.messageInput);if(a&&ws.im.wim.user){var a=ws.string.escapeXml(a),a=a.replace(/\r\n|\n/g,"<br>"),c=ws.im.wim.getDisplayId(this.buddyAimId),d=new Date;a.length>2E3?(a=ws.string.substituteParams(Config.Strings.IM_Notice_MessageNotSent,c)+" ",a+=ws.string.substituteParams(Config.Strings.IM_Notice_MessageTooLarge,c),this.addMessage({message:a,senderAimId:ws.im.wim._systemAimId,autoresponse:!1,timestamp:d.getTime()/1E3})):ws.im.wim.isBuddyAllowed(this.buddyAimId)?(this.addMessage({message:a,
senderAimId:ws.im.wim.user.displayId,autoresponse:!1,timestamp:d.getTime()/1E3}),(!this.isService||this.serviceOn)&&ws.im.wim.sendIm(this.buddyAimId,a,!0,!1)):(a=ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserBlocked,c),this.addMessage({message:a,senderAimId:ws.im.wim._systemAimId,autoresponse:!1,timestamp:d.getTime()/1E3}))}}else this._appendToConversationDisplay(this._formatMessage({message:Config.Strings.SignOnStatus_Offline_SignInForIm+" "+this.buddyAimId,senderAimId:ws.im.wim._systemAimId},
!1)),this.buddyAimId?this.phoneMode?ws.widget.Dialogs.ok(Config.Strings.SignInAIMToSendTextToBuddy+" "+this.buddyAimId):ws.widget.Dialogs.ok(Config.Strings.SignInAIMToSendIMToBuddy+" "+this.buddyAimId):this.phoneMode?ws.widget.Dialogs.ok(Config.Strings.SignInAIMToSendText):ws.widget.Dialogs.ok(Config.Strings.SignInAIMToSendIM)},cleanupNewWidgets:function(){var a=b.query(".screenNameContainer",this.mainPane.domNode)[0];a&&(a=e.byNode(a),this.mainPane.removeChild(a),a.destroyRecursive());if(a=b.query(".newPhonePane",
this.mainPane.domNode)[0])a=e.byNode(a),this.mainPane.removeChild(a),a.destroyRecursive()},onSMSSubmit:function(){var a=this.isAnon()?this.newPhoneInput.value:this.buddyAimId;if(this.isAnon()&&(a=this.validatePhone(a),!a)){this.addMessage({message:Config.Strings.SMS_Validation_Error_InvalidNumber,senderAimId:ws.im.wim._systemAimId,autoresponse:!1,timestamp:d.getTime()/1E3});return}var c=b.trim(this.messageInput.value||"").substr(0,130);if(c!=""){var d=new Date;this.newPhoneInput.value=this.phoneInput.value=
a;this.imGroup.updateImGroup(this,this.buddyAimId,a,!0);this.friendly=this.buddyAimId=a;this.updateTitle();this.phonePane.hide();this.cleanupNewWidgets();ws.lang.setTimeout(this,"resize",0);Config.SMSServiceValidationEnable?this.verifyRoutabilityForSMS(a,c):(this.sendSMS(this.buddyAimId,a,c),this.messageInput.value="",this.onPhoneKeyPress(null),this.savePhoneNum(a.substr(1)),d=new Date,this.addMessage({message:c,senderAimId:ws.im.wim.user.displayId,autoresponse:!1,timestamp:d.getTime()/1E3}))}},verifyRoutabilityForSMS:function(a,
c){this._smsServiceCall("routable",{svc:"SMS",pn:a,msg:c,autoResponse:!1})},_smsServiceCall:function(a,c){c||(c={});var d="";"routable"==a&&(d=Config.SMSService+a);if(d!=null)c.r=ws.im.wim._requestId++,c.devId=Config.SMSdevId,c.f="json",d={url:d,callbackParamName:"c",content:c,load:b.hitch(this,"_onRoutability"),error:b.hitch(this,function(){}),preventCache:!0},b.io.script.get(d)},_onRoutability:function(a,c){a=a.response;c=c.args.content;this.messageInput.value="";var b=new Date;if(a.data)if(a.data.routable)ws.im.wim.sendSMS(this.buddyAimId,
a.data.routeTo,c.msg),this.messageInput.value="",this.onPhoneKeyPress(null),this.savePhoneNum(a.data.routeTo.substr(1)),this.addMessage({message:c.msg,senderAimId:ws.im.wim.user.displayId,autoresponse:!1,timestamp:b.getTime()/1E3},this.buddyAimId);else{var f="";switch(a.statusDetailCode){case this.SmsRoutingServiceDetailCodes.GenericError:case this.SmsRoutingServiceDetailCodes.NoDetail:case this.SmsRoutingServiceDetailCodes.InvalidNumber:f=Config.Strings.SMS_Validation_Error_InvalidNumber;break;case this.SmsRoutingServiceDetailCodes.NumberBlockedByUser:f=
Config.Strings.SMS_Validation_Error_NumberBlocked;break;case this.SmsRoutingServiceDetailCodes.NoPathToCarrier:f=Config.Strings.SMS_Validation_Error_NoPath;break;case this.SmsRoutingServiceDetailCodes.LandLine:f=Config.Strings.SMS_Validation_Error_Landline;break;case this.SmsRoutingServiceDetailCodes.UnknownNumber:f=Config.Strings.SMS_Validation_Error_Unknown;break;case this.SmsRoutingServiceDetailCodes.InternationalNumber:f=Config.Strings.SMS_Validation_Error_International}this.addMessage({message:f,
senderAimId:ws.im.wim._systemAimId,autoresponse:!1,timestamp:b.getTime()/1E3})}},typingChanged:function(a){this.phoneMode||ws.html.setInnerText(this.typingIndicator.domNode,ws.string.substituteParams({typing:Config.Strings.IM_Notice_UserTyping,typed:Config.Strings.IM_Notice_UserTyped,none:""}[a],ws.im.wim.getDisplayId(this.buddyAimId)))},updateTitle:function(){this.title=this.getImTitleHtml();this.imGroup._updateTabLabel(this)},getImTitleHtml:function(){return this.isAnon()?this.phoneMode?Config.Strings.IM_Title_NewText:
Config.Strings.IM_Title_NewIM:this.friendly?this.friendly:ws.im.wim.getDisplayId(this.buddyAimId)},onResized:function(){this.inherited(arguments);if(this.domNode){this.knock&&this.knock.toolbar.layout();var a=b.query(".screenNameContainer",this.mainPane.domNode)[0];if((a=a?e.byNode(a):null)&&a.isShowing()){var a=b.contentBox(a.domNode).w,c=b._getMarginSize(this.screenNameLabel).w;b.marginBox(this.screenNameTextbox.domNode,{w:a-c-5})}b.marginBox(this.messageInput,{w:b.contentBox(this.messageInput.parentNode).w});
b.marginBox(this.phoneInput,{w:b.contentBox(this.phoneInput.parentNode).w-18});this.offlinePane.isShowing()&&(this.promptToolbar.resize(),this.signToolbar.resize());this.mainPane.layout()}},_formatMessage:function(a,b){ws.im.wim.getDisplayId(a.senderAimId);var d=a.message.replace(/("http(s)?\:\S+")\s*>/gi,'$1 target="_blank">'),d=d.replace(/<div[^>]*\/>/gi,"");a.senderAimId!=ws.im.wim._systemAimId&&a.senderAimId.length!=0&&d.indexOf("<a ")==-1&&(d=d.replace(/(\s|^|>)(http(?:s)?\:\/\/[^\s<]+)(\s|$|<)/gi,
'$1<a class="wsLink" href="$2" target="_blank">$2</a>$3'),d=d.replace(/(\s|^|>)(www\.[^\s<]*\.[^\s<]*)(\s|$|<)/gi,'$1<a class="wsLink" href="http://$2" target="_blank">$2</a>$3'));var d=this._insertSmileyImages(d),f="",e="",g=ws.im.wim.getBuddyById(a.senderAimId);Settings.ChatTimeStamp&&(e=a.timestamp?new Date(a.timestamp*1E3):new Date((new Date).getTime()/1E3),e=" "+ws.im.wim.makeTimeStamp(e));var j=!0;a.senderAimId==ws.im.wim._systemAimId?(f+='<div class="mainSprite icon iconAIM"></div><span class="systemIm">',
j=!1):a.senderAimId.length==0?(f+='<span class="localMessage">',j=!1):f+=ws.im.wim.user&&a.senderAimId.toLowerCase()==ws.im.wim.user.aimId.toLowerCase()?'<img src="'+ws.im.wim.getMiniIconUrl(g)+'" class="mainSprite icon buddyShadow itsme" align="absmiddle"><span class="userIm">':'<img src="'+ws.im.wim.getMiniIconUrl(g)+'" class="mainSprite icon buddyShadow" align="absmiddle"><span class="userIm">';f+=d+"</span>";Settings.ChatTimeStamp&&j&&(f+='<span class="imTimeStamp">'+e+"</span>");a.autoresponse&&
(f="<hr>"+f+"<hr>");b&&(f='<div class="imBlock">'+f+"</div>");return f},_appendToConversationDisplay:function(a){var c=b.doc.createElement("div");c.className="imBlock";this.conversationPane.domNode.appendChild(c);c.innerHTML=a;this.scrollToEnd()},scrollToEnd:function(){window.setTimeout(b.hitch(this,function(){if(this.conversationPane&&this.conversationPane.domNode)this.conversationPane.domNode.scrollTop=this.conversationPane.domNode.scrollHeight}),200)},smiliesRegExps:[{image:"shock",regexp:/=-O/gi},
{image:"greed",regexp:/:-\$/gi},{image:"indecision",regexp:/:-\\/gi},{image:"frown",regexp:/:-\(/gi},{image:"kiss",regexp:/:-\*/gi},{image:"foot",regexp:/:-!/gi},{image:"cry",regexp:/:\'\(/gi},{image:"yell",regexp:/>:O/gi},{image:"yell",regexp:/&gt;:O/gi},{image:"shame",regexp:/:-\[/gi},{image:"kiss",regexp:/:-X/gi},{image:"wink",regexp:/;-\)/gi},{image:"tongue",regexp:/:-P/gi},{image:"cool",regexp:/8-\)/gi},{image:"halo",regexp:/O:-\)/gi},{image:"smile",regexp:/:-\)/gi},{image:"smile",regexp:/:\)/gi},
{image:"smile",regexp:/:=\)/gi},{image:"grin",regexp:/:-D/gi}],_insertSmileyImages:function(a){for(var b=0;b<this.smiliesRegExps.length;b++)var d=this.smiliesRegExps[b],a=a.replace(d.regexp,'<img class="imSmiley imS'+d.image+'" src="'+Config.SpacerImageURL+'">');return a},showIfUserIsOffline:function(a){a=a||this.buddyAimId;if(a.indexOf(this.imGroup.anonIdPrefix)!=0&&ws.im.wim.isInBuddyList(a)&&ws.im.wim.isBuddyAllowed(a)){var c=ws.im.wim.buddies[a];c?this._showIfUserIsOffline(c):c||ws.im.wim.getPresence(a,
b.hitch(this,"_showIfUserIsOffline"))}},addOfflineLinks:function(){var a=this.isAnon()?this._lastCheckedScreenName:this.buddyAimId,b=ws.string.substituteParams("<span class='wsLink' onclick='dojo.publish(\"aimWimSendEmail\", [\""+a+"\"]); return false;'>{0}</span>",Config.Strings.SendEmail),a=ws.string.substituteParams(" | <span class='wsLink' onclick='dojo.publish(\"aimWimSetPhoneMode\", [\""+a+"\"]); return false;'>{0}</span>",Config.Strings.Text_Message);Settings.ShowMobileIcon||(a="");var d=new Date;
this.addMessage({message:ws.string.substituteParams(Config.Strings.IM_Notice_OfflineLinks,b+a,""),autoresponse:!1,senderAimId:"",timestamp:d.getTime()/1E3})},_showIfUserIsOffline:function(a){if(a.state=="offline"){var b="",b=a.service?ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserOfflineService,ws.im.wim.getDisplayId(a.aimId)):ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserOfflineMaybe,ws.im.wim.getDisplayId(a.aimId));this.addMessage({message:b,senderAimId:ws.im.wim._systemAimId});
a.service||this.addOfflineLinks()}},onBlurScreenName:function(){var a=this.screenNameTextbox.getValue();if(a&&a!=this._lastCheckedScreenName){this._lastCheckedScreenName=a;var b=ws.im.wim.getBuddyByNick(a);if(b)a=b.aimId;this.showIfUserIsOffline(a)}},setupKnockKnock:function(){this.knock=new ws.im.KnockKnock({buddyAimId:this.buddyAimId});this.stackWidget.addChild(this.knock);this.stackWidget.selectChild(this.knock);this.connect(this.knock,"onClickAccept","onAcceptKnockKnock");this.connect(this.knock,
"onClickDecline","onDeclineKnockKnock");this.connect(this.knock,"onClickBlock","onDeclineKnockKnock")},onAcceptKnockKnock:function(){var a=this.buddyAimId;this.getParent().closeChild(this);this.knock=null;b.publish("aimWimBuddyClicked",[{aimId:a}])},onDeclineKnockKnock:function(){this.getParent().closeChild(this);this.knock=null},clearImHistory:function(){},_getTimezoneString:function(a){a=-a.getTimezoneOffset();return(a>=0?"+":"-")+b.string.pad(Math.floor(Math.abs(a)/60),2)+b.string.pad(Math.abs(a)%
60,2)},_formatMessageMF:function(a,b){if(a.senderAimId.length==0)return"";var d=ws.im.wim.getDisplayId(a.senderAimId)||a.senderAimId;a.autoresponse&&(d=Config.Strings.IM_Label_AutoResponsePrefix+d);var f=a.message.replace(/("http(s)?\:\S+")\s*>/g,'$1 target="_blank">'),f=this._insertSmileyImages(f),e="",g="",j="",i;i=a.timestamp?new Date(a.timestamp*1E3):new Date((new Date).getTime()/1E3);g=" "+ws.im.wim.makeTimeStamp(i);a.senderAimId.toLowerCase()==this.buddyAimId.toLowerCase()?e+='<span class="username buddyImName" style="font-weight:bold;color:blue">'+
d+'</span><abbr class="timestamp imTimeStamp" style="font-weight:normal;font-size:10px" title="'+ws.date.formatISO8601(i)+this._getTimezoneString(i)+'">'+g+': </abbr><span class="messageData userIm">':a.senderAimId==ws.im.wim._systemAimId||a.senderAimId.length==0?(j=" status",e+='<span class="username" style="display:none">'+a.aboutAimId+'</span><abbr class="timestamp imTimeStamp" style="font-weight:normal; font-size:10px" title="'+ws.date.formatISO8601(i)+this._getTimezoneString(i)+'">'+g+': </abbr><span class="type" title="'+
a.state+'" style="display:none">'+(a.awayMessage?a.awayMessage:"")+'</span><span class="messageData systemIm" style="color:gray;text-align:left;font-size:11px">'):e+='<span class="username userImName" style="font-weight:bold;color:red">'+d+'</span><abbr class="timestamp imTimeStamp" style="font-weight:normal;font-size:10px;" title="'+ws.date.formatISO8601(i)+this._getTimezoneString(i)+'">'+g+': </abbr><span class="messageData userIm">';e+=f+"</span>";a.autoresponse&&(e="<hr>"+e+"<hr>");b&&(e='<div style="display:block" class="message imBlock'+
j+'">'+e+"</div>\n");return e},getParticipantMarkup:function(){return'<div class="participants" style="display:none">\n<div class="vcard" style="display:none" uid="'+ws.im.wim.user.aimId+'"> <div class="fn" style="display:none">'+ws.im.wim.getDisplayId(ws.im.wim.user.aimId)+'</div></div>\n<div class="vcard" style="display:none" uid="'+this.buddyAimId+'"> <div class="fn" style="display:none">'+ws.im.wim.getDisplayId(this.buddyAimId)+"</div></div>\n</div>\n"},getConversationMarkup:function(){var a=
"",b=ws.im.wim.buddies[this.buddyAimId];if(b&&b.im){var d=b.im,a='<div class="hChat">\n<div class="title" style="display:none">'+ws.string.substituteParams(Config.Strings.IMSave_Title,ws.date.formatDateTime(new Date,"MMM d"))+'</div>\n<div class="service" style="display:none">'+(b.service?b.service:"AIM")+"</div>\n";a+=this.getParticipantMarkup();for(b=0;b<d.length;b++)a+=this._formatMessageMF(d[b],!0);a+="</div>"}return a},_getMessageTitle:function(){var a="",b=ws.im.wim.buddies[this.buddyAimId];
if(b&&b.im)for(var b=b.im,d=0,f=b.length-1;f>=0;f--)b[f].senderAimId!=ws.im.wim._systemAimId&&b[f].senderAimId.length>0&&(d++,a.length>50||(a+=(a.length>0?" | ":"")+b[f].message.replace(/\<.*?\>|&.*?;|\r\n/g," ")));return ws.string.substituteParams(Config.Strings.IMSave_subject_prefix,d)+a.substr(0,50)},saveConversation:function(a,c){var d=this.getConversationMarkup();if(d.length==0)this.addMessage({message:Config.Strings.IMSave_Empty,senderAimId:ws.im.wim._systemAimId,autoresponse:!1,timestamp:(new Date).getTime()/
1E3});else{b.publish("WSFeedbackStart",[Config.Strings.IM_Notice_Saving]);var f=ws.im.wim.buddies[this.buddyAimId],d={From:ws.UserContext.UserAddress,To:f&&f.service?ws.im.wim.getDisplayId(this.buddyAimId):this.buddyAimId,Subject:this._getMessageTitle(),ChatLog:!0,RichEdit:!0,RichBody:d,PlainBody:ws.html.renderedTextContent(this.conversationPane.domNode),DraftMsgFolder:a};ws.io.rpc({action:"SaveMessage",content:d,load:b.hitch(this,function(){b.publish("WSFeedbackEnd",[Config.Strings.IM_Notice_Saving]);
var a=new Date;this.addMessage({message:ws.string.substituteParams(Config.Strings.IMSave_Success,c),senderAimId:ws.im.wim._systemAimId,autoresponse:!1,timestamp:a.getTime()/1E3})}),error:b.hitch(this,function(){b.publish("WSFeedbackEnd",[Config.Strings.IM_Notice_Saving]);var a=new Date;this.addMessage({message:ws.string.substituteParams(Config.Strings.IMSave_Failure,c),senderAimId:ws.im.wim._systemAimId,autoresponse:!1,timestamp:a.getTime()/1E3})})});ws.reporting.reportAction("IM Save Conversation "+
a)}},sendMail:function(){var a=this.isAnon()?this._lastCheckedScreenName:this.buddyAimId;ws.WebSuite.exitSettings();ws.WebSuite.getCompose(null,function(b){b.reset({to:a,backToString:"setFolder"})})},validatePhone:function(a){var b=null,a=a.replace(RegExp(/\s/g),"");a.match(RegExp(/^\+?[\(\)\-\.0-9]*$/))&&(a=a.replace(RegExp(/[^0-9]/g),""),a.length>=10&&(a.length==10?b="+1"+a:a.length==11&&a[0]=="1"&&(b="+"+a)));return b},getBestPhone:function(){this.contactRec=this.addrModel.getRecordByScreenName(this.buddyAimId);
var a=[];if(this.contactRec){for(var b=1;b<5;b++)if(this.contactRec["phone"+b]){if(this.contactRec["phone"+b+"Type"]=="Cellular")return this.contactRec["phone"+b];a.push(this.contactRec["phone"+b])}if(a.length>0)return a[0]}return""},_ignoreResponse:function(){},savePhoneNum:function(a){if(this.contactRec)for(var c=1;c<5;c++)if(!this.contactRec["phone"+c]||this.contactRec["phone"+c].length==0){this.contactRec["phone"+c]=a;this.contactRec["phone"+c+"Type"]="Cellular";this.contactRec.load=b.hitch(this,
"_ignoreResponse");this.contactRec.error=b.hitch(this,"_ignoreResponse");if(this.addrModel.getCategories())this.contactRec.category=this.addrModel.getCategories()[this.contactRec.category];this.addrModel.createOrModifyContact(this.contactRec);break}else if(this.contactRec["phone"+c]==a)break},setIMmode:function(){if(this.phoneMode){this.phoneMode=!1;ws.html.setInnerText(this.typingIndicator.domNode,"");var a=Config.Strings.IM_Notice_AIM;if(this.isAnon()){var c=b.query(".screenNameContainer",this.mainPane.domNode)[0];
if(c)c.style.display="";if(c=b.query(".newPhonePane",this.mainPane.domNode)[0])c.style.display="none"}else if(this.phonePane.hide(),this.isService)a=Config.Strings.IM_Notice_FB;ws.browser.focus(this.messageInput);this.updateTitle();this.addMessage({message:a,senderAimId:ws.im.wim._systemAimId,autoresponse:!1,timestamp:(new Date).getTime()/1E3});ws.lang.setTimeout(this.mainPane,"resize",0)}},setPhonemode:function(){if(!this.phoneMode&&Settings.ShowMobileIcon){this.phoneMode=!0;if(this.isAnon()){var a=
b.query(".screenNameContainer",this.mainPane.domNode)[0];if(a)a.style.display="none";if(a=b.query(".newPhonePane",this.mainPane.domNode)[0])a.style.display=""}else this.phonePane.show();if(this.phoneInput.value.length==0&&this.buddyAimId.length>0)a=this.getBestPhone(),a.length>0?(this.phoneInput.value="+"+a,ws.browser.focus(this.messageInput)):(a=this.isAnon()?this.newPhoneInput:this.phoneInput,a.value=Config.Strings.IM_Notice_PhoneNumber,ws.browser.focus(a),ws.lang.setTimeout(function(a){try{a.select()}catch(b){}},
50,a));ws.lang.setTimeout(this.mainPane,"resize",0);this.updateTitle();this.onKeyUp(null);var a=new Date,c=Config.Strings.IM_Notice_SMS+" "+Config.Strings.IM_Notice_SMSDisclaimer;Config.SMSLegalInfoURL.length>0&&(c+=" "+ws.string.substituteParams("<a target=_blank href='{0}'>{1}</a>",Config.SMSLegalInfoURL,Config.Strings.IM_Notice_SMSInfo));this.addMessage({message:c,senderAimId:ws.im.wim._systemAimId,autoresponse:!1,timestamp:a.getTime()/1E3})}},onSessionStart:function(){this.onlinePane.show();this.offlinePane.hide();
this.phoneMode&&(ws.browser.focus(this.phoneInput),ws.lang.setTimeout(function(a){try{a.select()}catch(b){}},50,this.phoneInput));this.onResized()},onSessionEnd:function(){this.promptNode.innerHTML=Config.Strings.DisconnectedAIM;this.aimLogo.className="mainSprite aimLogo";this.signinBtn.className="wsLink";this.onlinePane.hide();this.offlinePane.show();this.signToolbar.resize();this.promptToolbar.resize();this.onResized()},onFBStart:function(){this.onlinePane.show();this.offlinePane.hide();this.onResized()},
onFBEnd:function(){if(Config.EnableIMServices&&this.isService)this.promptNode.innerHTML=Config.Strings.DisconnectedFB,this.aimLogo.className="mainSprite fbLogo",this.signinBtn.className="fbLink",this.onlinePane.hide(),this.offlinePane.show(),this.onResized()},onClickSignIn:function(){ws.im.wim.user?ws.im.wim.setServiceConnection("facebook",!0):b.publish("aimSignIn")},onBuddyListLoad:function(){try{var a=new Date,b=ws.im.wim.buddies[this.buddyAimId],d=ws.im.wim.getServiceConfig("facebook");if(!b&&
d&&!d.online){if(this.serviceOn&&(this.serviceOn=!1,!this.isAnon())){var f=this.friendly?this.friendly:ws.im.wim.getDisplayId(this.buddyAimId),e=ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserOfflineService,f);this.addMessage({message:e,timestamp:a.getTime()/1E3,autoresponse:!1,senderAimId:ws.im.wim._systemAimId});this.onFBEnd()}}else if(b&&b.service&&!this.serviceOn&&d)this.serviceOn=!0,this.isAnon()||(f=this.friendly?this.friendly:ws.im.wim.getDisplayId(this.buddyAimId),e=ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserOnline,
f),this.addMessage({message:e,timestamp:a.getTime()/1E3,autoresponse:!1,senderAimId:ws.im.wim._systemAimId})),this.onFBStart()}catch(g){}}}));b._hasResource["ws.im.ImGroup"]||(b._hasResource["ws.im.ImGroup"]=!0,b.provide("ws.im.ImGroup"),b.declare("ws.im.MoverNoScroll",b.dnd.Mover,{onMouseMove:function(a){var b=this.marginBox;this.host.onMove(this,{l:b.l+a.pageX,t:b.t+a.pageY})},onMouseUp:function(){this.host.imGroup.ensureOnscreen();this.inherited(arguments)}}),b.declare("ws.im.ImGroup",[e._Widget,
e._Templated],{templateString:b.cache("ws.im","ImGroup.html",'<div class="imGroup">\r\n\t<div dojoType="dijit.layout.LayoutContainer" class="imGroupWindow" dojoAttachPoint="windowPane">\r\n\t\t<div dojoType="dijit.layout.StackController" dojoAttachPoint="pageController" containerId="${id}pageContainer" buttonWidget="ws.im.ImPageButton" class="nav" layoutAlign="left"></div>\r\n\t\t<div class="closingPane" dojoType="ws.widget.Pane" dojoAttachPoint="closingPane" layoutAlign="client">\r\n\t\t\t<div class="closingMsg" dojoAttachPoint="closingMsg"></div>\r\n\t\t\t<div dojoAttachPoint="closingTB" dojoType="ws.widget.WSToolbar" vizType="Bare">\r\n\t\t\t\t<div dojoType="ws.widget.Pane" toolbarPosition="center">\r\n\t\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick: _onClickCloseButton">${Yes}</div>\r\n\t\t\t\t\t<div dojoType="ws.widget.Button" type="Bare"dojoAttachPoint="cancelBtn" dojoAttachEvent="onClick: onClickCancel">${Cancel}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class="imGroupContent" id="${id}_window" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="windowPaneContent" layoutAlign="client">\r\n\t\t\t<div dojoType="ws.widget.Pane" dojoAttachPoint="titlePane" class="titleBar" layoutAlign="top">\r\n\t\t\t\t<img class="logo mainSprite status-online" dojoAttachPoint="titleStatus" src="${spacer}">\r\n\t\t\t\t<div class="title" dojoAttachPoint="windowTitleNode">\r\n\t\t\t\t\t<table dojoAttachPoint="tableNode" dojoAttachEvent="onclick: onClickMenu">\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td><div class="titleCell" dojoAttachPoint="titleCell"><span class="wsLink" dojoAttachPoint="containerNode"></span></div></td>\r\n\t\t\t\t\t\t\t<td width="13"><img src="${spacer}" class="wsArrow"></td>\r\n\t\t\t\t\t\t\t<td width="1"></td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t\t<span class="mainSprite imCloseBtn" dojoAttachEvent="onclick: onClickCloseButton"></span>\r\n\t\t\t\t<span class="mainSprite imMinBtn" dojoAttachEvent="onclick: onClickMinimizeButton"></span>\r\n\t\t\t</div>\r\n\t\t\t<div class="signinCont" dojoType="dijit.layout.StackContainer" dojoAttachPoint="signinPageContainer" layoutAlign="client">\r\n\t\t\t\t<div dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="onlinePane">\r\n\t\t\t\t\t<div dojoType="dijit.layout.StackContainer" dojoAttachPoint="pageContainer" id="${id}pageContainer" layoutAlign="client"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="signin" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="offlinePane">\r\n\t\t\t\t\t<div class="wrap">\t\t\t\t\r\n\t\t\t\t\t\t<div class="prompt" dojoAttachPoint="promptNode"></div>\t\t\t\r\n\t\t\t\t\t\t<img class="mainSprite aimlogo"  src="${spacer}">\r\n\t\t\t\t\t\t<span class="wsLink signinBtn" dojoAttachPoint="signinBtn">${SignIn}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="titleBar imGroupMinimized" style="display: none;" dojoAttachPoint="minimizedNode" dojoAttachEvent="onclick: onClickRestoreButton">\r\n\t\t<span dojoAttachPoint="minimizedTitleNode" class="title"></span>\r\n\t\t<span class="mainSprite imCloseBtn" dojoAttachEvent="onclick: onClickCloseButton"></span>\r\n\t\t<span class="mainSprite imResBtn"></span>\r\n\t</div>\r\n</div>\r\n\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,imMap:{},anonIdPrefix:">>@n0n<<",anonIdCounter:0,navWidth:172,isMinimized:!1,titlebarFlash:!1,titlebarTimer:null,startup:function(){if(b.isIE||b.isFF>=4)this.connect(this.titlePane.domNode,"onmousedown","onMoveMouseDown"),this.connect(this.titlePane.domNode,"onmouseup","onMoveMouseUp"),this.resizeHandle=b.create("div",{className:"dojoxResizeHandle"}),this.windowPaneContent.domNode.appendChild(this.resizeHandle),this.connect(this.resizeHandle,
"onmousedown","onResizeMouseDown"),this.connect(this.resizeHandle,"onmouseup","onResizeMouseUp"),this.minSize={w:330,h:250};else{var a=new b.dnd.Moveable(this.windowPane.domNode,{handle:this.titlePane.domNode,mover:ws.im.MoverNoScroll});a.imGroup=this;b.disconnect(a.events[2]);a=new l.layout.ResizeHandle({targetContainer:this.windowPane.domNode,activeResize:!0,minWidth:330,minHeight:250});a.startup();this.connect(a,"_updateSizing","onResized");this.connect(a,"_endSizing","ensureOnscreen");this.windowPaneContent.domNode.appendChild(a.domNode)}var a=
b.window.getBox(),c=b._getMarginSize(this.windowPane.domNode);this.windowPane.domNode.style.left=a.w-c.w-230+"px";if(c.h>300)c.h=274;this.windowPane.domNode.style.top=a.h-c.h+"px";this.pageController.hide();this.onResized();this.subscribe("aimWimUnblock","unblockBuddy");this.subscribe(this.pageContainer.id+"-selectChild","onSelectChild");this.subscribe(this.pageContainer.id+"-removeChild","onRemoveChild");this.subscribe(this.pageContainer.id+"-addChild","onAddChild");this.subscribe("wsresize","ensureOnscreen");
b.isIE<8&&this.subscribe("ws_view-selectChild","ensureOnscreen");this.subscribe("aimWimSendEmail","sendMail");this.subscribe("aimWimSetPhoneMode","setPhonemode");this.connect(this.windowPane,"resize","onTitleResized");this.connect(this.signinBtn,"onclick","onClickSignIn");this.createActionMenu();this.windowTitleNode.menu=this.actionMenu;this.connect(window,"onunload","unload");this.promptNode.innerHTML=Config.Strings.SignInAIMToSendIM;ws.im.wim.listeners.push(this)},onResizeMouseDown:function(a){ws.widget.popup.closeAllPopups();
document.releaseCapture();this.rszHandle&&this.disconnect(this.rszHandle);var c=b.marginBox(this.windowPane.domNode);this.startPoint={x:a.pageX,y:a.pageY};this.startSize={w:c.w,h:c.h};this.resizeHandle.setCapture(!0);this.rszHandle=this.connect(this.resizeHandle,"onmousemove","onResizeMouseMove");b.stopEvent(a)},onResizeMouseUp:function(){document.releaseCapture();this.rszHandle&&this.disconnect(this.rszHandle);this.rszHandle=null;this.ensureOnscreen()},onResizeMouseMove:function(a){b.stopEvent(a);
if(a=this._getNewCoords(a))b.marginBox(this.windowPane.domNode,a),this.onResized()},_getNewCoords:function(a){try{if(!a.clientX||!a.clientY)return!1}catch(b){return null}return this._checkConstraints(this.startSize.w+(a.pageX-this.startPoint.x),this.startSize.h+(a.pageY-this.startPoint.y))},_checkConstraints:function(a,b){if(this.minSize){var d=this.minSize;if(a<d.w)a=d.w;if(b<d.h)b=d.h}if(this.constrainMax&&this.maxSize){d=this.maxSize;if(a>d.w)a=d.w;if(b>d.h)b=d.h}return{w:a,h:b}},onMoveMouseDown:function(a){ws.widget.popup.closeAllPopups();
document.releaseCapture();this.mvrHandle&&this.disconnect(this.mvrHandle);this.startPoint={x:a.pageX,y:a.pageY};a.target.setCapture(!0);this.mvrHandle=this.connect(a.target,"onmousemove","onMoveMouseMove");b.stopEvent(a)},onMoveMouseUp:function(){document.releaseCapture();this.mvrHandle&&this.disconnect(this.mvrHandle);this.mvrHandle=null;this.ensureOnscreen()},onMoveMouseMove:function(a){b.stopEvent(a);var c=this.windowPane.domNode.style,d=Math.round(parseFloat(c.left))||0,f=Math.round(parseFloat(c.top))||
0;c.left=d+(a.pageX-this.startPoint.x)+"px";c.top=f+(a.pageY-this.startPoint.y)+"px";this.startPoint={x:a.pageX,y:a.pageY}},unload:function(){try{for(var a in this.imMap){var b=this.imMap[a];b&&b.close()}}catch(d){}},onSessionStart:function(){this.signinPageContainer.selectChild(this.onlinePane);this.onlinePane.resize()},onSessionEnd:function(){this.promptNode.innerHTML=Config.Strings.SignInAIMToSendIM},onError:function(a){var b=new Date;if(a.action=="im/sendIM"){var d=ws.im.wim.lastIMStatusCode=
a.statusCode,f=a.params.t;ws.im.wim.phones[f]&&(f=ws.im.wim.phones[f]);var e=ws.im.wim.getDisplayId(f),g=ws.string.substituteParams(Config.Strings.IM_Notice_MessageNotSent,e)+" ";if(d==602){if((a=this.imMap[f])&&a.phoneMode)a=a.phoneInput.value,a.length>0&&(e=a);g+=ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserOffline,e)}else d==603?a.resp.data.subCode.subError==14?g=ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserOfflineService,e):g+=ws.im.wim.isBuddyAllowed(f)?ws.string.substituteParams(Config.Strings.IM_Notice_UserBlocked,
e):ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserBlocked,e):g+=d==606?ws.string.substituteParams(Config.Strings.IM_Notice_MessageTooLarge,e):d==430?Config.Strings.Notice_NearRateLimit:d==600?Config.Strings.IM_Notice_InvalidTarget:a.statusText;ws.im.wim.user&&this.addIm(f,{message:g,senderAimId:ws.im.wim._systemAimId,autoresponse:!1,timestamp:b.getTime()/1E3},!1,!0)}else if(a.action=="routable")ws.im.wim.user&&this.pageContainer.selectedChildWidget.addMessage({message:a.errorMsg,autoresponse:!1,
senderAimId:ws.im.wim._systemAimId,timestamp:b.getTime()/1E3});else if(this.isShowing()&&!this.isMinimized&&a.errorType!=9){f=a;if(typeof f=="object")for(g in f="",a)g!="params"&&(f+=g+": "+a[g]+", ");ws.im.wim.user&&(this.pageContainer.selectedChildWidget.addMessage({message:Config.Strings.Error_AimGeneric,autoresponse:!1,senderAimId:ws.im.wim._systemAimId,timestamp:b.getTime()/1E3}),this.pageContainer.selectedChildWidget.addMessage({message:f,autoresponse:!1,senderAimId:ws.im.wim._systemAimId,timestamp:b.getTime()/
1E3}))}},onBuddyListLoad:function(){try{for(var a in this.imMap){var b=this.imMap[a];b&&(b._showSavedConversation(),b.updateTitle())}this._setTitleIcon(this.pageContainer.selectedChildWidget)}catch(d){}},onPresenceChanged:function(a){var b=a.aimId,d=ws.im.wim.getDisplayId(b),f=a.state;if(this.imMap[b]){var e=ws.im.wim.buddies[b];if(!this.pageContainer.selectedChildWidget.isAnon()&&e&&e.state&&a.oldValues.state&&a.oldValues.state!=e.state){var g=new Date,f=e.state,j="";f=="online"?j=ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserOnline,
d):f=="offline"?j=e.service?ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserOfflineService,d):ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserOfflineMaybe,d):f=="away"&&(j=ws.string.substituteParams(Config.Strings.IM_Notice_RemoteUserAway,d));j&&this.addIm(b,{message:j,awayMessage:"",senderAimId:ws.im.wim._systemAimId,aboutAimId:b,state:f,autoresponse:!1,timestamp:g.getTime()/1E3},!1,!0);f=="offline"&&!e.service&&this.imMap[b].addOfflineLinks()}if(e&&(!e.friendly||a.oldValues.friendly!=
e.friendly)){if(e.friendly)this.imMap[b].friendly=e.friendly;this.imMap[b]._showSavedConversation();this.imMap[b].updateTitle()}this._setOffline(this.imMap[b],f=="offline"||f=="away")}},addIm:function(a,b,d,e,h){var g=!1;a||(g=!0,a=this.anonIdPrefix+(this.anonIdCounter-1),a=this.imMap[a]?a:this.anonIdPrefix+this.anonIdCounter++);var j=ws.im.wim.getDisplayId(a),i=this.imMap[a];if(!i){if(ws.im.wim.declinedBuddies[b.senderAimId]&&!d)return;i=this.imMap[a]=new ws.im.Im({isUserInitiated:g?!0:d,closable:!0,
imGroup:this,buddyAimId:a,title:a.indexOf(this.anonIdPrefix)>-1?h?Config.Strings.IM_Title_NewText:Config.Strings.IM_Title_NewIM:j});this.pageContainer.addChild(i);(d||this.pageContainer.getChildren().length==1)&&this.pageContainer.selectChild(i);this.pageContainer.getChildren().length==1?ws.reporting.reportAction("IM Win Open"):ws.reporting.reportAction("IM Tab Open");this._updateTabLabel(i)}b.message&&b.message.length>0&&i.addMessage(b);if(d&&this.isMinimized)this.onClickRestoreButton();if(!this.isShowing())this.windowPane.domNode.style.left=
this.savedL,this.windowPane.domNode.style.top=this.savedT,this.show(),this.onClickRestoreButton();this._showHideNavPane();!e&&b.senderAimId.length>0&&(d?(this.pageContainer.selectChild(i),ws.im.wim.user&&i.messageInput.focus()):((this.isMinimized||i!=this.pageContainer.selectedChildWidget)&&this._setNewMessage(i,!0),b.message&&ws.browser.setFlashingWindowTitle(ws.string.substituteParams(Config.Strings.IM_Title,j))));this.signinPageContainer.selectChild(this.onlinePane);h||a.charAt(0)=="+"?i.setPhonemode():
d&&!h&&i.setIMmode();this.updateActionMenu()},closeIm:function(a){var b=this.imMap[a];b&&(b.close(this),delete this.imMap[a])},onClickCancel:function(){this.isClosing=!1;this.closingPane.hide();this.windowPaneContent.show();this.windowPane.resize()},onClickCloseButton:function(a){ws.widget.popup.closeAllPopups();var b=this.pageContainer.getChildren().length;this.isClosing=!0;if(b>1){if(this.isMinimized)this.onClickRestoreButton();this.closingMsg.innerHTML=ws.string.substituteParams(Config.Strings.IM_Label_CloseConfirmation,
b);this.windowPaneContent.hide();this.closingPane.show();this.windowPane.resize();this.closingTB.layout()}else this._onClickCloseButton();a.stopPropagation()},_onClickCloseButton:function(){for(;this.pageContainer.getChildren().length>0;)this.pageContainer.closeChild(this.pageContainer.getChildren()[0]);ws.reporting.reportAction("IM Win Close");this.isClosing=!1;this.closingPane.hide();this.windowPaneContent.show()},onClickMinimizeButton:function(){ws.widget.popup.closeAllPopups();this.savedL=this.windowPane.domNode.style.left;
this.savedT=this.windowPane.domNode.style.top;this.windowPane.domNode.style.display="none";this.minimizedNode.style.display="";this.isMinimized=!0;this._updateTitle()},onClickRestoreButton:function(){this.windowPane.domNode.style.display="";this.minimizedNode.style.display="none";this.windowPane.domNode.style.left=this.savedL;this.windowPane.domNode.style.top=this.savedT;this._showHideNavPane();this.pageContainer.selectedChildWidget.scrollToEnd();this.isMinimized=!1;this._setNewMessage(this.pageContainer.selectedChildWidget,
!1);this.onResized()},onClickSignIn:function(){b.publish("aimSignIn")},createActionMenu:function(){if(!this.actionMenu)this.actionMenu=new ws.widget.WSMenu,this.actionMenu.startup(),b.addClass(this.actionMenu.domNode,"imActionMenu"),this.ignoreMenuItem=new ws.widget.WSMenuItem({caption:Config.Strings.Menu_Ignore,onClick:b.hitch(this,"ignoreBuddy")}),this.actionMenu.addChild(this.ignoreMenuItem),this.blockMenuItem=new ws.widget.WSMenuItem({caption:Config.Strings.Menu_Block,onClick:b.hitch(this,"blockBuddy")}),
this.actionMenu.addChild(this.blockMenuItem),this.actionMenu.addChild(new ws.widget.WSMenuSeparator),this.emailMenuItem=new ws.widget.WSMenuItem({caption:Config.Strings.Title_SwitchMail,onClick:b.hitch(this,"mailBuddy")}),this.actionMenu.addChild(this.emailMenuItem),this.modeMenuItem=new ws.widget.WSMenuItem({caption:Config.Strings.Title_SwitchTxtMsg,onClick:b.hitch(this,"setMode")}),Settings.ShowMobileIcon&&this.actionMenu.addChild(this.modeMenuItem),this.actionMenu.addChild(new ws.widget.WSMenuSeparator),
this.timeMenuItem=new ws.widget.WSMenuItem({caption:Config.Strings.IMMenu_ShowTimestamp,onClick:b.hitch(this,"showTimestamp")}),this.actionMenu.addChild(this.timeMenuItem),this.actionMenu.addChild(new ws.widget.WSMenuItem({caption:Config.Strings.Title_SaveIMToFolder,onClick:b.hitch(this,"saveIM")})),this.actionMenu.addChild(new ws.widget.WSMenuItem({caption:Config.Strings.IMMenu_ClearWindow,onClick:b.hitch(this,"clearWindow")}))},onClickMenu:function(){ws.im.wim.user!=null&&(ws.widget.popup.closeAllPopups(),
this.updateActionMenu(),this.actionMenu.open(this.tableNode))},updateActionMenu:function(){var a=this.pageContainer.selectedChildWidget,b=a.buddyAimId;this.ignoreMenuItem.setChecked(b&&b in ws.im.wim.ignoredBuddies);this.blockMenuItem.setChecked(b&&b in ws.im.wim.blockedBuddies);this.timeMenuItem.setChecked(Settings.ChatTimeStamp);(b=ws.im.wim.buddies[b])&&b.service?(this.blockMenuItem.disable(),this.emailMenuItem.disable()):(this.blockMenuItem.enable(),this.emailMenuItem.enable());a.phoneMode?this.modeMenuItem.setCaption(Config.Strings.Title_SwitchIM):
this.modeMenuItem.setCaption(Config.Strings.Title_SwitchTxtMsg)},unblockBuddy:function(){this.blockBuddy(!0)},blockBuddy:function(a){if(!this.pageContainer.selectedChildWidget.isAnon()){var b=this.pageContainer.selectedChildWidget.buddyAimId;if(!a||b in ws.im.wim.blockedBuddies)b in ws.im.wim.blockedBuddies||a?(ws.im.wim.unblockBuddy(b),a=ws.string.substituteParams(Config.Strings.IM_Notice_Unblocked,b)):(ws.im.wim.blockBuddy(b),a=ws.string.substituteParams("<div class='blockMsg'><div class='blockMsgText'>%{0}</div><div class='blockMsgUser'>%{1}</div><div class='blockMsgLink'><span class='wsLink' onclick='dojo.publish(\"aimWimUnblock\"); return false;'>%{2}</span></div></div>",
Config.Strings.IM_Notice_Blocked,b,Config.Strings.IM_Notice_UnblockLink)),this.updateActionMenu(),this.pageContainer.selectedChildWidget.addMessage({message:a,autoresponse:!1,senderAimId:"",timestamp:(new Date).getTime()/1E3})}},ignoreBuddy:function(){if(!this.pageContainer.selectedChildWidget.isAnon()){var a=this.pageContainer.selectedChildWidget.buddyAimId,b=!(a in ws.im.wim.ignoredBuddies);ws.im.wim.ignoreBuddy(a,b);this.updateActionMenu();var d=new Date;this.pageContainer.selectedChildWidget.addMessage({message:ws.string.substituteParams(b?
Config.Strings.IM_Notice_Ignored:Config.Strings.IM_Notice_Unblocked,ws.im.wim.getDisplayId(a)),autoresponse:!1,senderAimId:ws.im.wim._systemAimId,timestamp:d.getTime()/1E3})}},showTimestamp:function(){var a=!Settings.ChatTimeStamp;ws.settings.saveSoon({ChatTimeStamp:a});Settings.ChatTimeStamp=a;this.updateActionMenu();for(var b in this.imMap)(a=this.imMap[b])&&a._showSavedConversation()},clearWindow:function(){this.pageContainer.selectedChildWidget.clearWindow()},typingChanged:function(a,b){this.imMap[a]&&
this.imMap[a].typingChanged(b)},updateImGroup:function(a,b,d,e){if(!e&&this._updatedExistingIm(d)){var h=this;setTimeout(function(){h.closeIm(b)},10)}else this.imMap[b]&&(delete this.imMap[b],this.imMap[d]=a)},_updatedExistingIm:function(a){var b=this.imMap[a];b&&setTimeout(function(){b._showSavedConversation();b._informNewMessage("",!0)},200);return!!b},_setOffline:function(a,b){this.pageController.pane2button[a.id].setOffline(b)},_setNewMessage:function(a,b){this.pageController.pane2button[a.id].setNewMessage(b);
this._updateTitle()},_updateTabLabel:function(a){var b=ws.im.wim.getBuddyById(a.buddyAimId),d=this.pageController.pane2button[a.id];d.setLabel(a.title);d.setBuddyIcon(ws.im.wim.getMiniIconUrl(b));b&&b.service&&d.setServiceIcon();this._updateTitle()},_updateTitle:function(){var a=this.pageContainer.selectedChildWidget,c=a.isAnon()?a.phoneMode?Config.Strings.IM_Title_NewText:Config.Strings.IM_Title_NewIM:a.friendly?a.friendly:ws.im.wim.getDisplayId(a.buddyAimId);ws.im.wim.getBuddyById(a.buddyAimId);
this.containerNode.innerHTML=c;this.onTitleResized();this._setTitleIcon(a);var a=this.pageController.getChildren().length,d=(c=b.filter(this.pageController.getChildren(),function(a){return a.hasNewMessage}).length)?ws.string.substituteParams(Config.Strings.IM_Title_NewCount,c):"";this.minimizedTitleNode.innerHTML=(a==1?Config.Strings.IM_Title_OneIM:ws.string.substituteParams(Config.Strings.IM_Title_MultipleIMs,a))+("<span class='newCounter'>"+d+"</span>");if((a=c>0)&&this.isMinimized){if(this.titlebarTimer==
null)this.titlebarFlash=!1,this.titlebarTimer=setInterval(b.hitch(this,"titlebarInterval"),800)}else if(this.titlebarTimer)clearInterval(this.titlebarTimer),this.titlebarTimer=null;b.toggleClass(this.minimizedNode,"minimizedNewMessages",a)},titlebarInterval:function(){if(this.titlebarTimer!=null)b.toggleClass(this.minimizedNode,"minimizedNewMessages",this.titlebarFlash),this.titlebarFlash=!this.titlebarFlash},_setTitleIcon:function(a){if(a){var b=ws.im.wim.buddies[a.buddyAimId];this.titleStatus.className=
b&&b.service?"logo mainSprite service":"logo mainSprite status-"+(a.phoneMode?"mobile2":b?b.state:"offline")}},onAddChild:function(a){(a=this.pageController.pane2button[a.id])&&a.domNode.scrollIntoView(!1)},onSelectChild:function(a){this._setTitleIcon(a);this._setNewMessage(a,!1);for(var b in this.pageController.pane2button){var d=this.pageController.pane2button[b];d.setChecked(d.checked)}a.scrollToEnd();e.focus(a.messageInput)},onRemoveChild:function(a){ws.im.wim.removeListener(this.imMap[a.buddyAimId]);
delete this.imMap[a.buddyAimId];this._updateTitle();this.pageContainer.getChildren().length==0?(this.savedL=this.windowPane.domNode.style.left,this.savedT=this.windowPane.domNode.style.top,this.hide()):this._showHideNavPane()},_showHideNavPane:function(){var a=this.pageController.isShowing(),c=this.pageContainer.getChildren().length>1;a&&!c?(this.pageController.hide(),b.contentBox(this.windowPane.domNode,{w:this.size.w-this.navWidth}),b.style(this.windowPane.domNode,"left",b.style(this.windowPane.domNode,
"left")+this.navWidth+"px"),this.onResized(),this.ensureOnscreen()):c&&!a&&(this.pageController.show(),b.addClass(this.pageController.domNode,"navOver"),b.contentBox(this.windowPane.domNode,{w:this.size.w+this.navWidth}),b.style(this.windowPane.domNode,"left",b.style(this.windowPane.domNode,"left")-this.navWidth+"px"),this.onResized(),this.ensureOnscreen())},onTitleResized:function(){if(!this.isClosing){this.windowTitleNode.style.width="";this.titleCell.style.width="";var a=b._getMarginSize(this.windowPane.domNode),
c=b._getMarginSize(this.containerNode),a=a.w-70;b.isMoz&&(a+=14);a<16&&(a=16);this.windowTitleNode.style.width=a+"px";if(b.isIE)this.titleCell.style.width=Math.min(c.w,a-16)+"px"}},onResized:function(){var a=b._getMarginSize(this.windowPane.domNode);b._getMarginSize(this.pageController.domNode);if(a.w>0)this.size=a,this.windowPaneContent.domNode.style.width=a.w-26+"px",this.windowPaneContent.domNode.style.height=a.h-24+"px",this.pageController.domNode.style.width="",this.windowPane.resize()},ensureOnscreen:function(){var a=
ws.WebSuite.viewportSize,c=b._getMarginBox(this.windowPane.domNode);if(c.l<0)this.windowPane.domNode.style.left="0px";else if(c.l+c.w>a.w)this.windowPane.domNode.style.left=a.w-c.w+"px";if(c.t<0)this.windowPane.domNode.style.top="0px";else if(c.t+c.h>a.h)this.windowPane.domNode.style.top=a.h-c.h+"px"},mailBuddy:function(){this.pageContainer.selectedChildWidget.sendMail()},setMode:function(){var a=this.pageContainer.selectedChildWidget;a.phoneMode?a.setIMmode():a.setPhonemode()},saveIM:function(){this.pageContainer.selectedChildWidget.saveConversation(Config.IMFolderName,
Config.Strings.Folder_SavedIMs,!1)},sendMail:function(a){(a=this.imMap[a])||(a=this.imMap[this.anonIdPrefix+(this.anonIdCounter-1)]);a&&a.sendMail()},setPhonemode:function(a){this.imMap[a]&&this.imMap[a].setPhonemode()}}),b.declare("ws.im.ImPageButton",[e._Widget,e._Templated],{templateString:'<span class="item" dojoAttachEvent="onclick: onClick, onmouseover: onMouseOver, onmouseout: onMouseOut">\t<img src="${spacer}" class="mainSprite buddyIcon" dojoAttachPoint="buddyIcon">\t<span dojoAttachPoint="containerNode, focusNode" class="selectButton">${label}</span>\t<img src="${spacer}" class="mainSprite serviceIcon" dojoAttachPoint="serviceIcon" style="display: none">\t<img src="${spacer}" class="mainSprite imNewMsgIcon">\t<span class="mainSprite AIMTitleClose" dojoAttachEvent="onclick: onClickClose" dojoAttachPoint="closeButton" style="display: none;"></span>\t<span style="clear: both;"></span></span>',
css:{templateString:""},hasNewMessage:!1,setChecked:function(a){a!=void 0&&b.toggleClass(this.domNode,"current",a)},setNewMessage:function(a){this.hasNewMessage=a;b.toggleClass(this.domNode,"itemWithNewMessage",a)},setOffline:function(a){b.toggleClass(this.domNode,"itemOffline",a)},setLabel:function(a){this.containerNode.innerHTML=a},setBuddyIcon:function(a){this.buddyIcon.src=a},setServiceIcon:function(){this.serviceIcon.style.display=""},onMouseOver:function(){this.closeButton.style.display=""},
onMouseOut:function(){this.closeButton.style.display="none"},onClickClose:function(){var a=b.query(".imGroup")[0];if(!e.byId(a.id).isClosing)this.onClickCloseButton()},onClickCloseButton:function(){ws.reporting.reportAction("IM Tab Close")}}));b._hasResource["ws.im.ImPanel"]||(b._hasResource["ws.im.ImPanel"]=!0,b.provide("ws.im.ImPanel"),b.declare("ws.im.ImPanel",[e._Widget,e._Templated],{templateString:b.cache("ws.im","ImPanel.html",'<div class="imPanel" style="display: none;">\r\n\t<div dojoType="dijit.layout.LayoutContainer" class="BLPane" layoutAlign="client" dojoAttachPoint="BLPane">\r\n\t\t<div dojoType="ws.widget.Pane" layoutAlign="top" class="statusBox" dojoAttachPoint="statusBox" style="display: none;">\r\n\t\t\t<div class="statusTitle">${SetStatusTitle}</div>\r\n\t\t\t<textarea class="wsInput statusInput" type="text" dojoAttachPoint="statusInput" dojoAttachEvent="onkeypress: onKeyStatus"></textarea>\r\n\t\t\t<div dojoType="ws.widget.Button" dojoAttachPoint="postButton" dojoAttachEvent="onClick: onPost">${LabelPostStatus}</div>\r\n\t\t\t<div dojoAttachPoint="cancelBtn" class="wsLink cancelButton" dojoAttachEvent="onclick: onSetStatus">${Cancel}</div>\r\n\t\t</div>\r\n\t\t<div dojoType="ws.widget.Pane" class="searchBox" dojoAttachPoint="searchBox" layoutAlign="top" style="display:none;">\r\n\t\t\t<div dojoType="ws.widget.ClearableTextbox" class="findInput" dojoAttachPoint="quickFindTextbox" defaultValue="${BuddyList_Label_Find}" dojoAttachEvent="onChange: quickFind" fieldWidth=""></div>\r\n\t\t</div>\r\n\t\t<div dojoType="dijit.layout.StackContainer" layoutAlign="client" dojoAttachPoint="contentStack">\r\n\t\t\t<div dojoType="ws.widget.Pane" layoutAlign="top" class="promoBox" dojoAttachPoint="promoBox">\r\n\t\t\t\t<div class="promoTitle">${Label_FBPromoSummary}</div>\r\n\t\t\t\t<div class="mainSprite promoConnect" dojoAttachEvent="onclick: promoConnect"></div>\r\n\t\t\t\t<div class="wsLink promoCancel" dojoAttachEvent="onclick: promoClose">${Label_FBCancel}</div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.Pane" dojoAttachPoint="BLCont" class="BLCont">\r\n\t\t\t\t<div dojoType="ws.widget.Pane" layoutAlign="top" class="connBox" dojoAttachPoint="connBox">\r\n\t\t\t\t\t<div class="dborder"></div>\r\n\t\t\t\t\t<div class="connTitle">${Label_FBConnTitle}</div>\r\n\t\t\t\t\t<div class="mainSprite connConnect" dojoAttachEvent="onclick: promoConnect"></div>\r\n\t\t\t\t\t<span class="connCancel" dojoAttachEvent="onclick: connClose">${Cancel}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoType="ws.im.BuddyList" layoutAlign="client" dojoAttachPoint="buddyListWidget"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,toolFn:null,layoutAlign:"client",startup:function(){ws.im.wim.listeners.push(this);b.subscribe("aimWimBuddyClicked",this,"openIm");this.connect(this.BLCont,"resize","textBoxResize");this.connect(this.searchBox,"clear","searchClear");b.query(".connConnect",this.connBox.domNode)[0].src=Config.BaseImagesURL+"fb_connect_btn.gif";this.layoutWidget=this.BLPane;this.BLPane.resize();this.onShow()},setupBtnEvents:function(a){b.connect(a,
"onmousedown",null,this.onMouseDown);b.connect(a,"onmouseup",null,this.onMouseUp);b.connect(a,"onmouseenter",null,this.onMouseOver);b.connect(a,"onmouseleave",null,this.onMouseOut)},onMouseDown:function(){b.addClass(this,"AIMbtnSel")},onMouseUp:function(){b.removeClass(this,"AIMbtnSel")},onMouseOver:function(){ws.widget.showInstatip(this)},onMouseOut:function(){ws.widget.hideInstatip(this)},textBoxResize:function(){var a=b._getMarginSize(this.BLCont.domNode),c=a.w;b.marginBox(this.quickFindTextbox.domNode,
{w:c});b.marginBox(this.quickFindTextbox.textbox,{w:c-16});b.marginBox(this.statusInput,{w:a.w-8})},onError:function(a){var c=a.errorMsg;if(typeof c=="object"){if(a.action&&a.action=="im/sendIM"&&a.statusCode!=401&&a.statusCode!=450&&a.statusCode!=460)return;var c="",d;for(d in a)d!="params"&&(c+=d+": "+a[d]+", ")}if(a.statusCode==401)a.errorType=1,ws.im.wim.resetUserData();Config.PageLocale.substr(0,2)!="en"&&(c=ws.string.substituteParams(Config.Strings.IM_Notice_ErrorCode,a.statusCode));switch(a.errorType){case 1:this.onSessionEnd();
b.publish("aimError",[c]);ws.im.wim.user&&ws.im.wim.user.aimId&&setTimeout(function(){ws.im.wim.end()},100);break;case 5:case 6:if(a.action){var e="";if(a.action=="buddylist/addBuddy"&&(a.statusCode==400||a.statusCode==462)){e=Config.Strings.ChatError_AddBuddy;break}if(a.action=="buddylist/removeBuddy"){e=Config.Strings.ChatError_RemoveBuddy;break}if(a.action=="buddylist/removeGroup"){e=Config.Strings.ChatError_RemoveGroup;break}if(a.action=="buddylist/renameGroup"){e=Config.Strings.ChatError_RenameGroup;
break}else e=Config.Strings.UnspecifiedError+"("+a.statusCode+")"}ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!0);ws.widget.Dialogs.ok(e);ws.widget.popup.setProp(ws.WebSuite.Navigation.aim,"manual",!1);break;case 9:a.action&&a.action=="fetchEvents"&&a.statusCode==460&&ws.im.wim._restartSession()}},onAuthCancel:function(){this.onSessionEnd()},onConsentCancel:function(){this.onSessionEnd()},onConsentInvalidToken:function(){this.onError("InvalidToken")},onIm:function(a){this._addToImDisplay(a.senderAimId,
a,!1);Settings.ChatSoundSend&&ws.im.wim.playEventSound("imSound",a.senderAimId)},onBuddyListLoad:function(){try{var a=ws.im.wim.getServiceConfig("facebook");a&&a.associated&&!Settings.FacebookPromoDone?this.contentStack.selectChild(this.promoBox):(a&&a.associated&&!Settings.FacebookPromoDone&&ws.settings.saveSoon({FacebookPromoDone:!0}),this.contentStack.selectChild(this.BLCont));a&&a.associated&&(a.notAuthorized||a.unableToConnect)?b.addClass(this.connBox.domNode,"connBoxShow"):b.removeClass(this.connBox.domNode,
"connBoxShow");if(!this._inited)this.BLPane.resize(),this._inited=!0;if(this._signOnCallback)this._signOnCallback(),this._signOnCallback=null;this.isSearching()&&this.quickFind()}catch(c){}},onDestroy:function(){this.imGroup&&this.imGroup._onClickCloseButton();ws.im.wim.end();ws.reporting.reportAction("IM Sign Out")},onSessionEnd:function(){this._inited=!1},onTypingChanged:function(a){this.imGroup&&this.imGroup.typingChanged(a.aimId,a.status)},blClose:function(){ws.WebSuite.Navigation.toggleBL()},
onClickImButton:function(){this.openIm()},closeTools:function(){if(this.isSearching())this.onSearch();if(this.statusBox.isShowing())this.onSetStatus();this.contentStack.selectedChildWidget==this.addBuddyCard&&this.addBuddy();this.backToList()},onSearch:function(){this.toolFn&&this.toolFn!=this.onSearch&&this.toolFn();this.searchBox.isShowing()?(b.removeClass(ws.WebSuite.Navigation.aimSearchBtn,"appTitleSearchSel"),this.searchBox.domNode.style.display="none",this.toolFn=null,this.quickFindTextbox.setValue(""),
this.quickFind()):(b.addClass(ws.WebSuite.Navigation.aimSearchBtn,"appTitleSearchSel"),this.toolFn=this.onSearch,this.searchBox.domNode.style.display="block",e.focus(this.quickFindTextbox.textbox));this.backToList();this.BLPane.resize()},onSetStatus:function(){this.toolFn&&this.toolFn!=this.onSetStatus&&this.toolFn();var a=!this.statusBox.isShowing();if(a){this.toolFn=this.onSetStatus;var b="";ws.im.wim.user.statusMsg&&(b=ws.im.wim.user.statusMsg.replace(/^\<div\>/,"").replace(/\<\/div\>$/,""));this.statusInput.value=
b}else this.toolFn=null,this.statusInput.value="";this.backToList();this.statusBox.setShowing(a);a&&e.focus(this.statusInput);this.BLPane.resize()},onPanelSelected:function(){this._signOnCallback=null},openIm:function(a){a=a||{};this._addToImDisplay(a.aimId,{message:a.message,senderAimId:ws.im.wim.user?ws.im.wim.user.displayId:"",autoresponse:!1,timestamp:(new Date).getTime()/1E3},!0,a.useSMS);a.aimId&&a.message&&this.isSignedOn()&&ws.im.wim.sendIm(a.aimId,a.message,!0)},signOn:function(a){this._inited=
!1;setTimeout(function(){ws.im.wim.start()},0);if(a)this._signOnCallback=a;ws.reporting.reportAction("IM Sign In")},isSignedOn:function(){return ws.im.wim.user!=null},addBuddy:function(){this.toolFn&&this.toolFn!=this.addBuddy&&this.toolFn();if(this.contentStack.selectedChildWidget!=this.addBuddyCard){this.toolFn=this.addBuddy;if(!this.addBuddyCard)this.addBuddyCard=new ws.im.AddBuddyCard,this.connect(this.addBuddyCard.cancelBtn,"onclick","addBuddy"),this.contentStack.addChild(this.addBuddyCard);
this.searchBox.setShowing(!1);this.contentStack.selectChild(this.addBuddyCard);this.addBuddyCard.onOpen();this.BLPane.resize()}else this.toolFn=null,this.backToList()},editBuddy:function(a,b){this.toolFn&&this.toolFn!=this.editBuddy&&this.toolFn();if(this.contentStack.selectedChildWidget!=this.editBuddyCard){this.toolFn=this.editBuddy;if(!this.editBuddyCard)this.editBuddyCard=new ws.im.AddBuddyCard,this.connect(this.editBuddyCard.cancelBtn,"onclick","editBuddy"),this.contentStack.addChild(this.editBuddyCard),
this.connect(this.editBuddyCard,"onClickAddButton","editBuddy"),this.editBuddyCard.setupEdit();this.searchBox.setShowing(!1);this.contentStack.selectChild(this.editBuddyCard);this.editBuddyCard.setData(a,b);this.editBuddyCard.onOpen();this.BLPane.resize()}else this.toolFn=null,this.backToList()},editGroup:function(a){this.toolFn&&this.toolFn!=this.editGroup&&this.toolFn();if(this.contentStack.selectedChildWidget!=this.editBuddyCard){this.toolFn=this.editGroup;if(!this.editGroupCard)this.editGroupCard=
new ws.im.EditGroupCard,this.connect(this.editGroupCard.cancelBtn,"onclick","backToList"),this.contentStack.addChild(this.editGroupCard),this.connect(this.editGroupCard,"onClickSaveButton","backToList");this.editGroupCard.setGroup(a);this.contentStack.selectChild(this.editGroupCard);this.editGroupCard.onOpen()}else this.toolFn=null,this.backToList()},backToList:function(){this.contentStack.selectChild(this.BLCont);this.BLPane.resize()},_addToImDisplay:function(a,c,d,e){if(!this.imGroup)this.imGroup=
new ws.im.ImGroup,b.body().appendChild(this.imGroup.domNode),this.imGroup.startup();this.imGroup.addIm(a,c,d,!1,e)},quickFind:function(){ws.lang.defer(this,function(){this.buddyListWidget.quickFind(this.quickFindTextbox.getValue())},500,"buddyListQuickFind")},searchClear:function(){this.quickFindTextbox.setValue("");this.quickFind()},isSearching:function(){return this.quickFindTextbox.getValue().length>0},onKeyPressSearchField:function(a){a.keyCode==b.keys.ENTER&&(this.quickFind(),a.preventDefault())},
onKeyStatus:function(a){a.keyCode==b.keys.ENTER&&(b.stopEvent(a),this.onPost())},onPost:function(){var a=b.trim(this.statusInput.value);ws.settings.saveSoon({ChatStatusMessage:a});ws.im.wim.setStatus(a);this.onSetStatus()},refreshWindow:function(a){(a=this.imGroup.imMap[a])&&a._showSavedConversation()},connClose:function(){b.removeClass(this.connBox.domNode,"connBoxShow");this.BLPane.resize()},promoClose:function(){ws.settings.saveSoon({FacebookPromoDone:!0});Settings.FacebookPromoDone=!0;this.contentStack.selectChild(this.BLCont);
this.BLPane.resize()},promoConnect:function(){var a=ws.im.wim.getServiceUrls("facebook"),b=ws.im.wim.getServiceConfig("facebook");b&&b.associated&&b.notAuthorized&&ws.im.wim.disableService("facebook");if(a)a.association=Config.FBAssociationUrl,ws.io.openWindow(a.association,"");ws.settings.saveSoon({FacebookPromoDone:!0});Settings.FacebookPromoDone=!0;this.contentStack.selectChild(this.BLCont);this.BLPane.resize()},promoJoin:function(){ws.io.openWindow(Config.FBJoinUrl,"")}}));b._hasResource["ws.layers.Aim"]||
(b._hasResource["ws.layers.Aim"]=!0,b.provide("ws.layers.Aim"))}}});

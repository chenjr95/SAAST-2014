/* (C) 2012 AOL Inc. All Rights Reserved */
dojo._xdResourceLoaded(function(){return{depends:[["provide","ws.dojofixes"],["provide","dijit._base.manager"],["provide","dojo.Stateful"],["provide","dijit._WidgetBase"],["provide","dijit._base.focus"],["provide","dojo.AdapterRegistry"],["provide","dijit._base.place"],["provide","dijit._base.popup"],["provide","dijit._base.scroll"],["provide","dojo.uacss"],["provide","dijit._base.sniff"],["provide","dijit._base.typematic"],["provide","dijit._base"],["provide","dijit._Widget"],["provide","dojo.string"],
["provide","dojo.date.stamp"],["provide","dojo.parser"],["provide","dojo.cache"],["provide","dijit._Templated"],["provide","dijit._Container"],["provide","dijit._Contained"],["provide","dijit.layout._LayoutWidget"],["provide","dijit.layout.StackContainer"],["provide","ws.widget.FTUTip"],["provide","ws.html"],["provide","ws.widget.util"],["provide","ws.Spinner"],["provide","ws.suite.Footer"],["provide","dojo.io.script"],["provide","ws.widget.Button"],["provide","ws.widget.WSModalPane"],["provide",
"ws.widget.WSToolbar"],["provide","ws.widget.Dialogs"],["provide","ws.presence"],["provide","ws.widget.OkCancelDialog"],["provide","ws.widget.Pane"],["provide","ws.themes.widget.ThemePickerDialog"],["provide","ws.themes.widget.ThemePicker"],["provide","dijit.layout.LayoutContainer"],["provide","dojo.date"],["provide","ws.date"],["provide","ws.widget.SingleLineNotification"],["provide","ws.widget.BuddyIcon"],["provide","ws.suite.TodayPage"],["provide","ws.widget.ModalNotification"],["provide","ws.bubbleConfig"],
["provide","ws.WebSuite"],["provide","ws.widget.Advertisement"],["provide","ws.widget.popup"],["provide","ws.widget.SearchAutoComplete"],["provide","ws.widget.FeedbackPane"],["provide","ws.suite.Hat"],["provide","ws.dom"],["provide","ws.sound"],["provide","dijit.layout.SplitContainer"],["provide","ws.widget.WSSplitContainer"],["provide","ws.widget.DefaultTextbox"],["provide","ws.widget.DefaultTextarea"],["provide","ws.widget.WSMenu"],["provide","ws.calendar.calutil"],["provide","ws.calendar.CalendarViewModel"],
["provide","dojox.grid._grid.lib"],["provide","dojox.grid._grid.scroller"],["provide","dojox.grid._grid.drag"],["provide","dojox.grid._grid.builder"],["provide","dojox.grid._grid.view"],["provide","dojox.grid._grid.views"],["provide","dojox.grid._grid.cell"],["provide","dojox.grid._grid.layout"],["provide","dojox.grid._grid.rows"],["provide","dojox.grid._grid.focus"],["provide","dojox.grid._grid.selection"],["provide","dojox.grid._grid.edit"],["provide","dojox.grid._grid.rowbar"],["provide","dojox.grid._grid.publicEvents"],
["provide","dojox.grid.VirtualGrid"],["provide","dojox.grid._data.fields"],["provide","dojox.grid._data.model"],["provide","dojox.grid._data.editors"],["provide","dojox.grid.editors"],["provide","dojox.grid.Grid"],["provide","ws.widget.ListView"],["provide","ws.widget.WSDatePicker"],["provide","ws.widget.PopupDatePicker"],["provide","ws.widget.WSTimePicker"],["provide","ws.widget.PopupTimePicker"],["provide","ws.widget.WSSelect"],["provide","ws.panels.TaskPanel"],["provide","ws.address.PeopleApp"],
["provide","ws.mail.FolderApp"],["provide","ws.calendar.EventsApp"],["provide","ws.calendar.TodoEditDialog"],["provide","ws.calendar.TodoApp"],["provide","ws.suite.Navigation"],["provide","ws.mail.Stationery"],["provide","ws.suite.SidePanel"],["provide","ws.widget.Splitter"],["provide","ws.address.AddressBookUtil"],["provide","ws.address.record"],["provide","ws.address.AddressModel"],["provide","ws.address.PeoplePicker"],["provide","ws.address.AddressField"],["provide","ws.mail.MailFilterModel"],
["provide","ws.mail.MailFilterModalPane"],["provide","ws.mail.MessageStatusDialog"],["provide","dojox.io.scriptFrame"],["provide","ws.im.wim"],["provide","ws.layers.dojo2"]],defineResource:function(b,k,l){if(!b._hasResource["ws.dojofixes"]){b._hasResource["ws.dojofixes"]=!0;b.provide("ws.dojofixes");if(b.isIE==6||b.isFF>=3)b.dojoabs=b._abs,b._abs=function(a,e){try{return b.dojoabs(a,e)}catch(f){return{x:0,y:0,w:0,h:0}}};b.isMac&&(b.addClass(b.doc.documentElement,"dj_mac"),b.isFF&&b.addClass(b.doc.documentElement,
"dj_macFF"));b.isIE==8?b.addClass(b.doc.documentElement,"dj_ie8"):ws.browser.ipad&&b.addClass(b.doc.documentElement,"dj_iPad");b.dojofromJson=b.fromJson;b.fromJson=function(a){if(!a||a=="")a='""';try{return b.dojofromJson(a)}catch(e){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.JsonParseErr,"Exception in JSON string, func: dojo.fromJson, file: dojofixes.js ")}};b.isArray=function(a){return a&&a.push&&a.splice&&a.join};if(b.isIE)ws.dojofixes.fixScroll=function(){b.body().scrollTop=document.documentElement.scrollTop=
0;b.body().scrollLeft=document.documentElement.scrollLeft=0},b.addOnLoad(function(){b.connect(b.body(),"onscroll",ws.dojofixes.fixScroll);document.documentElement.onscroll=ws.dojofixes.fixScroll})}b._hasResource["dijit._base.manager"]||(b._hasResource["dijit._base.manager"]=!0,b.provide("dijit._base.manager"),b.declare("dijit.WidgetSet",null,{constructor:function(){this._hash={};this.length=0},add:function(a){if(this._hash[a.id])throw Error("Tried to register widget with id=="+a.id+" but that id is already registered");
this._hash[a.id]=a;this.length++},remove:function(a){this._hash[a]&&(delete this._hash[a],this.length--)},forEach:function(a,e){var e=e||b.global,f=0,g;for(g in this._hash)a.call(e,this._hash[g],f++,this._hash);return this},filter:function(a,e){var e=e||b.global,f=new k.WidgetSet,g=0,h;for(h in this._hash){var j=this._hash[h];a.call(e,j,g++,this._hash)&&f.add(j)}return f},byId:function(a){return this._hash[a]},byClass:function(a){var e=new k.WidgetSet,b,g;for(b in this._hash)g=this._hash[b],g.declaredClass==
a&&e.add(g);return e},toArray:function(){var a=[],e;for(e in this._hash)a.push(this._hash[e]);return a},map:function(a,e){return b.map(this.toArray(),a,e)},every:function(a,e){var e=e||b.global,f=0,g;for(g in this._hash)if(!a.call(e,this._hash[g],f++,this._hash))return!1;return!0},some:function(a,e){var e=e||b.global,f=0,g;for(g in this._hash)if(a.call(e,this._hash[g],f++,this._hash))return!0;return!1}}),function(){k.registry=new k.WidgetSet;var a=k.registry._hash,e=b.attr,f=b.hasAttr,g=b.style;k.byId=
function(e){return typeof e=="string"?a[e]:e};var h={};k.getUniqueId=function(e){var b;do b=e+"_"+(e in h?++h[e]:h[e]=0);while(a[b]);return k._scopeName=="dijit"?b:k._scopeName+"_"+b};k.findWidgets=function(e){function b(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType==1){var g=e.getAttribute("widgetId");g?(g=a[g])&&f.push(g):b(e)}}var f=[];b(e);return f};k._destroyAll=function(){k._curFocus=null;k._prevFocus=null;k._activeStack=[];b.forEach(k.findWidgets(b.body()),function(a){a._destroyed||
(a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy())})};b.isIE&&b.addOnWindowUnload(function(){k._destroyAll()});k.byNode=function(e){return a[e.getAttribute("widgetId")]};k.getEnclosingWidget=function(e){for(;e;){var b=e.getAttribute&&e.getAttribute("widgetId");if(b)return a[b];e=e.parentNode}return null};var j=k._isElementShown=function(a){var b=g(a);return b.visibility!="hidden"&&b.visibility!="collapsed"&&b.display!="none"&&e(a,"type")!="hidden"};k.hasDefaultTabStop=function(a){switch(a.nodeName.toLowerCase()){case "a":return f(a,
"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var e;try{var b=a.contentDocument;if("designMode"in b&&b.designMode=="on")return!0;e=b.body}catch(g){try{e=a.contentWindow.document.body}catch(h){return!1}}return e.contentEditable=="true"||e.firstChild&&e.firstChild.contentEditable=="true";default:return a.contentEditable=="true"}};var m=k.isTabNavigable=function(a){return e(a,"disabled")?!1:f(a,"tabIndex")?e(a,"tabIndex")>=0:k.hasDefaultTabStop(a)};
k._getTabNavigable=function(a){function g(a){return a&&a.tagName.toLowerCase()=="input"&&a.type&&a.type.toLowerCase()=="radio"&&a.name&&a.name.toLowerCase()}var h,k,l,q,w,s,u={},A=function(a){b.query("> *",a).forEach(function(a){if(!(b.isIE&&a.scopeName!=="HTML")&&j(a)){if(m(a)){var v=e(a,"tabIndex");if(!f(a,"tabIndex")||v==0)h||(h=a),k=a;else if(v>0){if(!l||v<q)q=v,l=a;if(!w||v>=s)s=v,w=a}v=g(a);b.attr(a,"checked")&&v&&(u[v]=a)}a.nodeName.toUpperCase()!="SELECT"&&A(a)}})};j(a)&&A(a);return{first:u[g(h)]||
h,last:u[g(k)]||k,lowest:u[g(l)]||l,highest:u[g(w)]||w}};k.getFirstInTabbingOrder=function(a){a=k._getTabNavigable(b.byId(a));return a.lowest?a.lowest:a.first};k.getLastInTabbingOrder=function(a){a=k._getTabNavigable(b.byId(a));return a.last?a.last:a.highest};k.defaultDuration=b.config.defaultDuration||200}());b._hasResource["dojo.Stateful"]||(b._hasResource["dojo.Stateful"]=!0,b.provide("dojo.Stateful"),b.declare("dojo.Stateful",null,{postscript:function(a){a&&b.mixin(this,a)},get:function(a){return this[a]},
set:function(a,e){if(typeof a==="object"){for(var b in a)this.set(b,a[b]);return this}b=this[a];this[a]=e;this._watchCallbacks&&this._watchCallbacks(a,b,e);return this},watch:function(a,e){var f=this._watchCallbacks;if(!f)var g=this,f=this._watchCallbacks=function(a,e,b,h){var k=function(f){if(f)for(var f=f.slice(),h=0,k=f.length;h<k;h++)try{f[h].call(g,a,e,b)}catch(o){console.error(o)}};k(f["_"+a]);h||k(f["*"])};!e&&typeof a==="function"?(e=a,a="*"):a="_"+a;var h=f[a];typeof h!=="object"&&(h=f[a]=
[]);h.push(e);return{unwatch:function(){h.splice(b.indexOf(h,e),1)}}}}));b._hasResource["dijit._WidgetBase"]||(b._hasResource["dijit._WidgetBase"]=!0,b.provide("dijit._WidgetBase"),function(){b.declare("dijit._WidgetBase",b.Stateful,{id:"",lang:"",dir:"","class":"",style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,attributeMap:{id:"",dir:"",lang:"","class":"",style:"",title:""},_blankGif:(b.config.blankGif||b.moduleUrl("dojo","resources/blank.gif")).toString(),
postscript:function(a,e){this.create(a,e)},create:function(a,e){this.srcNodeRef=b.byId(e);this._connects=[];this._subscribes=[];if(this.srcNodeRef&&typeof this.srcNodeRef.id=="string")this.id=this.srcNodeRef.id;if(a)this.params=a,b._mixin(this,a);this.postMixInProperties();if(!this.id)this.id=k.getUniqueId(this.declaredClass.replace(/\./g,"_"));k.registry.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();var f=this.srcNodeRef;f&&f.parentNode&&this.domNode!==f&&f.parentNode.replaceChild(this.domNode,
f)}this.domNode&&this.domNode.setAttribute("widgetId",this.id);this.postCreate();this.srcNodeRef&&!this.srcNodeRef.parentNode&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a=function(a,e){(e.params&&a in e.params||e[a])&&e.set(a,e[a])},e;for(e in this.attributeMap)a(e,this);b.forEach(this._getSetterAttributes(),function(e){e in this.attributeMap||a(e,this)},this)},_getSetterAttributes:function(){var a=this.constructor;if(!a._setterAttrs){var e=a._setterAttrs=[],f,g=a.prototype,
h;for(h in g)b.isFunction(g[h])&&(f=h.match(/^_set([a-zA-Z]*)Attr$/))&&f[1]&&e.push(f[1].charAt(0).toLowerCase()+f[1].substr(1))}return a._setterAttrs},postMixInProperties:function(){},buildRendering:function(){if(!this.domNode)this.domNode=this.srcNodeRef||b.create("div");if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(b.map(a,function(a){return a+"Rtl"})));b.addClass(this.domNode,a)}},postCreate:function(){},startup:function(){this._started=!0},destroyRecursive:function(a){this._beingDestroyed=
!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){this._beingDestroyed=!0;this.uninitialize();var e=b,f=e.forEach,g=e.unsubscribe;f(this._connects,function(a){f(a,e.disconnect)});f(this._subscribes,function(a){g(a)});f(this._supportingWidgets||[],function(a){a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy()});this.destroyRendering(a);k.registry.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);
this.domNode&&(a?b.removeAttr(this.domNode,"widgetId"):b.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||b.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){b.forEach(this.getChildren(),function(e){e.destroyRecursive&&e.destroyRecursive(a)})},uninitialize:function(){return!1},_setClassAttr:function(a){b.replaceClass(this[this.attributeMap["class"]||"domNode"],a,this["class"]);this._set("class",a)},_setStyleAttr:function(a){var e=this[this.attributeMap.style||
"domNode"];b.isObject(a)?b.style(e,a):e.style.cssText?e.style.cssText+="; "+a:e.style.cssText=a;this._set("style",a)},_attrToDom:function(a,e){var f=this.attributeMap[a];b.forEach(b.isArray(f)?f:[f],function(f){var h=this[f.node||f||"domNode"];switch(f.type||"attribute"){case "attribute":b.isFunction(e)&&(e=b.hitch(this,e));f=f.attribute?f.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;b.attr(h,f,e);break;case "innerText":h.innerHTML="";h.appendChild(b.doc.createTextNode(e));break;case "innerHTML":h.innerHTML=
e;break;case "class":b.replaceClass(h,e,this[a])}},this)},get:function(a){var e=this._getAttrNames(a);return this[e.g]?this[e.g]():this[a]},set:function(a,e){if(typeof a==="object"){for(var b in a)this.set(b,a[b]);return this}b=this._getAttrNames(a);if(this[b.s])var g=this[b.s].apply(this,Array.prototype.slice.call(arguments,1));else a in this.attributeMap&&this._attrToDom(a,e),this._set(a,e);return g||this},_attrPairNames:{},_getAttrNames:function(a){var e=this._attrPairNames;if(e[a])return e[a];
var b=a.charAt(0).toUpperCase()+a.substr(1);return e[a]={n:a+"Node",s:"_set"+b+"Attr",g:"_get"+b+"Attr"}},_set:function(a,e){var b=this[a];this[a]=e;this._watchCallbacks&&this._created&&e!==b&&this._watchCallbacks(a,b,e)},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getDescendants:function(){return this.containerNode?b.query("[widgetId]",this.containerNode).map(k.byNode):[]},getChildren:function(){return this.containerNode?k.findWidgets(this.containerNode):
[]},connect:function(a,e,f){a=[b._connect(a,e,this,f)];this._connects.push(a);return a},disconnect:function(a){for(var e=0;e<this._connects.length;e++)if(this._connects[e]==a){b.forEach(a,b.disconnect);this._connects.splice(e,1);break}},subscribe:function(a,e){var f=b.subscribe(a,this,e);this._subscribes.push(f);return f},unsubscribe:function(a){for(var e=0;e<this._subscribes.length;e++)if(this._subscribes[e]==a){b.unsubscribe(a);this._subscribes.splice(e,1);break}},isLeftToRight:function(){return this.dir?
this.dir=="ltr":b._isBodyLtr()},placeAt:function(a,e){a.declaredClass&&a.addChild?a.addChild(this,e):b.place(this.domNode,a,e);return this}})}());b._hasResource["dijit._base.focus"]||(b._hasResource["dijit._base.focus"]=!0,b.provide("dijit._base.focus"),b.mixin(k,{_curFocus:null,_prevFocus:null,isCollapsed:function(){return k.getBookmark().isCollapsed},getBookmark:function(){var a,e,f=b.doc.selection,g=k._curFocus;if(b.global.getSelection){if(f=b.global.getSelection())if(f.isCollapsed){if(a=g?g.tagName:
"")if(a=a.toLowerCase(),a=="textarea"||a=="input"&&(!g.type||g.type.toLowerCase()=="text"))return f={start:g.selectionStart,end:g.selectionEnd,node:g,pRange:!0},{isCollapsed:f.end<=f.start,mark:f};a={isCollapsed:!0}}else e=f.getRangeAt(0),a={isCollapsed:!1,mark:e.cloneRange()}}else if(f){a=g?g.tagName:"";a=a.toLowerCase();if(g&&a&&(a=="button"||a=="textarea"||a=="input"))return f.type&&f.type.toLowerCase()=="none"?{isCollapsed:!0,mark:null}:(e=f.createRange(),{isCollapsed:e.text&&e.text.length?!1:
!0,mark:{range:e,pRange:!0}});a={};try{e=f.createRange(),a.isCollapsed=!(f.type=="Text"?e.htmlText.length:e.length)}catch(h){return a.isCollapsed=!0,a}if(f.type.toUpperCase()=="CONTROL")if(e.length){a.mark=[];f=0;for(g=e.length;f<g;)a.mark.push(e.item(f++))}else a.isCollapsed=!0,a.mark=null;else a.mark=e.getBookmark()}return a},moveToBookmark:function(a){var e=b.doc;if(a=a.mark)if(b.global.getSelection){if((e=b.global.getSelection())&&e.removeAllRanges)a.pRange?(e=a.node,e.selectionStart=a.start,
e.selectionEnd=a.end):(e.removeAllRanges(),e.addRange(a))}else if(e.selection&&a){var f;a.pRange?f=a.range:b.isArray(a)?(f=e.body.createControlRange(),b.forEach(a,function(a){f.addElement(a)})):(f=e.body.createTextRange(),f.moveToBookmark(a));f.select()}},getFocus:function(a,e){var f=!k._curFocus||a&&b.isDescendant(k._curFocus,a.domNode)?k._prevFocus:k._curFocus;return{node:f,bookmark:f==k._curFocus&&b.withGlobal(e||b.global,k.getBookmark),openedForWindow:e}},focus:function(a){if(a){var e="node"in
a?a.node:a,f=a.bookmark,a=a.openedForWindow,g=f?f.isCollapsed:!1;if(e){var h=e.tagName.toLowerCase()=="iframe"?e.contentWindow:e;if(h&&h.focus)try{h.focus()}catch(j){}k._onFocusNode(e)}if(f&&b.withGlobal(a||b.global,k.isCollapsed)&&!g){a&&a.focus();try{b.withGlobal(a||b.global,k.moveToBookmark,null,[f])}catch(m){}}}},_activeStack:[],registerIframe:function(a){return k.registerWin(a.contentWindow,a)},unregisterIframe:function(a){k.unregisterWin(a)},registerWin:function(a,e){var f=function(a){k._justMouseDowned=
!0;setTimeout(function(){k._justMouseDowned=!1},0);if(!b.isIE||!a||!(a.srcElement&&a.srcElement.parentNode==null))k._onTouchNode(e||a.target||a.srcElement,"mouse")},g=b.isIE?a.document.documentElement:a.document;if(g)if(b.isIE){a.document.body.attachEvent("onmousedown",f);var h=function(a){a.srcElement.tagName.toLowerCase()!="#document"&&k.isTabNavigable(a.srcElement)?k._onFocusNode(e||a.srcElement):k._onTouchNode(e||a.srcElement)};g.attachEvent("onactivate",h);var j=function(a){k._onBlurNode(e||
a.srcElement)};g.attachEvent("ondeactivate",j);return function(){a.document.detachEvent("onmousedown",f);g.detachEvent("onactivate",h);g.detachEvent("ondeactivate",j);g=null}}else{g.body.addEventListener("mousedown",f,!0);var m=function(a){k._onFocusNode(e||a.target)};g.addEventListener("focus",m,!0);var v=function(a){k._onBlurNode(e||a.target)};g.addEventListener("blur",v,!0);return function(){g.body.removeEventListener("mousedown",f,!0);g.removeEventListener("focus",m,!0);g.removeEventListener("blur",
v,!0);g=null}}},unregisterWin:function(a){a&&a()},_onBlurNode:function(){k._prevFocus=k._curFocus;k._curFocus=null;if(!k._justMouseDowned)k._clearActiveWidgetsTimer&&clearTimeout(k._clearActiveWidgetsTimer),k._clearActiveWidgetsTimer=setTimeout(function(){delete k._clearActiveWidgetsTimer;k._setStack([]);k._prevFocus=null},100)},_onTouchNode:function(a,e){k._clearActiveWidgetsTimer&&(clearTimeout(k._clearActiveWidgetsTimer),delete k._clearActiveWidgetsTimer);var f=[];try{for(;a;){var g=b.attr(a,"dijitPopupParent");
if(g)a=k.byId(g).domNode;else if(a.tagName&&a.tagName.toLowerCase()=="body"){if(a===b.body())break;a=b.window.get(a.ownerDocument).frameElement}else{var h=a.getAttribute&&a.getAttribute("widgetId"),j=h&&k.byId(h);j&&!(e=="mouse"&&j.get("disabled"))&&f.unshift(h);a=a.parentNode}}}catch(m){}k._setStack(f,e)},_onFocusNode:function(a){if(a&&a.nodeType!=9&&(k._onTouchNode(a),a!=k._curFocus)){if(k._curFocus)k._prevFocus=k._curFocus;k._curFocus=a;b.publish("focusNode",[a])}},_setStack:function(a,e){var f=
k._activeStack;k._activeStack=a;for(var g=0;g<Math.min(f.length,a.length);g++)if(f[g]!=a[g])break;for(var h,j=f.length-1;j>=g;j--)if(h=k.byId(f[j]))h._focused=!1,h.set("focused",!1),h._hasBeenBlurred=!0,h._onBlur&&h._onBlur(e),b.publish("widgetBlur",[h,e]);for(j=g;j<a.length;j++)if(h=k.byId(a[j]))h._focused=!0,h.set("focused",!0),h._onFocus&&h._onFocus(e),b.publish("widgetFocus",[h,e])}}),b.addOnLoad(function(){var a=k.registerWin(window);b.isIE&&b.addOnWindowUnload(function(){k.unregisterWin(a);
a=null})}));if(!b._hasResource["dojo.AdapterRegistry"])b._hasResource["dojo.AdapterRegistry"]=!0,b.provide("dojo.AdapterRegistry"),b.AdapterRegistry=function(a){this.pairs=[];this.returnWrappers=a||!1},b.extend(b.AdapterRegistry,{register:function(a,e,b,g,h){this.pairs[h?"unshift":"push"]([a,e,b,g])},match:function(){for(var a=0;a<this.pairs.length;a++){var e=this.pairs[a];if(e[1].apply(this,arguments))return e[3]||this.returnWrappers?e[2]:e[2].apply(this,arguments)}throw Error("No match found");
},unregister:function(a){for(var e=0;e<this.pairs.length;e++)if(this.pairs[e][0]==a)return this.pairs.splice(e,1),!0;return!1}});if(!b._hasResource["dijit._base.place"])b._hasResource["dijit._base.place"]=!0,b.provide("dijit._base.place"),k.getViewport=function(){return b.window.getBox()},k.placeOnScreen=function(a,e,f,g){f=b.map(f,function(a){var b={corner:a,pos:{x:e.x,y:e.y}};g&&(b.pos.x+=a.charAt(1)=="L"?g.x:-g.x,b.pos.y+=a.charAt(0)=="T"?g.y:-g.y);return b});return k._place(a,f)},k._place=function(a,
e,f,g){var h=b.window.getBox();(!a.parentNode||String(a.parentNode.tagName).toLowerCase()!="body")&&b.body().appendChild(a);var j=null;b.some(e,function(e){var m=e.corner,k=e.pos,l=0,x={w:m.charAt(1)=="L"?h.l+h.w-k.x:k.x-h.l,h:m.charAt(1)=="T"?h.t+h.h-k.y:k.y-h.t};f&&(l=f(a,e.aroundCorner,m,x,g),l=typeof l=="undefined"?0:l);var q=a.style,w=q.display,s=q.visibility;q.visibility="hidden";q.display="";var u=b.marginBox(a);q.display=w;q.visibility=s;q=Math.max(h.l,m.charAt(1)=="L"?k.x:k.x-u.w);w=Math.max(h.t,
m.charAt(0)=="T"?k.y:k.y-u.h);s=Math.min(h.l+h.w,m.charAt(1)=="L"?q+u.w:k.x);k=Math.min(h.t+h.h,m.charAt(0)=="T"?w+u.h:k.y);s-=q;k-=w;l+=u.w-s+(u.h-k);if(j==null||l<j.overflow)j={corner:m,aroundCorner:e.aroundCorner,x:q,y:w,w:s,h:k,overflow:l,spaceAvailable:x};return!l});j.overflow&&f&&f(a,j.aroundCorner,j.corner,j.spaceAvailable,g);var e=b._isBodyLtr(),m=a.style;m.top=j.y+"px";m[e?"left":"right"]=(e?j.x:h.w-j.x-j.w)+"px";return j},k.placeOnScreenAroundNode=function(a,e,f,g){e=b.byId(e);e=b.position(e,
!0);return k._placeOnScreenAroundRect(a,e.x,e.y,e.w,e.h,f,g)},k.placeOnScreenAroundRectangle=function(a,e,b,g){return k._placeOnScreenAroundRect(a,e.x,e.y,e.width,e.height,b,g)},k._placeOnScreenAroundRect=function(a,e,b,g,h,j,m){var v=[],o;for(o in j)v.push({aroundCorner:o,corner:j[o],pos:{x:e+(o.charAt(1)=="L"?0:g),y:b+(o.charAt(0)=="T"?0:h)}});return k._place(a,v,m,{w:g,h:h})},k.placementRegistry=new b.AdapterRegistry,k.placementRegistry.register("node",function(a,e){return typeof e=="object"&&
typeof e.offsetWidth!="undefined"&&typeof e.offsetHeight!="undefined"},k.placeOnScreenAroundNode),k.placementRegistry.register("rect",function(a,e){return typeof e=="object"&&"x"in e&&"y"in e&&"width"in e&&"height"in e},k.placeOnScreenAroundRectangle),k.placeOnScreenAroundElement=function(){return k.placementRegistry.match.apply(k.placementRegistry,arguments)},k.getPopupAroundAlignment=function(a,e){var f={};b.forEach(a,function(a){switch(a){case "after":f[e?"BR":"BL"]=e?"BL":"BR";break;case "before":f[e?
"BL":"BR"]=e?"BR":"BL";break;case "below-alt":e=!e;case "below":f[e?"BL":"BR"]=e?"TL":"TR";f[e?"BR":"BL"]=e?"TR":"TL";break;case "above-alt":e=!e;default:f[e?"TL":"TR"]=e?"BL":"BR",f[e?"TR":"TL"]=e?"BR":"BL"}});return f};if(!b._hasResource["dijit._base.popup"])b._hasResource["dijit._base.popup"]=!0,b.provide("dijit._base.popup"),k.popup={_stack:[],_beginZIndex:1E3,_idGen:1,_createWrapper:function(a){var e=a.declaredClass?a._popupWrapper:b.hasClass(a.parentNode,"dijitPopup")&&a.parentNode,f=a.domNode||
a;if(!e&&(e=b.create("div",{"class":"dijitPopup",style:{display:"none"},role:"presentation"},b.body()),e.appendChild(f),f=f.style,f.display="",f.visibility="",f.position="",f.top="0px",a.declaredClass))a._popupWrapper=e,b.connect(a,"destroy",function(){b.destroy(e);delete a._popupWrapper});return e},moveOffScreen:function(a){a=this._createWrapper(a);b.style(a,{visibility:"hidden",top:"-9999px",display:""})},hide:function(a){a=this._createWrapper(a);b.style(a,"display","none")},getTopPopup:function(){for(var a=
this._stack,e=a.length-1;e>0&&a[e].parent===a[e-1].widget;e--);return a[e]},open:function(a){for(var e=this._stack,f=a.popup,g=a.orient||((a.parent?a.parent.isLeftToRight():b._isBodyLtr())?{BL:"TL",BR:"TR",TL:"BL",TR:"BR"}:{BR:"TR",BL:"TL",TR:"BR",TL:"BL"}),h=a.around,j=a.around&&a.around.id?a.around.id+"_dropdown":"popup_"+this._idGen++;e.length&&(!a.parent||!b.isDescendant(a.parent.domNode,e[e.length-1].widget.domNode));)k.popup.close(e[e.length-1].widget);var m=this._createWrapper(f);b.attr(m,
{id:j,style:{zIndex:this._beginZIndex+e.length},"class":"dijitPopup "+(f.baseClass||f["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:a.parent?a.parent.id:""});if((b.isIE||b.isMoz)&&!f.bgIframe)f.bgIframe=new k.BackgroundIframe(m);g=h?k.placeOnScreenAroundElement(m,h,g,f.orient?b.hitch(f,"orient"):null):k.placeOnScreen(m,a,g=="R"?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],a.padding);m.style.display="";m.style.visibility="visible";f.domNode.style.visibility="visible";h=[];h.push(b.connect(m,
"onkeypress",this,function(e){if(e.charOrCode==b.keys.ESCAPE&&a.onCancel)b.stopEvent(e),a.onCancel();else if(e.charOrCode===b.keys.TAB&&(b.stopEvent(e),(e=this.getTopPopup())&&e.onCancel))e.onCancel()}));f.onCancel&&h.push(b.connect(f,"onCancel",a.onCancel));h.push(b.connect(f,f.onExecute?"onExecute":"onChange",this,function(){var a=this.getTopPopup();if(a&&a.onExecute)a.onExecute()}));e.push({widget:f,parent:a.parent,onExecute:a.onExecute,onCancel:a.onCancel,onClose:a.onClose,handlers:h});if(f.onOpen)f.onOpen(g);
return g},close:function(a){for(var e=this._stack;a&&b.some(e,function(e){return e.widget==a})||!a&&e.length;){var f=e.pop(),g=f.widget,h=f.onClose;if(g.onClose)g.onClose();b.forEach(f.handlers,b.disconnect);g&&g.domNode&&this.hide(g);h&&h()}}},k._frames=new function(){var a=[];this.pop=function(){var e;a.length?(e=a.pop(),e.style.display=""):(b.isIE<9?(e="<iframe src='"+(b.config.dojoBlankHtmlUrl||b.moduleUrl("dojo","resources/blank.html")+""||'javascript:""')+"' style='position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity=\"0\");'>",
e=b.doc.createElement(e)):(e=b.create("iframe"),e.src='javascript:""',e.className="dijitBackgroundIframe",b.style(e,"opacity",0.1)),e.tabIndex=-1,k.setWaiRole(e,"presentation"));return e};this.push=function(e){e.style.display="none";a.push(e)}},k.BackgroundIframe=function(a){if(!a.id)throw Error("no id");if(b.isIE||b.isMoz){var e=this.iframe=k._frames.pop();a.appendChild(e);b.isIE<7||b.isQuirks?(this.resize(a),this._conn=b.connect(a,"onresize",this,function(){this.resize(a)})):b.style(e,{width:"100%",
height:"100%"})}},b.extend(k.BackgroundIframe,{resize:function(a){this.iframe&&b.style(this.iframe,{width:a.offsetWidth+"px",height:a.offsetHeight+"px"})},destroy:function(){if(this._conn)b.disconnect(this._conn),this._conn=null;this.iframe&&(k._frames.push(this.iframe),delete this.iframe)}});if(!b._hasResource["dijit._base.scroll"])b._hasResource["dijit._base.scroll"]=!0,b.provide("dijit._base.scroll"),k.scrollIntoView=function(a,e){b.window.scrollIntoView(a,e)};b._hasResource["dojo.uacss"]||(b._hasResource["dojo.uacss"]=
!0,b.provide("dojo.uacss"),function(){var a=b,e=a.doc.documentElement,f=a.isIE,g=a.isOpera,h=Math.floor,j=a.isFF,m=a.boxModel.replace(/-/,""),f={dj_ie:f,dj_ie6:h(f)==6,dj_ie7:h(f)==7,dj_ie8:h(f)==8,dj_ie9:h(f)==9,dj_quirks:a.isQuirks,dj_iequirks:f&&a.isQuirks,dj_opera:g,dj_khtml:a.isKhtml,dj_webkit:a.isWebKit,dj_safari:a.isSafari,dj_chrome:a.isChrome,dj_gecko:a.isMozilla,dj_ff3:h(j)==3};f["dj_"+m]=!0;var v="",k;for(k in f)f[k]&&(v+=k+" ");e.className=a.trim(e.className+" "+v);b._loaders.unshift(function(){if(!b._isBodyLtr()){var f=
"dj_rtl dijitRtl "+v.replace(/ /g,"-rtl ");e.className=a.trim(e.className+" "+f)}})}());b._hasResource["dijit._base.sniff"]||(b._hasResource["dijit._base.sniff"]=!0,b.provide("dijit._base.sniff"));if(!b._hasResource["dijit._base.typematic"])b._hasResource["dijit._base.typematic"]=!0,b.provide("dijit._base.typematic"),k.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(this._currentTimeout<0?this._initialDelay:
this._subsequentDelay>1?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);this._timer=setTimeout(b.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(a,e,f,g,h,j,m,v){if(h!=this._obj)this.stop(),this._initialDelay=m||500,this._subsequentDelay=j||0.9,this._minDelay=v||10,this._obj=h,this._evt=a,this._node=f,this._count=this._currentTimeout=-1,this._callback=b.hitch(e,g),this._fireEventAndReload(),this._evt=b.mixin({faux:!0},a)},stop:function(){if(this._timer)clearTimeout(this._timer),
this._timer=null;if(this._obj)this._callback(-1,this._node,this._evt),this._obj=null},addKeyListener:function(a,e,f,g,h,j,m){if(e.keyCode)e.charOrCode=e.keyCode,b.deprecated("keyCode attribute parameter for dijit.typematic.addKeyListener is deprecated. Use charOrCode instead.","","2.0");else if(e.charCode)e.charOrCode=String.fromCharCode(e.charCode),b.deprecated("charCode attribute parameter for dijit.typematic.addKeyListener is deprecated. Use charOrCode instead.","","2.0");return[b.connect(a,"onkeypress",
this,function(v){v.charOrCode==e.charOrCode&&(e.ctrlKey===void 0||e.ctrlKey==v.ctrlKey)&&(e.altKey===void 0||e.altKey==v.altKey)&&(e.metaKey===void 0||e.metaKey==(v.metaKey||!1))&&(e.shiftKey===void 0||e.shiftKey==v.shiftKey)?(b.stopEvent(v),k.typematic.trigger(v,f,a,g,e,h,j,m)):k.typematic._obj==e&&k.typematic.stop()}),b.connect(a,"onkeyup",this,function(){k.typematic._obj==e&&k.typematic.stop()})]},addMouseListener:function(a,e,f,g,h,j){var m=b.connect;return[m(a,"mousedown",this,function(m){b.stopEvent(m);
k.typematic.trigger(m,e,a,f,a,g,h,j)}),m(a,"mouseup",this,function(a){b.stopEvent(a);k.typematic.stop()}),m(a,"mouseout",this,function(a){b.stopEvent(a);k.typematic.stop()}),m(a,"mousemove",this,function(a){a.preventDefault()}),m(a,"dblclick",this,function(m){b.stopEvent(m);b.isIE&&(k.typematic.trigger(m,e,a,f,a,g,h,j),setTimeout(b.hitch(this,k.typematic.stop),50))})]},addListener:function(a,e,b,g,h,j,m,v){return this.addKeyListener(e,b,g,h,j,m,v).concat(this.addMouseListener(a,g,h,j,m,v))}};b._hasResource["dijit._base"]||
(b._hasResource["dijit._base"]=!0,b.provide("dijit._base"));if(!b._hasResource["dijit._Widget"])b._hasResource["dijit._Widget"]=!0,b.provide("dijit._Widget"),b.connect(b,"_connect",function(a,e){a&&b.isFunction(a._onConnect)&&a._onConnect(e)}),k._connectOnUseEventHandler=function(){},k._lastKeyDownNode=null,b.isIE?function(){var a=function(a){k._lastKeyDownNode=a.srcElement};b.doc.attachEvent("onkeydown",a);b.addOnWindowUnload(function(){b.doc.detachEvent("onkeydown",a)})}():b.doc.addEventListener("keydown",
function(a){k._lastKeyDownNode=a.target},!0),function(){b.declare("dijit._Widget",k._WidgetBase,{_deferredConnects:{onClick:"",onDblClick:"",onKeyDown:"",onKeyPress:"",onKeyUp:"",onMouseMove:"",onMouseDown:"",onMouseOut:"",onMouseOver:"",onMouseLeave:"",onMouseEnter:"",onMouseUp:""},onClick:k._connectOnUseEventHandler,onDblClick:k._connectOnUseEventHandler,onKeyDown:k._connectOnUseEventHandler,onKeyPress:k._connectOnUseEventHandler,onKeyUp:k._connectOnUseEventHandler,onMouseDown:k._connectOnUseEventHandler,
onMouseMove:k._connectOnUseEventHandler,onMouseOut:k._connectOnUseEventHandler,onMouseOver:k._connectOnUseEventHandler,onMouseLeave:k._connectOnUseEventHandler,onMouseEnter:k._connectOnUseEventHandler,onMouseUp:k._connectOnUseEventHandler,create:function(){this._deferredConnects=b.clone(this._deferredConnects);for(var a in this.attributeMap)delete this._deferredConnects[a];for(a in this._deferredConnects)this[a]!==k._connectOnUseEventHandler&&delete this._deferredConnects[a];this.inherited(arguments);
if(this.domNode)for(a in this.params)this._onConnect(a)},_onConnect:function(a){a in this._deferredConnects&&(this.connect(this[this._deferredConnects[a]||"domNode"],a.toLowerCase(),a),delete this._deferredConnects[a])},focused:!1,isFocusable:function(){return this.focus&&b.style(this.domNode,"display")!="none"},onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()},setAttribute:function(a,e){b.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,e)},attr:function(a){if(b.config.isDebug){var e=arguments.callee._ach||(arguments.callee._ach={}),f=(arguments.callee.caller||"unknown caller").toString();e[f]||(b.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+f,"","2.0"),e[f]=!0)}return arguments.length>=2||typeof a==="object"?this.set.apply(this,arguments):this.get(a)},nodesWithKeyClick:["input","button"],connect:function(a,e,f){var g=b,h=g._connect,j=this.inherited(arguments,
[a,e=="ondijitclick"?"onclick":e,f]);if(e=="ondijitclick"&&g.indexOf(this.nodesWithKeyClick,a.nodeName.toLowerCase())==-1){var m=g.hitch(this,f);j.push(h(a,"onkeydown",this,function(e){if((e.keyCode==g.keys.ENTER||e.keyCode==g.keys.SPACE)&&!e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey)k._lastKeyDownNode=e.target,"openDropDown"in this&&a==this._buttonNode||e.preventDefault()}),h(a,"onkeyup",this,function(a){if((a.keyCode==g.keys.ENTER||a.keyCode==g.keys.SPACE)&&a.target==k._lastKeyDownNode&&!a.ctrlKey&&
!a.shiftKey&&!a.altKey&&!a.metaKey)return k._lastKeyDownNode=null,m(a)}))}return j},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}})}();if(!b._hasResource["dojo.string"])b._hasResource["dojo.string"]=!0,b.provide("dojo.string"),b.getObject("string",!0,b),b.string.rep=function(a,e){if(e<=0||!a)return"";for(var b=[];;){e&1&&b.push(a);if(!(e>>=1))break;a+=a}return b.join("")},b.string.pad=function(a,e,f,g){f||(f="0");a=String(a);e=b.string.rep(f,
Math.ceil((e-a.length)/f.length));return g?a+e:e+a},b.string.substitute=function(a,e,f,g){g=g||b.global;f=f?b.hitch(g,f):function(a){return a};return a.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(a,j,m){a=b.getObject(j,!1,e);m&&(a=b.getObject(m,!1,g).call(g,a,j));return f(a,j).toString()})},b.string.trim=String.prototype.trim?b.trim:function(a){for(var a=a.replace(/^\s+/,""),e=a.length-1;e>=0;e--)if(/\S/.test(a.charAt(e))){a=a.substring(0,e+1);break}return a};if(!b._hasResource["dojo.date.stamp"])b._hasResource["dojo.date.stamp"]=
!0,b.provide("dojo.date.stamp"),b.getObject("date.stamp",!0,b),b.date.stamp.fromISOString=function(a,e){if(!b.date.stamp._isoRegExp)b.date.stamp._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;var f=b.date.stamp._isoRegExp.exec(a),g=null;if(f){f.shift();f[1]&&f[1]--;f[6]&&(f[6]*=1E3);e&&(e=new Date(e),b.forEach(b.map(["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(a){return e["get"+a]()}),function(a,
e){f[e]=f[e]||a}));g=new Date(f[0]||1970,f[1]||0,f[2]||1,f[3]||0,f[4]||0,f[5]||0,f[6]||0);f[0]<100&&g.setFullYear(f[0]||1970);var h=0,j=f[7]&&f[7].charAt(0);j!="Z"&&(h=(f[8]||0)*60+(Number(f[9])||0),j!="-"&&(h*=-1));j&&(h-=g.getTimezoneOffset());h&&g.setTime(g.getTime()+h*6E4)}return g},b.date.stamp.toISOString=function(a,e){var b=function(a){return a<10?"0"+a:a},e=e||{},g=[],h=e.zulu?"getUTC":"get",j="";e.selector!="time"&&(j=a[h+"FullYear"](),j=["0000".substr((j+"").length)+j,b(a[h+"Month"]()+1),
b(a[h+"Date"]())].join("-"));g.push(j);if(e.selector!="date"){j=[b(a[h+"Hours"]()),b(a[h+"Minutes"]()),b(a[h+"Seconds"]())].join(":");h=a[h+"Milliseconds"]();e.milliseconds&&(j+="."+(h<100?"0":"")+b(h));if(e.zulu)j+="Z";else if(e.selector!="time"){var h=a.getTimezoneOffset(),m=Math.abs(h);j+=(h>0?"-":"+")+b(Math.floor(m/60))+":"+b(m%60)}g.push(j)}return g.join("T")};if(!b._hasResource["dojo.parser"])b._hasResource["dojo.parser"]=!0,b.provide("dojo.parser"),b.parser=new function(){function a(a){if(h.isString(a))return"string";
if(typeof a=="number")return"number";if(typeof a=="boolean")return"boolean";if(h.isFunction(a))return"function";if(h.isArray(a))return"array";if(a instanceof Date)return"date";if(a instanceof h._Url)return"url";return"object"}function e(a,e){switch(e){case "string":return a;case "number":return a.length?Number(a):NaN;case "boolean":return typeof a=="boolean"?a:a.toLowerCase()!="false";case "function":h.isFunction(a)&&(a=a.toString(),a=h.trim(a.substring(a.indexOf("{")+1,a.length-1)));try{return a===
""||a.search(/[^\w\.]+/i)!=-1?new Function(a):h.getObject(a,!1)||new Function(a)}catch(b){return new Function}case "array":return a?a.split(/\s*,\s*/):[];case "date":switch(a){case "":return new Date("");case "now":return new Date;default:return h.date.stamp.fromISOString(a)}case "url":return h.baseUrl+a;default:return h.fromJson(a)}}function f(e,b){for(var f in e)f.charAt(0)!="_"&&(f in j||(b[f]=a(e[f])));return b}function g(a,e){var b=m[a];if(b){if(!e&&!b.params)b.params=f(b.cls.prototype,{})}else{var b=
h.getObject(a),g=null;if(!b)return null;e||(g=f(b.prototype,{}));b={cls:b,params:g}}return b}var h=b,j={},m={};h.connect(h,"extend",function(){m={}});this._functionFromScript=function(a,e){var b="",f="",g=a.getAttribute(e+"args")||a.getAttribute("args");g&&h.forEach(g.split(/\s*,\s*/),function(a,e){b+="var "+a+" = arguments["+e+"]; "});(g=a.getAttribute("with"))&&g.length&&h.forEach(g.split(/\s*,\s*/),function(a){b+="with("+a+"){";f+="}"});return new Function(b+a.innerHTML+f)};this.instantiate=function(a,
f,j){var m=[],f=f||{},j=j||{},k=(j.scope||h._scopeName)+"Type",l="data-"+(j.scope||h._scopeName)+"-";h.forEach(a,function(a){if(a){var v,u,A,B,E,F;a.node?(v=a.node,u=a.type,F=a.fastpath,B=(A=a.clsInfo||u&&g(u,F))&&A.cls,E=a.scripts):(v=a,E=(B=(A=(u=k in f?f[k]:v.getAttribute(k))&&g(u))&&A.cls)&&(B._noScript||B.prototype._noScript)?[]:h.query("> script[type^='dojo/']",v));if(!A)throw Error("Could not load class '"+u);var z={};j.defaults&&h._mixin(z,j.defaults);a.inherited&&h._mixin(z,a.inherited);
if(F){if((A=v.getAttribute(l+"props"))&&A.length)try{A=h.fromJson.call(j.propsThis,"{"+A+"}"),h._mixin(z,A)}catch(C){throw Error(C.toString()+" in data-dojo-props='"+A+"'");}if(A=v.getAttribute(l+"attach-point"))z.dojoAttachPoint=A;if(A=v.getAttribute(l+"attach-event"))z.dojoAttachEvent=A;b.mixin(z,f)}else{var a=v.attributes,D;for(D in A.params)if((u=D in f?{value:f[D],specified:!0}:a.getNamedItem(D))&&(u.specified||b.isIE&&D.toLowerCase()=="value")){u=u.value;switch(D){case "class":u="className"in
f?f.className:v.className;break;case "style":u="style"in f?f.style:v.style&&v.style.cssText}F=A.params[D];z[D]=typeof u=="string"?e(u,F):u}}var G=[],I=[];h.forEach(E,function(a){v.removeChild(a);var e=a.getAttribute(l+"event")||a.getAttribute("event"),b=a.getAttribute("type"),a=h.parser._functionFromScript(a,l);e?b=="dojo/connect"?G.push({event:e,func:a}):z[e]=a:I.push(a)});var H=(E=B.markupFactory||B.prototype&&B.prototype.markupFactory)?E(z,v,B):new B(z,v);m.push(H);(B=v.getAttribute(l+"id")||v.getAttribute("jsId"))&&
h.setObject(B,H);h.forEach(G,function(a){h.connect(H,a.event,null,a.func)});h.forEach(I,function(a){a.call(H)})}});f._started||h.forEach(m,function(a){!j.noStart&&a&&b.isFunction(a.startup)&&!a._started&&(!a.getParent||!a.getParent())&&a.startup()});return m};this.parse=function(a,e){function f(a,h){var j=b.clone(a.inherited);b.forEach(["dir","lang"],function(e){var b=a.node.getAttribute(e);b&&(j[e]=b)});for(var v=a.clsInfo&&!a.clsInfo.cls.prototype._noScript?a.scripts:null,l=!a.clsInfo||!a.clsInfo.cls.prototype.stopParser||
e&&e.template,p=a.node.firstChild;p;p=p.nextSibling)if(p.nodeType==1){var w,C=l&&p.getAttribute(k+"type");w=C?C:l&&p.getAttribute(m);C=C==w;w?(w={type:w,fastpath:C,clsInfo:g(w,C),node:p,scripts:[],inherited:j},h.push(w),f(w,h)):v&&p.nodeName.toLowerCase()=="script"?(w=p.getAttribute("type"))&&/^dojo\/\w/i.test(w)&&v.push(p):l&&f({node:p,inherited:j},h)}}var j;!e&&a&&a.rootNode?(e=a,j=e.rootNode):j=a;var e=e||{},m=(e.scope||h._scopeName)+"Type",k="data-"+(e.scope||h._scopeName)+"-",l=[];f({node:j?
b.byId(j):b.body(),inherited:e&&e.inherited||{dir:b._isBodyLtr()?"ltr":"rtl"}},l);return this.instantiate(l,e&&e.template?{template:!0}:null,e)}},function(){var a=function(){b.config.parseOnLoad&&b.parser.parse()};b.getObject("dijit.wai.onload")===b._loaders[0]?b._loaders.splice(1,0,a):b._loaders.unshift(a)}();if(!b._hasResource["dojo.cache"]){b._hasResource["dojo.cache"]=!0;b.provide("dojo.cache");var I={};b.cache=function(a,e,f){typeof a=="string"?a=b.moduleUrl(a,e):f=e;e=a.toString();a=f;f!=void 0&&
!b.isString(f)&&(a="value"in f?f.value:void 0);f=f&&f.sanitize?!0:!1;typeof a=="string"?a=I[e]=f?b.cache._sanitize(a):a:a===null?delete I[e]:(e in I||(a=b._getText(e),I[e]=f?b.cache._sanitize(a):a),a=I[e]);return a};b.cache._sanitize=function(a){if(a){var a=a.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,""),e=a.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);e&&(a=e[1])}else a="";return a}}if(!b._hasResource["dijit._Templated"])b._hasResource["dijit._Templated"]=!0,b.provide("dijit._Templated"),
b.declare("dijit._Templated",null,{templateString:null,templatePath:null,widgetsInTemplate:!1,_skipNodeCache:!1,_earlyTemplatedStartup:!1,constructor:function(){this._attachPoints=[];this._attachEvents=[]},_stringRepl:function(a){var e=this.declaredClass,f=this;return b.string.substitute(a,this,function(a,h){h.charAt(0)=="!"&&(a=b.getObject(h.substr(1),!1,f));if(typeof a=="undefined")throw Error(e+" template:"+h);if(a==null)return"";return h.charAt(0)=="!"?a:a.toString().replace(/"/g,"&quot;")},this)},
buildRendering:function(){var a=k._Templated.getCachedTemplate(this.templatePath,this.templateString,this._skipNodeCache),e;if(b.isString(a)){if(e=b._toDom(this._stringRepl(a)),e.nodeType!=1)throw Error("Invalid template: "+a);}else e=a.cloneNode(!0);this.domNode=e;this.inherited(arguments);this._attachTemplateNodes(e);if(this.widgetsInTemplate)a=this._startupWidgets=b.parser.parse(e,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang},propsThis:this,scope:"dojo"}),
this._supportingWidgets=k.findWidgets(e),this._attachTemplateNodes(a,function(a,e){return a[e]});this._fillContent(this.srcNodeRef)},_fillContent:function(a){var e=this.containerNode;if(a&&e)for(;a.hasChildNodes();)e.appendChild(a.firstChild)},_attachTemplateNodes:function(a,e){for(var e=e||function(a,e){return a.getAttribute(e)},f=b.isArray(a)?a:a.all||a.getElementsByTagName("*"),g=b.isArray(a)?0:-1;g<f.length;g++){var h=g==-1?a:f[g];if(!this.widgetsInTemplate||!e(h,"dojoType")&&!e(h,"data-dojo-type")){var j=
e(h,"dojoAttachPoint")||e(h,"data-dojo-attach-point");if(j)for(var m=j.split(/\s*,\s*/);j=m.shift();)b.isArray(this[j])?this[j].push(h):this[j]=h,this._attachPoints.push(j);if(j=e(h,"dojoAttachEvent")||e(h,"data-dojo-attach-event"))for(var m=j.split(/\s*,\s*/),v=b.trim;j=m.shift();)if(j){var o=null;j.indexOf(":")!=-1?(o=j.split(":"),j=v(o[0]),o=v(o[1])):j=v(j);o||(o=j);this._attachEvents.push(this.connect(h,j,o))}(j=e(h,"waiRole"))&&k.setWaiRole(h,j);(j=e(h,"waiState"))&&b.forEach(j.split(/\s*,\s*/),
function(a){a.indexOf("-")!=-1&&(a=a.split("-"),k.setWaiState(h,a[0],a[1]))})}}},startup:function(){b.forEach(this._startupWidgets,function(a){a&&!a._started&&a.startup&&a.startup()});this.inherited(arguments)},destroyRendering:function(){b.forEach(this._attachPoints,function(a){delete this[a]},this);this._attachPoints=[];b.forEach(this._attachEvents,this.disconnect,this);this._attachEvents=[];this.inherited(arguments)}}),k._Templated._templateCache={},k._Templated.getCachedTemplate=function(a,e,
f){var g=k._Templated._templateCache,h=e||a,j=g[h];if(j){try{if(!j.ownerDocument||j.ownerDocument==b.doc)return j}catch(m){}b.destroy(j)}e||(e=b.cache(a,{sanitize:!0}));e=b.string.trim(e);if(f||e.match(/\$\{([^\}]+)\}/g))return g[h]=e;else{a=b._toDom(e);if(a.nodeType!=1)throw Error("Invalid template: "+e);return g[h]=a}},b.isIE&&b.addOnWindowUnload(function(){var a=k._Templated._templateCache,e;for(e in a){var f=a[e];typeof f=="object"&&b.destroy(f);delete a[e]}}),b.extend(k._Widget,{dojoAttachEvent:"",
dojoAttachPoint:"",waiRole:"",waiState:""});b._hasResource["dijit._Container"]||(b._hasResource["dijit._Container"]=!0,b.provide("dijit._Container"),b.declare("dijit._Container",null,{isContainer:!0,buildRendering:function(){this.inherited(arguments);if(!this.containerNode)this.containerNode=this.domNode},addChild:function(a,e){var f=this.containerNode;if(e&&typeof e=="number"){var g=this.getChildren();if(g&&g.length>=e)f=g[e-1].domNode,e="after"}b.place(a.domNode,f,e);this._started&&!a._started&&
a.startup()},removeChild:function(a){typeof a=="number"&&(a=this.getChildren()[a]);if(a)(a=a.domNode)&&a.parentNode&&a.parentNode.removeChild(a)},hasChildren:function(){return this.getChildren().length>0},destroyDescendants:function(a){b.forEach(this.getChildren(),function(e){e.destroyRecursive(a)})},_getSiblingOfChild:function(a,e){var b=a.domNode,g=e>0?"nextSibling":"previousSibling";do b=b[g];while(b&&(b.nodeType!=1||!k.byNode(b)));return b&&k.byNode(b)},getIndexOfChild:function(a){return b.indexOf(this.getChildren(),
a)},startup:function(){this._started||(b.forEach(this.getChildren(),function(a){a.startup()}),this.inherited(arguments))}}));b._hasResource["dijit._Contained"]||(b._hasResource["dijit._Contained"]=!0,b.provide("dijit._Contained"),b.declare("dijit._Contained",null,{getParent:function(){var a=k.getEnclosingWidget(this.domNode.parentNode);return a&&a.isContainer?a:null},_getSibling:function(a){var e=this.domNode;do e=e[a+"Sibling"];while(e&&e.nodeType!=1);return e&&k.byNode(e)},getPreviousSibling:function(){return this._getSibling("previous")},
getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var a=this.getParent();if(!a||!a.getIndexOfChild)return-1;return a.getIndexOfChild(this)}}));if(!b._hasResource["dijit.layout._LayoutWidget"])b._hasResource["dijit.layout._LayoutWidget"]=!0,b.provide("dijit.layout._LayoutWidget"),b.declare("dijit.layout._LayoutWidget",[k._Widget,k._Container,k._Contained],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,buildRendering:function(){this.inherited(arguments);
b.addClass(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var a=this.getParent&&this.getParent();if(!a||!a.isLayoutContainer)this.resize(),this._viewport=k.getViewport(),this.connect(b.isIE?this.domNode:b.global,"onresize",function(){var a=k.getViewport();if(a.w!=this._viewport.w||a.h!=this._viewport.h)this._viewport=a,this.resize()})}},resize:function(a,e){var f=this.domNode;if(a){b.marginBox(f,a);if(a.t)f.style.top=a.t+"px";if(a.l)f.style.left=a.l+
"px"}var g=e||{};b.mixin(g,a||{});if(!("h"in g)||!("w"in g))g=b.mixin(b.marginBox(f),g);var h=b.getComputedStyle(f),j=b._getMarginExtents(f,h),m=b._getBorderExtents(f,h),g=this._borderBox={w:g.w-(j.w+m.w),h:g.h-(j.h+m.h)},j=b._getPadExtents(f,h);this._contentBox={l:b._toPixelValue(f,h.paddingLeft),t:b._toPixelValue(f,h.paddingTop),w:g.w-j.w,h:g.h-j.h};this.layout()},layout:function(){},_setupChild:function(a){b.addClass(a.domNode,this.baseClass+"-child "+(a.baseClass?this.baseClass+"-"+a.baseClass:
""))},addChild:function(a){this.inherited(arguments);this._started&&this._setupChild(a)},removeChild:function(a){b.removeClass(a.domNode,this.baseClass+"-child"+(a.baseClass?" "+this.baseClass+"-"+a.baseClass:""));this.inherited(arguments)}}),k.layout.marginBox2contentBox=function(a,e){var f=b.getComputedStyle(a),g=b._getMarginExtents(a,f),h=b._getPadBorderExtents(a,f);return{l:b._toPixelValue(a,f.paddingLeft),t:b._toPixelValue(a,f.paddingTop),w:e.w-(g.w+h.w),h:e.h-(g.h+h.h)}},function(){var a=function(a,
f){a.resize?a.resize(f):b.marginBox(a.domNode,f);b.mixin(a,b.marginBox(a.domNode));b.mixin(a,f)};k.layout.layoutChildren=function(e,f,g,h,j){f=b.mixin({},f);b.addClass(e,"dijitLayoutContainer");g=b.filter(g,function(a){return a.region!="center"&&a.layoutAlign!="client"}).concat(b.filter(g,function(a){return a.region=="center"||a.layoutAlign=="client"}));b.forEach(g,function(e){var g=e.domNode,k=e.region||e.layoutAlign,n=g.style;n.left=f.l+"px";n.top=f.t+"px";n.bottom=n.right="auto";b.addClass(g,"dijitAlign"+
(k.substring(0,1).toUpperCase()+k.substring(1)));g={};h&&h==e.id&&(g[e.region=="top"||e.region=="bottom"?"h":"w"]=j);k=="top"||k=="bottom"?(g.w=f.w,a(e,g),f.h-=e.h,k=="top"?f.t+=e.h:n.top=f.t+f.h+"px"):k=="left"||k=="right"?(g.h=f.h,a(e,g),f.w-=e.w,k=="left"?f.l+=e.w:n.left=f.l+f.w+"px"):(k=="client"||k=="center")&&a(e,f)})}}();b._hasResource["dijit.layout.StackContainer"]||(b._hasResource["dijit.layout.StackContainer"]=!0,b.provide("dijit.layout.StackContainer"),b.declare("dijit.layout.StackContainer",
k.layout._LayoutWidget,{doLayout:!0,persist:!1,baseClass:"dijitStackContainer",buildRendering:function(){this.inherited(arguments);b.addClass(this.domNode,"dijitLayoutContainer");k.setWaiRole(this.containerNode,"tabpanel")},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onkeypress",this._onKeyPress)},startup:function(){if(!this._started){var a=this.getChildren();b.forEach(a,this._setupChild,this);this.persist?this.selectedChildWidget=k.byId(b.cookie(this.id+"_selectedChild")):
b.some(a,function(a){if(a.selected)this.selectedChildWidget=a;return a.selected},this);var e=this.selectedChildWidget;if(!e&&a[0])e=this.selectedChildWidget=a[0],e.selected=!0;b.publish(this.id+"-startup",[{children:a,selected:e}]);this.inherited(arguments)}},resize:function(){var a=this.selectedChildWidget;if(a&&!this._hasBeenShown)this._hasBeenShown=!0,this._showChild(a);this.inherited(arguments)},_setupChild:function(a){this.inherited(arguments);b.replaceClass(a.domNode,"dijitHidden","dijitVisible");
a.domNode.title=""},addChild:function(a,e){this.inherited(arguments);this._started&&(b.publish(this.id+"-addChild",[a,e]),this.selectedChildWidget||this.selectChild(a))},removeChild:function(a){this.inherited(arguments);this._started&&b.publish(this.id+"-removeChild",[a]);if(!this._beingDestroyed&&this.selectedChildWidget===a&&(this.selectedChildWidget=void 0,this._started)){var e=this.getChildren();e.length&&this.selectChild(e[0])}},selectChild:function(a,e){a=k.byId(a);if(this.selectedChildWidget!=
a){var f=this._transition(a,this.selectedChildWidget,e);this._set("selectedChildWidget",a);b.publish(this.id+"-selectChild",[a]);this.persist&&b.cookie(this.id+"_selectedChild",this.selectedChildWidget.id)}return f},_transition:function(a,e){e&&this._hideChild(e);var b=this._showChild(a);a.resize&&(this.doLayout?a.resize(this._containerContentBox||this._contentBox):a.resize());return b},_adjacent:function(a){var e=this.getChildren(),f=b.indexOf(e,this.selectedChildWidget);f+=a?1:e.length-1;return e[f%
e.length]},forward:function(){return this.selectChild(this._adjacent(!0),!0)},back:function(){return this.selectChild(this._adjacent(!1),!0)},_onKeyPress:function(a){b.publish(this.id+"-containerKeyPress",[{e:a,page:this}])},layout:function(){this.doLayout&&this.selectedChildWidget&&this.selectedChildWidget.resize&&this.selectedChildWidget.resize(this._containerContentBox||this._contentBox)},_showChild:function(a){var e=this.getChildren();a.isFirstChild=a==e[0];a.isLastChild=a==e[e.length-1];a._set("selected",
!0);b.replaceClass(a.domNode,"dijitVisible","dijitHidden");return a._onShow()||!0},_hideChild:function(a){a._set("selected",!1);b.replaceClass(a.domNode,"dijitHidden","dijitVisible");a.onHide()},closeChild:function(a){a.onClose(this,a)&&(this.removeChild(a),a.destroyRecursive())},destroyDescendants:function(a){b.forEach(this.getChildren(),function(e){this.removeChild(e);e.destroyRecursive(a)},this)}}),b.extend(k._Widget,{selected:!1,closable:!1,iconClass:"",showTitle:!0}));b._hasResource["ws.widget.FTUTip"]||
(b._hasResource["ws.widget.FTUTip"]=!0,b.provide("ws.widget.FTUTip"),b.declare("ws.widget.FTUTip",[k._Widget,k._Templated],{templateString:b.cache("ws.widget","FTUTip.html",'<div class="FTUTip ${className}" dojoAttachPoint="ftutip" dojoAttachEvent="onclick: onClick" style="display:none">\r\n\t<div class="padBox" dojoAttachPoint="padBox">\r\n\t\t<div class="message" dojoAttachPoint="message"></div>\r\n\t\t<button class="mainSprite wsCloseBtn" dojoAttachPoint="closeButton" dojoAttachEvent="onclick: closeTip"></button>\r\n\t</div>\r\n\t<div dojoAttachPoint="balloonArrowNode"></div>\r\n</div>\r\n'),
css:{templateString:""},name:"",content:"",delayOnShow:10,className:"",dimensions:{w:264,h:null},positionOverNode:document.body,offset:{x:0,y:0},arrowPosition:"right",distanceArrowFromEdge:10,saveAsSeenOnClose:!0,startup:function(){this.positionOverNode&&this.connect(window,"onresize","placeOnScreen");this.message.style.width=this.dimensions.w+"px";if(this.dimensions.height)this.message.style.height=this.dimensions.h+"px";if(this.domNode&&this.balloonArrowNode!=null)b.addClass(this.balloonArrowNode,
"mainSprite balloonArrow "+this.arrowPosition),this.arrowPosition=="right"||this.arrowPosition=="left"?this.balloonArrowNode.style.top=this.distanceArrowFromEdge+"px":this.balloonArrowNode.style.left=this.distanceArrowFromEdge+"px";if(this.message)this.message.innerHTML=this.content,b.forEach(b.query("a",this.message),function(a){b.addClass(a,"wsLink")});this.load&&this.load(this)},placeOnScreen:function(){if(this.positionOverNode){var a=b.position(this.positionOverNode);k.placeOnScreen(this.domNode,
{x:this.offset.x+a.x,y:this.offset.y+a.y},["TL"])}},showTip:function(){setTimeout(b.hitch(this,function(){this.domNode.style.display="";this.placeOnScreen()}),this.delayOnShow)},onClick:function(a){a.target.tagName=="A"&&this.closeTip()},closeTip:function(){this.saveAsSeenOnClose&&ws.bubbleConfig.saveAsSeen(this.name);this.destroy()},isExisting:function(){return this.domNode}}));if(!b._hasResource["ws.html"])b._hasResource["ws.html"]=!0,b.provide("ws.html"),ws.html={_rewriteIframeContent:{},setInnerText:function(a,
e){e=e||"";e+="";b.isIE||b.isWebKit?a.innerText=e:b.isMoz?a.textContent=e:a.innerHTML=ws.string.escapeXml(e)},setShowing:function(a,e){if(a)a.style.display=e?"":"none"},setVisibility:function(a,e){a.style.visibility=e?"visible":"hidden"},asciiSeparator:"------------------------------------------------------------",getText:function(a){a=b.create("div",{innerHTML:a});return ws.html.renderedTextContent(a,null,!0)},renderedTextContent:function(a,e,b){return this._renderedTextContent(a,e,b).replace(/__aolwebsuiteblk____aolwebsuiteblk__/g,
"\n").replace(/__aolwebsuiteblk__/g,"\n")},_renderedTextContent:function(a,e,f,g){var a=b.byId(a),h="";if(a==null)return h;if(a.tagName&&a.tagName.toLowerCase()=="style")return"";for(var j=0;j<a.childNodes.length;j++)switch(a.childNodes[j].nodeType){case 1:case 5:var m="unknown";try{m=b.style(a.childNodes[j],"display")}catch(k){}var o=a.childNodes[j].nodeName.toLowerCase();b.isWebKit&&b.indexOf(["p","div","li"],o)!=-1&&(m="block");f&&o=="hr"&&(m="block");switch(m){case "block":case "list-item":case "run-in":case "table":case "table-row-group":case "table-header-group":case "table-footer-group":case "table-row":case "table-column-group":case "table-column":case "table-cell":case "table-caption":h+=
"__aolwebsuiteblk__";h+=f&&a.childNodes[j].tagName&&a.childNodes[j].tagName.toLowerCase()=="hr"?this.asciiSeparator:ws.html._renderedTextContent(a.childNodes[j],e,f,g||o=="pre");h+="__aolwebsuiteblk__";break;case "none":break;default:h+=a.childNodes[j].tagName&&a.childNodes[j].tagName.toLowerCase()=="br"?"\n":ws.html._renderedTextContent(a.childNodes[j],e,f,g)}break;case 3:case 2:case 4:m=a.childNodes[j].nodeValue;o="unknown";try{o=b.style(a,"text-transform")}catch(n){}switch(o){case "capitalize":m=
m.split(" ");for(o=0;o<m.length;o++)m[o]=m[o].charAt(0).toUpperCase()+m[o].substring(1);m=m.join(" ");break;case "uppercase":m=m.toUpperCase();break;case "lowercase":m=m.toLowerCase();break;case "nowrap":case "pre-wrap":case "pre-line":case "pre":break;default:e&&(m=m.replace(/\s+/,""))}h+=g?m.replace(/&nbsp;/gi," "):m.replace(/[\r\n]/g,"").replace(/&nbsp;/gi," ")}return h},addHoverClass:function(a,e,f){if(b.isIE<=7||f)e||(e="hover"),b.connect(a,"onmouseenter",function(){b.addClass(a,e)}),b.connect(a,
"onmouseleave",function(){b.removeClass(a,e)})},hideSoon:function(a){a.wsHtmlTimeoutId&&window.clearTimeout(a.wsHtmlTimeoutId);a.wsHtmlTimeoutId=setTimeout(function(){a.style.display="none"},100)},showSoon:function(a){a.wsHtmlTimeoutId&&window.clearTimeout(a.wsHtmlTimeoutId);a.wsHtmlTimeoutId=setTimeout(function(){a.style.display=""},100)},setAbsolutePosition:function(a,e){var f=a.offsetParent||b.body(),f=b._abs(f);a.style.left=e.x-f.x+"px";a.style.top=e.y-f.y+"px"},recreateIframe:function(a,e){var f=
a.innerHTML,g=/( src=["'][^"']*["'])/i.exec(f),f=g?f.replace(g[0],' src="about:blank"'):f.replace(/<iframe/i,'<iframe src="about:blank"');a.innerHTML="";a.innerHTML=f;f=a.getElementsByTagName("iframe")[0];if(e)f.style.display="none",b.io.iframe.setSrc(f,e,!0),f.style.display="";return f},rewriteIframe:function(a,e,f){return b.isIE||b.isMoz?(f=f||"defaultId",ws.html._rewriteIframeContent[f]=e,b.isIE<=6?ws.html.recreateIframe(a.parentNode,"javascript:setTimeout(function(){document.write(parent.ws.html._rewriteIframeContent['"+
f+"']);document.close();},5),void 1"):ws.html.recreateIframe(a.parentNode,"javascript:document.write(parent.ws.html._rewriteIframeContent['"+f+"']);document.close()")):(f=b.io.iframe.doc(a),f.open(),f.write(e),f.close(),a)},targetLinksToNewWindow:function(a){b.forEach(a.getElementsByTagName("a"),function(a){a.target="_blank"})},scaleImage:function(a,e){var b=a.offsetWidth,g=a.offsetHeight;if(b>e)a.width=e,a.height=Math.round(e/b*g)},fixKeyForMac:function(a){if(b.isMac&&a.keyChar&&a.keyChar.toLowerCase()==
"\u2211")a.keyChar="w";return a},fixKeyCodeForMac:function(a){if(b.isMac&&b.isMoz&&a.ctrlKey&&(a.keyCode==77||a.keyChar=="M"))return b.keys.ENTER;return a.keyCode},isTargetAnInputElement:function(a){var e=!1;a&&a.target&&a.target.nodeName&&(a=a.target.nodeName.toLowerCase(),e=a=="input"||a=="textarea");return e},isTargetALinkElement:function(a){var e=!1;a&&a.target&&a.target.nodeName&&(e=a.target.nodeName.toLowerCase()=="a");return e},overElement:function(a,e){if(typeof b=="undefined")return!1;var a=
b.byId(a),f={x:e.pageX,y:e.pageY},g=b._getBorderBox(a),h=b.position(a,!0),j=h.x,m=h.y;return f.x>=j&&f.x<=j+g.w&&f.y>=h.y&&f.y<=m+g.h},selectInputText:function(a){var e=b.global,f=b.doc,a=b.byId(a);try{if(f.selection&&b.body().createTextRange){if(a.createTextRange){var g=a.createTextRange();g.moveStart("character",0);g.moveEnd("character",a.value.length);g.select()}}else e.getSelection&&a.setSelectionRange&&a.setSelectionRange(0,a.value.length);a.focus()}catch(h){}},getScrollbar:function(){var a=
b.create("div",{style:{width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-300px",left:"0px"}}),e=b.create("div",{style:{width:"400px",height:"400px"}},a);b.body().appendChild(a);var f=a.offsetWidth-a.clientWidth;b.body().removeChild(a);a.removeChild(e);return{w:f}},clearSelection:function(){try{return window.getSelection?b.isSafari?window.getSelection().collapse():window.getSelection().removeAllRanges():document.selection&&(document.selection.empty?document.selection.empty():
document.selection.clear&&document.selection.clear()),!0}catch(a){return!1}},setFloat:function(a,e){a.style[ws.html.floatAttr]=e},getFloat:function(a){return a.style[ws.html.floatAttr]},floatAttr:b.isIE?"styleFloat":"cssFloat"};if(!b._hasResource["ws.widget.util"])b._hasResource["ws.widget.util"]=!0,b.provide("ws.widget.util"),b.extend(k._Widget,{show:function(){b.hasClass(this.domNode,"dijitStackContainer-child")&&b.removeClass(this.domNode,"dijitHidden");this.domNode.style.display=""},hide:function(){b.hasClass(this.domNode,
"dijitStackContainer-child")&&b.addClass(this.domNode,"dijitHidden");this.domNode.style.display="none"},isShowing:function(){if(this.domNode&&b.hasClass(this.domNode,"dijitStackContainer-child"))return!b.hasClass(this.domNode,"dijitHidden");return this.domNode&&this.domNode.style.display!="none"},setShowing:function(a){a?this.show():this.hide()},setEnabled:function(a){a?this.enable():this.disable()},resize:function(a){if(a&&(!this.coords||this.coords.w!=a.w||this.coords.h!=a.h))this.coords=a,b.marginBox(this.domNode,
a);this.onResized()},onResized:function(){var a=this.stackWidget||this.layoutWidget;a&&a.resize&&a.resize()},onShow:function(){var a=b.contentBox(this.domNode);if(a.w!=this.width||a.h!=this.height)this.onResized();this.width=a.w;this.height=a.h},onHide:function(){},spacer:Config.SpacerImageURL,baseimages:Config.BaseImagesURL,images:Config.BaseResourcesURL+"images/",affinityimages:Config.BaseAffinityResourcesURL+"images/"}),b.extend(k.WidgetSet,{first:function(){for(var a in this._hash)return this._hash[a];
return null}}),b.mixin(ws.widget,{insertCssText:function(a,e){if(a&&a.length!=0){var f=a.match(/\$\{([^\}]+)\}/g);if(f)for(var g=0;g<f.length;g++){var h=f[g],h=h.substring(2,h.length-1);(h=k._Widget.prototype[h])&&(a=a.replace(f[g],h))}var j,f=b.doc.getElementsByTagName("style");f.length<25?(j=b.doc.createElement("style"),f=b.doc.getElementsByTagName(b.isSafari||e?"head":"body")[0],f||(f=b.doc.createElement("head"),b.place(f,b.doc.documentElement,"first")),f.appendChild(j)):j=f[f.length-1];j.styleSheet?
(f=function(){try{j.styleSheet.cssText+=a}catch(e){}},j.styleSheet.disabled?setTimeout(f,10):f()):(f=b.doc.createTextNode(a),j.appendChild(f));return j}},createMenu:function(a){var e=new ws.widget.WSMenu;b.forEach(a,function(a){a&&(a=new (a.dojoType?eval(a.dojoType):a.separator?ws.widget.WSMenuSeparator:ws.widget.WSMenuItem)(a),e.addChild(a))});b.body().appendChild(e.domNode);e.startup();return e},fixFFCursor:function(a){if(b.isMoz)a.style.overflow="hidden",ws.lang.setTimeout(this,function(){a.style.overflow=
"auto"},0)},pointer:function(a){var e=b.query(".wsPointerContainer",a.node)[0];e||(e=document.createElement("div"),a.node.appendChild(e));e.className="wsPointerContainer wsPointerContainer-"+a.side;e.style.display="block";e.style.zIndex=2;var f=b.query(".wsPointer",a.node)[0];f||(f=document.createElement("div"),e.appendChild(f));f.pointerSide=a.side;f.className="wsPointer wsPointer-"+a.side;f.style.display="block";f.style.zIndex=2;var g=b._abs(a.node),h=b._abs(a.target);a.side=="right"||a.side=="left"?
(g=h.y-g.y,g+=a.target.offsetHeight/2,g-=ws.widget.pointerHeight,g+=a.nudge?a.nudge:0,f.style.top=Math.round(g)+"px",f.style.left="0",e.style.width=this.pointerWidth+"px",e.style.height=b._getMarginSize(a.node).h+"px",b.addClass(e,"wsPointerContainer-0Top"),b.removeClass(e,".wsPointerContainer-0Left")):(g=h.x-g.x,g+=a.target.offsetWidth/2,g-=ws.widget.pointerWidth,g+=a.nudge?a.nudge:0,f.style.left=Math.round(g)+"px",f.style.top="0",e.style.height=this.pointerHeight+"px",e.style.width=b._getMarginSize(a.node).w+
"px",b.addClass(e,"wsPointerContainer-0Left"),b.removeClass(e,".wsPointerContainer-0Top"));return e},setPointerLoc:function(a,e){if(e!=null){var f=b.query(".wsPointer",a)[0];f||(f=document.createElement("div"),a.appendChild(f));f.pointerSide=e.side;f.className="wsPointer wsPointer-"+e.side;f.style.display="block";f.style.zIndex=2;e.side=="right"||e.side=="left"?(f.style.top=e.offset+"px",f.style.left=""):(f.style.left=e.offset+"px",f.style.top="")}},getPointerLoc:function(a){var e=b.query(".wsPointer",
a)[0];if(!e)return null;a=e.pointerSide;e=a=="right"||a=="left"?parseInt(e.style.top):parseInt(e.style.left);return{offset:isNaN(e)?0:e,side:a}},hidePointer:function(a){if(a=b.query(".wsPointer",a)[0])a.style.display="none"},pointerWidth:15,pointerHeight:12,getEventTarget:function(a,e,f){a=a.target||a.srcElement;if(a.nodeType==3)a=a.parentNode;if(b.hasClass(a,e))return a;for(;a.nodeName!="BODY";){if(f&&b.hasClass(a,f))break;if(b.hasClass(a,e))return a;a=a.parentNode}return null},_showInstatip:function(a,
e,f,g,h){b.byId("instatip").innerHTML=e;f||(f=b.marginBox(window.wsMasterTip));e=f.w;tipHeight=f.h;var j=g||b.position(a);if(!(j.w==0&&j.y==0)){var m={l:j.x+j.w/2-e/2,t:j.y+j.h+4},g={l:e/2-6,t:-7},f="mainSprite instatipArrow";if(h=="right")m.l=j.x+j.w+12,m.t=j.y+(j.h-tipHeight)/2,g.l=-10,g.t=tipHeight/2-6,f+=" instatipArrowR";else if(h=="left")m.l=j.x-e-12,m.t=j.y+(j.h-tipHeight)/2,g.l=e+7,g.t=tipHeight/2-6,f+=" instatipArrowL";else if(h=="top")g.t=tipHeight-4,m.t=j.y-tipHeight-4-11,f+=" instatipArrowT";
if(m.l<0)m.l=3,g.l=j.x+j.w/2-8;else{var h=m.l+e,k=b.window.getBox().w;if(h>k)m.l-=h-k+3,g.l=e-j.w/2-4-(k-(j.x+j.w))}b.style(window.wsMasterTip,{top:m.t+"px",left:m.l+"px"});e=b.query(".instatipArrow")[0];e.className=f;e.style.left=g.l+"px";e.style.top=g.t+"px";window.wsMasterTip.style.visibility="visible";this.currentInstatipNode=a}},hideInstatip:function(a){this.instatipAboutToShowNode&&a==this.instatipAboutToShowNode&&this.clearInstatipTimer();window.wsMasterTip.style.visibility="hidden"},showInstatip:function(a,
e){if(a){e||(e={});if(e.noCache)b.removeAttr(a,"data-tip-width"),this.currentInstatipNode=null;if(this.instatipShowTimer)if(a==this.instatipAboutToShowNode)return;else this.clearInstatipTimer();if(!e.label)e.label=b.attr(a,"data-title")||b.attr(a,"title"),e.label&&b.attr(a,"data-title",e.label);if(e.label){b.removeAttr(a,"title");if(!e.side)e.side="bottom";this.instatipAboutToShowNode=a;var f=300;if(b.body().className.indexOf("btnLabelsOn"!=-1)){var g=b.query(".label",a);g&&g[0]&&b.style(g[0],"display")!=
"none"&&(f=1E3)}this.instatipShowTimer=setTimeout(b.hitch(this,function(){this._showInstatip(a,e.label,e.tipDimensions,e.nodePosition,e.side);this.clearInstatipTimer()}),f)}}},isInstatipShowing:function(){return window.wsMasterTip.style.visibility=="visible"},clearInstatipTimer:function(){if(this.instatipShowTimer)clearTimeout(this.instatipShowTimer),this.instatipShowTimer=null;this.instatipAboutToShowNode=null},instatipAboutToShowNode:null,currentInstatipNode:null,launchIM:function(a,e){ws.presence._launchIM(a,
!1);ws.reporting.reportAction("IM Button in Toolbar Clicked - "+e)},updateIMButton:function(a,e,f){a.enableArrow(!1);var g=a.containerNode.getElementsByTagName("img");if(g)if(g=g[0],e){for(var h=null,j=[],m=0;m<e.length;m++)if(e[m].state!="offline")h=e[m].aimId,j.push({caption:"<img class='buddyIcon' src='"+(e[m].buddyIcon||e[m].presenceIcon)+"'><span class='buddyName'>"+e[m].aimId+"</span>",onClick:b.hitch(this,"launchIM",e[m].aimId,f)});if(h){a.enable();if(g)g.className="icon";j.length>1?(a.enableArrow(!0),
a.onClick=b.hitch(a,"toggleMenu")):a.onClick=b.hitch(this,"launchIM",h,f);a.setMenuDefinition(j)}else if(a.disable(),g)g.className="disIcon"}else if(a.disable(),g)g.className="disIcon"}}),b.mixin(k,{setWaiRole:function(){},setWaiState:function(){},removeWaiState:function(){}}),b.connect(k.registry,"add",function(a){for(;a!=null;){if(a.css){var e=a.css.templatePath,f=a.css.templateString;e&&!k._Widget._cssFiles[e.toString()]&&(f=f||b._getText(e),k._Widget._cssFiles[e.toString()]=!0);f&&!k._Widget._cssStrings[f]&&
(ws.widget.insertCssText(f,null,e),k._Widget._cssStrings[f]=!0)}a=a.constructor.superclass}}),k._Widget._cssFiles={},k._Widget._cssStrings={},k._Templated.getCachedTemplate=function(a,e,f){var g=k._Templated._templateCache,h=e||a,j=g[h];if(j){try{if(!j.ownerDocument||j.ownerDocument==b.doc)return j}catch(m){}b.destroy(j)}e||(e=b.cache(a,{sanitize:!0}));e=b.string.trim(e);e.indexOf("${")!=-1&&(e=b.string.substitute(e,Config.Strings,function(a,e){e.charAt(0)=="!"&&(a=Config.Strings[e.substr(1)]);if(typeof a==
"undefined")return"${"+e+"}";if(!a)return"";return e.charAt(0)=="!"?a:a.toString().replace(/"/g,"&quot;")},this));if(f||e.match(/\$\{([^\}]+)\}/))return g[h]=e;else{a=b._toDom(e);if(a.nodeType!=1)throw Error("Invalid template: "+e);return g[h]=a}};if(!b._hasResource["ws.Spinner"])b._hasResource["ws.Spinner"]=!0,b.provide("ws.Spinner"),(new Image).src=Config.BaseImagesURL+"common/spinnerFeedback.gif",ws.Spinner=function(a,e,f){var g=null,h=null;switch(a){case "Feedback":g="common/spinnerFeedback.gif";
h="20px";break;case "AimSignIn":g="common/spinnerAimSignIn.gif";h="18px";break;default:g="common/spinnerAutoSave.gif",h="18px"}if(e)a={width:h,height:h,display:"none"},this.spinGif=document.createElement("img"),b.mixin(a,f||{}),b.style(this.spinGif,a),this.spinGif.src=Config.BaseImagesURL+g,e.innerHTML="",e.appendChild(this.spinGif);this.spin=function(){this.spinGif.style.display=""};this.stop=function(){this.spinGif.style.display="none"}};b._hasResource["ws.suite.Footer"]||(b._hasResource["ws.suite.Footer"]=
!0,b.provide("ws.suite.Footer"),b.declare("ws.suite.Footer",[k._Widget,k._Templated],{templateString:b.cache("ws.suite","Footer.html",'<div class="footer_container">\r\n\t<span class="feedback" dojoAttachPoint="feedback" style="display:none">\r\n\t\t<span class="feedbackBox">\r\n\t\t\t<div class="progressNode" dojoAttachPoint="progressNode"></div>\r\n\t\t\t<img src="${spacer}" class="mainSprite persistentIcon" dojoAttachPoint="persistentIcon">\r\n\t\t\t<span dojoAttachPoint="feedbackTextNode" class="feedbackSpan"></span>\r\n\t\t\t&nbsp;<a href="#" dojoAttachPoint="undoLink" class="wsLink undoLink">${Undo}</a>\r\n\t\t</span>\r\n\t</span>\r\n</div>\r\n'),
css:{templateString:""},spinner:null,startup:function(){this.feedbackDescriptions=[];this.feedbackPersistence=[];b.subscribe("WSFeedbackStart",this,"onFeedbackStart");b.subscribe("WSFeedbackEnd",this,"onFeedbackEnd");b.subscribe("WSFeedbackHide",this,"hideFeedback");b.subscribe("WSEditor/BodyClick",this,"hideFeedback")},setWidth:function(a){b.marginBox(this.domNode,{w:a})},loginTime:new Date,onFeedbackStart:function(a,e,b,g,h){e||this.hideFeedbackNonPersist();this.feedbackDescriptions.push(a);this.feedbackPersistence.push(e);
this.undoCB=b?b:null;this.cleanUpUndoCB=g?g:null;this.undoLabel=h||Config.Strings.Undo;this.updateFeedback()},onFeedbackEnd:function(a){a=b.indexOf(this.feedbackDescriptions,a);a!=-1&&(this.feedbackDescriptions.splice(a,1),this.feedbackPersistence.splice(a,1));this.updateFeedback()},updateFeedback:function(){if(this.feedbackDescriptions.length==0){if(this.feedback&&this.feedback.style)this.feedback.style.display="none";b.disconnect(this.docMouseDownHandle);b.disconnect(this.docKeyDownHandle);this.listenerConnected=
!1;this.spinner&&this.spinner.stop()}else{var a=this.feedbackDescriptions[this.feedbackDescriptions.length-1],e=this.feedbackPersistence[this.feedbackPersistence.length-1];if(this.feedback&&this.feedback.style)this.feedback.style.display="block";ws.html.setShowing(this.undoLink,Config.EnableUndo&&this.undoCB);ws.html.setInnerText(this.undoLink,this.undoLabel);ws.html.setInnerText(this.feedbackTextNode,a);if(e)ws.html.setShowing(this.progressNode,!1),ws.html.setShowing(this.persistentIcon,!0),this.spinner&&
this.spinner.stop();else{ws.html.setShowing(this.progressNode,!0);ws.html.setShowing(this.persistentIcon,!1);if(!this.spinner)this.spinner=new ws.Spinner("Feedback",this.progressNode);this.spinner.spin()}setTimeout(b.hitch(this,function(){if(!this.listenerConnected)this.docMouseDownHandle=b.connect(document.documentElement,"onmousedown",this,"hideFeedback"),this.docKeyDownHandle=b.connect(document.documentElement,"onkeydown",this,"hideFeedback"),this.listenerConnected=!0}),0)}},hideFeedback:function(a){var e=
!0;Config.EnableUndo&&(a&&ws.html.overElement(this.undoLink,a)?(this.undoLastAction(),e=!1):this.cleanUpUndo());this.cleanUpUndoCB=this.undoCB=null;if(this.feedbackDescriptions.length)if(e)for(;this.feedbackDescriptions.length;)this.onFeedbackEnd(this.feedbackDescriptions[this.feedbackDescriptions.length-1]);else this.onFeedbackEnd(this.feedbackDescriptions[this.feedbackDescriptions.length-1]);else this.updateFeedback()},hideFeedbackNonPersist:function(){if(this.feedbackDescriptions.length){for(var a=
[],e=[],b=0;b<this.feedbackDescriptions.length;b++)this.feedbackPersistence[b]&&(a.push(this.feedbackPersistence[b]),e.push(this.feedbackDescriptions[b]));this.feedbackPersistence=a;this.feedbackDescriptions=e}this.updateFeedback()},undoLastAction:function(){this.undoCB&&this.undoCB()},cleanUpUndo:function(){this.cleanUpUndoCB&&this.cleanUpUndoCB()}}));b._hasResource["dojo.io.script"]||(b._hasResource["dojo.io.script"]=!0,b.provide("dojo.io.script"),b.getObject("io",!0,b),function(){var a=b.isIE?
"onreadystatechange":"load",e=/complete|loaded/;b.io.script={get:function(f){var g=this._makeScriptDeferred(f),h=g.ioArgs;b._ioAddQueryToUrl(h);b._ioNotifyStart(g);if(this._canAttach(h)){var j=this.attach(h.id,h.url,f.frameDoc);if(!h.jsonp&&!h.args.checkString)var m=b.connect(j,a,function(a){if(a.type=="load"||e.test(j.readyState))b.disconnect(m),h.scriptLoaded=a})}b._ioWatch(g,this._validCheck,this._ioCheck,this._resHandle);return g},attach:function(a,e,h){var h=h||b.doc,j=h.createElement("script");
j.type="text/javascript";j.src=e;j.id=a;j.charset="utf-8";return h.getElementsByTagName("head")[0].appendChild(j)},remove:function(a,e){b.destroy(b.byId(a,e));this["jsonp_"+a]&&delete this["jsonp_"+a]},_makeScriptDeferred:function(a){var e=b._ioSetArgs(a,this._deferredCancel,this._deferredOk,this._deferredError),h=e.ioArgs;h.id=b._scopeName+"IoScript"+this._counter++;h.canDelete=!1;h.jsonp=a.callbackParamName||a.jsonp;if(h.jsonp)h.query=h.query||"",h.query.length>0&&(h.query+="&"),h.query+=h.jsonp+
"="+(a.frameDoc?"parent.":"")+b._scopeName+".io.script.jsonp_"+h.id+"._jsonpCallback",h.frameDoc=a.frameDoc,h.canDelete=!0,e._jsonpCallback=this._jsonpCallback,this["jsonp_"+h.id]=e;return e},_deferredCancel:function(a){a.canceled=!0;a.ioArgs.canDelete&&b.io.script._addDeadScript(a.ioArgs)},_deferredOk:function(a){a=a.ioArgs;a.canDelete&&b.io.script._addDeadScript(a);return a.json||a.scriptLoaded||a},_deferredError:function(a,e){e.ioArgs.canDelete&&(a.dojoType=="timeout"?b.io.script.remove(e.ioArgs.id,
e.ioArgs.frameDoc):b.io.script._addDeadScript(e.ioArgs));return a},_deadScripts:[],_counter:1,_addDeadScript:function(a){b.io.script._deadScripts.push({id:a.id,frameDoc:a.frameDoc});a.frameDoc=null},_validCheck:function(){var a=b.io.script,e=a._deadScripts;if(e&&e.length>0){for(var h=0;h<e.length;h++)a.remove(e[h].id,e[h].frameDoc),e[h].frameDoc=null;b.io.script._deadScripts=[]}return!0},_ioCheck:function(a){a=a.ioArgs;if(a.json||a.scriptLoaded&&!a.args.checkString)return!0;if((a=a.args.checkString)&&
eval("typeof("+a+") != 'undefined'"))return!0;return!1},_resHandle:function(a){b.io.script._ioCheck(a)?a.callback(a):a.errback(Error("inconceivable dojo.io.script._resHandle error"))},_canAttach:function(){return!0},_jsonpCallback:function(a){this.ioArgs.json=a}}}());b._hasResource["ws.widget.Button"]||(b._hasResource["ws.widget.Button"]=!0,b.provide("ws.widget.Button"),b.declare("ws.widget.Button",[k._Widget,k._Templated],{showArrow:!1,showArrowBorder:!1,highlight:!1,className:"",iconClassName:"",
tabIndex:"",title:"",tip:"",arrowTitle:"",minWidth:null,size:"",type:"",fixSize:!1,templateString:'<div class="unselectable btn" tabindex="${tabIndex}" dojoAttachEvent="onmouseenter:_onMouseEnter,onmouseleave:_onMouseLeave,onclick:_onClick, onmouseover:_onMouseOver, onmousedown:_onMouseDown, onmouseup:_onMouseUp, onmouseout:_onMouseOut, onkeypress:onKeyPress">\t<div class="btnLabel" dojoAttachPoint="containerNode"></div>\t<div class="btnArrow" dojoAttachPoint="arrowNode" dojoAttachEvent="onclick:onArrowClick" style="display:none"><img class="btnArrowImg" dojoAttachPoint="arrowImg" src="'+
Config.SpacerImageURL+'"></div></div>',css:{templateString:""},startup:function(){if(!this._started){this._started=!0;this.title&&this.setTitle(this.title);this.label?this.setLabel(this.label):this.setLabel(this.getLabel());this.size!=""&&b.addClass(this.domNode,"btn"+this.size);this.type!=""&&this.setType(this.type);this.className&&b.addClass(this.domNode,this.className);if(this.showArrow)this.arrowNode.style.display="";this.showArrowBorder&&b.addClass(this.arrowNode,"btnSplitArrow");this.disabled&&
this.disable();this.highlight&&this.setHighlight(!0);this.minWidth&&this.resize();if(b.isIE&&(setTimeout(b.hitch(this,"fixButtons"),10),b.isIE==7&&this.fixSize))this.ie7fixSizeRetry=5,window.setTimeout(b.hitch(this,this.ie7fixSize),0);ws.html.addHoverClass(this.domNode,"btn"+this.size+this.type+"Hover",!0);this.clickClassName="btn"+this.size+this.type+"Click";this._origTip=this.tip;this._origTitle=this.title;this.subscribe("toolbarLayoutUpdate",b.hitch(this,function(){this.renderIconButtonContent();
this.tip=this._origTip;this.setTitle(this._origTitle);this.processTip2()}));this.renderIconButtonContent();this.processTip2()}},ie7fixSize:function(){var a=null;try{a=b.coords(this.containerNode)}catch(e){}a==null||a.w==0||a.h==0?this.ie7fixSizeRetry&&(this.ie7fixSizeRetry--,window.setTimeout(b.hitch(this,this.ie7fixSize),30)):(b.style(this.domNode,"width",a.w+"px"),b.style(this.domNode,"height",a.h+"px"))},fixButtons:function(){if(this.domNode!=null)this.domNode.style.zoom="",this.domNode.style.zoom=
1},resize:function(){var a=b._getMarginSize(this.domNode).w;if(this.minWidth&&a<this.minWidth)this.domNode.style.width=this.minWidth+"px"},sizeMyself:function(){if(this.domNode.parentNode){var a=document.createElement("span");this.domNode.parentNode.insertBefore(a,this.domNode)}b.body().appendChild(this.domNode);this.marginBox=b.marginBox(this.domNode);a&&(a.parentNode.insertBefore(this.domNode,a),b._destroyElement(a))},setTip:function(a){this._origTip=this.tip=a;this.processTip2()},processTip2:function(){if(this.tip)this.setTitle("");
else if(!this.tip&&this.iconClassName!=""&&!b.hasClass(this.domNode,"DropDownButton")&&!b.hasClass(this.domNode,"DropDownLink"))if(this.title!="")this.tip=this.title;else{var a=b.query(".label",this.containerNode);if(a.length==1)this.tip=a[0].innerHTML;this.setTitle("")}},renderIconButtonContent:function(){if(this.iconClassName!=""){b.addClass(this.domNode,"wsIconButton");var a="";this.showArrow&&(a+="<div class='btnIconArrowCntr'>");a+="<div class='icon "+this.iconClassName+"'></div>";if(this.showArrow)a+=
"<img class='btnArrowImg' src='"+Config.SpacerImageURL+"'></div>",this.arrowNode.style.display="none";this.label!=""&&(a+="<div class='label'>"+this.label+"</div>");this.containerNode.innerHTML=a;b.hasClass(b.body(),"btnLabelsOn2")&&b.query(".label",this.containerNode).length==0&&b.query(".icon",this.containerNode).style({top:"7px"})}},getLabel:function(){return this.containerNode.innerHTML},setLabel:function(a){this.label=a;this.containerNode.innerHTML=a},IsEqualsLabel:function(a){return this.containerNode.innerHTML==
a},setType:function(a,e){this.type!=""&&b.removeClass(this.domNode,"btn"+this.size+this.type);this.subType!=""&&b.removeClass(this.domNode,"btn"+this.size+this.subType);this.type=a;this.subType=e;b.addClass(this.domNode,"btn"+this.size+a);this.subType&&b.addClass(this.domNode,"btn"+this.size+a+e)},setTitle:function(a){this._origTitle=this.title=a;this.domNode.title=a},enable:function(){this.disabled=!1;b.removeClass(this.domNode,"btn"+this.size+"Disabled")},disable:function(){this.disabled=!0;b.addClass(this.domNode,
"btn"+this.size+"Disabled")},setHighlight:function(a){this.highlight=a;b.toggleClass(this.domNode,"ButtonHighlight",a)},_onClick:function(a){this.tip&&ws.widget.hideInstatip(this.domNode);if(!this.disabled){this.onClick(a);try{this.domNode&&this.domNode.blur()}catch(e){}}},_onMouseDown:function(a){this.disabled||(b.addClass(this.domNode,this.clickClassName),this.highlight||b.addClass(this.domNode,"ButtonHighlight"),this.onMouseDown(a))},_onMouseUp:function(a){(!this.menu||this.menu&&!this.menu.isShowing())&&
this.setHighlight(this.highlight);b.removeClass(this.domNode,this.clickClassName);if(!this.disabled)this.onMouseUp(a)},_onMouseOut:function(a){(!this.menu||this.menu&&!this.menu.isShowing())&&this.setHighlight(this.highlight);b.removeClass(this.domNode,this.clickClassName);if(!this.disabled)this.onMouseOut(a)},_onMouseOver:function(a){this.onMouseOver(a)},_onMouseEnter:function(){if(this.tip&&(!this.menu||this.menu&&!this.menu.isShowing())){if(!this.tipDim)b.byId("instatip").innerHTML=this.tip,this.tipDim=
b.marginBox(window.wsMasterTip);ws.widget.showInstatip(this.domNode,{label:this.tip,tipDimensions:this.tipDim})}},_onMouseLeave:function(){this.tip&&ws.widget.hideInstatip(this.domNode)},onClick:function(){},onMouseOver:function(){},onMouseDown:function(){},onMouseUp:function(){},onMouseOut:function(){},onArrowClick:function(){},onKeyPress:function(){}}),b.declare("ws.widget.DropDownBase",null,{menuId:"",menu:null,menuDefinition:null,menuClassName:"",anchorPosition:null,onClick:function(a){a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0;this.toggleMenu()},onKeyPress:function(a){a.keyCode==b.keys.ENTER&&setTimeout(b.hitch(this,"toggleMenu"),0)},toggleMenu:function(){ws.lang.ensureLayersLoaded(b.hitch(this,function(){this.menu||this.getMenu();this.menu.isShowing()?(this.setHighlight&&this.setHighlight(!1),this.menu.close()):(this.updateMenu(this.menu),this.menu.open(this.anchorPosition||this.domNode),this.setHighlight&&this.setHighlight(!0),this.tip&&ws.widget.hideInstatip(this.domNode))}))},getMenu:function(){this.menuId?
this.menu=k.byId(this.menuId):this.createMenu()},createMenu:function(){this.menu=ws.widget.createMenu(this.menuDefinition);this.menuClassName!=""&&b.addClass(this.menu.domNode,this.menuClassName);this.setHighlight&&this.menu.connect(this.menu,"onClose",b.hitch(this,function(){this.setHighlight(!1)}))},setMenuDefinition:function(a){if(this.menu)this.menu.isShowing()&&this.menu.close(),this.menu.destroyRecursive(),this.menu=null;this.menuDefinition=a},updateMenu:function(){}}),b.declare("ws.widget.DropDownButton",
[ws.widget.Button,ws.widget.DropDownBase],{showArrow:!0,dyn:!1,startup:function(){this.inherited(arguments);b.addClass(this.domNode,"DropDownButton");this.size!=""&&b.addClass(this.domNode,"DropDownButton"+this.size)},enableArrow:function(a){this.showArrow=a;this.arrowNode.style.display=a?"":"none";this.showArrowBorder&&b.toggleClass(this.arrowNode,"btnSplitArrow",a);b.toggleClass(this.domNode,"DropDownButton",a)},resize:function(){if(this.dyn)this.domNode.style.width=b.marginBox(this.containerNode).w+
"px"},isArrowEnabled:function(){return this.showArrow},updateMenu:function(){this.inherited(arguments);this.menu.padding=[0,-1]}}),b.declare("ws.widget.DropDownLink",[k._Widget,k._Templated,ws.widget.DropDownBase],{templateString:'<span class="unselectable DropDownLink ${className}" dojoAttachPoint="contentNode" dojoAttachEvent="onclick:onClick" style="white-space:nowrap;cursor:pointer">\t<span dojoAttachPoint="containerNode"></span>&nbsp;<img src="${spacer}" class="${arrowClass}"></span>',className:"",
arrowClass:"btnArrowImg",arrowSize:"small",postMixInProperties:function(){this.inherited(arguments);if(this.arrowSize=="large")this.arrowClass="mainSprite btnArrowImgLarge"},startup:function(){this.inherited(arguments);this.tip=null},setLabel:function(a){this.containerNode.innerHTML=a}}),b.declare("ws.widget.SplitDropDownButton",ws.widget.DropDownButton,{startup:function(){b.addClass(this.domNode,"SplitDropDownButton"+this.size);ws.html.addHoverClass(this.arrowNode,"btnSplitArrowHover");if(this.arrowTitle)this.arrowNode.title=
this.arrowTitle;this.inherited(arguments)},showArrowBorder:!0,onClick:function(){},onArrowClick:function(a){this.disabled||(this.toggleMenu(),a.stopPropagation())}}),b.declare("ws.widget.Checkbox",[k._Widget,k._Templated],{templateString:'<table class="chkBoxCntr"><tr valign="top"><td><div class="mainSprite chkBox" dojoAttachPoint="chkNode" dojoAttachEvent="onclick:toggle"></div></td><td class="chkBoxLabel" dojoAttachPoint="labelNode" dojoAttachEvent="onclick:toggle"></td></tr></table>',checked:!1,
label:"",disabled:!1,startup:function(){this.checked&&this.setChecked(!0);this.setLabel(this.label);this.setDisabled(this.disabled)},setChecked:function(a){this.checked=a?!0:!1;b.toggleClass(this.domNode,"chkBoxChecked",this.checked)},setDisabled:function(a){this.disabled=a;b.toggleClass(this.domNode,"chkBoxDisabled",this.disabled)},setLabel:function(a){this.label=a;this.labelNode.innerHTML=this.label},toggle:function(a){this.disabled||(this.setChecked(!this.checked),this.onClick(a))},onClick:function(){}}));
b._hasResource["ws.widget.WSModalPane"]||(b._hasResource["ws.widget.WSModalPane"]=!0,b.provide("ws.widget.WSModalPane"),b.declare("ws.widget.WSModalPane",k._Widget,{css:{templateString:""},destroyOnClose:!0,bg0pacity:0.6,bgZIndex:998,backgroundColor:"#000",startup:function(){this.createBG();b.isIE?setTimeout(b.hitch(this,function(){this.checkSize()}),0):this.checkSize()},createBG:function(){if(!this.bg)this.bg=b.create("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:"100%",zIndex:this.bgZIndex,
backgroundColor:this.backgroundColor,opacity:this.bg0pacity}}),this.bgShowing=!1;if(!this.bgShowing)b.body().appendChild(this.bg),this.bgShowing=!0,this.bg.id=this.id+"bg",this.bgIframe=new k.BackgroundIframe(this.bg)},checkSize:function(){if(this.domNode&&this.domNode.style.display!="none"){var a=b.window.getBox();this.domNode.style.height="auto";this.mb=b._getMarginSize(this.domNode);var e=(a.w-this.mb.w)/2,f=(a.h-this.mb.h)/2;f<10?(this.domNode.style.overflow="auto",this.domNode.style.height=Math.max(a.h-
20,0)+"px",f=10):this.domNode.style.overflow="";this.domNode.style.left=e+"px";this.domNode.style.top=f+"px";this.bg.style.width=Math.max(a.w,0)+"px";this.bg.style.height=Math.max(a.h,0)+"px";setTimeout(b.hitch(this,function(){this.domNode.style.visibility="visible"}),0)}},show:function(){(!this.domNode.parentNode||!(this.domNode.parentNode.tagName&&this.domNode.parentNode.tagName.toLowerCase()=="body"))&&b.body().appendChild(this.domNode);this.inherited(arguments);this.createBG();this.checkSize();
this.domNode.style.visibility="visible";this.connect(window,"onresize","checkSize");this._onShow();b.publish("popup/open",[]);ws.WebSuite.isModalOpen=!0;this.domNode.focus()},hide:function(){this.bgIframe&&this.bgIframe.destroy();this.bg&&b._destroyElement(this.bg);this.bgShowing=!1;this.destroyOnClose?this.destroyRecursive():this.inherited(arguments);ws.WebSuite.isModalOpen=!1;b.isIE&&window.focus()}}));b._hasResource["ws.widget.WSToolbar"]||(b._hasResource["ws.widget.WSToolbar"]=!0,b.provide("ws.widget.WSToolbar"),
b.declare("ws.widget.WSToolbar",[k._Widget,k._Templated,k._Container],{templateString:'<div class="wsToolbar">\t<div class="containerNode" dojoAttachPoint="containerNode" style="float: left;"></div>\t<div class="centerNode" dojoAttachPoint="centerNode" style="float: left;"></div>\t<div class="rightNode" dojoAttachPoint="rightNode" style="float: right;"></div></div>',css:{templateString:""},vizType:"",defaultWidth:-1,alwaysShowRightNode:!0,webKitLeftWidthMargin:0,minItemSize:10,startup:function(){if(this.vizType&&
(b.addClass(this.domNode,"wsToolbar"+this.vizType),this.vizType=="Bare"))this.domNode.style.backgroundColor="transparent";b.forEach(this.getChildren(),b.hitch(this,"_processChild"));b.isIE&&(setTimeout(b.hitch(this,"fixButtons"),10),this.connect(window,"onresize","fixButtons"));setTimeout(b.hitch(this,"layout"),0);this.subscribe("toolbarLayoutUpdate","layout")},addToolbarItem:function(a){this.addChild(a);this._processChild(a)},_processChild:function(a){var e="left";a.toolbarPosition=="right"&&(e=
"right");ws.html.setFloat(a.domNode,e);if(e=a.toolbarPosition=="center"?this.centerNode:a.toolbarPosition=="right"?this.rightNode:null)this.containerNode.removeChild(a.domNode),e.appendChild(a.domNode)},fixButtons:function(){if(this.domNode!=null)this.domNode.style.zoom="",this.domNode.style.zoom=1},onResized:function(){this.skipLayout?this.skipLayout=!1:this.layout()},layout:function(){this.containerNode.style.width="";this.centerNode.style.width="";this.rightNode.style.width="";var a=function(a,
e,f){var g=0;b.forEach(a.childNodes,function(a){if(a.nodeType==1)a=b._getMarginSize(a).w,a>f&&(g+=a+(b.isIE&&window._g_WS_WebFont.fontMode==0?5:6)),e&&e.push(g)});return g},e=function(a,e){if(e&&e.length>0)for(var b=0;b<e.length-1;b++)if(e[b]&&e[b+1]&&a>e[b]&&a<e[b+1])return e[b];return a},f=b.isIE?[]:null,g=a(this.containerNode,f,this.minItemSize);b.isWebKit&&(g+=this.webKitLeftWidthMargin);var h=a(this.rightNode,null,this.minItemSize),a=a(this.centerNode,null,this.minItemSize),j=this.getWidth(),
m=b.contentBox(this.domNode).h;if(this.alwaysShowRightNode&&j>0){var k=b.isIE?20:0;j<g+k+a+h?(g=j-k-a-h,b.isIE&&(g=e(g,f)),this.domNode.style.height=b.hasClass(b.body(),"btnLabelsOn2")?"80px":"60px",m==30&&this._wrap()):(this.domNode.style.height=b.hasClass(b.body(),"btnLabelsOn2")?"40px":"30px",m==60&&this._wrap())}this.centerNode.style.marginLeft=Math.round((j-(g+h+a))/2)+"px";b.contentBox(this.containerNode,{w:Math.min(j,g)});b.contentBox(this.rightNode,{w:Math.min(j,h)});b.contentBox(this.centerNode,
{w:Math.min(j,a)});b.isIE&&setTimeout(b.hitch(this,"fixButtons"),10)},_wrap:function(){setTimeout(b.hitch(this,"wrap"),100)},wrap:function(){},getWidth:function(){var a=b.contentBox(this.domNode).w;if(a==0&&this.defaultWidth>-1)a=this.defaultWidth;return a}}),b.extend(k._Widget,{toolbarPosition:"left"}));if(!b._hasResource["ws.widget.Dialogs"])b._hasResource["ws.widget.Dialogs"]=!0,b.provide("ws.widget.Dialogs"),ws.widget.Dialogs={iframePane:null,show:function(a,e,f,g){if(!this.dialog)this.dialog=
new ws.widget.GenericDialog,b.body().appendChild(this.dialog.domNode),this.dialog.startup();this.dialog.show(a,e,f,g);b.publish("popup/open",[])},showTransientDialog:function(a,e,f,g,h){f=new ws.widget.GenericDialog(b.mixin({destroyOnClose:!0},f));b.body().appendChild(f.domNode);f.startup();var j=[];if(g&&g.length)for(var m=0;m<g.length;m++)j.push(g[m].label);h=b.mixin({btnArgs:g},h);f.show(a,j,e,h);b.publish("popup/open",[])},ok:function(a,e,b,g){b?this.okCancel(a,e):this.show(a,["&nbsp;&nbsp;&nbsp;&nbsp;"+
Config.Strings.OK+"&nbsp;&nbsp;&nbsp;&nbsp;"],e,g)},okCancel:function(a,e,b){this.show(a,b?[Config.Strings.Cancel,Config.Strings.OK]:[Config.Strings.OK,Config.Strings.Cancel],function(a){e&&(b?e(a!=0):e(a==0))});return this.dialog},yesNo:function(a,e){this.show(a,[Config.Strings.Yes,Config.Strings.No],function(a){e&&e(a==0)})},iframe:function(a){if(a&&this.iframePane==null)this.iframePane=a.isModal!=null&&a.isModal?new ws.widget.iframeModalPane:new ws.widget.iframePane,this.iframePane.pluginId=a.pluginId,
b.body().appendChild(this.iframePane.domNode),this.iframePane.startup(),this.iframePane.show(a.url,a.box,a.offset),b.publish("popup/open",[])},iframeClose:function(a){this.iframePane&&this.iframePane.pluginId&&this.iframePane.pluginId==a&&this.iframePane.hide()}},b.declare("ws.widget.GenericDialog",[ws.widget.WSModalPane,k._Templated],{widgetsInTemplate:!0,destroyOnClose:!1,templateString:'<div class="WSModalPane">\t<div class="WSModalPaneInner">\t\t<img dojoAttachPoint="wsCloseBtn" src="${spacer}" class="mainSprite wsCloseBtn" dojoattachevent="onclick: hide">\t\t<div dojoAttachPoint="modCon" class="modalContainer">\t\t\t<div dojoAttachPoint="textNode" style="padding: 8px 0px 30px 0px;font-weight:bold;"></div>\t\t\t<div dojoAttachPoint="toolbar" dojoType="ws.widget.WSToolbar" vizType="Bare"></div>\t\t</div>\t\t<img dojoAttachPoint="alertIcon" src="${spacer}" class="mainLargeIcon dialogAlertIcon">       <input dojoAttachPoint="focusInput" type="text" style="position:absolute;left:-2000px" />\t</div></div>',
show:function(a,e,f,g){g=g||{};this.wsCloseBtn.style.display=g.newCancel?"":"none";ws.widget.popup.ignoreClicks(!0);b.isString(a)?(a=a.replace(/\\x22/g,"&quot;").replace(/\\n/g,"<br>").replace(/\\x2f/g,"/"),this.textNode.innerHTML=a):this.textNode.appendChild(a);this.callback=f;this.domNode.style.width=(g.width||300)+"px";this.inherited(arguments);this.setupButtons(e,g);if(g&&g.alertIcon){if(this.modCon.style.paddingLeft="93px",this.alertIcon)this.alertIcon.style.display=""}else if(this.modCon.style.paddingLeft=
"20px",this.alertIcon)this.alertIcon.style.display="none";b.isIE&&this.toolbar.layout();b.publish("popup/open",[])},focus:function(){this.focusInput.focus()},setupButtons:function(a,e){this.ensureButtonsExist(a.length,e);for(var b=0;b<a.length;b++){var g=this.buttons[b];g.show();g.setLabel(a[b]);g.setType("");g.IsEqualsLabel(Config.Strings.Cancel)?g.setType("Bare"):e&&e.btnArgs&&e.btnArgs.length&&e.btnArgs[b]&&e.btnArgs[b].type&&(e.btnArgs[b].subType?g.setType(e.btnArgs[b].type,e.btnArgs[b].subType):
g.setType(e.btnArgs[b].type))}for(b=a.length;b<this.buttons.length;b++)this.buttons[b].show();this.toolbar.layout();for(b=a.length;b<this.buttons.length;b++)this.buttons[b].hide()},ensureButtonsExist:function(a,e){if(!this.buttons)this.buttons=[];for(var f,g=this.buttons.length;g<a;g++)f={toolbarPosition:"right"},e.btnArgs&&e.btnArgs[g]&&b.mixin(f,e.btnArgs[g]),f=new ws.widget.Button(f),f.onClick=b.hitch(this,"onButtonClick",g),this.toolbar.addToolbarItem(f),this.buttons.push(f),f.startup()},onButtonClick:function(a){this.hide();
ws.widget.popup.ignoreClicks(!1);this.callback&&this.callback(a)}}),b.declare("ws.widget.iframeModalPane",[ws.widget.WSModalPane,k._Templated],{destroyOnClose:!0,templateString:'<div class="WSModalPane"><div class="WSModalPaneInner">\t<div class="mainSprite wsCloseBtn" dojoAttachEvent="onclick: onCancel"></div>\t\t<div class="modalContainer">\t\t\t<iframe frameborder="0" scrolling="${scrolling}" dojoAttachPoint="iframeNode" style="clear:both;display:block"></iframe>\t\t</div>\t</div></div>',pluginId:null,
scrolling:"yes",show:function(a,e,f){f||(f={w:64,h:76});ws.widget.popup.closeAllPopups();this.iframeNode.src=a;b.marginBox(this.domNode,{w:e.w+f.w,h:e.h+f.h});b.marginBox(this.iframeNode,{w:e.w,h:e.h});this.inherited(arguments)},onCancel:function(){this.hide()},hide:function(){ws.widget.popup.close(this);this.inherited(arguments);ws.widget.Dialogs.iframePane=null}}),b.declare("ws.widget.iframePane",[k._Widget,k._Templated],{templateString:'<iframe frameborder="0" scrolling="no" dojoAttachPoint="iframeNode" style="clear:both;display:block"></iframe>',
onClose:function(){this.hide()},show:function(a,e,f){ws.widget.popup.closeAllPopups();this.iframeNode.src=a;b.marginBox(this.domNode,e);b.marginBox(this.iframeNode,{w:e.w-18,h:e.h-30});a={popup:this};if(f){var e=k.byId("PanelWidget"),g=b.coords(e.domNode);a.x=g.l+f.l;a.y=g.t+f.t+e.pluginHeaderHeight}else{if(e.l)a.x=e.l;if(e.t)a.y=e.t}ws.widget.popup(a)},hide:function(){ws.widget.popup.close(this);this.inherited(arguments);this.destroyRecursive();ws.widget.Dialogs.iframePane=null}});if(!b._hasResource["ws.presence"])b._hasResource["ws.presence"]=
!0,b.provide("ws.presence"),ws.presence={getBuddyIconUrl:function(a,e){var b=ws.presence.getScreenNameForContact(a,e);return b?Config.BuddyIconUrl+encodeURIComponent(b):null},getPresenceIconForScreenName:function(a,e){var b=e||Config.AIMPresenceUrl+encodeURIComponent(a);return ws.string.substituteParams('<a href="#"><img align=\'absmiddle\' src="{0}" border="0"></a>',b)},getPresenceIconUrl:function(a){var e=Config.PresenceIconUrl;switch(a){case 1:e+="online.gif";break;case 2:e+="offline.gif";break;
case 5:e+="idle.gif";break;case 6:e+="away.gif";break;case 7:e+="mobile.gif";break;case 8:e+="mobile.gif";break;default:e="about:blank"}return e},ableToGetIM:function(a){return a==1||a==5||a==6||a==7||a==8},getPresenceIcon:function(a){return(a=ws.presence.getScreenNameForContact(a))?this.getPresenceIconForScreenName(a):"&nbsp;"},getScreenNameForContact:function(a,e){var b=a.screenName||ws.presence.getScreenNameForAddress(a.email)||ws.presence.getScreenNameForAddress(a.email1)||ws.presence.getScreenNameForAddress(a.email2);
e||(b=b||a.email||a.email1||a.email2);return b},getScreenNameForAddress:function(a){return(a=ws.presence.parseEmailAddress(a))&&b.indexOf(Config.KnownDomains,a.domain)!=-1?a.name:null},_launchIM:function(a,e){Settings.IMSending=="Aim"||!Config.EnableWebIM?this.launchClientIM(a):Settings.EnableAIMPanel&&this.launchAIMPanel(a,e)},launchIM:function(a,e,f){a.indexOf("@")>=0&&!e?(e={},e.load=b.hitch(this,function(a){f?this._launchIM("",f):a.presenceState==4?ws.widget.Dialogs.ok(Config.Strings.ErrorIMServer):
this._launchIM(a.screenName,f)}),e.content={email:a},this.getScreenNameFromEmail(e)):this._launchIM(a,f)},launchClientIM:function(a){if(!ws.presence.imFrame)ws.presence.imFrame=b.io.iframe.create("IMFrame",null,Config.EmptyFileURL);a=ws.string.substituteParams(Config.SendIMUrlAIM,a);b.io.iframe.setSrc(ws.presence.imFrame,a,!0)},launchAIMPanel:function(a,e,f,g){if(k.byId("NavigationWidget"))ws.WebSuite.Navigation.AIMInit(b.hitch(this,function(){var b=ws.WebSuite.Navigation.aim;f||b.openIm({aimId:a,
useSMS:e});g&&b.refreshWindow(a)}));else try{opener.ws.presence.launchAIMPanel(a,e),opener.focus()}catch(h){}},launchAIMExpress:function(a){var e=screen.availWidth+1E4,b=screen.availHeight+1E3,a=typeof a!="undefined"?ws.string.substituteParams(Config.IMLaunchAE,encodeURIComponent(a)):Config.LaunchAE,e=ws.string.substituteParams("status=yes,resizable=yes,menubar=no,scrollbars=yes,left={0},top={1},width={2},height={3}",e,b,1,1);ws.io.openWindow(a,"",e)},parseEmailAddress:function(a){if(a==null||a==
"")return null;var e="",b="",a=a.match(/(.*)@(.*)/);a!=null&&a.length==3&&(e=a[1],b=a[2],e!=null&&(e=e.replace(/\/M/gi,""),e=e.replace(/\/A/gi,"")),b!=null&&(b=b.toLowerCase()));return{name:e,domain:b}},getScreenNameFromEmail:function(a){ws.io.rpc({action:"GetPresenceInfo",content:a.content,load:b.hitch(this,function(e){a.load(e)}),error:a.error})},getPresence:function(a){b.io.script.get({url:Config.WIMServer+"presence/get",callbackParamName:"c",content:{f:"json",k:Config.WIMKey,t:a.users,friendly:1},
load:a.load,error:function(){a.error&&a.error()},timeout:a.timeout,preventCache:!0})}};if(!b._hasResource["ws.widget.OkCancelDialog"])b._hasResource["ws.widget.OkCancelDialog"]=!0,b.provide("ws.widget.OkCancelDialog"),ws.widget.OkCancelDialog={alert:function(a,e,b){ws.widget.Dialogs.ok(a,e,b)}};b._hasResource["ws.widget.Pane"]||(b._hasResource["ws.widget.Pane"]=!0,b.provide("ws.widget.Pane"),b.declare("ws.widget.Pane",k._Widget,{}),b.declare("ws.widget.ContainerPane",[k._Widget,k._Container],{}));
b._hasResource["ws.themes.widget.ThemePickerDialog"]||(b._hasResource["ws.themes.widget.ThemePickerDialog"]=!0,b.provide("ws.themes.widget.ThemePickerDialog"),b.declare("ws.themes.widget.ThemePickerDialog",[ws.widget.WSModalPane,k._Templated],{templateString:b.cache("ws.themes.widget","ThemePickerDialog.html",'<div class="WSModalPane ThemePickerModal">\r\n\t<div class="WSModalPaneInner">\r\n\t\t<div class="modalContainer">\r\n\t\t\t<div dojotype="ws.widget.Pane" class="themePickerDlg">\r\n\t\t\t\t<div class="header" dojoattachpoint="hdrTitle1">\r\n\t\t\t\t\t${ThemesPickerDialogTitle}</div>\r\n\t\t\t\t<div dojoattachpoint="themeItemPaneWrapper" class="themeItemPaneWrapper">\r\n\t\t\t\t\t<div dojotype="ws.widget.ContainerPane" dojoattachpoint="themeItemPane" class="themeItemPane">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="toolbarPad">\r\n\t\t\t\t\t<div dojotype="ws.widget.WSToolbar" dojoattachpoint="toolbar" viztype="Bare">\r\n\t\t\t\t\t\t<div class="themeCancelBtn" dojotype="dijit._Widget" toolbarposition="right">\r\n\t\t\t\t\t\t\t<a href="#" dojoattachevent="onclick: handleCancel" class="wsLink" dojoattachpoint="themeCancelBtn">${ThemesPickerDialogCancel}</a></div>\r\n\t\t\t\t\t\t<div dojotype="ws.widget.Button" dojoattachpoint="themeSaveBtn" dojoattachevent="onClick: handleSaveBtn" toolbarposition="right">\r\n\t\t\t\t\t\t\t${ThemesPickerDialogSave}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="useRandomDiv" dojoattachpoint="useRandomDiv">\r\n\t\t\t\t\t<div dojoType="ws.widget.Checkbox" dojoattachevent="onClick:checkBoxChange" dojoattachpoint="useRandomCheckbox" label="${ThemesPickerDialogUseRandom}" />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,destroyOnClose:!1,currentSelected:"",originalSelection:"",debugShowAllThemes:!1,themeWidget:null,startup:function(){this.inherited(arguments);if(Config.EnableThemeDebugQueryParameters){var a=ws.io.getQueryParameter("_st");if(a&&a==="1")this.debugShowAllThemes=!0}this.tc=window._ws_theme;if(Config.AllowRandomThemes&&this.tc.randomThemeList&&this.tc.randomThemeList.length)this.useRandomDiv.style.display="block";b.style(this.bg,"opacity",0);if(typeof External_Themes==
"undefined")this.domNode.style.display="none",_ws.loadScript({src:Config.ThemeConfigURL+"_master.js",load:b.hitch(this,this.handleThemeDataLoad),error:b.hitch(this,this.handleThemeDataLoad)})},handleThemeDataLoad:function(){this.domNode.style.display="block";this.parseThemeData();for(var a=this.themeData.IDList,e=[],b=0;b<a.length;b++){var g=this.themeData[a[b]];g&&this.isThemeShowable(g)&&e.push(g)}this.renderThemesPane(e);this.show(this.currentSelected,this.originalSelection)},parseThemeData:function(){this.themeData=
ws.lang.shallowCopy(Config.WebSuiteThemes);this.themeData[Config.ThemeDefault].active=!0;var a=[];typeof External_Themes!="undefined"&&(a=a.concat(External_Themes.IDList));for(var e=[],b=[],g=0;g<a.length;g++){var h=a[g];this.themeData[h]=External_Themes[h];if(this.themeData&&this.themeData[h]){var j=this.themeData[h];j.active=!1;j.availableUntil="";var m=["forceStart","forceEnd","optoutStart","optoutEnd","optinStart","optinEnd"],k=!1,o=null;if(j.PromoAttribute)for(var o=j.PromoAttribute,n=0;n<m.length;n++)if(!this.tc.unspecified(o[m[n]])){k=
!0;break}if(this.debugShowAllThemes)k?e.push(h):b.push(h),j.active=!0,this.setDebugInfo(j);else if(k){m=!1;if(this.forceOrOptoutThemeId==null&&this.tc.isThemeInDateRange(o,"force")&&this.tc.isTargetUserMatch(j))this.forceOrOptoutThemeId=h,e.push(h),m=!0,j.active=!0,this.setAvailUntil(j,o,"force");else if(this.forceOrOptoutThemeId==null&&this.tc.isThemeInDateRange(o,"optout")&&this.tc.isTargetUserMatch(j))this.forceOrOptoutThemeId=h,this.optOut=!0,e.push(h),m=!0,j.active=!0,this.setAvailUntil(j,o,
"optout");else if(this.optinThemeId==null&&this.tc.isThemeInDateRange(o,"optin")&&this.tc.isTargetUserMatch(j))this.optinThemeId=h,e.push(h),m=!0,j.active=!0,this.setAvailUntil(j,o,"optin");if(this.tc.isThemeInDateRange(o,"gallery")){if(!m)e.push(h),j.active=!0;this.setAvailUntil(j,o,"gallery")}}else if(this.tc.unspecified(j.galleryStart)&&this.tc.unspecified(j.galleryEnd))b.push(h),j.active=!0;else if(this.tc.isThemeInDateRange(o,"gallery"))b.push(h),j.active=!0,this.setAvailUntil(j,o,"gallery");
this.themeData[h].resourcePath=this.tc.getExternalThemeResourcePath(this.themeData[h])}}this.themeData.IDList=[Config.ThemeDefault].concat(e,b)},isThemeShowable:function(a){if(a.active)return!0;return!1},setAvailUntil:function(a,e,f){e=e[f+"End"];f=null;this.tc.unspecified(e)||(f=b.date.stamp.fromISOString(e));f?(e=f.getMonth()+1+"/"+f.getDate()+"/"+f.getFullYear(),a.availableUntil=ws.string.substituteParams(Config.Strings.ThemesPickerDialogAvailable,e)):a.availableUntil=""},setDebugInfo:function(a){var e=
"",b=["forceStart","forceEnd","optoutStart","optoutEnd","optinStart","optinEnd","galleryStart","galleryEnd","promoImg","promoLink"],g=a.PromoAttribute;if(g)for(var h=0;h<b.length;h++){var j=b[h],m=g[j];this.tc.unspecified(m)||(e+=j+": "+m+"\n")}b=["gender","age","zip","match"];if(g=a.MatchAttribute)for(h=0;h<b.length;h++)j=g[h],m=g[j],this.tc.unspecified(m)||(e+=j+": "+m+"\n");if(e)a.description=e,a.availableUntil="* debug mouse over"},initView:function(){this.toolbar.layout();this.randomThemeEnabled=
this.tc.randomThemeEnabled;this.useRandomCheckbox.setChecked(this.randomThemeEnabled)},checkBoxChange:function(){if(this.randomThemeEnabled=this.useRandomCheckbox.checked){var a=this.tc.getRandomTheme();this.clearSelectedItem();this.setSelectedItem(a);this.themeWidget.changeTheme(a)}},renderThemesPane:function(a){for(var e=0,b=0,g=0;g<a.length;g++){var h=new ws.themes.widget.ThemePickerDialogItem({dialogWidget:this,item:a[g],row:b});h.startup();this.themeItemPane.addChild(h);h.domNode.style.left=
e*182+"px";h.domNode.style.top=b*126+"px";e++;e%4==0&&(b++,e=0)}this.themeItemPane.domNode.style.height=b*126+"px"},handleCancel:function(){this.themeWidget.changeTheme(this.originalSelection);this.hide()},handleSaveBtn:function(){this.tc.randomThemeEnabled=this.randomThemeEnabled;this.themeWidget.saveTheme();this.hide()},getSelectedItem:function(){return this.themeItemPane.getChildren().filter(function(a){return a.selected})},clearSelectedItem:function(){b.forEach(this.themeItemPane.getChildren(),
function(a){a.select(!1)})},setSelectedItem:function(a){this.selectedItem=null;b.forEach(this.themeItemPane.getChildren(),b.hitch(this,function(e){e.item.id==a?(e.select(!0),this.selectedItem=e):e.select(!1)}));this.selectedItem&&setTimeout(b.hitch(this,function(){this.themeItemPaneWrapper.scrollTop=(this.selectedItem.row-1)*126},100))},show:function(a,e){this.originalSelection=e;this.clearSelectedItem();this.setSelectedItem(a);this.inherited(arguments);this.initView()}}),b.declare("ws.themes.widget.ThemePickerDialogItem",
[k._Widget,k._Templated],{dialogWidget:null,item:null,loaded:!1,selected:!1,widgetsInTemplate:!0,templateString:"<div class='themeItem'><div dojoAttachPoint='imageDiv' class='imageDiv'><div dojoAttachPoint='itemHoverBg' class='itemHoverBg'></div><div dojoAttachPoint='itemName' class='itemName'></div></div><div dojoAttachPoint='availableDate' class='availableDate'></div></div>",startup:function(){this.itemName.innerHTML=Config.ShowThemeDisplayName?this.item.label:"";this.imageDiv.onclick=b.hitch(this,
this.handleClick);this.imageDiv.onmouseover=b.hitch(this,this.handleOver);this.imageDiv.onmouseout=b.hitch(this,this.handleOut);if(this.item.availableUntil)this.availableDate.innerHTML=this.item.availableUntil;if(this.item.description)this.domNode.title=this.item.description;if(this.item.iconImg){var a=this.item.resourcePath+"/"+this.item.iconImg;this.item.defaultTheme&&(a=Config.BaseImagesURL+"themes/dialogIcon.png");b.style(this.imageDiv,{backgroundColor:this.item.iconBgColor?this.item.iconBgColor:
"#fff",backgroundImage:"url('"+a+"')",backgroundPosition:"center center",backgroundRepeat:"no-repeat"})}else if(this.item.iconBgColor)this.imageDiv.style.backgroundColor=this.item.iconBgColor;else if(!this.item.defaultTheme)this.imageDiv.style.backgroundColor="#fff"},handleOver:function(a){if(!this.selected)this.itemName.style.display="block",this.itemHoverBg.style.display="block";if(a&&a.stopPropagation)a.stopPropagation();else if(event)event.cancelBubble=!0},handleOut:function(a){if(!this.selected)this.itemName.style.display=
"none",this.itemHoverBg.style.display="none";if(a&&a.stopPropagation)a.stopPropagation();else if(event)event.cancelBubble=!0},updateThemeConfig:function(a){this.dialogWidget.tc.active[a]=!0;this.dialogWidget.tc.themeData[a]=this.dialogWidget.themeData[a]},handleClick:function(){this.dialogWidget.clearSelectedItem();this.select(!0);this.updateThemeConfig(this.item.id);this.dialogWidget.themeWidget.changeTheme(this.item.id)},createSelectedNodes:function(){var a=document.createElement("div");b.addClass(a,
"themeItemSelected");var e=document.createElement("img");e.src=Config.SpacerImageURL;var f=document.createElement("span");f.innerHTML=Config.Strings.ThemesPickerSelected;a.appendChild(e);a.appendChild(f);return a},select:function(a){this.selected=a;this.itemName.style.display="none";if(a)this.itemHoverBg.style.display="block",this.itemHoverBg.style.height="70px",this.selectedDiv?this.selectedDiv.style.display="block":(this.selectedDiv=this.createSelectedNodes(),this.imageDiv.appendChild(this.selectedDiv));
else{if(this.selectedDiv)this.selectedDiv.style.display="none";this.itemHoverBg.style.display="none";this.itemHoverBg.style.height="18px"}}}));b._hasResource["ws.themes.widget.ThemePicker"]||(b._hasResource["ws.themes.widget.ThemePicker"]=!0,b.provide("ws.themes.widget.ThemePicker"),b.declare("ws.themes.widget.ThemePicker",[k._Widget,k._Templated],{templateString:b.cache("ws.themes.widget","ThemePicker.html","<div></div>\r\n"),themeCss:{templateString:b.cache("ws.themes.widget","ThemeStyles.css",
'body a, body .wsLink, body .wsLink:visited, body .aimSignIn, body .aimError, body .wsSelect .option, body .buddyList .groupEdit{color: %{Gen_base};}body .wsLink:hover, body .wsLink:focus{color: %{Gen_base};}body .themeCancelBtn .wsLink,body .themeCancelBtn a,body .themeCancelBtn a:visited{color:#555;}body .footer_container .feedback .undoLink,body .feedbackBox .wsLink,body .feedbackBox a,body .feedbackBox a:visited,body .feedbackBox .wsLink:hover,body .feedbackBox .wsLink:focus{color: %{Gen_medium};}body .WSHat .signOutLink a,body .WSHat .signOutLink a:visited,body .WSHat .adminLinks .link,body .WSHat .adminLinks .pipe,body .WSHat .adminLinks span a,body .WSHat .adminLinks span a:visited {color: %{Hdr_link};}body .WSHat .salutation {color: %{Hdr_grtingText};}body .fdbkBadge .fdbkBadgeIcon,body .fdbkPaneEntry ul li:hover .feedbackSprite,body .fdbkPaneEntry ul li.fdbkOptionHover .feedbackSprite {background-color: %{Gen_base};}body .peoplePicker .showHighlight .row-highlight .dojoxGrid-cell,body .editCalendar .screenNameRowHover,body .messageListView .dojoxGrid-header-sort-up,body .messageListView .dojoxGrid-header-sort-down,body .buddyList h2.groupItemHover,body .buddyList .buddy h3:hover,body .wsMenuItemHover,body .listView .dojoxGrid-row-over,body .filterRow:hover,body .filterRow:hover td,body .appPplNode .appPplItem:hover,body .appTodo .taskItem:hover,body .appFolders .folderItem:hover,body .bgColor:hover,.test {background-color: %{Gen_light} !important;}body .displayMessage .wsItemHover,body .displayMessage .wsItem:hover {background-color: %{Gen_light} !important; color: #202020 !important;}body .taskPanel .taskCloseBtnCntr {background-color: %{Gen_light} !important;}.dj_ie8 body .WSUntimedView .bodyCellToday,.dj_ie8 body .WSGridView .bodyCellToday,.dj_ie8 body .peoplePicker .showHighlight .row-highlight .dojoxGrid-cell,.dj_ie8 body .editCalendar .screenNameRowHover,.dj_ie8 body .messageListView .dojoxGrid-header-sort-up,.dj_ie8 body .messageListView .dojoxGrid-header-sort-down,.dj_ie8 body .buddyList h2.groupItemHover,.dj_ie8 body .buddyList .buddy h3:hover,.dj_ie8 body .wsMenuItemHover,.dj_ie8 body .listView .dojoxGrid-row-over,.dj_ie8 .test {background-color: %{Gen_light} !important;}body .searchInfo, body .sendConfirmation .linkButton, body .searchInfo .DropDownButton .btnLabel{color: #fff;}body .dojoxGrid-row .searchTerm,body .displayMessage .searchTerm {background-color: %{Gen_medium};}body .WSNavigation .navItemCurrent,body .appStack .currAppTitle,body .settings .pageList .pageItem.current,body .appTodo .appTitleAddTaskSel,body #eventApp .appTitleAddEvSel,body .appPpl .appTitleSearchSel,body .appAim .appTitleSearchSel,body .imWidget .imBlock .itsme,body .appFolders .currFolderItem,body .navToolbar .mnUnseen,body .searchInfo{background-color: %{Gen_base};}body .appFolders .appFoldersNode .currFolderItem:hover{background-color: %{Gen_base} !important;}body .displayMessage .itemSelected{background-color:%{Gen_base};}.dj_ie7 body .WSNavigation .hasUnseen.navItemCurrent .text .unseen,.dj_ie8 body .WSNavigation .hasUnseen.navItemCurrent .text .unseen {background-color:%{Gen_dark};}body .btn, body .btnHover, body .btnSmall, body .btnLarge {background-color: %{Gen_base}; border: 1px solid %{Gen_dark};}body .btnHover, body .btnSmallHover, body .btnLargeHover {background-color: %{Gen_base};}body .wsToolbarControls .btnClick,body .wsToolbarControls .ButtonHighlight,body .WSNavigation .controlsPane ul li.cpBtnClick div.cpBtn,body .imPanel .AIMbtnSel {background-color: %{Gen_base} !important; border-bottom: none;}body .btn .btnSplitArrow {border-left: 1px solid %{Gen_dark};}body .WSNavigation .presence, body .WSNavigation .presence:hover {box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; border:none; background: none repeat scroll 0 0 transparent;}body .WSHat {background-image:url("%{themeDir}/hat_bg1.png");}body .WSHat .leftHat,body .WSHat .affinityLeftHat {background-repeat:no-repeat; background-image:url("%{themeDir}/hat_bg2.png");}body .WSNavigation .wsToolbarBare,body .WSCNavigation .wsToolbarBare {background-color:transparent; border-bottom:none;}body .settings .pageList.wsToolbar.wsToolbarBare {background-color:transparent !important;}body .WSModalPane .wsToolbar,body .imWidget .wsToolbar {background-color:transparent;}body .sendConfirmation .wsToolbar {background-color:transparent;}body .wsToolbarBare {background-color: transparent;}body .picturePicker .dojoxGrid-row-over .dojoxGrid-cell {background-color:transparent;}body .dojoxGrid-row,body .dojoxGrid-row, td {outline: none;}body .dojoxGrid-scrollbox, body .dojoxGrid-row {background-color: Transparent;}body .btnSmallBare,body .btnBare,body .btnLargeBare {background-image: none; background: none; border: none; box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; color: #666;}body div.btnSmallDisabled,body div.btnDisabled,body div.btnLargeDisabled,body div.btnDisabled.btnSmallHover,body div.btnDisabled.btnHover, body div.btnDisabled.btnLargeHover {cursor: default; background-color: #cdcdcb; background-image: -moz-linear-gradient(bottom , #cdcec9 50%, #d5d5d3 100%); background-image: linear-gradient(bottom , #cdcec9 50%, #d5d5d3 100%); background-image: -o-linear-gradient(bottom , #cdcec9 50%, #d5d5d3 100%); background-image: -webkit-linear-gradient(bottom , #cdcec9 50%, #d5d5d3 100%); background-image: -ms-linear-gradient(bottom , #cdcec9 50%, #d5d5d3 100%); border: 1px solid #9f9f9f; box-shadow: 0 1px 0 #e5e5e3 inset, 0 1px 0 #cececc; -moz-box-shadow: 0 1px 0 #e5e5e3 inset, 0 1px 0 #cececc; -webkit-box-shadow: 0 1px 0 #e5e5e3 inset, 0 1px 0 #cececc; text-shadow: -1px -1px 0 #ababa9;}\r\n')},
themeCssStr:"",highContrastCss:{templateString:b.cache("ws.themes.widget","ThemeStylesHighContrast.css",'html, body{color: #000;}body .WSNavigation .navItemCurrent .iconPersonal {background-position:0 -378px;}body .navToolbar .navItemCurrent .iconSearch {background-position: -201px 0;}body .WSNavigation .navItemCurrent .iconNewMail {background-position: -49px -202px;}body .WSNavigation .navItemCurrent .iconOldMail,body .WSNavigation .navItemCurrent .iconVoicemail,body .WSNavigation .navItemCurrent .iconFeeds {background-position: -363px -234px;}body .WSNavigation .navItemCurrent .iconTodayOnAOL {background-position: -150px -152px;}body .WSNavigation .navItemCurrent .iconInbox {background-position: 0 -126px;}body .WSNavigation .navItemCurrent .iconDrafts {background-position: 0 -151px;}body .WSNavigation .navItemCurrent .iconAutoSavedSent,body .WSNavigation .navItemCurrent .iconSent {background-position: -1px -177px;}body .WSNavigation .navItemCurrent .iconSavedIMs {background-position: -1px -201px;}body .WSNavigation .navItemCurrent .iconSpam {background-position: -1px -228px;}body .WSNavigation .navItemCurrent .iconDeleted {background-position: -1px -252px;}body .WSNavigation .navItemCurrent .iconContacts {background-position: 0 -302px;}body .WSNavigation .navItemCurrent .iconAIM {background-position: 0 -277px;}body .WSNavigation .navItemCurrent .iconCalendar {background-position: -1px -325px;}body .WSNavigation .hasUnseen.navItemCurrent .text .unseen {box-shadow: 1px 1px 1px #666 inset; -moz-box-shadow: 1px 1px 1px #666 inset; -webkit-box-shadow: 1px 1px 1px #666 inset; color: #fff; background-color: #999; text-shadow: 1px 1px 0px #666;}.dj_ie7 body .WSNavigation .hasUnseen.navItemCurrent .text .unseen,.dj_ie8 body .WSNavigation .hasUnseen.navItemCurrent .text .unseen{background-color: #999;}body .WSNavigation .navItemCurrent,body .settings .pageList .pageItem.current{background-color: #fff !important; border-top: 1px solid #CCC; background-image: -moz-linear-gradient(bottom, #fff 50%, #fff 100%); background-image: linear-gradient(bottom, #fff 50%, #fff 100%); background-image: -o-linear-gradient(bottom, #fff 50%, #fff 100%); background-image: -webkit-linear-gradient(bottom, #fff 50%, #fff 100%); background-image: -ms-linear-gradient(bottom, #fff 50%, #fff 100%);}body .displayMessage .itemSelected{background-color: #f0f0f0 !important; color:#000;}body .settings .pageList .pageItem.current{color:#000; text-shadow:none;}body .btn, body .btnDisabled, body .btnSmall, body .btnLarge,body .btnHover, body .btnSmallHover, body .btnLargeHover{background-color: #fff; background-image: -moz-linear-gradient(bottom , #fff, #fff); background-image: linear-gradient(bottom , #fff, #fff); background-image: -o-linear-gradient(bottom , #fff, #fff); background-image: -webkit-linear-gradient(bottom , #fff, #fff); background-image: -ms-linear-gradient(bottom , #fff, #fff); border: 1px solid #686868; color: #000; text-shadow:none;}body div.btnSmallDisabled,body div.btnDisabled,body div.btnLargeDisabled,body div.btnDisabled.btnSmallHover,body div.btnDisabled.btnHover, body div.btnDisabled.btnLargeHover {cursor: default; background-color: #fff; background-image: -moz-linear-gradient(bottom , #fff, #fff); background-image: linear-gradient(bottom , #fff, #fff); background-image: -o-linear-gradient(bottom , #fff, #fff); background-image: -webkit-linear-gradient(bottom , #fff, #fff); background-image: -ms-linear-gradient(bottom , #fff, #fff); border: 1px solid #CCC; color: #686868; text-shadow: none;}.WSNavigation .presence, .WSNavigation .presence:hover {box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; border:none; background: none repeat scroll 0 0 transparent;}body a, body .wsLink, body .wsLink:visited,body .aimSignIn, body .aimError,body .wsLink:hover, body .wsLink:focus,body .wsSelect .option{color: #0066cc;}body .WSHat .signOutLink a,body .WSHat .signOutLink a:visited,body .WSHat .adminLinks .link,body .WSHat .adminLinks .pipe,body .themeCancelBtn .wsLink,body .themeCancelBtn a,body .themeCancelBtn a:visited,body .WSHat .signOutLink .wsLink,body .WSHat .signOutLink a,body .WSHat .signOutLink a:visited,body .WSHat .adminLinks .link,body .WSHat .adminLinks .pipe,body .WSHat .adminLinks span,body .WSHat .adminLinks span a,body .WSHat .adminLinks span a:visited{color: #000;}body .WSHat .searchGoogleText {color:#000;}body .WSHat .salutation {color: #000;}body .WSHat .searchArea .searchWebLabel {color: #000;} body .WSHat .topHat {border-bottom: 1px solid #aaa;}body .WSUntimedView .bodyCellToday,body .WSGridView .bodyCellToday,body .peoplePicker .showHighlight .row-highlight .dojoxGrid-cell,body .editCalendar .screenNameRowHover,body .messageListView .dojoxGrid-header-sort-up,body .messageListView .dojoxGrid-header-sort-down,body .buddyList h2.groupItemHover,body .buddyList .buddy a:hover,body .wsMenuItemHover,body .listView .dojoxGrid-row-over,body .filterRow:hover,.test {background-color: #D6F2FE !important; border-bottom: 1px solid #AAE3FC; border-top: 1px solid #AAE3FC;}body .wsItemHover,body .wsItem:hover{background-color: #D6F2FE !important; color: #000;}body .searchInfo {background-color: #46B9E9; background-image: -moz-linear-gradient(bottom , #46B9E9 ,#6ACAF2); background-image: linear-gradient(bottom , #46B9E9 ,#6ACAF2); background-image: -o-linear-gradient(bottom , #46B9E9 ,#6ACAF2); background-image: -webkit-linear-gradient(bottom , #46B9E9 ,#6ACAF2); background-image: -ms-linear-gradient(bottom , #46B9E9 ,#6ACAF2); text-shadow: none;}body .searchInfo .btnLabel {text-shadow: none;}body .searchInfo, body .sendConfirmation .linkButton, body .searchInfo .DropDownButton .btnLabel{color: #fff; text-shadow: none;}body .filterButtonVisible .searchData {border-right: 1px solid #6ACAF2;}body .filterButtonVisible .searchData > span {border-right: 1px solid #077BA6;}body .sendConfirmation .pipe{border-right: 1px solid #6ACAF2; border-left: 1px solid #077BA6;}body .dojoxGrid-row .searchTerm {background-color: #a5d8ed;}body .wsToolbarControls .btnClick,body .wsToolbarControls .ButtonHighlight,body .WSNavigation .controlsPane ul li.cpBtnClick div,body .imPanel .AIMbtnSel {background-color: #46B9E9 !important; background-image: -moz-linear-gradient(bottom , #46B9E9 50%, #6ACAF2 100%); background-image: linear-gradient(bottom , #46B9E9 50%, #6ACAF2 100%); background-image: -o-linear-gradient(bottom , #46B9E9 50%, #6ACAF2 100%); background-image: -webkit-linear-gradient(bottom , #46B9E9 50%, #6ACAF2 100%); background-image: -ms-linear-gradient(bottom , #46B9E9 50%, #6ACAF2 100%); box-shadow: 0 1px 0 #85D1F1 inset; -moz-box-shadow: 0 1px 0 #85D1F1 inset; -webkit-box-shadow: 0 1px 0 #85D1F1 inset; border-bottom: none;}body .WSNavigation .navItemCurrent .text {text-shadow: none;}body .themeItemPane .imageDiv .itemName {color:#fff;}body .settings .pageList .pageItem,body .settings .feedback .feedback_box,body .settings .feedback .feedback_box span.feedbackSpan,body .settings .feedback span.feedbackSpan,body .welcomeDlg .FriendsInfo,body .welcomeDlg .FriendsHdr,body .welcomeDlg .SyncInfo,body .welcomeDlg .SyncHdr,body .welcomeDlg .SyncHdr,body .welcomeDlg .EasyTransfer,body .welcomeDlg .MakeHome,body .welcomeDlg .description,body .todayPage .head .greeting,body .addressListView span.contactName,body .contactDetail .nickNameDiv span.nickNameInfo,body .contactDetail .tablePane .infoLabel,body .contactDetail .tablePane .nameInfo,body .contactDetail .tablePane .primaryInfo,body .distributionList .tableView .headerDiv,body .distributionList .inputLabels,body .distributionList .inputLabels,body .distributionList .editPane .displayName,body .editContact .contactType,body .editContact .mainTable span.inputLabels,body .editContact .mainTable .headerLabels,body .editContact .mainTable div.addressInputLabels,body .addEditEvent .inputData .addLocationInputShow,body .addEditEvent .dlgTitle,body .inlineAddEvent .inputData .dateSpan,body .buddyList li a,body .imUser .name,body .imPanel .listTab .btn,body .imGroup .minimizedNewMessages,body .imGroup .titleBar,body div.current .btnLabel,body .galleryPanel .galleryContent .rowItem .plugintitle,body span.inputLabels,body .AYO_HintText,body .galleryPanel .galleryContent .rowItem .author,body .galleryPanel .galleryContent .rowItem .plugindesc,body .galleryPanel .catNav .itemSelected,body .WSCalendarView .viewLinks .selected,body .WSCalendarView .searchbar span.dateSpanLabel,body .WSCalendarView .viewLinks .selected,body .btn, .btnHover, .btnDisabled, .btnSmall, .btnLarge,body .wsSelect,body .searchMenuHeaderItem .label,body .WSNavigation,body .WSNavigation .hasUnseen .text,body .WSNavigation .navItem .text,body .messageListView .dojoxGrid-row,body .listView .dojoxGrid-header,body .fakePreviewPane,body .displayMessage .header .fieldRow .value,body .displayMessage .addToLinksNode,body .displayMessage .headerLinksNode,body .displayMessage .bodyPrompt,body .displayMessage .shortHeader,body .WSGridView .bodyCell .dayName,body .WSGridView .bodyCell .dayNumber,body .WSTimePicker .pickerBody,body .FTUTip .message,body .themeItem .availableDate,body .themeItem .itemName,body .themePickerDlg .header,body .wsMenuItem,body .wsInput, body .searchInputDiv,textarea{color: #000;}body .messageListView .row-read {color: #666;}body .imGroup .titleBar .title .wsLink {color: #fff;}body .searchInfo .btnLabel {color: #000;}body .displayMessage .header {background-color: #fff !important;}body .WSHat {background-image:url("%{themeDir}/hat_bg1.png");}body .WSHat .leftHat,body .WSHat .affinityLeftHat {background-repeat:no-repeat; background-image:url("%{themeDir}/hat_bg2.png");}body .footer_container .feedback .undoLink,body .feedbackBox .wsLink,body .feedbackBox a,body .feedbackBox a:visited,body .feedbackBox .wsLink:hover,body .feedbackBox .wsLink:focus{color: #85D1F1;}body .composeMessage .attachmentBtn .btnArrowImg.deleteBtn {background-position: -204px -81px;}body .WSNavigation .navItemCurrent .wsSmallAddButton {background-position: -225px -76px;}body .WSNavigation .wsToolbarBare,body .WSCNavigation .wsToolbarBare {background-color:transparent; border-bottom:none;}body .settings .pageList.wsToolbar.wsToolbarBare {background-color:transparent !important;}body .WSModalPane .wsToolbar,body .imWidget .wsToolbar {background-color:transparent;}body .sendConfirmation .wsToolbar {background-color:transparent;}body .wsToolbarBare {background-color: transparent;}\r\n')},
highContrastThemeCssStr:null,isHighContrastTheme:!1,isVisible:!0,prefs:null,postCreate:function(){window._ws_theme=ws.themes.ThemeConfig;this.tc=window._ws_theme;window._ws_theme.themePicker=this;if(this.themePickerDialog)b._destroyElement(this.themePickerDialog.domNode),this.themePickerDialog.destroy(),this.themePickerDialog=null;this.hatWidget=k.byId("HatWidget");if(!this.isVisible)this.domNode.style.display="none",this.hide();this.themeCssStr=this.themeCss.templateString||b._getText(this.themeCss.templatePath);
this.prefs=this.tc.prefs;this.hatLogoUrl=Config.DefaultLogoIsDark?Config.BaseAffinityResourcesURL+"images/hat_logo_gen_light.png":Config.BaseAffinityResourcesURL+"images/hat_logo_dark.png";if(this.tc.initialThemeLoaded)this.startUpThemeLoaded(),this.startUpThemeChangeDone=!0;this.tc.wasTakeover&&this.tc.optOut&&this.showNewPromoThemeBubble(!0)},startUpThemeLoaded:function(){this.tc.currentThemeId!=Config.ThemeDefault&&this.changeTheme(this.tc.currentThemeId)},sendTrackingURL:function(a){if(a.trackingURL!=
null){var e="?rnd=";a.trackingURL.indexOf("?")>=0&&(e="&rnd=");a=a.trackingURL+e+Math.random();(new Image).src=a}},onChangeTheme:function(){this.openThemePickerDialog(this.tc.currentThemeId)},openThemePickerDialog:function(a,e){Settings.WSSConnectError?ws.widget.Dialogs.ok(Config.Strings.SettingsDisabledThm):(this.themePickerDialog?this.themePickerDialog.show(a,this.tc.currentThemeId):(this.themePickerDialog=new ws.themes.widget.ThemePickerDialog({themeWidget:this,currentSelected:a,originalSelection:this.tc.currentThemeId}),
b.body().appendChild(this.themePickerDialog.domNode),this.themePickerDialog.startup()),e&&this.changeTheme(a))},changeTheme:function(a){if(!this.isThemeValid(a)&&(a=this.tc.restoreToThemeId,!this.isThemeValid(a)))a=Config.ThemeDefault;if(this.tc.themeData[a]||a==Config.ThemeDefault){var e=this.tc.themeData[a];this.tc.currentThemeId=e.id;this.tc.currentThemeData=e;this._changeTheme(a)}else this.tc.loadTheme(a,b.hitch(this,this._changeTheme,a))},_changeTheme:function(a){if(this.tc.themeData[a])this.tc.currentThemeId=
a,this.tc.currentThemeData=this.tc.themeData[a];if(Settings.EnablePromoThemes&&this.tc.forceOrOptoutThemeId&&this.isThemeValid(a)&&this.tc.forceOrOptoutThemeId!=a)this.prefs.optOutForcedThemeId=this.tc.forceOrOptoutThemeId;if(a!=this.tc.forceOrOptoutThemeId&&a!=this.tc.optinThemeId)this.tc.restoreToThemeId=a;this._insertThemeCss(a);b.publish("Theme/Change",[a]);return a},isThemeValid:function(a){if(this.tc.active[a])return!0;return!1},saveTheme:function(a){this.prefs.SelectedTheme="theme-"+this.tc.currentThemeId.toLowerCase();
this.prefs.restoreToTheme=this.tc.restoreToThemeId;this.prefs.randomThemeEnabled=this.tc.randomThemeEnabled;ws.settings.saveNow({ThemePrefs:this.prefs});Settings.ThemePrefs=this.prefs;var e=this.tc.currentThemeId;this.tc.randomThemeEnabled&&(e="RandomThemeEnabled");a||ws.reporting.reportAction("Theme - "+e)},_changeToPromoTheme:function(){this.themeOptTip.closeTip();this.tc.optinThemeId&&(b.isIE?setTimeout(b.hitch(this,function(){this.openThemePickerDialog(this.tc.optinThemeId,!0)}),100):this.openThemePickerDialog(this.tc.optinThemeId,
!0))},_optOutTakeOverTheme:function(){ws.reporting.reportAction("Theme - Opted out of: "+this.tc.forceOrOptoutThemeId);this.themeOptTip.closeTip();this.tc.loadTheme(this.tc.forceOrOptoutThemeId,b.hitch(this,function(){this.changeTheme(this.tc.restoreToThemeId);this.saveTheme(!0)}))},_openSettings:function(){ws.WebSuite.openSettings();this.themeOptTip.closeTip()},showNewPromoThemeBubble:function(a){var e=a?this.tc.forceOrOptoutThemeId:this.tc.optinThemeId;e&&this.tc.loadTheme(e,b.hitch(this,function(){ws.lang.ensureLayersLoaded(b.hitch(this,
function(){var f=a?"ThemeOptout":"ThemeOptin",g=this.tc.themeData[e],h=g.PromoAttribute;if(g&&h&&this.hatWidget){var j=Settings.LastSeenPromoTipBubble,m=["",""];j&&(m=j.split(";"));m.length<2&&(m[1]="");j=a?1:0;if(m[j]!=g.id){m[j]=g.id;var k=a?"optout":"optin";(j=h[k+"TipMessage"])||(j=a?Config.Strings.ThemesPromoFTUTipOptOut:Config.Strings.ThemesPromoFTUTipOptIn);var o="12px",n="20px",l="",x=208;if(h=h[k+"TipIcon"])l=ws.string.substituteParams("<div style='position:absolute;left:15px;top:19px;width:115px;height:70px;border: 1px solid #ccc;background:url({0}) no-repeat center center'></div>",
g.resourcePath+"/"+h),o="146px",n="43px",x=175;this.themeOptTip=new ws.widget.FTUTip({name:f,content:l+"<div style='min-height:"+n+"'>"+j+"</div>"+("<div style='position:relative;height:25px;margin-top:5px;margin-right:10px;font-weight:normal;'><div class='wsLink ptbNoThanksLnk'>"+Config.Strings.Themes_NoThanks+"</div><div class='ptbOKBtn'></div></div>"),positionOverNode:this.domNode,distanceArrowFromEdge:64,arrowPosition:"top",dimensions:{w:x},offset:{x:-63,y:24},saveAsSeenOnClose:!1,load:b.hitch(this,
function(){var e=new ws.widget.Button;e.startup();e.setLabel(Config.Strings.OK);e.onClick=b.hitch(this,function(){this.themeOptTip.closeTip()});var f=b.query(".ptbOKBtn",this.themeOptTip.ftutip);f.length&&f[0].appendChild(e.domNode);a?(e.onClick=b.hitch(this,function(){this.themeOptTip.closeTip()}),b.query(".ptbNoThanksLnk",this.themeOptTip.ftutip).onclick(b.hitch(this,function(){this._optOutTakeOverTheme()}))):(e.onClick=b.hitch(this,function(){this._changeToPromoTheme()}),b.query(".ptbNoThanksLnk",
this.themeOptTip.ftutip).onclick(b.hitch(this,function(){this.themeOptTip.closeTip()})))})});b.body().appendChild(this.themeOptTip.domNode);if(this.themeOptTip.closeButton)this.themeOptTip.closeButton.style.display="none";this.themeOptTip.padBox.style.backgroundColor="#fff";b.style(this.themeOptTip.message,{backgroundColor:"#fff",color:"#000",fontSize:"14px",fontWeight:"normal",padding:"17px 14px 14px "+o,backgroundColor:"#fff"});this.themeOptTip.startup();if(Settings.FirstLogin&&this.themeOptTip.domNode)this.themeOptTip.domNode.style.zIndex=
990;this.themeOptTip.placeOnScreen();this.themeOptTip.domNode.style.display="";ws.settings.saveSoon({LastSeenPromoTipBubble:m.join(";")});Settings.LastSeenPromoTipBubble=m.join(";")}}}))}))},onPromoClick:function(){ws.io.openWindow(this.tc.currentThemeData.promoLink)},_insertThemeCss:function(){this.isHighContrastTheme=!1;var a="",e=this.tc.currentThemeData;if(!e.defaultTheme){var f=e.resourcePath,g=e.useDarkArrow?"-106px -83px":"-131px -307px";if(e.highContrast){this.isHighContrastTheme=!0;f={baseImage:Config.BaseImagesURL,
themeDir:f};if(!this.highContrastThemeCssStr)this.highContrastThemeCssStr=this.highContrastCss.templateString||b._getText(this.highContrastCss.templatePath);try{a=ws.string.substituteParams(this.highContrastThemeCssStr,f)}catch(h){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"ThemeStylesHighContrast.css  error: targeted theme ("+this.tc.currentThemeId+") has invalid property: file:ThemePicker.js")}}else{var f={themeDir:f},j;for(j in this.tc.map){var m=this.tc.map[j];f[j]=e.styleInfo[m[0]][m[1]]}try{a=
ws.string.substituteParams(this.themeCssStr,f)}catch(k){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"ThemeStyles.css error: targeted theme ("+this.tc.currentThemeId+") has invalid property: file:ThemePicker.js")}}a+=""+(" body .WSHat .megaMenuArrow { background-position: "+g+";}");if(e.changeHatLogo)e=[' body .WSHat .logoArea, body .miniLogin .logoArea IMG { background-image: url("',e.resourcePath+"/hat_logo_std.png",'");'].join(""),a+=e;else if(Config.DefaultLogoIsDark&&!e.useDarkHatLogo||
!Config.DefaultLogoIsDark&&e.useDarkHatLogo)e=[' body .WSHat .logoArea, body .miniLogin .logoArea IMG { background-image: url("',this.hatLogoUrl,'");'].join(""),a+=e}b.isWebKit?(b._destroyElement(document.getElementById("themeCommon")),e=document.createElement("style"),e.setAttribute("id","themeCommon"),e.innerText=a,document.getElementsByTagName("head")[0].appendChild(e)):b.isIE?document.getElementById("themeCommon").styleSheet.cssText=a:document.getElementById("themeCommon").innerHTML=a}}));b._hasResource["dijit.layout.LayoutContainer"]||
(b._hasResource["dijit.layout.LayoutContainer"]=!0,b.provide("dijit.layout.LayoutContainer"),b.declare("dijit.layout.LayoutContainer",k.layout._LayoutWidget,{baseClass:"dijitLayoutContainer",constructor:function(){b.deprecated("dijit.layout.LayoutContainer is deprecated","use BorderContainer instead",2)},layout:function(){k.layout.layoutChildren(this.domNode,this._contentBox,this.getChildren())},addChild:function(){this.inherited(arguments);this._started&&k.layout.layoutChildren(this.domNode,this._contentBox,
this.getChildren())},removeChild:function(){this.inherited(arguments);this._started&&k.layout.layoutChildren(this.domNode,this._contentBox,this.getChildren())}}),b.extend(k._Widget,{layoutAlign:"none"}));if(!b._hasResource["dojo.date"])b._hasResource["dojo.date"]=!0,b.provide("dojo.date"),b.getObject("date",!0,b),b.date.getDaysInMonth=function(a){var e=a.getMonth();if(e==1&&b.date.isLeapYear(a))return 29;return[31,28,31,30,31,30,31,31,30,31,30,31][e]},b.date.isLeapYear=function(a){a=a.getFullYear();
return!(a%400)||!(a%4)&&!!(a%100)},b.date.getTimezoneName=function(a){var e=a.toString(),b="",g=e.indexOf("(");if(g>-1)b=e.substring(++g,e.indexOf(")"));else if(g=/([A-Z\/]+) \d{4}$/,e=e.match(g))b=e[1];else if(e=a.toLocaleString(),g=/ ([A-Z\/]+)$/,e=e.match(g))b=e[1];return b=="AM"||b=="PM"?"":b},b.date.compare=function(a,e,b){a=new Date(+a);e=new Date(+(e||new Date));b=="date"?(a.setHours(0,0,0,0),e.setHours(0,0,0,0)):b=="time"&&(a.setFullYear(0,0,0),e.setFullYear(0,0,0));if(a>e)return 1;if(a<e)return-1;
return 0},b.date.add=function(a,e,b){var g=new Date(+a),h=!1,j="Date";switch(e){case "day":break;case "weekday":var m;(e=b%5)?m=parseInt(b/5):(e=b>0?5:-5,m=b>0?(b-5)/5:(b+5)/5);var k=a.getDay(),o=0;k==6&&b>0?o=1:k==0&&b<0&&(o=-1);k+=e;if(k==0||k==6)o=b>0?2:-2;b=7*m+e+o;break;case "year":j="FullYear";h=!0;break;case "week":b*=7;break;case "quarter":b*=3;case "month":h=!0;j="Month";break;default:j="UTC"+e.charAt(0).toUpperCase()+e.substring(1)+"s"}if(j)g["set"+j](g["get"+j]()+b);h&&g.getDate()<a.getDate()&&
g.setDate(0);return g},b.date.difference=function(a,e,f){var e=e||new Date,f=f||"day",g=e.getFullYear()-a.getFullYear(),h=1;switch(f){case "quarter":a=a.getMonth();e=e.getMonth();a=Math.floor(a/3)+1;e=Math.floor(e/3)+1;e+=g*4;h=e-a;break;case "weekday":g=Math.round(b.date.difference(a,e,"day"));f=parseInt(b.date.difference(a,e,"week"));if(g%7==0)g=f*5;else{var h=0,j=a.getDay(),m=e.getDay(),f=parseInt(g/7),e=g%7,a=new Date(a);a.setDate(a.getDate()+f*7);a=a.getDay();if(g>0)switch(!0){case j==6:h=-1;
break;case j==0:h=0;break;case m==6:h=-1;break;case m==0:h=-2;break;case a+e>5:h=-2}else if(g<0)switch(!0){case j==6:h=0;break;case j==0:h=1;break;case m==6:h=2;break;case m==0:h=1;break;case a+e<0:h=2}g+=h;g-=f*2}h=g;break;case "year":h=g;break;case "month":h=e.getMonth()-a.getMonth()+g*12;break;case "week":h=parseInt(b.date.difference(a,e,"day")/7);break;case "day":h/=24;case "hour":h/=60;case "minute":h/=60;case "second":h/=1E3;case "millisecond":h*=e.getTime()-a.getTime()}return Math.round(h)};
if(!b._hasResource["ws.date"])b._hasResource["ws.date"]=!0,b.provide("ws.date"),ws.date.firstDayOfWeek=Config.FirstDayOfWeek,ws.date.RFC2445=Config.Strings.DateRFC2445,ws.date.RFC2445WithTime=Config.Strings.DateRFC2445WithTime,ws.date.months=[Config.Strings.January,Config.Strings.February,Config.Strings.March,Config.Strings.April,Config.Strings.May,Config.Strings.June,Config.Strings.July,Config.Strings.August,Config.Strings.September,Config.Strings.October,Config.Strings.November,Config.Strings.December],
ws.date.shortMonths=[Config.Strings.Jan,Config.Strings.Feb,Config.Strings.Mar,Config.Strings.Apr,Config.Strings.ShortMay,Config.Strings.Jun,Config.Strings.Jul,Config.Strings.Aug,Config.Strings.Sep,Config.Strings.Oct,Config.Strings.Nov,Config.Strings.Dec],ws.date.days=[Config.Strings.Sunday,Config.Strings.Monday,Config.Strings.Tuesday,Config.Strings.Wednesday,Config.Strings.Thursday,Config.Strings.Friday,Config.Strings.Saturday],ws.date.shortDays=[Config.Strings.Sun,Config.Strings.Mon,Config.Strings.Tue,
Config.Strings.Wed,Config.Strings.Thu,Config.Strings.Fri,Config.Strings.Sat],ws.date.monthNames=ws.date.months.concat(ws.date.shortMonths),ws.date.dayNames=ws.date.days.concat(ws.date.shortDays),ws.date.abbrevDays=[Config.Strings.AbbSunday,Config.Strings.AbbMonday,Config.Strings.AbbTuesday,Config.Strings.AbbWednesday,Config.Strings.AbbThursday,Config.Strings.AbbFriday,Config.Strings.AbbSaturday],ws.date.amAbb=Config.Strings.Date_am,ws.date.pmAbb=Config.Strings.Date_pm,ws.date.kEmptyDate=null,ws.date.MONTH_LENGTH=
[31,28,31,30,31,30,31,31,30,31,30,31],ws.date.LEAP_MONTH_LENGTH=[31,29,31,30,31,30,31,31,30,31,30,31],ws.date.dateParts={YEAR:0,MONTH:1,DAY:2,HOUR:3,MINUTE:4,SECOND:5,MILLISECOND:6,QUARTER:7,WEEK:8,WEEKDAY:9},ws.date.add=function(a,e,b){switch(e){case ws.date.dateParts.YEAR:a=new Date(a.getFullYear()+b,a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds());break;case ws.date.dateParts.MONTH:a.getMonth()+b<0?(e=Math.abs(a.getMonth()+b),b=Math.floor(e/12)+1,a=new Date(a.getFullYear()-
b,12-e%12,a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())):(e=a.getMonth()+b,b=Math.floor(e/12),a=new Date(a.getFullYear()+b,e%12,a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()));break;case ws.date.dateParts.HOUR:a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours()+b,a.getMinutes(),a.getSeconds(),a.getMilliseconds());break;case ws.date.dateParts.MINUTE:a=new Date(a.getTime()+b*6E4);break;case ws.date.dateParts.SECOND:a=new Date(a.getFullYear(),
a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds()+b,a.getMilliseconds());break;case ws.date.dateParts.MILLISECOND:a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()+b);break;default:a=new Date(a.getFullYear(),a.getMonth(),a.getDate()+b,a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())}return a},ws.date.getFirstDayOfWeekFromDate=function(a){var e=a.getDay()-ws.date.firstDayOfWeek;e<0&&(e+=7);return ws.date.add(a,
ws.date.dateParts.DAY,-e)},ws.date.getLastDayOfWeek=function(a){var e=a.getDay();return ws.date.add(a,ws.date.dateParts.DAY,(ws.date.firstDayOfWeek-e+6)%7)},ws.date.getFirstDayInMonthView=function(a){a=new Date(a.getFullYear(),a.getMonth(),1);return ws.date.getFirstDayOfWeekFromDate(a)},ws.date.getLastDayInMonthView=function(a){var e=null,e=ws.date.getFirstDayInMonthView(a);return e=ws.date.add(e,ws.date.dateParts.DAY,35).getMonth()!=a.getMonth()?ws.date.add(e,ws.date.dateParts.DAY,34):ws.date.add(e,
ws.date.dateParts.DAY,41)},ws.date.numberOfWeeksSpanMonth=function(a){var e=null,e=ws.date.getFirstDayInMonthView(a);return e=ws.date.add(e,ws.date.dateParts.DAY,35).getMonth()!=a.getMonth()?5:6},ws.date.getADateInPreviousMonth=function(a){return ws.date.add(a,ws.date.dateParts.DAY,-a.getDate())},ws.date.getPreviousMonth=function(a){var e=a,e=ws.date.getADateInPreviousMonth(a);a.getDate()<e.getDate()&&e.setDate(a.getDate());return e},ws.date.getADateInNextMonth=function(a){var e=b.date.getDaysInMonth(a),
a=new Date(a.getFullYear(),a.getMonth(),1);return ws.date.add(a,ws.date.dateParts.DAY,e)},ws.date.getNextMonth=function(a){var e=ws.date.getADateInNextMonth(a),b=ws.date.GetDaysInMonth(e.getFullYear(),e.getMonth());a.getDate()>b?e.setDate(b):e.setDate(a.getDate());return e},ws.date.daysSpanned=function(a,e){var b=a.getTimezoneOffset()*6E4,g=e.getTimezoneOffset()*6E4,b=a.getTime()-b,g=e.getTime()-g;return Math.floor(g/864E5)-Math.floor(b/864E5)},ws.date.shortestDate=function(a,e){var f=new Date,g=
f.getDate(),h=f.getMonth(),f=f.getYear(),j=new Date(a),m=j.getDate(),k=j.getMonth(),o=j.getYear(),g=b.date.difference(new Date(o,k,m),new Date(f,h,g),"day"),h=e?"":Config.Strings.Today+" ";return g==0?h+ws.date.formatDateTime(j,Config.Strings.DateToday):g==1&&!e?Config.Strings.Yesterday+" "+ws.date.formatDateTime(j,Config.Strings.DateToday):g<7?ws.date.formatDateTime(j,Config.Strings.DateWeek):f==o?ws.date.formatDateTime(j,Config.Strings.DateThisYear):ws.date.formatDateTime(j,Config.Strings.DateYear)},
ws.date.timeAgo=function(a){var e=new Date,a=new Date(a),b=(e-a)/1E3;b<1&&(b=1);var g=Math.round(b/60),h=Math.floor(b/86400);return b<60?ws.string.substituteParams(Config.Strings.TimeAgo_NSeconds,Math.round(b)):g==1?Config.Strings.TimeAgo_OneMinute:b<3600?ws.string.substituteParams(Config.Strings.TimeAgo_NMinutes,g):b<5400?Config.Strings.TimeAgo_OneHour:h==0&&e.getDate()==a.getDate()?ws.string.substituteParams(Config.Strings.TimeAgo_NHours,Math.round(b/3600)):h<=1?Config.Strings.TimeAgo_OneDay:h<=
7?ws.string.substituteParams(Config.Strings.TimeAgo_NDays,h):e.getYear()==a.getYear()?ws.date.formatDateTime(a,Config.Strings.TimeAgo_ThisYearDate):ws.date.formatDateTime(a,Config.Strings.TimeAgo_PreviousYearDate)},ws.date.readableDuration=function(a){if(a<60)return Math.round(a)+Config.Strings.SecondsAbbrev;var e=[];a>=86400&&(e.push(Math.round(a/86400)+Config.Strings.DaysAbbrev),a%=86400);a>=3600&&(e.push(Math.round(a/3600)+Config.Strings.HoursAbbrev),a%=3600);a>=60&&e.push(Math.round(a/60)+Config.Strings.MinutesAbbrev);
return e.join(" ")},ws.date.formatISO8601=function(a){var e=a.getMonth()+1,b=a.getDate(),g=a.getHours(),h=a.getMinutes(),j=a.getSeconds();return""+a.getFullYear()+(e<0||e>9?e:"0"+e)+(b<0||b>9?b:"0"+b)+"T"+(g<0||g>9?g:"0"+g)+(h<0||h>9?h:"0"+h)+(j<0||j>9?j:"0"+j)},ws.date.formatRFC2445=function(a){var e=a.getMonth()+1,b=a.getDate();return""+a.getFullYear()+(e<0||e>9?e:"0"+e)+(b<0||b>9?b:"0"+b)},ws.date.formatRFC2445WithTime=function(a){var e=a.getMonth()+1,b=a.getDate(),g=a.getHours(),h=a.getMinutes(),
j=a.getSeconds();return""+a.getFullYear()+(e<0||e>9?e:"0"+e)+(b<0||b>9?b:"0"+b)+(g<0||g>9?g:"0"+g)+(h<0||h>9?h:"0"+h)+(j<0||j>9?j:"0"+j)},ws.date.formatDateTime=function(a,e){var b=a.getFullYear()+"",g=a.getMonth()+1,h=a.getDate(),j=a.getDay(),m=a.getHours(),k=a.getMinutes(),o=a.getSeconds(),l={};l.y=b;l.yyyy=b;l.yy=b.substring(2,4);l.M=g;l.MM=g<0||g>9?g:"0"+g;l.MMM=ws.date.monthNames[g-1];l.NNN=ws.date.monthNames[g+11];l.d=h;l.dd=h<0||h>9?h:"0"+h;l.E=ws.date.dayNames[j+7];l.EE=ws.date.dayNames[j];
l.H=m;l.HH=m<0||m>9?m:"0"+m;l.h=m==0?12:m>12?m-12:m;l.hh=l.h<0||l.h>9?l.h:"0"+l.h;l.K=m>11?m-12:m;l.k=m+1;l.KK=l.K<0||l.K>9?l.K:"0"+l.K;l.kk=l.k<0||l.k>9?l.k:"0"+l.k;l.a=m>11?ws.date.pmAbb:ws.date.amAbb;l.m=k;l.mm=k<0||k>9?k:"0"+k;l.s=o;l.ss=o<0||o>9?o:"0"+o;b="";g=e.split("");h=0;for(m=j=null;h<e.length;){j=g[h];for(m="";g[h]==j&&h<g.length;)m+=g[h++];b+=l[m]!=null?l[m]:m}return b},ws.date.formatTime=function(a,e,b){var g=a.getHours(),h=a.getMinutes(),j=a.getSeconds(),a={};a.H=g;a.HH=g<0||g>9?g:
"0"+g;a.h=g==0?12:g>12?g-12:g;a.hh=a.h<0||a.h>9?a.h:"0"+a.h;a.K=g>11?g-12:g;a.k=g+1;a.KK=a.K<0||a.K>9?a.K:"0"+a.K;a.kk=a.k<0||a.k>9?a.k:"0"+a.k;a.a=g>11?ws.date.pmAbb:ws.date.amAbb;a.m=h;a.mm=h<0||h>9?h:"0"+h;a.s=j;a.ss=j<0||j>9?j:"0"+j;b&&h==0&&(e=b);for(var b="",h=e.split(""),g=0,m=j=null;g<e.length;){j=h[g];for(m="";h[g]==j&&g<h.length;)m+=h[g++];b+=a[m]!=null?a[m]:m}return b},ws.date.formatMinutes=function(a,e,b){a%=1440;var g=Math.floor(a/60),h=a-g*60,a={};a.H=g;a.HH=g<0||g>9?g:"0"+g;a.h=g==
0?12:g>12?g-12:g;a.hh=a.h<0||a.h>9?a.h:"0"+a.h;a.K=g>11?g-12:g;a.k=g+1;a.KK=a.K<0||a.K>9?a.K:"0"+a.K;a.kk=a.k<0||a.k>9?a.k:"0"+a.k;a.a=g>11?ws.date.pmAbb:ws.date.amAbb;a.m=h;a.mm=h<0||h>9?h:"0"+h;b&&h==0&&(e=b);for(var b="",g=e.split(""),h=0,j=null,m=null;h<e.length;){j=g[h];for(m="";g[h]==j&&h<g.length;)m+=g[h++];b+=a[m]!=null?a[m]:m}return b},ws.date.IsInteger=function(a){for(var e=0;e<a.length;e++)if("1234567890".indexOf(a.charAt(e))==-1)return!1;return!0},ws.date.GetInt=function(a,e,b,g){for(;g>=
b;g--){var h=a.substring(e,e+g);if(h.length<b)break;if(ws.date.IsInteger(h))return h}return null},ws.date.GetDateFromFormat=function(a,e){a+="";e+="";for(var b=0,g=0,h="",j="",m,k,l=new Date,n=l.getYear(),p=l.getMonth()+1,x=1,q=l.getHours(),w=l.getMinutes(),l=l.getSeconds(),s="";g<e.length;){h=e.charAt(g);for(j="";e.charAt(g)==h&&g<e.length;)j+=e.charAt(g++);if(j=="yyyy"||j=="yy"||j=="y"){j=="yyyy"&&(k=m=4);j=="yy"&&(k=m=2);j=="y"&&(m=2,k=4);n=ws.date.GetInt(a,b,m,k);if(n==null)return 0;b+=n.length;
n.length==2&&(n=n>70?1900+(n-0):2E3+(n-0))}else if(j=="MM"||j=="M"){p=ws.date.GetInt(a,b,j.length,2);if(p==null||p<1||p>12)return 0;b+=p.length}else if(j=="dd"||j=="d"){x=ws.date.GetInt(a,b,j.length,2);if(x==null||x<1||x>31)return 0;b+=x.length}else if(j=="hh"||j=="h"){q=ws.date.GetInt(a,b,j.length,2);if(q==null||q<1||q>12)return 0;b+=q.length}else if(j=="HH"||j=="H"){q=ws.date.GetInt(a,b,j.length,2);if(q==null||q<0||q>23)return 0;b+=q.length}else if(j=="KK"||j=="K"){q=ws.date.GetInt(a,b,j.length,
2);if(q==null||q<0||q>11)return 0;b+=q.length}else if(j=="kk"||j=="k"){q=ws.date.GetInt(a,b,j.length,2);if(q==null||q<1||q>24)return 0;b+=q.length;q--}else if(j=="mm"||j=="m"){w=ws.date.GetInt(a,b,j.length,2);if(w==null||w<0||w>59)return 0;b+=w.length}else if(j=="ss"||j=="s"){l=ws.date.GetInt(a,b,j.length,2);if(l==null||l<0||l>59)return 0;b+=l.length}else if(j=="a"){h=0;s=Config.Strings.Date_am.length;h=a.substring(b,b+s).toLowerCase();if(h==Config.Strings.Date_am)h=s,s="AM";else if(h==Config.Strings.Date_pm)h=
Config.Strings.Date_pm.length,s="PM";else return 0;b+=h}else if(a.substring(b,b+j.length)!=j)return 0;else b+=j.length}if(b!=a.length)return 0;if(p==2)if(n%4==0&&n%100!=0||n%400==0){if(x>29)return 0}else if(x>28)return 0;if((p==4||p==6||p==9||p==11)&&x>30)return 0;q<12&&s=="PM"?q=q-0+12:q>11&&s=="AM"&&(q-=12);return(new Date(n,p-1,x,q,w,l)).getTime()},ws.date.ParseDate=function(a){var e=arguments.length==2?arguments[1]:!1;generalFormats=["y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d"];monthFirst=
["M/d/y","M-d-y","M.d.y","MMM-d","M/d","M-d"];dateFirst=["d/M/y","d-M-y","d.M.y","d-MMM","d/M","d-M"];for(var e=["generalFormats",e?"dateFirst":"monthFirst",e?"monthFirst":"dateFirst"],b=null,g=0;g<e.length;g++)for(var h=window[e[g]],j=0;j<h.length;j++)if(b=ws.date.GetDateFromFormat(a,h[j]),b!=0)return new Date(b);return null},ws.date.ParseDateFromFormat=function(a,e){var b=null;try{if(b=new Date(ws.date.GetDateFromFormat(a,e)),b==null||b.getFullYear()<=1970)b=null}catch(g){b=null}return b},ws.date.ParseTimeFromFormat=
function(a,e){var b=new Date,g=b.getYear()+1900,h=b.getMonth()+1,b=b.getDate();return ws.date.ParseDateFromFormat(h+"/"+b+"/"+g+" "+a,"M/d/yyyy "+e)},ws.date.ParseHourMinTextField=function(a,e,b){var g=0,h=0,j=!1,m=[],e=ws.date.ParseTimeFromFormat(a,e);e==null?j=!0:(g=e.getHours(),h=e.getMinutes());j&&(e=ws.date.ParseTimeFromFormat(a,b),e!=null&&(g=e.getHours(),h=0));if(e==null)return null;m.hr=g;m.min=h;return m},ws.date.GetPreviousWeekDate=function(a){return ws.date.add(a,ws.date.dateParts.DAY,
-7)},ws.date.GetNextWeekDate=function(a){return ws.date.add(a,ws.date.dateParts.DAY,7)},ws.date.GetFirstDayInWeek=function(a,e){var b=a.getDay()-e;b<0&&(b+=7);return ws.date.add(a,ws.date.dateParts.DAY,-b)},ws.date.GetLastDayInWeek=function(a,e){var b=a.getDay();return ws.date.add(a,ws.date.dateParts.DAY,(e-b+6)%7)},ws.date.IsValidDate=function(a){return a!=ws.date.kEmptyDate&&a.getTime},ws.date.TimeRangeFormatter=function(a,e,b,g,h){if(b||!ws.date.IsValidDate(a))return"";b=ws.date.formatDateTime(a,
a.getMinutes()>0?g:h);!ws.date.IsValidDate(e)||a.getTime()==e.getTime()?a=b:(a=ws.date.formatDateTime(e,e.getMinutes()>0?g:h),a=b+"-"+a);return a},ws.date.FormatTimeRange=function(a,e,b,g,h){(a=ws.date.TimeRangeFormatter(a,e,b,g,h))&&(a=a.toLowerCase());return a},ws.date.IsLeapYear=function(a){return a%4==0&&(a%100!=0||a%400==0)},ws.date.GetDaysInMonth=function(a,e){return ws.date.IsLeapYear(a)?ws.date.LEAP_MONTH_LENGTH[e]:ws.date.MONTH_LENGTH[e]},ws.date.incrementMonth=function(a){var e=a.getDate(),
a=new Date(a.getFullYear(),a.getMonth()+1,1),b=ws.date.GetDaysInMonth(a.getFullYear(),a.getMonth());e<=b?a.setDate(e):a.setDate(b);return a};b._hasResource["ws.widget.SingleLineNotification"]||(b._hasResource["ws.widget.SingleLineNotification"]=!0,b.provide("ws.widget.SingleLineNotification"),b.declare("ws.widget.SingleLineNotification",[k._Widget,k._Templated],{templateString:b.cache("ws.widget","SingleLineNotification.html",'<div class="SingleLineNotification">\r\n\t<div class="alertBar">\r\n\t\t<span class="alertLeft"><img class="mainSprite slnAlertIcon" src="${spacer}"><span dojoAttachPoint="alertTxt">${NotificationHeadsUp}</span></span><span class="barRight" dojoattachpoint="msg"></span>\r\n\t</div>\r\n\t<img src="${spacer}" class="mainSprite closeBtn" dojoattachpoint="closeBtn" dojoattachevent="onclick:close">\r\n</div>\r\n'),
css:{templateString:""},extraClassName:"",close:function(a){b.animateProperty({node:this.domNode,duration:300,properties:{height:{end:0,unit:"px"}},onEnd:b.hitch(this,function(){this.hide();b.publish("WebSuite/CloseNotification")})}).play();if(ws.WebSuite.notificationMsg.id!="awayMessage_1"&&!ws.WebSuite.notificationMsg.sticky&&a!==!0)ws.WebSuite.seenNotificationIds[ws.WebSuite.seenNotificationIds.length]=ws.WebSuite.notificationMsg.id,ws.settings.saveSoon({SeenNotificationMsgs:ws.WebSuite.seenNotificationIds})},
autoDismiss:function(a){setTimeout(b.hitch(this,function(){this.close(!0)}),a?a*1E3:3E4)}}));b._hasResource["ws.widget.BuddyIcon"]||(b._hasResource["ws.widget.BuddyIcon"]=!0,b.provide("ws.widget.BuddyIcon"),b.declare("ws.widget.BuddyIcon",[k._Widget,k._Templated],{contact:null,size:48,showBuddyShadow:!0,templateString:'<div class="buddyIcon" style="height:${size}px;width:${size}px;">\t<img src="${spacer}" dojoAttachPoint="defaultIcon" style="height: ${size}px; width: ${size}px; position: absolute; background: url(\'${baseimages}prime/mainLargeIcon8.png\') -65px -105px;">\t<img src="${spacer}" dojoAttachPoint="icon" dojoAttachEvent="onload: onLoad, onclick: onClick, onerror: onError" style="display: none; background-color: #fff; width: ${size}px; height: ${size}px; position: absolute;">\t<img src="${spacer}" dojoAttachPoint="icon2" style="position: absolute; left: -9999px; top: -9999px; width: 1px; height: 1px">   <div dojoAttachPoint="buddyShadow" class="buddyShadow" style="position:absolute;height:${size}px;width:${size}px;"></div></div>',
postCreate:function(){this.defaultIcon.style.backgroundPosition={32:"-67px -107px",48:"-57px -140px",64:"-57px -140px"}[this.size];this.showBuddyShadow?b.isIE<9&&b.style(this.buddyShadow,{width:this.size-1+"px",height:this.size-1+"px"}):this.buddyShadow.style.display="none"},show:function(a){this.contact=a;this.icon.style.display="none";var e=ws.presence.getBuddyIconUrl(a);this.showIcon=e!=null;if(e)b.isSafari&&b.isSafari<4?(this.icon2.src=e,setTimeout(b.hitch(this,function(){this.icon.src=e}),0)):
this.icon.src=e},onLoad:function(){if(this.showIcon)this.icon.style.display=""},onClick:function(){var a=ws.presence.getScreenNameForContact(this.contact);a&&ws.presence.launchIM(a)},onError:function(){this.icon.style.display="";setTimeout(b.hitch(this,function(){this.icon.style.display="none"}),0)}}));b._hasResource["ws.suite.TodayPage"]||(b._hasResource["ws.suite.TodayPage"]=!0,b.provide("ws.suite.TodayPage"),b.declare("ws.suite.TodayPage",[k._Widget,k._Templated],{templateString:b.cache("ws.suite",
"TodayPage.html",'<div>\r\n\t<div dojoType="dijit.layout.LayoutContainer" class="todayPage" dojoAttachPoint="layoutWidget">\r\n        <div dojoType="ws.widget.SingleLineNotification" dojoAttachPoint="notification" class="notification" layoutalign="top" style="display:none"></div>\r\n\t\t<div dojoType="ws.widget.Pane" layoutAlign="top" class="head" dojoAttachPoint="headPane">\r\n\t\t\t<div dojoAttachPoint="mailCount" dojoAttachEvent="onclick: onClickMailCount" class="mailCount">\r\n\t\t\t\t<img src="${spacer}" class="mainSprite icon" dojoAttachPoint="mailIcon">\r\n\t\t\t\t<span dojoAttachPoint="mailCountNode" class="mailCountText" >&nbsp;</span>\r\n\t\t\t</div>\r\n\t\t\t<div dojoAttachPoint="errMsgNode" style="display:none" class="errMsgNode"></div>\r\n\t\t\t<div class="clock" dojoAttachPoint="clock" style="display:none">\r\n\t\t\t\t<div class="date" dojoAttachPoint="dateNode">&nbsp;</div>\r\n\t\t\t\t<div class="time" dojoAttachPoint="timeNode">&nbsp;</div>\r\n\t\t\t</div>\r\n\t\t\t<div class="weather" dojoAttachPoint="weather" style="display:none">\r\n\t\t\t\t<iframe dojoAttachPoint="weatherIframe" src="about:blank" width="100%" height="100%" frameborder=0 border=0 marginwidth=0 marginheight=0 scrolling="no" align="top" allowTransparency="true"></iframe>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojoType="ws.widget.Pane" dojoAttachPoint="iframePane" layoutAlign="client">\r\n\t\t\t<iframe src="about:blank" scrolling="auto" frameBorder="no" name="" allowtransparency="true" id="todayIframe" style="display:none;background-color:#fff"></iframe>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,themeColorsDone:!1,hasIframeInited:!1,startup:function(){if(!this._started){this._started=!0;this.iframe=b.byId("todayIframe");if(this.iframe.src=="about:blank")this.iframe.style.display="";var a=null;Config.ShowWeatherInToday&&Config.WeatherURL?(ws.html.setShowing(this.weather,!0),a=ws.string.substituteParams(Config.WeatherURL,ws.UserContext.Zip)):ws.html.setShowing(this.clock,!0);var e=b.hitch(this,function(){this.hasIframeInited=!0;b.io.iframe.setSrc(this.iframe,
this._getTodayUrl(),!0);a&&b.io.iframe.setSrc(this.weatherIframe,this._getWeatherUrl(),!0)});Config.EnableThemes&&window._ws_theme&&!window._ws_theme.initialThemeLoaded?window._ws_theme.todayPageCallbackFunc=e:e();this.connect(this.mailModel,"modelUpdated","updateMailCount");this.subscribe("Theme/Change","updateTodayPageIframes");this.subscribe("locationZipUpdated","updateWeatherLocation");this.subscribe("Settings/hide",function(){var a=this.notification;a&&a.isInternalNotification&&Settings.AwayMessageType!=
null&&Settings.AwayMessageType=="Disabled"&&a.isShowing()&&a.hide()});this.subscribe("MegaMenuOpen",function(){if(!this.iframeClickCatcher)this.iframeClickCatcher=document.createElement("div"),document.body.appendChild(this.iframeClickCatcher);var a=b.position(this.iframe);b.style(this.iframeClickCatcher,{position:"absolute",backgroundColor:"#fff",opacity:0,width:a.w+"px",height:a.h+"px",top:a.y+"px",left:a.x+"px",visibility:"visible",zIndex:1900})});this.subscribe("MegaMenuClose",function(){b.style(this.iframeClickCatcher,
{visibility:"hidden",zIndex:0})})}},targetIframe:function(){if(Config.WelcomePageURL)this.iframe=ws.html.recreateIframe(this.iframePane.domNode,this._getTodayUrl());Config.ShowWeatherInToday&&Config.WeatherURL&&this.weatherIframe&&this.updateWeatherLocation()},onHide:function(){this.iframe=ws.html.recreateIframe(this.iframePane.domNode);this.iframe.style.display="none";b.publish("Today/hide");if(ws.WebSuite.isRecordTimingData&&ws.WebSuite.todayPageUnloaded==0)ws.WebSuite.todayPageUnloaded=new Date},
onShow:function(){this.inherited(arguments);this.iframe.style.display=="none"?this.targetIframe():this.iframe.style.display="";Config.ShowWeatherInToday||this.updateClock();this.updateMailCount();if(ws.WebSuite.isRecordTimingData&&ws.WebSuite.todayPageLoaded==0)ws.WebSuite.todayPageLoaded=new Date;b.publish("Today/show");if(!this.mailCountUpdataCtr)this.mailCountUpdataCtr=b.connect(this.mailModel,"modelUpdated",this,"updateMailCount")},blockAds:function(){},updateMailCount:function(){if(this.domNode.style.display!=
"none"&&this.mailModel){var a=this.mailModel.getFolderByName(this.mailModel.getInboxFolderName()),e="",b=this.mailCount,g=this.errMsgNode,h=this.mailCountNode;if(a)a=a.unseenCount,e=ws.string.substituteParams(Config.Strings[a==0?"MessageCountNone":a==1?"MessageCountSingular":"MessageCountPlural"],a);else if(this.mailModel.isLoading())e=Config.Strings.Loading;else if(this.mailModel.isErrorState()){this.mailModel.getErrorObj();e=Config.Strings.TodayPageErrNotAvailable;if(this.mailModel.isNetErrorState())e=
Config.Strings.TodayPageNetworkErr;e+="<br><span>"+Config.Strings.TodayPageErrLoginAgain+"</span>";h=b=this.errMsgNode;g=this.mailCount}h.innerHTML=e;ws.html.setShowing(b,!0);ws.html.setShowing(g,!1)}},onClickMailCount:function(){ws.WebSuite.displayFolder(this.mailModel.getInboxFolderName())},_getTodayUrl:function(){var a=Config.WelcomePageURL;Config.EnableThemes&&(a+=(a.indexOf("?")>0?"&":"?")+this._getThemeColor());window._g_WS_WebFont&&window._g_WS_WebFont.fontMode&&(a+=(a.indexOf("?")>0?"&":"?")+
"fontCss="+window._g_WS_WebFont.webFontsMap[window._g_WS_WebFont.fontMode]);return a},_getWeatherUrl:function(){var a="";Config.ShowWeatherInToday&&Config.WeatherURL&&(a=ws.string.substituteParams(Config.WeatherURL,ws.UserContext.Zip),Config.EnableThemes&&(a+=(a.indexOf("?")>0?"&":"?")+this._getThemeColor(!0)),window._g_WS_WebFont&&window._g_WS_WebFont.fontMode&&(a+=(a.indexOf("?")>0?"&":"?")+"fontCss="+window._g_WS_WebFont.webFontsMap[window._g_WS_WebFont.fontMode]));return a},updateClock:function(){this.dateNode.innerHTML=
ws.date.formatDateTime(new Date,Config.Strings.CalYboxDateFormat2);ws.date.amAbb="<span class='ampm'>"+Config.Strings.Date_am+"</span>";ws.date.pmAbb="<span class='ampm'>"+Config.Strings.Date_pm+"</span>";this.timeNode.innerHTML=ws.date.formatTime(new Date,Config.Strings.CalTimeFormatRange1);ws.date.amAbb=Config.Strings.Date_am;ws.date.pmAbb=Config.Strings.Date_pm},updateWeatherLocation:function(){if(Config.ShowWeatherInToday&&Config.WeatherURL)this.weather.innerHTML='<iframe src="about:blank" width="100%" height="100%" frameborder=0 border=0 marginwidth=0 marginheight=0 scrolling="no" align="top" allowTransparency="true"></iframe>',
this.weatherIframe=ws.html.recreateIframe(this.weather,this._getWeatherUrl())},updateTodayPageIframes:function(){this.iframe.style.display!="none"&&this.hasIframeInited&&this.targetIframe()},_getThemeColor:function(a){(a=window._ws_theme.getThemeColorQueryString(a,!0,!0))||(a="lightest=A5D8ED&midlightlight=46B9E9&midlight=46B9E9&darkest=077BA6&link=46B9E9&text=ffffff");return a}}));if(!b._hasResource["ws.widget.ModalNotification"])b._hasResource["ws.widget.ModalNotification"]=!0,b.provide("ws.widget.ModalNotification"),
ws.widget.ModalNotification={iframePane:null,startup:function(a){this.iframePane=new ws.widget.iframeModalPane({scrolling:"no"});b.body().appendChild(this.iframePane.domNode);b.query("iframe",this.iframePane.domNode);var e=b.isIE?50:76;this.iframePane.show(a.url,a.box,{w:b.isIE?30:50,h:a.closeButton?e+38:e});if(a.closeButton){e=new ws.widget.WSToolbar({vizType:"Bare"});b.query(".modalContainer",this.iframePane.domNode)[0].appendChild(e.domNode);e.startup();var f=new ws.widget.Button({toolbarPosition:"center",
size:"Large"});f.setLabel(a.closeButtonText);f.onClick=b.hitch(this,function(){this.iframePane.hide()});f.startup();e.addToolbarItem(f);e.layout()}ws.WebSuite.startupDlgDone=!0;b.publish("popup/open",[])}};if(!b._hasResource["ws.bubbleConfig"])b._hasResource["ws.bubbleConfig"]=!0,b.provide("ws.bubbleConfig"),ws.bubbleConfig={welcomeDialogIsShown:!1,openedPinId:"MiniMods",openedPinNeeded:!1,canShowOtherBubbles:!1,pinBubblesEnabled:!1,bmLoaded:!1,inSetting:!1,historyList:[],bubbleHistory:null,requestedPins:{},
allConfigedPins:null,pinGroupMap:null,init:function(){this.loadHistory();b.subscribe("Settings/show",b.hitch(this,function(){this.inSetting=!0;ws.bubbleConfig.hidePinBubble("NewImTextBtns",!0);ws.bubbleConfig.hidePinBubble("MiniMods",!0);ws.bubbleConfig.hidePinBubble("CustomizeMenu",!0)}));b.subscribe("Settings/hide",b.hitch(this,function(){this.inSetting=!1;setTimeout(b.hitch(this,function(){ws.bubbleConfig.showPinBubble("NewImTextBtns",null,!0);ws.bubbleConfig.showPinBubble("MiniMods",null,!0)}),
500)}))},isShowable:function(a){return b.indexOf(this.historyList,a)==-1},hasBeenSeen:function(a){return b.indexOf(this.historyList,a)!=-1},allPinsSeen:function(a){for(var a=a||this.allConfigedPins,e=0;e<a.length;e++)if(!this.hasBeenSeen(a[e]))return!1;return!0},setAllPinsHistory:function(a,e){for(var f=e||this.allConfigedPins,g=0;g<f.length;g++){var h=f[g],j=b.indexOf(this.historyList,h);j==-1?a||this.historyList.push(h):a&&this.historyList.splice(j,1)}},showPinBubble:function(a,e,b){var g=null;
this.requestedPins[a]||(this.requestedPins[a]={node:null});g=e?this.requestedPins[a].node=e:this.requestedPins[a].node;if(b)this.requestedPins[a].couldBeShowing=!0;this.pinBubblesEnabled&&ws.widget.bubbleManager&&!this.hasBeenSeen(a)&&this.requestedPins[a].couldBeShowing&&ws.widget.bubbleManager.showPinBubble(a,g)},hidePinBubble:function(a,e){this.requestedPins[a]||(this.requestedPins[a]={});if(e)this.requestedPins[a].couldBeShowing=!1;this.pinBubblesEnabled&&ws.widget.bubbleManager&&ws.widget.bubbleManager.hidePinBubble(a)},
getOptionMenuLabel:function(){return this.allPinsSeen()?Config.Strings.PinBubble_ShowQT:Config.Strings.PinBubble_HideQT},loadHistory:function(){this.bubbleHistory={};if(typeof Settings.SeenFTUTips=="string"&&Settings.SeenFTUTips)this.bubbleHistory=b.fromJson(Settings.SeenFTUTips);if(this.bubbleHistory&&this.bubbleHistory.SeenFTUTips)this.historyList=this.bubbleHistory.SeenFTUTips.split(",")},saveHistory:function(){this.bubbleHistory.SeenFTUTips=this.historyList.join(",");ws.settings.saveNow({SeenFTUTips:this.bubbleHistory})},
saveAsSeen:function(a){b.indexOf(this.historyList,a)==-1&&this.historyList.push(a);this.saveHistory()},checkPinBubblesEnable:function(){this.pinGroupMap={};this.allConfigedPins=[];var a=this.canShowOtherBubbles=!1,e=!1;if(Config.BubblePinsEnabled)for(var b in Config.BubblePins)if(Config.BubblePins.hasOwnProperty(b)&&Config.BubblePins[b].group)e=Config.BubblePins[b].group,this.allConfigedPins.push(b),this.pinGroupMap[e]||(this.pinGroupMap[e]=[]),this.pinGroupMap[e].push(b),e=!0;if(e){b=!1;for(var g in this.pinGroupMap)this.pinGroupMap.hasOwnProperty(g)&&
(this.bubbleHistory[g]?this.allPinsSeen(this.pinGroupMap[g])||(this.bubbleHistory[g].timesSeen>=Config.BubblePinsExpireLogins?(a=!0,this.setAllPinsHistory(!1,this.pinGroupMap[g])):(this.bubbleHistory[g].timesSeen++,b=!0),Math.floor((new Date).getTime()/6E4)-this.bubbleHistory[g].firstSeenTime>=Config.BubblePinsExpireMinutes&&(a=!0,this.setAllPinsHistory(!1,this.pinGroupMap[g]))):(this.bubbleHistory[g]={firstSeenTime:Math.floor((new Date).getTime()/6E4),timesSeen:1},b=!0));(a||b)&&this.saveHistory();
if(this.allPinsSeen()){if(this.pinBubblesEnabled=!1,this.canShowOtherBubbles=!0,a)this.loadBubbleManager(function(){ws.widget.bubbleManager&&ws.widget.bubbleManager.showAllPinsClosedBubble()}),this.canShowOtherBubbles=!1}else this.pinBubblesEnabled=!0,this.canShowOtherBubbles=!1}else this.canShowOtherBubbles=!0},resetPinPref:function(){var a=this.allPinsSeen();this.setAllPinsHistory(a);if(a){ws.reporting.reportAction("Onboarding-pins-Show-All");this.pinBubblesEnabled=!0;for(var e in this.pinGroupMap)this.pinGroupMap.hasOwnProperty(e)&&
(this.bubbleHistory[e]={firstSeenTime:Math.floor((new Date).getTime()/6E4),timesSeen:1});this.loadBubbleManager(b.hitch(this,this.showRequestedPins))}else{ws.reporting.reportAction("Onboarding-pins-Hide-All");for(var f in this.requestedPins)this.requestedPins.hasOwnProperty(f)&&this.hidePinBubble(f);this.pinBubblesEnabled=!1}ws.widget.bubbleManager&&ws.widget.bubbleManager.allClosedBubble&&ws.widget.bubbleManager.allClosedBubble.hide(0);this.saveHistory()},showRequestedPins:function(){for(var a in this.requestedPins)this.requestedPins.hasOwnProperty(a)&&
this.showPinBubble(a)},loadBubbleManager:function(a){this.bmLoaded?a&&a():ws.WebSuite.ensureStartupPromoLayer(b.hitch(this,function(){this.bmLoaded=!0;ws.widget.bubbleManager.setUp();a&&a()}))},checkForBubblePins:function(){this.checkPinBubblesEnable();this.pinBubblesEnabled&&this.loadBubbleManager(b.hitch(this,this.showRequestedPins))},openFirstBubble:function(a){if((!this.welcomeDialogIsShown||a)&&this.pinBubblesEnabled)this.bmLoaded?(a=ws.widget.bubbleManager.getPinByName(this.openedPinId))?a.expandTip():
this.openedPinNeeded=!0:this.openedPinNeeded=!0}},ws.bubbleConfig.init();if(!b._hasResource["ws.WebSuite"])b._hasResource["ws.WebSuite"]=!0,b.provide("ws.WebSuite"),ws.WebSuite={isRecordTimingData:!0,todayPageLoaded:0,todayPageUnloaded:0,messageListTimerStart:0,messageListTimerEnd:0,messageReadTimerStart:0,messageReadTimerEnd:0,messageSize:0,pluginBarRenderTime:-1,topBarNoticeHeight:0,minContentHeight:250,minViewWidth:660,qaErrConsoleHeight:0,notificationSeen:!1,notificationMsg:null,deferComplete:Config.LoadLayersTimeout==
0,deferCompletedTime:!1,hashWidgets:{},settingsLoaded:{},isPanelSplitterInitializing:!1,wsObj:null,taskPanel:null,lastSelectedTab:null,isModalOpen:!1,startupDlgDone:!1,internalNotificationsActive:!1,externalNotificationInitilized:!1,cmpseMsgWidPersist:{lastSelFromAddr:null,selectedFromAddr:null},rmreqid:null,widthMode:4,heightMode:Settings.ListSpacingType,snippetsOn:!1,isSettingLoaded:function(a){return this.settingsLoaded.all||this.settingsLoaded[a]},_resize:function(){this.resize()},resize:function(){this.viewportSize=
b.window.getBox();this.widthMode=this.viewportSize.w<=800?1:this.viewportSize.w<=1024?2:this.viewportSize.w<=1200?3:4;if(this.isAutoSpacingEnabled){var a=this.getAutoSpacingType();if(a!=this.heightMode)b.removeClass(b.body(),"spacing"+this.heightMode),b.addClass(b.body(),"spacing"+a),this.heightMode=a,b.publish(["ListSpacingResize"])}a=Math.max(this.viewportSize.h-(this.hatHeight+this.topBarNoticeHeight+this.qaErrConsoleHeight),this.minContentHeight);this.browserUpgradeBar&&this.browserUpgradeBar.layout();
if(this.qaErrConsoleNode){var e=document.getElementById("FooterWidget");if(e)e.style.bottom=this.qaErrConsoleHeight+"px"}if(this.settingsWidget&&this.settingsWidget.isShowing())e=b.byId("ws_settings"),b.marginBox(e,{w:this.viewportSize.w,h:a}),b.marginBox(this.settingsWidget.domNode,{w:this.viewportSize.w,h:a}),this.settingsWidget.resize();else{b.marginBox("ws_application",{w:this.viewportSize.w,h:a});this.minViewWidth=this.widthMode==1?580:660;this.SidePanel.resize({h:a});var f=b._getMarginSize(this.Navigation.domNode).w,
g=this.SidePanel.isClosed()?0:b._getMarginSize(this.SidePanel.domNode).w;this.NavSplitterEl.style.left=f-this.NavSplitter.splitterMargin+"px";this.ViewWidget.domNode.style.left=f+this.navSplitterWidth+"px";e=Math.max(this.viewportSize.w-(f+this.navSplitterWidth+0+g),this.minViewWidth);f=e+g+f+this.navSplitterWidth;a-=f>this.viewportSize.w?this.scrollbarWidth:0;b.marginBox("ws_appScroll",{w:f,h:a});this.Navigation.resize({h:a});this.NavSplitter.setHeight(a);this.ViewWidget.resize({w:e,h:a})}},resizeViewWidgetWidth:function(){var a=
b._getMarginSize(this.Navigation.domNode).w,e=b._getMarginSize(this.SidePanel.domNode).w,f=Math.max(this.viewportSize.w-(a+this.navSplitterWidth+e),this.minViewWidth);setTimeout(b.hitch(this,function(){this.ViewWidget.resize({w:f})}),0)},splitSizer:function(a){a<140?a=42:a<181?a=180:a>340&&(a=340);return a},splitterResize:function(){this.resize()},windowResize:function(){b.isIE?ws.lang.defer(this,"_resize",100,"ws.WebSuite._resize"):this.resize()},getWSObj:function(){if(this.wsObj==null)this.wsObj=
document.location.toString().indexOf("Solo.aspx")>0?ws.CalSolo:ws.WebSuite;return this.wsObj},tracklm:function(a){ws.bootstrap&&ws.bootstrap.add&&ws.bootstrap.add("load_mail",a)},trackdl:function(a,e){ws.reporting&&ws.reporting.DL&&ws.reporting.DL.append&&ws.reporting.DL.append(a,e)},trackall:function(a,e){ws.bootstrap&&ws.bootstrap.add&&ws.bootstrap.add("load_mail",a);ws.reporting&&ws.reporting.DL&&ws.reporting.DL.append&&ws.reporting.DL.append(a,e)},initialize:function(){try{this.tracklm("-WS.Ia");
if(!Config.LogStatistics)this.isRecordTimingData=!1;ws.WebSuite._initialize()}catch(a){this.tracklm("-WS.Ib"),window.DisplayAppLoadError&&DisplayAppLoadError(a)}this.tracklm("-WS.Iz")},_initialize:function(){this.initialized=!0;this.tracklm("-WS._Ia");if(!this.scrollbarWidth)this.scrollbarWidth=ws.html.getScrollbar().w;this.theMailModel=ws.bootstrap.theMailModel;this.theMailModel.isLoading()?this.deferredInitHandle=b.connect(this.theMailModel,"modelUpdated",this,"deferredInit"):setTimeout(b.hitch(this,
"deferredInit"),100);b.connect(this.theMailModel,"inboxTypeUpdated",this,"inboxTypeUpdated");this.currentFolder=this.theMailModel.getInboxFolderName();ws.browser.addOnBeforeUnload(this,"onBeforeUnload");var a=ws.io.getQueryParameter("app")||ws.io.getQueryParameter("a");this.initGlobalUIPrefs();this.tracklm("-WS._Ib");b.parser.instantiate([b.byId("NavigationWidget")],{dojoType:"ws.suite.Navigation"});this.Navigation=k.byId("NavigationWidget");this.Navigation.setMailModel(this.theMailModel);this.Navigation.searchMailCB=
b.hitch(this,"mailSearch");this.Navigation.searchCalendarCB=b.hitch(this,"calendarSearch");this.Navigation.searchContactsCB=b.hitch(this,"contactsSearch");b.connect(this.Navigation,"displayFolder",this,"displayFolder");b.connect(this.Navigation,"composeMessage",this,"composeMessage");!a&&Config.EnableTodayCurtain&&Settings.ShowTodayAtSignIn&&window._ws_theme.hideLoadingCurtain();b.parser.instantiate([b.byId("ws_navsplitter")],{dojoType:"ws.widget.Splitter"});b.parser.instantiate([b.byId("ws_view")],
{dojoType:"dijit.layout.StackContainer"});this.ViewWidget=k.byId("ws_view");this.NavSplitter=k.byId("ws_navsplitter");this.NavSplitter.addSizerFunc(b.hitch(this,"splitSizer"));b.parser.instantiate([b.byId("SidePanel")],{dojoType:"ws.suite.SidePanel"});this.SidePanel=k.byId("SidePanel");b.addClass(b.body(),"spacing"+(this.isAutoSpacingEnabled?this.getAutoSpacingType():this.heightMode));this.browserUpgradeNotice();this.initializeSizing();this.tracklm("-WS._Ic");b.parser.instantiate([b.byId("HatWidget")],
{dojoType:"ws.suite.Hat"});this.HatWidget=k.byId("HatWidget");this.HatWidget.setMailModel(this.theMailModel);b.connect(this.HatWidget,"clickLogo",this,"clickLogo");this.HatWidget.openSettingsCB=b.hitch(this,"openSettings");this.tracklm("-WS._Id");b.parser.instantiate([b.byId("FooterWidget")],{dojoType:"ws.suite.Footer"});window.wsMasterTip=b._toDom("<div class='instatipCntr' style='visibility:hidden'><div id='instatip'></div><div class='mainSprite instatipArrow'></div></div>");b.body().appendChild(window.wsMasterTip);
if(a)this.deferComplete=!0,this.tracklm("-WS._Ie");else if(!this.parseAppQueryCmd()&&!this._tabSelected)Config.EnableTodayCurtain&&Settings.ShowTodayAtSignIn?(this.selectTab("todayPage",null,null,!0),this.tracklm("-WS._If")):(this.deferComplete=!0,this.selectTab("messageList",b.hitch(this,function(){window._ws_theme.hideLoadingCurtain()})),this.tracklm("-WS._Ig"),b.publish("Today/hide"),this.skipToday=!0,Settings.ShowTodayAtSignIn||ws.reporting.reportAction("Off Today Page At Sign In"));Settings.WSSConnectError?
(this.tracklm("-WS._Ih"),ws.widget.Dialogs.show(Config.Strings.WSSConnectErrorMessage+"<p>"+Config.Strings.TheMailTeam,[Config.Strings.OK],null,{width:400})):(Settings.FirstLogin?(Settings.FeatureNoticeVer=3,Config.WelcomeToMailTour&&this.openWelcomeFTE(),ws.settings.saveSoon({FirstLogin:!1,FirstTime2newUX:!1,FeatureNoticeVer:Settings.FeatureNoticeVer}),ws.bootstrap.add("-WS._Ii",1)):Settings.FirstTime2newUX?(Settings.FeatureNoticeVer=4,Config.Welcome2newUX&&this.openWelcomeFTE(),ws.settings.saveSoon({FirstTime2newUX:!1,
FeatureNoticeVer:Settings.FeatureNoticeVer})):Settings.FeatureNoticeVer<3?(Settings.FeatureNoticeVer=5,Config.Welcome2newUX&&this.openWelcomeFTE(),ws.settings.saveSoon({FeatureNoticeVer:Settings.FeatureNoticeVer})):(ws.WebSuite.startupDlgDone||(this.openFriendlyNameFTE(),this.tracklm("-WS._Ij")),ws.WebSuite.startupDlgDone||(this.openSignatureDialog(),this.tracklm("-WS._Ik")),ws.WebSuite.startupDlgDone||(this.openGetZipDialog(),this.tracklm("-WS._Il"))),ws.bubbleConfig.checkForBubblePins());b.isIE||
b.isWebKit?b.connect(b.body(),"onkeydown",this,"onKeyPress"):b.connect(b.doc,"onkeypress",this,"onKeyPress");ws.lang.ensureLayersLoaded(b.hitch(this,"onLayersLoaded"));a&&this.selectAppQueryString(a,b.hitch(window._ws_theme,window._ws_theme.hideLoadingCurtain));this.tracklm("-WS._Im");Settings.ShowTodayAtSignIn?b.subscribe("WSDeferredInit",this,"startNotification"):this.startNotification();this.tracklm("-WS._In");Config.LoadLayersTimeout>0&&setTimeout(b.hitch(this,function(){if(!this.deferComplete)this.deferCompletedTime=
new Date,this.deferComplete=!0;this.tracklm("-WS._Io");ws.lang.ensureLayersLoadedExtra(b.hitch(this,function(){Config.CreateDspMsgAtStartup&&(this.__ensureTabExists("displayMessage",null,!1),this.tracklm("-WS._Ir"));Config.CreateMsgListAtStartup&&(this._ensureTabExists("messageList",null,!1),this.tracklm("-WS._Ip"));!b.isFF&&Config.CreateComposeAtStartup&&(this.__ensureTabExists("composeMessage",null,!1),this.tracklm("-WS._Iq"))}),{layers:["ComposeMessage","DisplayMessage"]})}),Config.LoadLayersTimeout);
this.tracklm("-WS._Iz")},initGlobalUIPrefs:function(){Settings.ToolbarButtonType!=3&&b.addClass(b.body(),"btnLabelsOn2")},browserUpgradeNotice:function(){function a(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/Windows NT ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));return a}function e(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/Trident\/([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));return a}
var f=0,g,h,j,m,v,l,n;if(b.isFF){if(Settings.FfUpgradeBarDisplayed)return;h=b.isFF;j=Config.FireFoxUpgradeNoticeVersion;m=!0;v="browser_upgrade/logo_ff.gif";l=Config.Strings.FireFoxUpgradeNoticeMsg;n={FfUpgradeBarDisplayed:!0};g=Config.FireFoxUpgradeNoticeURL}else if(b.isIE){if(Settings.IEUpgradeBarDisplayed)return;l=e();h=b.isIE;l==5&&h<9&&(h=9);j=Config.IEUpgradeNoticeVersion;m=a()>=6;v="browser_upgrade/logo_ie.gif";l=Config.Strings.IEUpgradeNoticeMsg;n={IEUpgradeBarDisplayed:!0};g=Config.IEUpgradeNoticeURL}else return;
if(j)try{f=parseFloat(j)}catch(p){}if(f>0&&h<f&&m){var x=b.hitch(this,function(){b.style(document.getElementById("browserUpgradeNoticeBarDiv"),{display:"none"});b.style(document.getElementById("HatWidget"),{top:"0px"});b.style(document.getElementById("hatAdHolder"),{top:"0px"});this.topBarNoticeHeight=0;this._initializeSizing();var a=b.byId("ws_settings");if(a&&this.settingsWidget&&this.settingsWidget.domNode)a.style.top=this.hatHeight+this.topBarNoticeHeight+"px",b.marginBox(this.settingsWidget.domNode,
{w:this.viewportSize.w,h:this.viewportSize.h-(this.hatHeight+this.topBarNoticeHeight)});ws.settings.saveSoon(n);this.browserUpgradeBar=null});j=b.hitch(this,function(){var a=ws.io.openWindow(g);a&&a.focus();x()});b.style(document.getElementById("HatWidget"),{top:"30px"});b.style(document.getElementById("hatAdHolder"),{top:"30px"});this.topBarNoticeHeight=30;f=document.createElement("div");f.id="browserUpgradeNoticeBarDiv";b.style(f,{position:"absolute",top:"0px",left:"0px",right:"0px",height:"30px",
lineHeight:"22px"});b.style(f,{background:"url('"+Config.BaseImagesURL+"browser_upgrade/bg_tile.gif') top left repeat-x"});h=this.browserUpgradeBar=new ws.widget.WSToolbar({vizType:"Bare"});h.startup();m=new k._Widget({toolbarPosition:"center"});b.style(m.domNode,{width:"27px",height:"27px"});var q=document.createElement("img");b.style(q,{position:"relative",top:"-3px",cursor:"pointer",border:"0"});q.src=Config.BaseImagesURL+v;q.onclick=j;m.domNode.appendChild(q);h.addToolbarItem(m);v=new k._Widget({toolbarPosition:"center"});
b.style(v.domNode,{color:"#333",fontFamily:"arial",fontSize:"12px",cursor:"pointer"});v.domNode.innerHTML="&nbsp;&nbsp;"+l+"&nbsp;&nbsp;&nbsp;";v.domNode.onclick=j;h.addToolbarItem(v);l=new ws.widget.Button({toolbarPosition:"center",size:"Small"});l.setLabel("&nbsp;&nbsp;"+Config.Strings.FireFoxUpgradeNoticeBtn+"&nbsp;&nbsp;");l.onClick=j;l.startup();h.addToolbarItem(l);l=new k._Widget({toolbarPosition:"right"});b.addClass(l.domNode,"mainSprite wsCloseBtn");b.style(l.domNode,{position:"absolute",
top:"8px",right:"11px","float":"none",border:"0"});l.domNode.onclick=x;h.addToolbarItem(l);f.appendChild(h.domNode);document.body.appendChild(f);h.layout()}},initAwayMessageNotification:function(){this.tracklm("-WS.AMNa");ws.io.rpc({action:"GetSettings",automatic:!0,content:{scope:"awayMsg"},load:b.hitch(this,function(a){a.settings.AwayMessageNotificationSettingsAvailable&&a.settings.AwayMessageNotificationAvailable?(this.internalNotificationsActive=!0,this.createAwayNotificationMessage()):(this.skipAwayMessageNotification=
!0,this.startNotification());this.tracklm("-WS.AMNb")}),error:b.hitch(this,function(){this.skipAwayMessageNotification=!0;this.startNotification();this.tracklm("-WS.AMNc")})})},initExternalNotification:function(){var a=document.createElement("script");a.type="text/javascript";a.src=Config.NotificationURL+"?uiVariant="+Config.UIVariant.toLowerCase()+"&locale="+Config.PageLocale+"&host="+document.location.host;var e=b.hitch(this,function(){if(!this.externalNotificationInitilized)this.internalNotificationsActive=
!1,this.externalNotificationInitilized=!0,this.createExternalNotificationMessage()});a.onload=a.onerror=e;a.onreadystatechange=function(){(this.readyState=="loaded"||this.readyState=="complete")&&e()};document.getElementsByTagName("head")[0].appendChild(a)},startNotification:function(){!this.externalNotificationInitilized&&Config.EnableNotification&&Settings.UserHash>=Config.UserHashThresholds.notification&&Config.NotificationURL?this.initExternalNotification():!this.skipAwayMessageNotification&&
Config.EnableInternalNotification&&Config.EnableVacationSettings&&Settings.UserHash>=Config.UserHashThresholds.awayMsgNotification&&setTimeout(b.hitch(this,function(){this.initAwayMessageNotification()},Config.AwayNotificationTimeOut))},createAwayNotificationMessage:function(){this.notificationMsg={msg:ws.string.substituteParams(Config.Strings.AwayMessageNotification,'<span class="wsLink awayMessageOff">'+Config.Strings.AwayMessageNotificationOFF+"</span>",'<a class="wsLink awayMessageSettings">'+
Config.Strings.AwayMessageNotificationSettings+"</a>"),id:"awayMessage_1",type:"simplemanual",callback:b.hitch(this,function(a,e){b.query(".awayMessageSettings",a)[0].onclick=b.hitch(this,"openSettings","generalSettings",null);b.query(".awayMessageOff",a)[0].onclick=function(){ws.settings.saveNow({AwayMessageType:"Disabled"});e.close()}})};b.publish("WebSuite/StartNotification")},createExternalNotificationMessage:function(){if(typeof notificationMsgs!="undefined"&&notificationMsgs.length>0){var a=
notificationMsgs;if(a&&a.length){var e,f;seenNotificationIds=this.getNotificationsSeenIds();for(var g=0;g<a.length;g++){var h=a[g];if(!this.hasNotifcationBeenSeen(h.id))switch(h.type){case "simpleauto":case "simplemanual":e=e?e.priority>h.priority?h:e:h;break;case "modal":f=f?f.priority>h.priority?h:f:h}}f&&!Settings.FirstLogin&&!ws.WebSuite.startupDlgDone?(ws.widget.ModalNotification.startup({closeButton:f.closeButton,closeButtonText:f.closeButtonText,url:f.msg,box:{w:parseInt(f.width),h:parseInt(f.height)}}),
h=f):e?(this.notificationMsg=h=e,b.publish("WebSuite/StartNotification")):this.startNotification();if(h&&h.sticky)this.seenNotificationIds[ws.WebSuite.seenNotificationIds.length]=h.id,ws.settings.saveSoon({SeenNotificationMsgs:ws.WebSuite.seenNotificationIds})}}else this.startNotification()},getNotificationsSeenIds:function(){if(!this.seenNotificationIds)this.seenNotificationIds=b.fromJson(Settings.SeenNotificationMsgs)||[];return this.seenNotificationIds},hasNotifcationBeenSeen:function(a){return b.indexOf(this.getNotificationsSeenIds(),
a)!=-1},_showNotification:function(a){if((a.id=="todayPage"||a.id=="messageList")&&!this.notificationSeen)if(this.internalNotificationsActive)this.notificationSeen=!0,a.notification.msg.innerHTML=this.notificationMsg.msg,a.notification.alertTxt.innerHTML=this.notificationMsg.alertTxt||Config.Strings.NotificationHeadsUp,a.notification.closeBtn.style.display=this.notificationMsg.isCloseable?"":"none",this.notificationMsg.extraClassName&&b.addClass(a.notification.domNode,this.notificationMsg.extraClassName),
this.notificationMsg.callback&&this.notificationMsg.callback(a.notification.msg,a.notification),a.notification.show(),a.layoutWidget.resize(),b.subscribe("WebSuite/CloseNotification",a.layoutWidget,"resize");else if(Config.EnableNotification&&Settings.UserHash>=Config.UserHashThresholds.notification&&Config.NotificationURL){this.notificationSeen=!0;a.notification.msg.innerHTML=this.notificationMsg.msg;this.notificationMsg.type=="simpleauto"&&a.notification.autoDismiss(this.notificationMsg.timeout);
if(this.notificationMsg.callback)a.notification.closeBtn.style.display="none",this.notificationMsg.callback(a.notification.msg,a.notification);a.notification.show();a.layoutWidget.resize();b.subscribe("WebSuite/CloseNotification",a.layoutWidget,"resize")}},showNotification:function(a){this.notificationMsg?this._showNotification(a):b.subscribe("WebSuite/StartNotification",b.hitch(this,function(a){this._showNotification(a)},a))},openWelcomeFTE:function(a){ws.bubbleConfig.welcomeDialogIsShown=!0;this.ensureStartupPromoLayer(b.hitch(this,
function(){(new ws.suite.WelcomeDialog({firstTime2newUX:a})).startup()}));ws.WebSuite.startupDlgDone=!0},openFriendlyNameFTE:function(){if(Config.DisplayNamePromotionDialog&&!Settings.IsFriendlyNameDlgDisplayed&&Settings.UserHash>=Config.AllowedUserRangeForFriendlyNameDlg&&Settings.IsAuthUser&&b.trim(Settings.FromDisplayName)=="")Settings.UserFullName==""?(b.require("ws.layers.StartupPromoDlgs"),ws.presence.getPresence({users:ws.UserContext.ActiveScreenName,load:b.hitch(this,"_presenceResponse"),
timeout:1E4})):this.ensureStartupPromoLayer(b.hitch(this,function(){(new ws.suite.FriendlyNameDialog({fromName:Settings.UserFullName})).startup()})),ws.WebSuite.startupDlgDone=!0},_presenceResponse:function(a){var e="";a&&a.response&&a.response.statusCode&&a.response.statusCode==200&&a.response.data.users[0]&&a.response.data.users[0].friendly&&a.response.data.users[0].friendly!=""&&(e=b.trim(a.response.data.users[0].friendly));this.ensureStartupPromoLayer(b.hitch(this,function(){try{(new ws.suite.FriendlyNameDialog({fromName:e})).startup()}catch(a){}}));
ws.WebSuite.startupDlgDone=!0},openGetZipDialog:function(){if(Config.EnableGetZip&&!Settings.GetZipDlgDisplayed&&Settings.UserHash>=Config.UserHashThresholds.getZipDialog)this.ensureStartupPromoLayer(b.hitch(this,function(){(new ws.suite.GetZipDialog({initialZip:ws.UserContext.Zip||""})).startup()})),ws.WebSuite.startupDlgDone=!0},openSignatureDialog:function(){if(!Settings.SignatureDlgDisplayed&&Settings.UserHash>=Config.SignatureDlgThreshold)this.ensureStartupPromoLayer(b.hitch(this,function(){(new ws.suite.SignatureDialog).startup()})),
ws.WebSuite.startupDlgDone=!0},ensureStartupPromoLayer:function(a){this.startupPromoLayerLoad?a&&a():(b.require("ws.layers.StartupPromoDlgs"),b.addOnLoad(b.hitch(this,function(a){this.startupPromoLayerLoad=!0;a&&window.setTimeout(a,100)},a)))},getErrorCount:function(){var a=0;if(window.ws_ErrLgr&&window.ws_ErrLgr._errors&&window.ws_ErrLgr._errors.length)a=window.ws_ErrLgr._errors.length;return a},formatError:function(a,e){var f=["count","category","fileName","lineNumber","message","info","stack"];
e&&(f=["category","fileName","lineNumber","message","info","rpc","T","stack"]);result="";b.forEach(f,function(f){var h=!0;if(a[f]){switch(f){case "count":result+="<b>Error has occurred "+a[f]+" times </b>";break;case "category":e&&(h=!1);result+="Category: "+a[f];break;case "fileName":e&&(h=!1);result+="File: "+a[f];break;case "lineNumber":e&&(h=!1);result+="Line Number: "+a[f];break;case "message":e&&(h=!1);result+="Message: "+a[f];break;case "info":e&&(h=!1);result+="Additional Info: "+a[f];break;
case "rpc":e&&(h=!1,result+="Recent RPCs: "+a[f]);break;case "T":e&&(result+="Time(mSec from start): "+a[f]);break;case "stack":a[f].length&&(result+="Call Stack:<div style='padding-left:10px;'>",b.forEach(a[f],function(a){result+=a+"<br />"}),result+="</div>")}result+=h?"<br />":";  "}});return result},openErrorConsole:function(){var a=null;if(ws.WebSuite.getErrorCount())a=window.ws_ErrLgr._errors;if(a&&a.length){var e="";b.forEach(a,function(a){e+=ws.WebSuite.formatError(a);e+="<br />"});ws.widget.Dialogs.show("<div class='errorConsoleHeader'>"+
Config.Strings.ErrorConsoleHead+"</div><div class='errorConsole'><div class='consoleContent'>"+e+"</div></div>",[Config.Strings.OK],null,{width:690})}else ws.widget.Dialogs.ok("<div class='errorConsoleHeader'>"+Config.Strings.ErrorConsoleHead+"</div>"+Config.Strings.ErrorConsoleEmpty+"<br>",null,!1)},qaErrorConsoleToggle:function(a){if(a&&this.qaErrConsoleNode.style.display=="none")this.qaErrConsoleNode.style.display="block",this.qaErrConsoleHeight=70,this.resize();else if(!a&&this.qaErrConsoleNode.style.display==
"block")this.qaErrConsoleNode.style.display="none",this.qaErrConsoleHeight=0,this.resize()},qaErrorConsole:function(a){if(Config.QaErrorConsole)if(this.firstResize){if(!this.qaErrConsolePause&&!this.qaErrConsoleDisabled){if(!this.qaErrConsoleNode){this.qaErrConsoleCount=1;this.qaErrConsoleNode=document.createElement("div");this.qaErrConsoleNode.style.display="none";b.addClass(this.qaErrConsoleNode,"qaErrConsoleNode");document.body.appendChild(this.qaErrConsoleNode);this.qaErrConsole=document.createElement("div");
b.addClass(this.qaErrConsole,"qaErrConsole");this.qaErrConsoleNode.appendChild(this.qaErrConsole);var e=document.createElement("div");e.innerHTML="<div>WebSuite QA Error Console</div>";b.addClass(e,"info");this.qaErrConsoleNode.appendChild(e);var f=document.createElement("span");f.innerHTML="Clear";f.onclick=b.hitch(this,function(){this.qaErrConsole.innerHTML="";this.qaErrConsoleCount=1});b.addClass(f,"qaLink");e.appendChild(f);f=document.createElement("span");f.innerHTML="Close";f.onclick=b.hitch(this,
function(){this.qaErrorConsoleToggle(!1)});b.addClass(f,"qaLink");e.appendChild(f);f=document.createElement("br");e.appendChild(f);var g=document.createElement("span");g.innerHTML="Pause";g.onclick=b.hitch(this,function(){this.qaErrConsolePause=!this.qaErrConsolePause;g.innerHTML=this.qaErrConsolePause?"Resume":"Pause"});b.addClass(g,"qaLink");e.appendChild(g);f=document.createElement("span");f.innerHTML="Disable (for session)";f.onclick=b.hitch(this,function(){this.qaErrorConsoleToggle(!1);this.qaErrConsoleDisabled=
!0});b.addClass(f,"qaLink");e.appendChild(f)}this.qaErrorConsoleToggle(!0);this.qaErrConsole.innerHTML+="<b>"+this.qaErrConsoleCount+")</b> ";this.qaErrConsoleCount++;this.qaErrConsole.innerHTML+=ws.WebSuite.formatError(a,!0);this.qaErrConsole.scrollTop=999999}}else{if(!this.queErrors)this.queErrors=[];this.queErrors.push(a)}},promoteTheme:function(a){this.selectTab("messageList",b.hitch(this,function(){window._ws_theme.hideLoadingCurtain();this.HatWidget&&this.HatWidget.themePicker?this.HatWidget.themePicker.openThemePickerDialog(a,
!0):ws.widget.OkCancelDialog.alert(Config.Strings.Themes_NoThemesInConfig)}))},promoteStationery:function(a){Settings.ComposeInPopup?this.selectTab("messageList",b.hitch(this,function(){window._ws_theme.hideLoadingCurtain();this.PopupComposeTip||ws.lang.ensureLayersLoaded(b.hitch(this,function(){this.PopupComposeTip=new ws.widget.FTUTip({name:"StationeryPopupCompose",content:ws.string.substituteParams(Config.Strings.PopupComposeStationeryTip,"<a href='javascript:void(0)' style='font-weight: bold'>",
"</a>"),positionOverNode:this.HatWidget.settingsItem,arrowPosition:"top",distanceArrowFromEdge:190,dimensions:{w:240},offset:{x:110,y:30},saveAsSeenOnClose:!1});b.body().appendChild(this.PopupComposeTip.domNode);this.PopupComposeTip.startup();b.query("a",this.PopupComposeTip.domNode).onclick(function(){ws.WebSuite.openSettings("generalSettings")});this.PopupComposeTip.showTip();ws.WebSuite.targetStationery=a}))})):this.selectTab("composeMessage",b.hitch(this,function(e){window._ws_theme.hideLoadingCurtain();
e.reset({targetStationery:!0});e.launchStationery(a)}))},promoteSuite:function(a){var e="<b>"+Config.Strings.SuitePromotionHeader+"</b><br><ul style='margin:5px; padding-left:20px'>",f=null,g=null,h;for(h in a)if(a[h][1])switch(a[h][0]){case "tid":if(this.HatWidget&&this.HatWidget.themePicker){var j=a[h][1];if(j==this.HatWidget.themePicker.changeTheme(j)){var m=j;e+="<li>";e+=ws.string.substituteParams(Config.Strings.SuitePromotionTheme,m,"&nbsp;&nbsp;<a href='javascript:void(0)' class='changeTheme'>",
"</a>\n");e+="</li>";f=j}}break;case "sid":j=a[h][1],a[h][4]&&(j=a[h][4]),e+="<li>",e+=Settings.ComposeInPopup?ws.string.substituteParams(Config.Strings.SuitePromotionStationeryPopup,j,j,"<a href='javascript:void(0)' class='changeComposeSetting'>","</a>\n"):ws.string.substituteParams(Config.Strings.SuitePromotionStationery,j),e+="</li>",g=a[h][1]}g&&!Settings.ComposeInPopup?this.selectTab("composeMessage",b.hitch(this,function(a){this._promoteSuite(e,f,g,null);a.reset({targetStationery:!0});a.launchStationery(g,
!0)})):this.selectTab("messageList",b.hitch(this,function(){this._promoteSuite(e,f,g,null)}))},_promoteSuite:function(a,e){window._ws_theme.hideLoadingCurtain(a);ws.lang.ensureLayersLoaded(b.hitch(this,function(){this._showSuitePromotionTip(a,e);e&&this.HatWidget.themePicker.saveTheme()}))},_showSuitePromotionTip:function(a,e){if(!this.SuitePromotionTip)this.SuitePromotionTip=new ws.widget.FTUTip({name:"SuitePromotionTip",content:a,positionOverNode:this.HatWidget.settingsItem,arrowPosition:"top",
distanceArrowFromEdge:240,dimensions:{w:240},offset:{x:47,y:20},saveAsSeenOnClose:!1}),b.body().appendChild(this.SuitePromotionTip.domNode),this.SuitePromotionTip.startup(),b.query(".changeTheme",this.SuitePromotionTip.domNode).onclick(function(){ws.WebSuite.HatWidget.themePicker.openThemePickerDialog(e,!1)}),b.query(".changeComposeSetting",this.SuitePromotionTip.domNode).onclick(function(){ws.WebSuite.openSettings("generalSettings")});this.SuitePromotionTip.showTip()},parseAppQueryCmd:function(){var a=
ws.bootstrap.parseAppQueryCmd(),e=a.cmds,f=a.cmdMap;ws.io._setObjectCookie(a.cookie,Config.WSGadgetCookieName,Config.WSGadgetCookieDomain,Config.WSGadgetCookiePath);return e.length>1?(this.promoteSuite(f),!0):e.length==1?(a=f[e[0]][1],b.hitch(this,f[e[0]][2])(a),!0):!1},onLayersLoaded:function(){window.ws_ErrLgr&&ws_ErrLgr.doIntiialSend();var a=ws.io.getQueryParameter("app")||ws.io.getQueryParameter("a"),e=!1;if(a=="ab"||a=="abook"||a=="addresses")e=!0;this.theAddressModel=new ws.address.AddressModel({sortable:!0,
fullTextSearchable:!0,fetchDataOnInit:e});this.Navigation.setContactsModel(this.theAddressModel);this.theCalendarModel=new ws.calendar.CalendarViewModel({modelType:"event"});this.Navigation.setCalendarModel(this.theCalendarModel);k.byId("eventApp").init();this.Navigation.selectAppById(Settings.NavAppSelected,!0)},getCurrentViewId:function(){return this.ViewWidget?this.ViewWidget.selectedChildWidget?this.ViewWidget.selectedChildWidget.id:null:null},hideLoadingCurtain:function(){var a=b.byId("loadingCurtain");
if(a)a.style.display="none",b.destroy(a)},deferredInit:function(){this.tracklm("-WS.DIa");b.disconnect(this.deferredInitHandle);setTimeout(b.hitch(this,function(){b.publish("WSDeferredInit");this.deferredInitComplete=!0}),100);if(Config.EnableHatRevenueSearchBar)ws.reporting.report("Initial View","Init - Aim SearchBar Test");else{var a="Initial View - ";a+=Settings.MiniNavMode?"mini-nav":"full-nav";ws.reporting.report(a,"Init")}this.tracklm("-WS.DIz")},initializeSizing:function(){this.NavSplitterEl=
b.byId("ws_navsplitter");b.connectPublisher("wsresize",ws.WebSuite,"resize");b.subscribe("WSSessionExpired",ws.WebSuite,"handleExpiredSession");this.navSplitterWidth=this.NavSplitter.splitterWidth;this._initializeSizing();b.connect(window,"onresize",this,"windowResize");ws.browser.ipad&&b.connect(window,"onorientationchange",this,"windowResize");b.subscribe("Splitter/resize",this,"splitterResize")},_initializeSizing:function(){this.hatHeight=70;this.resize();this.firstResize=!0;if(this.queErrors&&
this.queErrors.length){for(;this.queErrors.length;)this.qaErrorConsole(this.queErrors.shift());this.queErrors=null}},displayFolder:function(a,e){var f=this.theMailModel.currentFolder;this.selectTab("messageList",b.hitch(this,function(b){b.displayFolder(a,null,null,e);ws.reporting.report(f==a?"Message List":"Switch Folder","Mail")}))},clickLogo:function(){var a=!1,e=this.settingsWidget;e&&e.isShowing()&&(e.onExitSettings(null,!0),a=!0);Config.EnableTodayCurtain?this.showTodayPage(a):this.selectTab("messageList",
b.hitch(this,function(e){folder=this.theMailModel.getInboxFolderName();e.displayFolder(folder);a||ws.reporting.report("Message List","Mail")}))},checkMail:function(){var a=this.settingsWidget,e=!0;a&&a.isShowing()&&(a.onExitSettings(null,!0),e=!1);this.selectTab("messageList",b.hitch(this,function(a){folder=this.theMailModel.getInboxFolderName();a.displayFolder(folder,null,null,null,!0);this.ViewWidget.selectedChildWidget.show();this.ViewWidget.selectedChildWidget.onShow(!0);e&&ws.reporting.report("Check Mail",
"Mail")}));b.publish("Hat/CheckMail")},handleComet:function(a){this.theMailModel.refetchFolderIndex(a.data.folder_name)},displayContactListView:function(a,e){this.selectTab("AddressList",function(b){b.backToList(a);b.scrollToRow(0);b.searchTimer&&clearTimeout(b.searchTimer);typeof e!="string"&&(e=void 0);b.search(e)})},displayNewContactView:function(a){this.selectTab("AddressList",function(e){e.selectView("editContactWidget",!1,!0);e.editContactWidget.showContact(null,null,!0);if(a)e.editContactWidget.email1Input.value=
a})},displayNewDistListView:function(){this.selectTab("AddressList",function(a){a.newDistributionList()})},setLastReadMsg:function(a,e){this.lastReadMsg={folder:a,uid:e}},previewPaneToLastReadMsg:function(a){if(Settings.EnablePreviewPane&&Settings.PreviewPaneVisible&&a.previewPane&&this.lastReadMsg){var e=this.lastReadMsg.folder,b=this.lastReadMsg.uid;a.model.currentFolder==e&&a.previewPane.uid==b?ws.reporting.report("Read Message -  Preview Pane","Mail"):a.model.currentFolder!=e?a.model.deselectAll():
a.previewMessage(b,!1,!0,!0)}},openMessage:function(a,e,b){var b=ws.settings.allowPopups()&&(b||Settings.ReadInPopup),g=this.theMailModel.getUidData(e),g=ws.reporting.DL.startEvent(g!=null&&g[this.theMailModel.columns.Attachment]?"read_mail_att":"read_mail",e,{opData:e,op1:b?"popup":"inline"});this.trackdl("-WS.OMa",e);this.rmreqid=g;b?this._openMessagePopup(a,e):this._openMessageInline(a,e);this.trackdl("-WS.OMz",e)},_openMessagePopup:function(a,e){this.trackdl("-WS._OMPa",e);window.openerContext=
{model:this.theMailModel,folder:a,uid:e,Settings:Settings,undoFeedbackPopup:b.hitch(this,"undoFeedbackPopup"),calendarDataUpdated:function(){b.publish("CalendarViewModel/modelUpdated")},webSuite:ws.WebSuite};ws.WebSuite.lastReadPopUp=ws.io.openWindow(Config.BaseMailPagesURL+"DisplayMessage.aspx?ws_popup=true","","status=yes,resizable=yes,left=5,top=5,width=885,height=606");var f=ws.WebSuite.lastReadPopUp;try{f.attachEvent?f.attachEvent("onbeforeunload",b.hitch(this,"_onbeforeunload",e)):f.onbeforeunload=
b.hitch(this,"_onbeforeunload",e)}catch(g){}this.trackdl("-WS._OMPz",e)},_onbeforeunload:function(a){ws.reporting.DL.removeEvent(a)},_openMessageInline:function(a,e){this.trackdl("-WS._OMIa",e);this.displayMessageBackTo=this.ViewWidget.selectedChildWidget.id=="AddressList"?"AddressList":"messageList";this._ensureTabExists("displayMessage",b.hitch(this,function(f){f.displayMessage(a,e,b.hitch(this,function(){this.trackdl("-WS._OMIb",e);this.selectTab("displayMessage")}))}));this.trackdl("-WS._OMIz",
e)},hideMessage:function(a,e,f,g){var h=this.displayMessageBackTo;this.selectTab(this.displayMessageBackTo,b.hitch(this,function(){if(h=="messageList"&&(a||ws.reporting.report("Message List","Mail"),setTimeout(function(){var a=k.byId("messageList");e!=-1&&a.scrollIntoView(e)},0),f)){var b=k.byId("messageList");Settings.EnablePreviewPane&&Settings.PreviewPaneVisible&&(g?b.model.deselectAll():b.previewMessage(f,!1,!0,!0))}}))},setDispMessageSafe:function(a,e){if(!this.safeMsgMap)this.safeMsgMap={};
this.safeMsgMap[a]||(this.safeMsgMap[a]=0);this.safeMsgMap[a]|=e?1:2},isDispMessageSafe:function(a,e){var b=!1;this.safeMsgMap&&this.safeMsgMap[a]&&(b=e?(this.safeMsgMap[a]&1)==1:(this.safeMsgMap[a]&2)==2);return b},undoFeedbackPopup:function(a,e,f,g,h){var j=null;switch(a){case "Spam":j=e.canUndo?b.hitch(this.theMailModel,"undoReportSpamMessages",e.responseUIDs):null;break;case "Move":j=e.canUndo&&g&&typeof g=="string"?b.hitch(this.theMailModel,"undoMoveMessages",e.responseUIDs,g,h):null;break;case "Delete":e.canUndo&&
g&&b.isArray(g)&&(!Config.UseOMS&&(Config.EnableRestoreButton||Settings.ViewNewOld)?(g=g[0],j=b.hitch(this,"_restoreMessage",g)):e.responseUIDs&&(j=b.hitch(this.theMailModel,"undoMoveMessages",e.responseUIDs,Config.DeletedItemsFolderName)));break;default:j=null}b.publish("WSFeedbackStart",[f,!0,j])},_restoreMessage:function(a){typeof a=="string"&&(a=[].concat(a));this.theMailModel.restoreMessages({uids:a,folder:Config.DeletedItemsFolderName,load:b.hitch(this,function(){this.theMailModel.refetchFolderIndex(this.theMailModel.currentFolder);
b.publish("WSFeedbackStart",[Config.Strings.MessageRestored,!0])}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for theMailModel.restoreMessages-_restoreMessage file:WebSuite.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorRestoring)}})},composeMessage:function(a){this._composeMessage(a);b.publish("Hat/ComposeMessage")},_composeMessage:function(a){if(ws.settings.allowPopups()&&(a&&(a.ctrlKey||b.isMac&&a.metaKey)||Settings.ComposeInPopup))this.popupCompose(b.hitch(this,
function(a){k.byId("AddressList")?a.reset(this.getContacts()):a.reset()}));else{var e=!1,f=this.settingsWidget;f&&f.isShowing()&&(f.onExitSettings(null,!0,!0),e=!0);this.composeSrc="messagelist";this.selectTab("composeMessage",b.hitch(this,function(a){var b;if(k.byId("AddressList")){b=this.getContacts();if(ws.WebSuite.targetStationery)b.targetStationery=!0;a.reset(b);this.unselectContacts()}else{b={backToString:"setFolder",skipComposeBeacon:e};if(ws.WebSuite.targetStationery)b.targetStationery=!0;
a.reset(b)}ws.WebSuite.targetStationery&&a.launchStationery(ws.WebSuite.targetStationery)}))}a&&a.preventDefault()},setSelectedStationery:function(){},getCompose:function(a,e,f){(Settings.ComposeInPopup||f)&&ws.settings.allowPopups()?this.popupCompose(e):ws.lang.ensureLayersLoaded(b.hitch(this,function(){this.selectTab("composeMessage",b.hitch(this,function(b){this.composeSrc=a;e(b)}))}))},reuseComposeWindow:function(a,e){k.byId("composeMessage").addEmail(a,e)},isComposeOpen:function(){if(this.getCurrentViewId()==
"composeMessage"){var a=k.byId("composeMessage");return a.layoutWidget==a.stackWidget.selectedChildWidget}else return!1},getContacts:function(){var a={backToString:"setFolder"};if(k.byId("AddressList").model.getSelectedUids().length){for(var e=k.byId("AddressList"),b=e.model.getActiveAbList(),e=e.model.getOffsetsForUids(e.model.getSelectedUids()),g=null,h=g="",j=0;j<e.length;j++)g=b.getRecordAtOffset(e[j]),(g=g.email1||g.email2||g.composeValue||g.screenName||"")&&(h+=g+", ");if(h)a.to=h,a.isDirty=
!0}return a},unselectContacts:function(){this.theAddressModel&&this.theAddressModel.deselectAll()},isComposeInTransition:function(){return this.isComposeOpen()&&k.byId("composeMessage").inTransition},popupCompose:function(a){window.composeContext={model:this.theMailModel,callback:a};ws.io.openWindow(Config.BaseMailPagesURL+"ComposeMessage.aspx?ws_popup=true","","status=yes,resizable=yes,left=5,top=5,width=885,height=606")},onBeforeUnload:function(){try{for(var a=0;a<ws.io._childWindows.length;a++)if(ws.io._childWindows[a].CM){var e=
ws.io._childWindows[a].CM.composeWidget.onBeforeUnload();if(e)return e}}catch(b){}return""},hideCompose:function(a,e,b){this.composeCanceled=!0;this.composeSrc=="address"?this.selectTab("AddressList",function(){var e=k.byId("AddressList");e&&e.deSelectEmptyPane();a&&a();ws.reporting.skipBeaconReporting=!b;ws.reporting.report("Contact List","Addresses")}):this.composeSrc=="display"&&!e?this.selectTab("displayMessage",function(){a&&a()}):this.composeSrc=="calendar"?(ws.reporting.skipBeaconReporting=
!b,this.Navigation.showCalendar(!0,a)):this.selectTab("messageList",function(){a&&a();ws.reporting.skipBeaconReporting=!b;ws.reporting.report("Message List","Mail")});this.composeCanceled=!1;this.Navigation.updateNavCollapser(!0)},clearSearch:function(){this.Navigation.clearSearch()},goToPreClearTab:function(){this.lastSelectedTab=="messageList"&&this.theMailModel.setFolder(this.currentFolder);if(this.lastSelectedTab=="composeMessage")this.lastSelectedTab="messageList";this.lastSelectedTab&&this.selectTab(this.lastSelectedTab)},
setFolderHistory:function(){this.lastSelectedTab=this.getCurrentViewId();this.currentFolder=this.theMailModel.currentFolder},mailSearch:function(a,e){ws.reporting.DL.startEvent("search_mail","search_mail",{opData:"WS.MSa"});var b=this.getCurrentViewId();this.lastSelectedTab=b;b!="messageList"&&b!="displayMessage"&&this.theMailModel.setFolder(this.theMailModel.getInboxFolderName());this.currentFolder=this.theMailModel.currentFolder;this.trackdl("-WS.MSb","search_mail");this.theMailModel.search(e,a);
this.trackdl("-WS.MSc","search_mail");this.selectTab("messageList",function(){ws.reporting.report("Search Mail","Mail");ws.WebSuite.trackdl("-WS.MSd","search_mail")})},contactsSearch:function(a){this.currentFolder=this.theMailModel.currentFolder;this.lastSelectedTab=this.getCurrentViewId();this.Navigation.showContacts(a)},calendarSearch:function(a,e){var b=this.getCurrentViewId();this.currentFolder=this.theMailModel.currentFolder;this.lastSelectedTab=b;if(b=k.byId("calendarView")){if(b!=this.ViewWidget.selectedChildWidget)b.fromCalSearch=
!0}else this.fromCalSearch=!0;this.selectTab("calendarView",function(b){b.selectSearchViewWithArg(a,e)})},addToCalendar:function(a,e){this.theMailModel.getMessage({folder:a,uid:e,load:b.hitch(this,function(a){ws.WebSuite.createAddEditWidget(b.hitch(this,function(){var e=ws.html.getText(a.body);this.addEditDialog.show(2,{summary:a.subject,notes:e})}))})})},repaintApplication:function(){var a=this.getCurrentViewId();if(a=="calendarView")k.byId("calendarView").repaint();else if(a=="messageList")this._inboxTypeUpdated?
(this.displayFolder(this.theMailModel.getInboxFolderName()),this._inboxTypeUpdated=!1):!Settings.ViewNewOld&&(this.theMailModel.currentFolder=="NewMail"||this.theMailModel.currentFolder=="OldMail")?this.displayFolder(this.theMailModel.getInboxFolderName()):Settings.ViewNewOld&&this.theMailModel.currentFolder=="Inbox"&&this.displayFolder(this.theMailModel.getInboxFolderName());else if(a=="AddressList")k.byId("AddressList").onResized()},inboxTypeUpdated:function(){this._inboxTypeUpdated=!0},editContact:function(a,
e,f){var g=k.byId("AddressList");g&&g.editContactWidget?this.selectTab("AddressList",function(){g.editContact(a,e,f)}):this._ensureTabExists("AddressList",b.hitch(this,function(b){b.createEditContactWidget();this.selectTab("AddressList",function(){b.editContact(a,e,f)})}))},createDistList:function(){this.selectTab("AddressList",b.hitch(this,function(a){a.newDistributionList()}))},showContactDetails:function(a){var e=k.byId("AddressList");e&&e.contactDetails?this.setupContactDetailsView(e,a):this._ensureTabExists("AddressList",
b.hitch(this,function(e){this.setupContactDetailsView(e,a)}))},setupContactDetailsView:function(a,e){a.selectView("contactDetails",!1);setTimeout(b.hitch(this,"showContactDetailsView",a,e),0)},showContactDetailsView:function(a,e){this.selectTab("AddressList",function(){});a.showContactDetails(e)},editContactFromMessageList:function(a){ws.lang.ensureLayersLoaded(b.hitch(this,function(){this.theAddressModel.getContact({uid:a.uid,load:b.hitch(this,function(e){this.editContact(a.uid,e,!0)})})}))},editDistributionList:function(a){var e=
k.byId("AddressList");e&&e.distributionListWidget?this.selectTab("AddressList",function(){e.editDistributionList(a)}):this._ensureTabExists("AddressList",b.hitch(this,function(e){e.createDistributionList();this.selectTab("AddressList",function(){e.editDistributionList(a)})}))},sharedGroup:function(a){this.selectTab("AddressList",function(e){e.sharedGroup(a)})},selectCalendarApp:function(a){this._selectCalendarApp(a)},_selectCalendarApp:function(a){this.selectTab("calendarView",b.hitch(this,function(e){window._ws_theme.hideLoadingCurtain();
e.update(!0);a&&a()}))},selectAppQueryString:function(a,e){var f=null;if(a)if(a=="ab"||a=="abook"||a=="addresses")f="AddressList";else if(a=="calendar"||a=="cal")f="calendarView";else if(a=="mail"||a=="p"){var f="messageList",g=ws.io.getQueryParameter("folder")||this.theMailModel.getInboxFolderName(),h=ws.io.getQueryParameter("searchIn"),j=ws.io.getQueryParameter("query");j==null&&h==null&&g==this.theMailModel.getInboxFolderName()||this.theMailModel.setFolder(g,j,h)}f&&("calendarView"==f?setTimeout(b.hitch(this,
function(){this.Navigation.showCalendar(!0)},0)):f!="messageList"?setTimeout(b.hitch(this,function(){ws.lang.ensureLayersLoadedSoon(b.hitch(this,function(){this.selectTab(f,e)}))},0)):setTimeout(b.hitch(this,function(){this.selectTab(f,e)},0)));b.publish("Today/hide");ws.WebSuite.skipToday=!0},selectTab:function(a,e,f,g){if(!g)this.deferComplete=!0;a=="displayMessage"&&this.trackdl("-WS.STa",this.rmreqid);this._tabSelected=!0;this.getCurrentViewId()=="todayPage"&&a!="todayPage"&&this.ViewWidget.selectedChildWidget.blockAds(!1);
f?a==this.getCurrentViewId()&&a!="composeMessage"?e&&e(this.ViewWidget.selectedChildWidget):this._ensureTabExists(a,e,!0):this.confirmClose(b.hitch(this,function(){a==this.getCurrentViewId()&&a!="composeMessage"?e&&e(this.ViewWidget.selectedChildWidget):this._ensureTabExists(a,e,!0)}),a)},_ensureTabExists:function(a,e,f){this._currentTab=a;if(a=="todayPage"){if(!this.TodayPage)this.TodayPage=new ws.suite.TodayPage({id:a,blockedAdIds:["HatAd","PanelAd"],mailModel:this.theMailModel}),this.ViewWidget.addChild(this.TodayPage);
f&&this.ViewWidget.selectChild(this.TodayPage);e&&e();this.showNotification(this.TodayPage)}else a=="messageList"?ws.mail.MessageListView&&Settings.ShowTodayAtSignIn?this.__ensureTabExists(a,e,f):(b.require("ws.layers.MessageList"),b.addOnLoad(b.hitch(this,function(){setTimeout(b.hitch(this,"__ensureTabExists",a,e,f),0)}))):a=="displayMessage"?(this.trackdl("-WS._ETc",this.rmreqid),ws.lang.ensureLayersLoadedExtra(b.hitch(this,"__ensureTabExists",a,e,f),{layers:["DisplayMessage"]})):a=="composeMessage"?
ws.lang.ensureLayersLoadedExtra(b.hitch(this,"__ensureTabExists",a,e,f),{layers:["ComposeMessage"]}):a=="calendarView"||a=="addCalendar"||a=="subscribeCalendar"||a=="editCalendar"?ws.lang.ensureLayersLoadedExtra(b.hitch(this,"__ensureTabExists",a,e,f),{layers:["CalFull"]}):ws.lang.ensureLayersLoaded(b.hitch(this,"__ensureTabExists",a,e,f))},__ensureTabExists:function(a,e,f){if(a!=this._currentTab&&f)a=="displayMessage"&&this.trackdl("-WS.__Ea",this.rmreqid);else{var g=k.byId(a);b.isFF&&a=="composeMessage"&&
g&&(g.toolbar.destroy(),this.ViewWidget.removeChild(g),g.destroyRecursive(),this.hashWidgets[a]&&(this.hashWidgets[a]=null),g=null);if(b.hasClass(this.Navigation.mnSearch,"mnSearchActive")&&this.Navigation.isMini)if(a=="composeMessage")this.Navigation.mnSearch.style.display="none";else if(a=="messageList")this.Navigation.mnSearch.style.display="block",g&&b.addClass(g.searchInfoPane.domNode,"searchInfoMini");!this.hashWidgets[a]&&!g?(this.hashWidgets[a]=(new Date).getTime(),f&&b.publish("WSFeedbackStart",
[Config.Strings.Loading]),setTimeout(b.hitch(this,function(){try{var h={id:a};switch(a){case "messageList":g=new ws.mail.MessageListView(h);g.setModel(this.theMailModel);g.getComposeCB=b.hitch(this,"getCompose","messagelist");g.openMessageCB=b.hitch(this,"openMessage");b.connect(g,"addContact",this,"displayNewContactView");b.connect(g,"editContact",this,"editContactFromMessageList");b.connect(g,"addToCalendar",this,"addToCalendar");Settings.ShowTodayAtSignIn||this.theMailModel.modelUpdated();break;
case "displayMessage":this.trackdl("-WS.__Eb",this.rmreqid);h.model=this.theMailModel;h.backToListCB=b.hitch(this,"hideMessage");h.getComposeCB=b.hitch(this,"getCompose","display");h.getAddEditWidgetCB=b.hitch(this,"getAddEditWidget");h.addEditDialog=this.addEditDialog;h.calendarModel=this.theCalendarModel;h.beaconSuffix="Inline";h.undoFeedbackCB=b.hitch(this,"undoFeedbackPopup");g=new ws.mail.DisplayMessageWidget(h);break;case "composeMessage":h.model=this.theMailModel;h.cancelCB=b.hitch(this,"hideCompose");
h.beaconSuffix="Inline";g=new ws.mail.ComposeMessageWidget(h);break;case "AddressList":g=new ws.address.AddressListView(h);g.setModel(this.theAddressModel);g.getComposeCB=b.hitch(this,"getCompose","address");break;case "calendarView":if(!ws.WebSuite.isSettingLoaded("cal")){this.hashWidgets.calendarView=null;ws.settings.load({scope:"cal",load:b.hitch(this,"_ensureTabExists",a,e,f),error:function(){ws.widget.Dialogs.ok(Config.Strings.Cal_ServiceTemporarilyUnavailable)}});return}g=new ws.calendar.CalendarViewWidget(h);
g.fromCalSearch=this.fromCalSearch;g.setModel(this.theCalendarModel);g.getAddEditWidgetCB=b.hitch(this,"getAddEditWidget");g.getComposeCB=b.hitch(this,"getCompose","calendar");g.getEventQuickViewWidgetCB=b.hitch(this,"getEventQuickViewWidget");g.getQuickAddWidgetCB=b.hitch(this,"getQuickAddWidget");g.showCalendarIndexCB=b.hitch(g,"isUpcomingView");break;case "addCalendar":g=new ws.calendar.AddCalendar(h);g.closeCB=b.hitch(this.Navigation,"showCalendar",!0);g.setModel(this.theCalendarModel);break;
case "editCalendar":h.editCalendar=!0;g=new ws.calendar.EditCalendar(h);g.closeCB=b.hitch(this.Navigation,"showCalendar",!0);g.setModel(this.theCalendarModel);break;case "subscribeCalendar":h.editCalendar=!1,g=new ws.calendar.SubscribeCalendar(h),g.closeCB=b.hitch(this.Navigation,"showCalendar",!0),g.setModel(this.theCalendarModel)}}catch(j){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"Exception: create new tab: "+a+" WebSuite.js::__ensureTabExists",j.name+" "+j.message)}this.ViewWidget.addChild(g);
f&&(this.updateSearchButton(a),this.ViewWidget.selectChild(g));e&&(this.trackdl("-WS.__Ec",a=="displayMessage"?this.rmreqid:null),e(g));f&&(this.showNotification(g),b.publish("WSFeedbackEnd",[Config.Strings.Loading]))}),0)):g?(f&&(this.trackdl("-WS.__Ee",a=="displayMessage"?this.rmreqid:null),this.updateSearchButton(a),this.ViewWidget.selectChild(g)),e&&(this.trackdl("-WS.__Ed",a=="displayMessage"?this.rmreqid:null),e(g))):this.hashWidgets[a]&&(new Date).getTime()-this.hashWidgets[a]>3E3&&(this.trackdl("-WS.__Ef",
a=="displayMessage"?this.rmreqid:null),this.hashWidgets[a]=null)}},updateSearchButton:function(a){a=="calendarView"||a=="editCalendar"||a=="addCalendar"||a=="subscribeCalendar"?Config.ShowCalendarSearchButton&&this.Navigation.setSearchScope("calendar",Config.Strings.Calendar):a=="AddressList"?this.Navigation.setSearchScope("contacts",Config.Strings.Contacts):this.Navigation.searchScope&&(this.Navigation.searchScope=="calendar"||this.Navigation.searchScope=="contacts")&&this.Navigation.clearSearch()},
getAddEditWidget:function(a){this.addEditDialog?a&&a(this.addEditDialog):(b.publish("WSFeedbackStart",[Config.Strings.Loading]),setTimeout(b.hitch(this,"createAddEditWidget",b.hitch(this,function(){a&&a(this.addEditDialog);b.publish("WSFeedbackEnd",[Config.Strings.Loading])})),10))},createAddEditWidget:function(a){ws.lang.ensureLayersLoadedExtra(b.hitch(this,function(){this.addEditDialog=new ws.calendar.AddEventDialog;this.addEditDialog.startup();this.addEditDialog.hide();this.addEditDialog.setModel(this.theCalendarModel);
b.body().appendChild(this.addEditDialog.domNode);a&&a()}),{layers:["CalFull"]})},getEventQuickViewWidget:function(a){this.eventQuickViewWidget?a&&a(this.eventQuickViewWidget):(b.publish("WSFeedbackStart",[Config.Strings.Loading]),setTimeout(b.hitch(this,"createEventQuickViewWidget",b.hitch(this,function(){a&&a(this.eventQuickViewWidget);b.publish("WSFeedbackEnd",[Config.Strings.Loading])})),0))},createEventQuickViewWidget:function(a){ws.lang.ensureLayersLoadedExtra(b.hitch(this,function(){var e={getAddEditWidgetCB:b.hitch(this,
"getAddEditWidget")};this.eventQuickViewWidget=new ws.calendar.EventQuickViewWidget(e);this.eventQuickViewWidget.startup();this.eventQuickViewWidget.setModel(this.theCalendarModel);b.body().appendChild(this.eventQuickViewWidget.domNode);a&&a()}),{layers:["CalFull"]})},getQuickAddWidget:function(a){this.quickAddWidget?a&&a(this.quickAddWidget):(b.publish("WSFeedbackStart",[Config.Strings.Loading]),setTimeout(b.hitch(this,"createQuickAddWidget",b.hitch(this,function(){a&&a(this.quickAddWidget);b.publish("WSFeedbackEnd",
[Config.Strings.Loading])})),0))},createQuickAddWidget:function(a){ws.lang.ensureLayersLoadedExtra(b.hitch(this,function(){var e={getAddEditWidgetCB:b.hitch(this,"getAddEditWidget")};this.quickAddWidget=new ws.calendar.QuickAdd(e);this.quickAddWidget.startup();this.quickAddWidget.setModel(this.theCalendarModel);b.body().appendChild(this.quickAddWidget.domNode);a&&a()}),{layers:["CalFull"]})},editCalendar:function(a){this._ensureTabExists("editCalendar",b.hitch(this,function(e){e.getCalId()==a?e.isShowing()||
this.selectTab("editCalendar"):e.isShowing()?e.confirmSwitchEditCalendar(a):(e.setCalId(a),this.selectTab("editCalendar"))}))},addCalendar:function(){this._ensureTabExists("addCalendar",b.hitch(this,function(){this.selectTab("addCalendar")}))},subscribeCalendar:function(){this._ensureTabExists("subscribeCalendar",b.hitch(this,function(){this.selectTab("subscribeCalendar")}))},showTodayPage:function(a){this._showTodayPage(a)},_showTodayPage:function(a){this.selectTab("todayPage",function(){a||ws.reporting.report("Today Page",
"Today")})},handleExpiredSession:function(a,e,f){if(Config.UsingThirdPartyAuth)window.location.replace(Config.SessionExpiryURL);else{if(!e)e=ws.UserContext.ActiveScreenName;(!this.miniLoginWidget||!this.miniLoginWidget.isShowing())&&ws.lang.ensureLayersLoaded(b.hitch(this,function(){if(!this.miniLoginWidget)this.miniLoginWidget=new ws.suite.MiniLogin,this.miniLoginWidget.startup();ws.widget.popup.closeAllPopups();this.miniLoginWidget.show(a,Config.SessionExpiryURL,f,e);this.miniLoginWidget.moveOffscreen();
var g=this.ViewWidget.selectedChildWidget;if(g.onSessionExpired)g.onSessionExpired(b.hitch(this.miniLoginWidget,"moveOnscreen"));else this.miniLoginWidget.moveOnscreen()}))}},isCalendarHidden:function(){return"calendarView"!=this.getCurrentViewId()},confirmClose:function(a,e){var b=this.ViewWidget.selectedChildWidget;b&&b.confirmClose?b.confirmClose(a,e):a&&a()},openSettings:function(a,e){this.confirmClose(b.hitch(this,function(){ws.lang.ensureLayersLoadedExtra(b.hitch(this,function(){var f=k.byId("composeMessage");
if(f&&f.isShowing()&&(f.resetDirty(),this.selectTab("messageList",null,!0),b.isIE))f.domNode.style.display="block",f.domNode.style.display="none";var f=b.byId("ws_application"),g=b.byId("ws_settings");if(!this.settingsWidget)b.publish("WSFeedbackStart",[Config.Strings.Loading]),this.settingsWidget=new ws.settings.SettingsContainer({id:"settingsContainer",settingsExitCallback:b.hitch(this,"exitSettings")}),g.appendChild(this.settingsWidget.domNode),this.settingsWidget.startup();f.style.display="none";
g.style.top=this.hatHeight+this.topBarNoticeHeight+"px";g.style.left="0px";g.style.display="";b.marginBox(g,{w:this.viewportSize.w,h:this.viewportSize.h-(this.hatHeight+this.topBarNoticeHeight)});b.marginBox(this.settingsWidget.domNode,{w:this.viewportSize.w,h:this.viewportSize.h-(this.hatHeight+this.topBarNoticeHeight)});this.settingsWidget.loadAndShow(a?a:"generalSettings",function(){b.publish("WSFeedbackEnd",[Config.Strings.Loading]);e&&e()});this.ViewWidget.selectedChildWidget?(this.ViewWidget.selectedChildWidget.hide(),
this.ViewWidget.selectedChildWidget.onHide()):setTimeout(b.hitch(this,function(){this.ViewWidget.selectedChildWidget.hide();this.ViewWidget.selectedChildWidget.onHide()}),0);this.SidePanel.hide();b.publish("Settings/show")}),{layers:["Settings"]})}),"settings")},exitSettings:function(a){var e=this.settingsWidget;if(e&&e.isShowing()){if(this.ViewWidget.selectedChildWidget&&this.ViewWidget.selectedChildWidget.id=="messageList"){var f=k.byId("GeneralSettings");f&&f.EnablePreviewPane.checked!=Settings.EnablePreviewPane&&
this.ViewWidget.selectedChildWidget.setPreviewPaneEnabled(f.EnablePreviewPane.checked)}e.hide();b.byId("ws_settings").style.display="none";e=b.byId("ws_application");e.style.display="block";e.style.visibility="inherit";b.byId("ws_application").style.display="block";this.isComposeInTransition()?this.selectTab("messageList",b.hitch(this,function(a){var e=this.theMailModel.getInboxFolderName();a.displayFolder(e)})):!a&&this.ViewWidget.selectedChildWidget&&(this.ViewWidget.selectedChildWidget.show(),
setTimeout(b.hitch(this,function(){this.ViewWidget.selectedChildWidget.onShow(!0)}),0));(!this.ViewWidget.selectedChildWidget||this.ViewWidget.selectedChildWidget.id!="todayPage")&&this.SidePanel.show();this.repaintApplication();this.resize();(a=k.byId("composeMessage"))&&b.isIE&&a.resize();b.publish("Settings/hide")}},onKeyPress:function(a){var e=ws.html.isTargetAnInputElement(a),f=ws.html.isTargetALinkElement(a);if(a.keyCode>=65&&a.keyCode<=90)a.keyChar=String.fromCharCode(a.keyCode);if(Config.EnableKeyboardShortcuts&&
a.keyChar&&b.isString(a.keyChar)&&!e&&!a.ctrlKey&&!a.metaKey&&(a.altKey||b.isMac)&&!this.isModalOpen)switch(b.isMac&&(a=ws.html.fixKeyForMac(a)),a.keyChar.toLowerCase()){case Config.Strings.KeyWriteMail:this.composeMessage(a)}var g=!0;if((a.keyCode||a.charCode)&&e||a.keyCode==b.keys.ENTER&&f)g=!1;if(a.keyCode==b.keys.UP_ARROW||a.keyCode==b.keys.DOWN_ARROW||a.keyCode==b.keys.PAGE_UP||a.keyCode==b.keys.PAGE_DOWN||a.keyCode==b.keys.HOME||a.keyCode==b.keys.END)e||a.preventDefault();a.stopPropagation();
g&&(b.publish("Suite/onKeyOnPress",[a]),this.processKeyPress(a))},processKeyPress:function(){},msgSentFeedbackFromPopout:function(){b.publish("WSFeedbackStart",[Config.Strings.ComposeSentTitle,!0])},isAutoSpacingEnabled:Settings.ListSpacingType==0,getAutoSpacingType:function(){var a=this.viewportSize?this.viewportSize.h:b.window.getBox().h;return a<=500?1:a>500&&a<=600?2:a>600&&a<=700?3:4},testingOnlyInit:function(){this.theMailModel=new ws.mail.MailModel;this.theAddressModel=new ws.address.AddressModel;
b.connect(this.theMailModel,"modelUpdated",this,"deferredInit");this.MessageListView=k.byId("messageList");this.MessageListView.setModel(this.theMailModel);this.MessageListView.getComposeCB=b.hitch(this,"getCompose","messagelist");b.connect(this.MessageListView,"openMessage",this,"openMessage")},testScriptError:function(){ws.WebSuite.testScriptError1()},testScriptError1:function(){}};b._hasResource["ws.widget.Advertisement"]||(b._hasResource["ws.widget.Advertisement"]=!0,b.provide("ws.widget.Advertisement"),
b.declare("ws.widget.Advertisement",k._Widget,{adConfig:null,adtype:"",location:"",lastRotateTime:0,blocked:!1,hatRevenueBlocked:!1,isHatAd:!1,screen:"large",adsDiv:null,adFeedBackDiv:null,adFeedBackDivAdded:!1,alreadyShownAds:!1,currentMagic:"0",startup:function(a){this.screen=screen.width<1E3?"small":"large";if(Config.AdInfo&&(this.adConfig=Config.AdInfo[this.adtype+"_"+this.screen]||Config.AdInfo[this.adtype+"_all"]))this.currentMagic=this.adConfig.magic;if(this.enabled()){if(Config.SendConfPageIsRichContent&&
this.adConfig.altMagic&&(b.subscribe("SendConf/show",b.hitch(this,function(){this.currentMagic=this.adConfig.altMagic;this.alreadyShownAds=!1;this.rotate(!0)})),b.subscribe("SendConf/hide",b.hitch(this,function(){this.currentMagic=this.adConfig.magic;this.alreadyShownAds=!1;this.rotate(!0)}))),b.addClass(this.domNode,"adFrameDiv adFrameDiv"+this.adConfig.location),this.domNode.style.width=this.adConfig.iframeWidth+"px",this.domNode.style.height=this.adConfig.iframeHeight+"px",this.onDocClk=ws.browser.addDocumentOnClick(this,
"onDocumentClick"),this.isHatAd&&this.hatRevenueBlock(k.byId("HatWidget").hatAdsAreBlocked()),!a)this.started=!0,this.rotateSoon()}else this.domNode.style.display="none"},block:function(a,e){this.pause(a,!0,e)},pause:function(a,e,b){if(this.enabled())if(this.blocked=a,Config.EnableInPageIFrameAds&&!this.adConfig.url)try{a||this.hatRevenueBlocked?window._g_WS_adsWrapperLoadingState==2&&this.adsDiv&&window.adsHideDiv(this.adsDiv):(window._g_WS_adsWrapperLoadingState==2&&this.adsDiv&&window.adsShowDiv(this.adsDiv),
this.rotate(b))}catch(g){}else if(a||this.hatRevenueBlocked){if(e)this.domNode.innerHTML="";this.createdIframe=!1;this.lastRotateTime=0}else this.rotate(b)},hatRevenueBlock:function(a){if(a)this.domNode.style.display="none";else if(this.enabled())this.domNode.style.display="block";var e=this.hatRevenueBlocked!=a;this.hatRevenueBlocked=a;e&&this.block(this.blocked)},enabled:function(){return(this.adConfig?!0:!1)&&Settings.ShowAd&&this.currentMagic!="0"&&!(Settings.SkipAds&&this.adConfig.skip)},addAdFeedBack:function(a){this.adFeedBackDiv=
document.createElement("div");this.adFeedBackDiv.style.position="relative";this.adFeedBackDiv.style.paddingTop="5px";var e=document.createElement("a");this.adFeedBackDiv.appendChild(e);e.appendChild(document.createTextNode(Config.Strings.AdFeedback));e.href=a;e.target="_blank";if(this.adsDiv&&!this.adFeedBackDivAdded)this.adFeedBackDivAdded=!0,this.domNode.appendChild(this.adFeedBackDiv)},adsWrapperLoaded:function(){try{if(window._g_WS_adsWrapperLoadingState=2,typeof gIsAPopupInvocation!="undefined"&&
gIsAPopupInvocation&&window.adsDisableTacoda(),window.adsTacFn(),window._g_WS_adsWrapperLoadCallBacks)for(var a in window._g_WS_adsWrapperLoadCallBacks)window._g_WS_adsWrapperLoadCallBacks[a]()}catch(e){}},loadAdsWrapperScripts:function(){var a=document.createElement("script");a.type="text/javascript";a.src=Config.AdsWrapperJsURL;var e=this;a.onload=function(){ws.lang.setTimeout(e,"adsWrapperLoaded",0)};a.onreadystatechange=function(){(this.readyState=="loaded"||this.readyState=="complete")&&ws.lang.setTimeout(e,
"adsWrapperLoaded",0)};document.getElementsByTagName("head")[0].appendChild(a)},makeAdsWrpperCalls:function(){if(!this.adsDiv){var a=document.createElement("div");a.style.position="relative";a.id=this.id+"AdsDiv";this.domNode.appendChild(a);this.adsDiv=a;if(this.adFeedBackDiv&&!this.adFeedBackDivAdded)this.adFeedBackDivAdded=!0,this.domNode.appendChild(this.adFeedBackDiv)}if(window._g_WS_adsWrapperLoadingState)window._g_WS_adsWrapperLoadingState==1?window._g_WS_adsWrapperLoadCallBacks[this.id]=b.hitch(this,
this.__makeAdsWrpperCalls):window._g_WS_adsWrapperLoadingState==2&&this.__makeAdsWrpperCalls();else{window._g_WS_adsWrapperLoadingState=1;if(!window._g_WS_adsWrapperLoadCallBacks)window._g_WS_adsWrapperLoadCallBacks={};window._g_WS_adsWrapperLoadCallBacks[this.id]=b.hitch(this,this.__makeAdsWrpperCalls);this.loadAdsWrapperScripts()}},__makeAdsWrpperCalls:function(){try{b.isWebKit?this.adsDiv&&(window.adsClrAd(this.adsDiv),window.htmlAdWH(this.currentMagic.split(":")[0],this.adConfig.iframeWidth,this.adConfig.iframeHeight,
"IFRAME",this.adsDiv)):this.alreadyShownAds?this.adsDiv&&window.adsReloadAd(this.adsDiv):(this.adsDiv&&window.htmlAdWH(this.currentMagic.split(":")[0],this.adConfig.iframeWidth,this.adConfig.iframeHeight,"IFRAME",this.adsDiv),this.alreadyShownAds=!0)}catch(a){}},rotate:function(a,e){if(this.enabled()&&!this.blocked&&!this.hatRevenueBlocked){if(this.adConfig.name=="mlsidebar1"||this.adConfig.name=="mlsidebar2"||this.adConfig.name=="displaymessagetext"){var b=ws.WebSuite.settingsWidget;if(b&&b.isShowing())return}else if(this.adConfig.name==
"sendconfirm"||this.adConfig.name=="sendconfirmtext"){if((b=ws.WebSuite.getCurrentViewId())&&b!="composeMessage"){this.block(!0);return}if(b=="composeMessage"&&(b=ws.WebSuite.ViewWidget.selectedChildWidget,b.stackWidget.selectedChildWidget==b.layoutWidget)){this.block(!0);return}}else if(Config.FreezeComposeBannerAd&&e&&this.adConfig.name=="messagelist"&&(b=ws.WebSuite.getCurrentViewId())&&b=="composeMessage")if((b=ws.WebSuite.ViewWidget.selectedChildWidget)&&b.stackWidget&&b.layoutWidget&&b.stackWidget.selectedChildWidget==
b.layoutWidget)return;if(Config.WunderloopKeywordURL&&!this.wunderloopScriptLoaded)if(ws.reporting._omniture.omnitureScriptLoaded())this.wunderloopScriptLoaded=!0;else if(!this.wunderloopScriptInitDelay){ws.lang.setTimeout(this,"rotate",1E4,a);this.wunderloopScriptInitDelay=!0;return}b=(new Date).getTime();if(!(b-this.lastRotateTime<this.adConfig.interval*1E3)||a){this.lastRotateTime=b;b="about:blank";if(Config.adServerType=="Yhoo")this.adConfig.url=ws.string.substituteParams("%{base}?name=%{name}&screen=%{screen}",
{base:Config.adPageURL,name:this.adtype,screen:this.screen});if(!this.createdIframe&&(!Config.EnableInPageIFrameAds||this.adConfig.url))this.domNode.innerHTML=ws.string.substituteParams("<iframe src=\"about:blank\" name='%{name}' style='width:%{width}px; height:%{height}px; background-color:transparent' marginwidth='0' marginheight='0' hspace='0' vspace='0' frameborder='0' scrolling='no' allowTransparency='true'></iframe>",{name:this.id+"frame",width:this.adConfig.iframeWidth,height:this.adConfig.iframeHeight}),
this.createdIframe=!0;if(this.adConfig.title=="displaymessagetext")this.currentMagic=Settings.DisplayMessageTextAdMagic;if(this.currentMagic!="0")if(this.adConfig.url){if(b=""+Math.random(),b=parseInt(b.substr(2),10),b=ws.string.substituteParams(this.adConfig.url,b),Config.WunderloopKeywordURL&&this.wunderloopScriptLoaded){var g=ws.reporting._generic.getWunderLoopKeyword();g&&(b=b.replace(/\|ADTECH/,"|"+g+"|ADTECH"))}}else Config.EnableInPageIFrameAds?this.makeAdsWrpperCalls():b=ws.string.substituteParams("%{base}?name=%{name}&screen=%{screen}",
{base:Config.adPageURL,name:this.adtype,screen:this.screen});this.createdIframe&&ws.html.recreateIframe(this.domNode,b);if(!Config.EnableInPageIFrameAds&&Config.EnableTacoda&&!this.tacodaInitiated)b=document.createElement("div"),this.domNode.appendChild(b),b.innerHTML='<iframe title="" width="1px" height="1px" frameborder=0 border=0 marginwidth=0 marginheight=0 scrolling="no"></iframe>',ws.html.recreateIframe(b,Config.SameDomainScriptsURL+Config.TacodaTagFile),ws.widget.Advertisement.prototype.tacodaInitiated=
!0;if(ws.UserContext.ParentalControls=="K"){if(!this.kolImgAdded){b=document.createElement("div");g=document.createElement("img");g.src=Config.BaseResourcesURL+"images/AdBug.gif";b.appendChild(g);with(g.style)position="absolute",right=bottom="0px";this.domNode.appendChild(b);this.kolImgAdded=b}this.kolImgAdded.style.display=this.adtype=="messagelist"?"none":"block"}}}},onDocumentClick:function(){setTimeout(b.hitch(this,function(){ws.io.openingWindow||this.rotateSoon(!0)}),0)},rotateSoon:function(a){ws.lang.setTimeout(this,
"rotate",2E3,!1,a)},uninitialize:function(){this.onDocClk&&b.disconnect(this.onDocClk);this.adConfig=null}}));if(!b._hasResource["ws.widget.popup"])b._hasResource["ws.widget.popup"]=!0,b.provide("ws.widget.popup"),ws.widget.popup=function(a){var e=null;if(b.isSafari&&a.around)for(var f=a.around;f.parentNode;)if(f=f.parentNode,b.hasClass(f,"dojoxGrid-scrollbox")){e=f;break}f=a.orient||{BL:"TL",TL:"BL"};e&&(f=a.orient||{BL:"TL"});var g=a.popup,h=f,j=a.manual,m=a.padding||[0,0],v=a.around,f=b.doc.createElement("div");
f.id="wsPopup"+Math.round(Math.random()*1E4);f.className="dijitPopup";f.style.zIndex=(a.preferZ?a.preferZ:ws.widget.popup.beginZIndex)+ws.widget.popup.stack.length;f.style.left="-999px";if(a.parent)f.dijitPopupParent=a.parent.id;b.body().appendChild(f);g.domNode.style.display="";f.appendChild(g.domNode);var l=new k.BackgroundIframe(f),n=y=0,p=b._getMarginSize(f);!isNaN(a.x)&&!isNaN(a.y)?(n=a.x+m[0],y=a.y+m[1]):(h=v?k.placeOnScreenAroundElement(f,v,h,null):k.placeOnScreen(f,a,h=="R"?["TR","BR","TL",
"BL"]:["TL","BL","TR","BR"]),n=h.x+m[0]*(h.corner.charAt(1)=="L"?1:-1),y=h.y+m[1]*(h.corner.charAt(0)=="T"?1:-1),e&&(y=Math.max(0,y-e.scrollTop)));e=b.window.getBox();n+p.w>e.w&&(n=Math.max(0,e.w-p.w));y+p.h>e.h&&(y=Math.max(0,e.h-p.h));f.style.top=y+"px";f.style.left=n+"px";g.popupNode=f;e=b.connect(b.isIE||b.isWebKit?b.body():b.doc,"onkeypress",function(a){a.keyCode==b.keys.ESCAPE&&!j&&!ws.WebSuite.isModalOpen&&ws.widget.popup.close(g)});ws.widget.popup.stack.push({wrapper:f,iframe:l,widget:g,parent:a.parent,
handler:e,manual:a.manual});if(g.onOpen)g.onOpen()},b.mixin(ws.widget.popup,{beginZIndex:2E3,stack:[],isInputType:function(a){if(a&&a.tagName&&(a=a.tagName.toLowerCase(),a=="input"||a=="textarea"))return!0;return!1},isFocusInInputInDialog:function(a){if(a&&a.tagName&&this.isInputType(a))for(;a;){if(a.tagName.toLowerCase()=="body")break;if(b.hasClass(a,"dijitPopup"))return!0;a=a.parentNode}return!1},close:function(a){for(;b.some(this.stack,function(e){return e.widget==a});){if(b.isIE){var e=document.activeElement;
e&&(this.isFocusInInputInDialog(e)||!this.isInputType(e))&&window.focus()}var e=this.stack.pop(),f=e.wrapper,g=e.iframe,h=e.widget;b.disconnect(e.handler);h.domNode.style.display="none";b.body().appendChild(h.domNode);g.destroy();b.destroy(f);if(h.onClose)h.onClose()}},setProp:function(a,e,b){for(var g=0;g<this.stack.length;g++)this.stack[g].widget==a&&(this.stack[g].widget[e]=b)},isPopupOpen:function(a){for(var e=0;e<this.stack.length;e++)if(this.stack[e].widget==a)return!0;return!1},onDocumentMouseDown:function(a){if(!this._ignoringClicks)for(var e=
this.stack.length-1;e>=0;e--)if(!(e+1>this.stack.length)){if(ws.html.overElement(this.stack[e].wrapper,a))break;this.stack[e].manual||this.close(this.stack[e].widget)}},onDocumentKeyPress:function(a){this.stack[0]&&this.stack[0].widget.processKey&&this.stack[0].widget.processKey(a)},registerWin:function(a){var e=b.isIE?a.document.body:a.document;if(e)a.popupHandles=[b.connect(e,"onmousedown",this,"onDocumentMouseDown"),b.connect(e,"onkeypress",this,"onDocumentKeyPress")];this.windows.push(a)},unregisterWin:function(a){a.popupHandles&&
b.forEach(a.popupHandles,b.disconnect);for(var e=[],f=0;f<this.windows.length;f++)try{this.windows[f]!=a&&e.push(this.windows[f])}catch(g){}this.windows=e},windows:[],ignoreClicks:function(a){this._ignoringClicks=a},isAnyPopupOpen:function(){return this.stack.length>0},closeAllPopups:function(){for(var a=this.stack.length-1;a>=0;a--)this.stack[a].manual||this.close(this.stack[a].widget)}}),b.addOnLoad(b.hitch(ws.widget.popup,"registerWin",window));b._hasResource["ws.widget.SearchAutoComplete"]||(b._hasResource["ws.widget.SearchAutoComplete"]=
!0,b.provide("ws.widget.SearchAutoComplete"),b.declare("ws.widget.SearchAutoComplete",[k._Widget,k._Templated],{templateString:b.cache("ws.widget","SearchAutoComplete.html",'<div class="SearchAutoComplete wsMenu ${className}" dojoAttachPoint="choices"></div>\r\n'),css:{templateString:""},widgetsInTemplate:!0,className:"",invocationType:null,SELECTED_CLASS:"selected",textbox:null,isOpen:!1,actionCB:null,isAutoCompleteEntry:!1,lastAutoComplete:null,postCreate:function(){if(Config.EnableHatRevenueSearchBar)this.invocationType=
Config.HatRevenueSearchInvocationType;else{var a=Config.WebSearchUrl.match(/s_it=.+&/i);if(a&&a[0])this.invocationType=a[0].substring(5,a[0].length-1);else if((a=Config.WebSearchUrl.match(/invocationType=.+&/i))&&a[0])this.invocationType=a[0].substring(15,a[0].length-1)}this.invocationType&&(this.connect(document,"onclick","documentOnClick"),this.connect(this.textbox,"onkeypress","textboxOnKeyPress"),this.connect(this.textbox,"onkeydown","textboxOnKeyDown"),this.connect(this.textbox,"onkeyup","textboxOnKeyUp"))},
textboxOnKeyPress:function(a){if(a.keyCode==13&&this.choices.style.display!="none")this.choices.style.display="none",a.preventDefault()},documentOnClick:function(){this.choices.style.display="none"},textboxOnKeyDown:function(a){if(this.choices.style.display!="none"&&a.keyCode==9)this.choices.style.display="none"},isKey:function(){if(arguments.length<2)return!1;for(var a=1;a<arguments.length;a++)if(arguments[0]==arguments[a])return!0;return!1},textboxOnKeyUp:function(a){a.stopPropagation();if(this.isKey(a.keyCode,
38,40))this.checkUpDownArrows(a.keyCode);else{if(this.textbox.value!=this.lastAutoComplete)this.lastAutoComplete=null,this.isAutoCompleteEntry=!1;this.keypressTimeout&&clearTimeout(this.keypressTimeout);this.keypressTimeout=setTimeout(b.hitch(this,"_textboxOnKeyUp"),250)}},_textboxOnKeyUp:function(){b.trim(this.textbox.value)!=""?b.xhrGet({url:Config.BasePagesURL+"common/proxy.aspx/searchAutoComplete",content:{q:this.textbox.value,it:this.invocationType,count:"10",output:"json"},timeout:5E3,handleAs:"json",
preventCache:!0,load:b.hitch(this,"populateChoices"),error:b.hitch(this,"removeChoices",!0)}):this.removeChoices(!0)},checkUpDownArrows:function(a){if(this.choices.style.display!="none"){var e=this.getSelected(),b=this.choices.childNodes;e==-1?a==38?this.setSelected(0,b.length-1):a==40&&this.setSelected(0,0):a==38?e-1>=0?this.setSelected(e,e-1):b.length>0&&this.setSelected(e,b.length-1):a==40&&(e+1<b.length?this.setSelected(e,e+1):this.setSelected(e,0))}},setSelected:function(a,e){var f=this.choices.childNodes;
if(f)b.removeClass(f[a],this.SELECTED_CLASS),b.addClass(f[e],this.SELECTED_CLASS),this.textbox.value=f[e].innerHTML,this.lastAutoComplete=this.textbox.value,this.isAutoCompleteEntry=!0},getSelected:function(){for(var a=this.choices.childNodes==null?0:this.choices.childNodes.length,e=0;e<a;e++)if(b.hasClass(this.choices.childNodes[e],this.SELECTED_CLASS))return e;return-1},addItem:function(a){a=b.create("div",{innerHTML:a},this.choices);this.connect(a,"onmouseover","itemOnMouseOver");this.connect(a,
"onclick","itemOnClick")},onOpen:function(){this.isOpen=!0},onClose:function(){this.isOpen=!1},populateChoices:function(a,e){if(e&&e.xhr&&e.xhr.status&&e.xhr.status==200&&a&&a[1]){this.removeChoices();var b=a[1];if(b.length>0){for(var g=0;g<b.length;g++)this.addItem(b[g]);this.choices.style.display=this.choices.childNodes.length>0?"block":"none";this.isOpen||ws.widget.popup({popup:this,parent:null,around:this.textbox,orient:{BL:"TL"},padding:[0,-1]})}else this.removeChoices(!0)}},removeChoices:function(a){this.choices.innerHTML=
"";if(a)ws.widget.popup.close(this),this.isOpen=!1},itemOnMouseOver:function(a){var e=this.getSelected();e!=-1&&b.removeClass(this.choices.childNodes[e],this.SELECTED_CLASS);b.addClass(a.currentTarget,this.SELECTED_CLASS)},itemOnClick:function(a){this.textbox.focus();this.textbox.value=a.currentTarget.innerHTML;this.choices.style.display="none";if(this.actionCB)this.isAutoCompleteEntry=!0,this.actionCB()},updateUrlInvocationType:function(a){var e=a;if(this.isAutoCompleteEntry){var b=/(.+)(s_it=.+)(&.+)/i;
if((b=b.exec(a))&&b.length>=4)return b.splice(0,1),b[1]="s_it="+Config.WebSearchAutoCompleteInvocType,e=b.join("");b=/(.+)(invocationType=.+)(&.+)/i;if((b=b.exec(a))&&b.length>=4)b.splice(0,1),b[1]="invocationType="+Config.WebSearchAutoCompleteInvocType,e=b.join("")}return e}}));b._hasResource["ws.widget.FeedbackPane"]||(b._hasResource["ws.widget.FeedbackPane"]=!0,b.provide("ws.widget.FeedbackPane"),b.declare("ws.widget.FeedbackPane",[k._Widget,k._Templated],{templateString:b.cache("ws.widget","FeedbackPane.html",
'<div class="fdbkPaneCntr">\r\n\t<div class="mainSprite wsCloseBtn" dojoAttachEvent="onclick:close"></div>\r\n\t<div class="fdbkPane">\r\n\t\t<div class="fdbkPaneEntry" dojoAttachPoint="entryPane">\r\n\t\t\t<div class="fdbkPaneTitle">We want to hear from you!</div>\r\n\t\t\t<ul dojoAttachPoint="fdbkOptions">\r\n\t\t\t\t<li dojoAttachEvent="onclick:openHelp">\r\n\t\t\t\t\t<div class="feedbackSprite fdbkOpt1"></div>\r\n\t\t\t\t\t<span class="wsLink">Need Help?</span>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li dojoAttachEvent="onclick:openShare">\r\n\t\t\t\t\t<div class="feedbackSprite fdbkOpt2"></div>\r\n\t\t\t\t\t<span class="wsLink">Share an idea</span>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li dojoAttachEvent="onclick:showFeedbackPane">\r\n\t\t\t\t\t<div class="feedbackSprite fdbkOpt3"></div>\r\n\t\t\t\t\t<span class="wsLink">Got Feedback?</span>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t\t<div class="fbLike">\r\n\t\t\t\t<span>Or like us on Facebook</span>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<iframe src="//www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Faolmail&amp;send=false&amp;layout=standard&amp;width=385&amp;show_faces=true&amp;action=like&amp;colorscheme=light&amp;font&amp;height=80&amp;appId=8160671994" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:385px; height:60px;" allowTransparency="true"></iframe>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<iframe dojoAttachPoint="iframePane" id="fdbkIframe" src="about:blank" width="410" height="285" frameborder="0" border="0" marginwidth="0" marginheight="0" scrolling="no" align="top" allowTransparency="false" style="display:none"></iframe>\r\n\t</div>\r\n\t<div class="wsPointer wsPointerShadow wsPointer-right" dojoAttachPoint="arrow"></div>\r\n</div>\r\n'),
doPostMsg:typeof window.postMessage!="undefined",pollingInterval:250,submitCloseDelay:3E3,startup:function(){b.isIE&&b.isIE<9&&b.removeClass(this.arrow,"wsPointerShadow");b.query("li",this.fdbkOptions).forEach(function(a){ws.html.addHoverClass(a,"fdbkOptionHover")});setTimeout(b.hitch(this,function(){this.connect(b.body(),"onclick",function(a){!ws.html.overElement(this.domNode,a)&&this.iframePane.style.display=="none"&&this.close()});this.subscribe("Suite/onKeyOnPress",function(a){a.keyCode==27&&
this.close()});this.doPostMsg&&this.connect(window,"message",function(a){a.origin===Config.FeedbackLinkDomain&&(a.data=="cancel"?this.close():a.data=="submit"&&setInterval(b.hitch(this,"close"),this.submitCloseDelay))},!1)}),100);this.inherited(arguments)},open:function(){this.showEntryPane();var a="";Config.EnableThemes&&((a=window._ws_theme.getThemeColorQueryString(!1,!1,!1))||(a="midlightlight=46B9E9&midlight=46B9E9&darkest=077BA6&link=46B9E9"),a="&"+a);window._g_WS_WebFont&&window._g_WS_WebFont.fontMode&&
(a+="&fontCss="+window._g_WS_WebFont.webFontsMap[window._g_WS_WebFont.fontMode]);b.io.iframe.setSrc(this.iframePane,Config.FeedbackLinkDomain+Config.FeedbackLinkPath+"?qa_md="+encodeURIComponent(document.domain)+"&qa_p="+encodeURIComponent(Config.BaseCommonPagesPath)+"&r="+encodeURIComponent(document.location.href)+a,!0)},close:function(){!this.doPostMsg&&this.messageComm&&clearInterval(this.messageComm);ws.widget.popup.close(this);this.destroy()},showFeedbackPane:function(){this.entryPane.style.display=
"none";this.iframePane.style.display="";if(!this.doPostMsg)this.messageCom&&clearInterval(this.messageComm),this.messageComm=setInterval(b.hitch(this,function(){var a=this.iframePane.contentWindow.frames[0].location.hash;if(a=="#cancel")clearInterval(this.messageComm),this.messageComm=null,this.close();else if(a=="#submit")clearInterval(this.messageComm),this.messageComm=null,setTimeout(b.hitch(this,function(){this.close()}),this.submitCloseDelay)}),this.pollingInterval)},showEntryPane:function(){this.iframePane.style.display=
"none";this.entryPane.style.display=""},openHelp:function(){ws.io.openWindow("http://help.aol.com/help/microsites/search.do?cmd=displayKC&docType=kc&externalId=73824","_blank",b.isIE?"status=yes,resizable=yes,menubar=yes,scrollbars=yes,location=yes,toolbar=yes":null)},openShare:function(){ws.io.openWindow("http://aolmail.uservoice.com/","_blank",b.isIE?"status=yes,resizable=yes,menubar=yes,scrollbars=yes,location=yes,toolbar=yes":null)}}));b._hasResource["ws.suite.Hat"]||(b._hasResource["ws.suite.Hat"]=
!0,b.provide("ws.suite.Hat"),b.declare("ws.suite.Hat",[k._Widget,k._Templated],{templateString:b.cache("ws.suite","Hat.html",'<div class="WSHat">\r\n\t<div class="leftHat" dojoattachpoint="leftHat">\r\n\t\t<div class="logoArea" dojoattachpoint="logoArea" dojoattachevent="onclick: onLogoClick">\r\n\t\t\t<span style="display: none;" class="CalSoloText" dojoattachpoint="CalSoloText"></span>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="searchArea" dojoattachpoint="searchAreaNode" style="display: none">\r\n\t\t<input type="text" name="query" maxlength="256" class="wsInput search" value="" dojoattachpoint="searchWebField" dojoattachevent="onkeypress: onKeyPressSearchWebField" />\r\n\t\t<\!-- one of the following is removed in startup --\>\r\n\t\t<div class="searchButtonContainer" dojoattachpoint="searchButtonContainer">\r\n\t\t\t<div dojotype="ws.widget.Button" dojoattachpoint="searchWebButton" id="searchButton" size="Large" dojoattachevent="onClick: searchWeb">\r\n\t\t\t\t${SearchWeb}</div>\r\n\t\t\t<div dojotype="ws.widget.SplitDropDownButton" dojoattachpoint="searchWebDropdownButton" size="Large" type="Alt1" id="searchPullDownButton" dojoattachevent="onClick: searchWebPulldownClick">\r\n\t\t\t\t${SearchWeb}</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div dojoattachpoint="rightHat" class="rightHat">\r\n\t\t<div dojotype="ws.widget.BuddyIcon" size="32" class="icon" dojoattachpoint="iconNode">\r\n\t\t</div>\r\n\t\t<div class="salutation">\r\n\t\t\t<span dojoattachpoint="screenNameNode" class="screenNameNode"></span>\r\n\t\t</div>\r\n\t\t<div dojoattachpoint="adminLinks" class="adminLinks">\r\n\t\t\t<span dojoattachpoint="signOutLink" class="signOutLink"></span>\r\n\t\t\t<span class="pipe">|</span>\r\n\t\t\t<span dojoattachpoint="megaMenuNode" class="link"><span dojoattachpoint="optionsLink" class="link">${Options}</span><img src="${spacer}" class="btnArrowImg megaMenuArrow"></span>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="hatBoxShadow"></div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,minLogoAreaWidth:270,maxSearchFieldWidth:276,promoThemeAdsBlocked:!1,searchBarAdsBlocked:!1,logoutUrl:Config.BaseCommonPagesPath+"Logout.aspx",loginUrl:Config.BasePagesURL+"Solo.aspx",whatsNewUrl:Config.WhatsNewURL,checkLinkedScreenNamesInterval:6E5,megaMenu:null,settingsWidget:null,mailModel:null,folderDataType:null,searchScope:"alltext",searchFieldColor:"#000",hatType:"mail",themePicker:null,hideSalutation:!1,setMailModel:function(a){this.mailModel=
a},createThemeSelector:function(){if(!this.themePicker){var a=this.hatType!="mail"?"DEFAULT":null,e=document.createElement("div");this.leftHat.appendChild(e);this.themePicker=new ws.themes.widget.ThemePicker({overrideTheme:a},e);b.addClass(this.themePicker.domNode,"themePicker")}},startup:function(){this.searchButtonContainer.getElementsByTagName("div");this.showWebSearchPulldown()?this.searchWebButton.destroy():this.searchWebDropdownButton.destroy();if(Config.WebSearchUiEnabled&&!Config.EnableHatRevenueSearchBar)this.searchAreaNode.style.display=
"";b.subscribe("WSDeferredInit",this,"updateLinkedScreenNames");b.subscribe("WSSessionExpired",this,function(){clearTimeout(this.updateLSNTimeout)});if(ws.UserContext.ActiveScreenName&&ws.UserContext.ActiveScreenName!=""){var a=ws.UserContext.ActiveScreenName;this.hideSalutation&&(a="");var e=Config.Strings.SignOut;this.screenNameNode.innerHTML=a;Config.FeedbackLinkPath&&Config.FeedbackLinkPath!=""&&b.style(this.screenNameNode,{width:b.isIE==7?"140px":"150px",display:"block"});if(this.hatType!="pubcal")b.isIE?
this.signOutLink.innerHTML=ws.string.substituteParams("<a href='{0}'>{1}</a>",this.logoutUrl,e):(this.signOutLink.innerHTML=ws.string.substituteParams("<a href='javascript:void(0)'>{1}</a>",this.logoutUrl,e),b.connect(b.query("a",this.signOutLink)[0],"onclick",b.hitch(this,function(){ws.settings.savePending();setTimeout(b.hitch(this,function(){document.location=this.logoutUrl}),200);return!1})))}else if(this.hatType=="pubcal")this.signOutLink.innerHTML=ws.string.substituteParams("<a href='{0}'>{1}</a>",
this.loginUrl,Config.Strings.SignIn);if(Config.AddDomainToHatUrls)a=function(a){if(a&&a.length>0){var e=ws.UserContext.UserAddress.indexOf("@");e!=-1&&(e=ws.UserContext.UserAddress.substr(e+1),a+=a.indexOf("?")>0?"&":"?",a+="d="+encodeURIComponent(e))}return a},Config.MailTourURL=a(Config.MailTourURL),Config.WelcomeDialogMailTourURL=a(Config.WelcomeDialogMailTourURL),Config.HelpMenuTourURL=a(Config.HelpMenuTourURL),Config.MailTourPanelsURL=a(Config.MailTourPanelsURL);this.initMegaMenu();if(Config.FeedbackLinkPath&&
Config.FeedbackLinkPath!=""){var f=b.create("div",{"data-title":Config.Strings.FeedbackShort,className:"mainSprite fdbkBadge",innerHTML:"<span class='mainSprite fdbkBadgeIcon'></span>"},this.domNode);this.connect(f,"onclick",b.hitch(this,function(){ws.widget.hideInstatip(f);if(!this.fdbkPane)this.fdbkPane=new ws.widget.FeedbackPane,this.fdbkPane.startup(),b.body().appendChild(this.fdbkPane.domNode),this.fdbkPaneCloseHandler=b.connect(this.fdbkPane,"close",this,function(){b.destroy(this.fdbkPane);
this.fdbkPane=null;b.disconnect(this.fdbkPaneCloseHandler)});this.fdbkPane.open()}));this.connect(f,"onmouseenter",function(){ws.widget.showInstatip(f)});this.connect(f,"onmouseleave",function(){ws.widget.hideInstatip(f)})}if(this.showWebSearchPulldown())this.searchWebButton=this.searchWebDropdownButton,this.searchWebButton.menuDefinition=[{caption:Config.Strings.Web,onClick:b.hitch(this,"searchWebUsingUrl",Config.Strings.Web)},{caption:Config.Strings.Hat_Web_SearchOption1,onClick:b.hitch(this,"searchWebUsingUrl",
Config.Strings.Hat_Web_SearchOption1)}];if(!Config.EnableHatRevenueSearchBar&&Config.WebSearchAutoCompleteEnabled)this.searchAutoComplete=new ws.widget.SearchAutoComplete({textbox:this.searchWebField,actionCB:b.hitch(this,"doSearchWeb")});b.subscribe("WSDeferredInit",b.hitch(this,function(){ws.bubbleConfig.showPinBubble("OptionsMenu",this.optionsLink,!0);if(!ws.WebSuite.startupDlgDone&&ws.bubbleConfig.canShowOtherBubbles)ws.WebSuite.startupDlgDone=!0,this.themePicker&&Settings.EnablePromoThemes&&
this.themePicker.showNewPromoThemeBubble(!1),Config.ShowMailExtPromotionForFF&&b.isFF>=3&&ws.bubbleConfig.isShowable("FF3MailTo")&&this._showFF3MailToDiscovery()}));Config.EnableHatRevenueSearchBar&&(b.require("ws.layers.HatRevenue"),b.addOnLoad(b.hitch(this,function(){this.searchBarAdsBlock(!0);this.HatRevenue=new ws.suite.HatRevenue({id:"HatRevenue"});this.HatRevenue.startup();b.place(this.HatRevenue.domNode,this.rightHat,"after")})));this.setWidth();b.subscribe("wsresize",this,"setWidth");this.updateBuddyIcon()},
showSoloLogo:function(){b.removeClass(this.logoArea,"logoArea");b.addClass(this.logoArea,"logoAreaCal");b.removeClass(this.leftHat,"leftHat");b.addClass(this.leftHat,"leftHatCal")},initMegaMenu:function(a){var e=this;if(!this.megaMenuDef)this.hatType=="mail"?this.megaMenuDef=b.filter(Config.MegaMenuLinks,function(a){if(a.id=="AOLHome"){if(!e.homeLinkDone){e.homeLinkDone=!0;var f=document.createElement("span");f.innerHTML="|";b.addClass(f,"pipe");e.adminLinks.insertBefore(f,e.signOutLink);var j=document.createElement("span");
j.innerHTML=a.caption;b.addClass(j,"link");j.onclick=function(){ws.io.openWindow(a.url,"")};e.adminLinks.insertBefore(j,f)}return!1}else if(a.id=="MyAccount")a.onClick=b.hitch(ws.io,"openWindow",a.url),a.caption="<span class='mainSprite menuIcon menuAccount'></span>"+a.caption;else if(a.id=="Help")ws.reporting.makeFeedbackUrl(a.url),j=ws.reporting.getFeedbackUrl(),a.onClick=b.hitch(ws.io,"openWindow",j);else if(a.id=="MailTour"){Config.ShowTakeTourBtn=!0;f="aol";if(Config.PageLocale=="en-ca"||Config.PageLocale==
"es-us")Config.UIVariant=="AIM"&&(f="aim");var j=Config.HelpMenuTourURL||Config.MailTourURL,m=ws.string.substituteParams(j,f,Config.PageLocale);a.onClick=function(){ws.io.openWindow(m,"","status=yes,resizable=yes,menubar=yes,scrollbars=yes,location=yes,toolbar=yes,top=50,left=50");ws.reporting.reportAction("Mail Tour")}}else if(a.id=="Settings")a.onClick=b.hitch(e,e.onSettingsClick),a.caption="<span class='mainSprite menuIcon menuSettings'></span>"+a.caption;else if(a.id=="Themes")if(Config.EnableThemes)e.createThemeSelector(),
a.onClick=b.hitch(e,e.onThemeClick),a.caption="<span class='mainSprite menuIcon menuThemes'></span>"+a.caption;else return!1;else if(a.id=="Basic")a.onClick=b.hitch(e,e.switchToBasic),a.caption=Config.Strings.BasicVersion;else if(a.id=="Accessible")a.onClick=b.hitch(e,e.a11yPrompt);else if(a.id=="Phoenix")if(Settings.CanSwitchToPhoenix&&Config.PhoenixSwitchUrl)a.onClick=b.hitch(e,e.onPhoenixLink);else return!1;else if(a.id=="WelcomeFTE")return!1;else if(a.id=="ResetBubblePins")a.onClick=function(){ws.bubbleConfig.resetPinPref()},
a.caption="";else if(a.id=="ErrorConsole")if(Config.ClientLogAllEnabled&&Config.ClientLogConsoleEnabled)a.onClick=ws.WebSuite.openErrorConsole,a.isErrorConsoleMenuItem=!0;else return!1;else a.onClick=b.hitch(ws.io,"openWindow",a.url);a.title="";return!0}):(this.megaMenuDef=[{caption:Config.Strings.Settings,onClick:b.hitch(e,e.onSettingsClick)}],Config.PubCalHelpURL&&this.megaMenuDef.push({caption:Config.Strings.Calendar,onClick:b.hitch(ws.io,"openWindow",Config.PubCalHelpURL)}));if(a&&a.length)if(a.push({separator:!0}),
this.megaMenu){if(this.linkedScreenNamesInMenu&&this.linkedScreenNamesInMenu.length>0)for(var f=0;f<this.linkedScreenNamesInMenu.length;f++)this.linkedScreenNamesInMenu[f].destroy();this.linkedScreenNamesInMenu=[];b.forEach(a,function(a,f){var j=new (a.dojoType?eval(a.dojoType):a.separator?ws.widget.WSMenuSeparator:ws.widget.WSMenuItem)(a);j.startup();e.linkedScreenNamesInMenu.push(j);b.place(j.domNode,e.megaMenu.containerNode,f)})}else this.megaMenuDef=a.concat(this.megaMenuDef);if(!this.megaMenu)this.megaMenu=
ws.widget.createMenu(this.megaMenuDef),b.addClass(this.megaMenu.domNode,"megaMenu"),this.megaMenu.bindDomNode(this.megaMenuNode),this.megaMenu.menuOrient={BR:"TR"},this.connect(this.megaMenuNode,"onmouseup","onMegaMouseUp"),this.megaMenu.connect(this.megaMenu,"open",b.hitch(this,"onMegaMenuOpen")),this.megaMenu.connect(this.megaMenu,"onClose",b.hitch(this,"onMegaMenuClose"))},setWidth:function(){var a=236,e=ws.WebSuite.viewportSize?ws.WebSuite.viewportSize.w:b.window.getBox().w;e>=1280?a=331:e>1090&&
(a=236+Math.floor((e-1090)/2));this.searchWebField.style.width=a+"px";if(!this.rightHatWidth)this.rightHatWidth=b._getMarginSize(this.rightHat).w;this.searchAreaNode.style.right=this.rightHatWidth+30+"px";this.megaMenu&&this.megaMenu.domNode.style.display!="none"&&this.megaMenu.close()},onKeyPressSearchWebField:function(a){a.keyCode==b.keys.ENTER&&(this.doSearchWeb(),a.preventDefault())},doSearchWeb:function(){this.showWebSearchPulldown()?this.searchWebPulldownClick():this.searchWeb()},updateMenuPulldown:function(){},
launchAndReportSearchWindow:function(a){ws.reporting.reportAction("centersearchdominica");this.searchAutoComplete&&(a=this.searchAutoComplete.updateUrlInvocationType(a));(this.newhw=ws.io.openWindow(a))&&setTimeout(b.hitch(this,function(){this.newhw.focus()}),50)},searchWebPulldownClick:function(){var a="",a=this.searchWebField.value,e=null,e=this.searchWebButton?this.getWebSearchUrl(this.searchWebButton.getLabel())+encodeURIComponent(a):Config.WebSearchUrl+encodeURIComponent(a);this.launchAndReportSearchWindow(e)},
searchWeb:function(){var a="",a=this.searchWebField.value;this.launchAndReportSearchWindow(Config.WebSearchUrl+encodeURIComponent(a))},getWebSearchUrl:function(a){return a==Config.Strings.Hat_Web_SearchOption1?Config.WebSearchUrlOption1:Config.WebSearchUrl},searchWebUsingUrl:function(a){this.searchWebButton&&(this.searchWebButton.IsEqualsLabel(a)||this.searchWebButton.setLabel(a));var e="",e=this.searchWebField.value;this.launchAndReportSearchWindow(this.getWebSearchUrl(a)+encodeURIComponent(e))},
showWebSearchPulldown:function(){return Config.PageLocale=="en-in"},updateBuddyIcon:function(){var a=ws.UserContext.ActiveScreenName||"";if(a)this.iconNode.show({screenName:a}),this.iconNode.editBG=document.createElement("div"),b.addClass(this.iconNode.editBG,"iconEditBg"),this.iconNode.editLabel=document.createElement("div"),b.addClass(this.iconNode.editLabel,"iconEdit"),this.iconNode.editLabel.innerHTML=Config.Strings.Label_GroupEdit,this.iconNode.domNode.appendChild(this.iconNode.editBG),this.iconNode.domNode.appendChild(this.iconNode.editLabel),
a=b.hitch(this,this.onIconClick),this.iconNode.onClick=a,this.iconNode.editBG.onclick=a,this.iconNode.editLabel.onclick=a,this.connect(this.iconNode,"onMouseOver","handleIconOver"),this.connect(this.iconNode,"onMouseOut","handleIconOut")},onIconClick:function(){Config.MakeBuddyIconUrl&&ws.io.openWindow(Config.MakeBuddyIconUrl)},handleIconOver:function(a){this.iconNode.editLabel.style.display="block";this.iconNode.editBG.style.display="block";a&&a.stopPropagation&&a.stopPropagation()},handleIconOut:function(a){this.iconNode.editLabel.style.display=
"none";this.iconNode.editBG.style.display="none";a&&a.stopPropagation&&a.stopPropagation()},onSettingsClick:function(){Settings.WSSConnectError?ws.widget.Dialogs.ok(typeof ws.CalSolo!="undefined"?Config.Strings.SettingsDisabledCal:Config.Strings.SettingsDisabled):this.openSettingsCB&&this.openSettingsCB()},onThemeClick:function(){if(this.themePicker)this.themePicker.onChangeTheme()},onPhoenixLink:function(){top.location=Config.PhoenixSwitchUrl},switchToBasic:function(){top.location=Config.BasePagesURL+
"Lite/Today.aspx"},a11yPrompt:function(){var a="<B>"+Config.Strings.AccessibleVersionPrompt1+"</B><P>"+Config.Strings.AccessibleVersionPrompt2+"<P>"+ws.string.substituteParams(Config.Strings.AccessibleVersionPrompt3,"<B>","</B>");ws.widget.Dialogs.okCancel(a,b.hitch(this,function(a){if(a)top.location=Config.BasePagesURL+"Lite/Today.aspx?AccessibilityRedirect=true"}))},openMailBlog:function(){ws.io.openWindow("http://mailblog.aol.com")},onMegaMouseUp:function(a){a.shiftKey&&(a.ctrlKey?b.publish("WSSessionExpired",
[Config.Strings.AuthTimeoutMain]):ws.io.openWindow(Config.BasePagesURL+"tools/Support.aspx"),a.preventDefault(),a.stopPropagation())},onMegaMenuOpen:function(){var a=this.megaMenu.getChildren();a&&b.forEach(a,function(a){if(a.isErrorConsoleMenuItem)a.domNode.style.display=ws.WebSuite.getErrorCount()?"":"none";else if(a.id=="ResetBubblePins")Config.BubblePinsEnabled?(a.domNode.style.display="",a.setCaption(ws.bubbleConfig.getOptionMenuLabel())):a.domNode.style.display="none"});b.publish("MegaMenuOpen")},
onMegaMenuClose:function(){b.publish("MegaMenuClose")},onLogoClick:function(){Config.MainLogoClickURL?ws.io.openWindow(Config.MainLogoClickURL,"_blank"):this.clickLogo()},clickLogo:function(){},updateLinkedScreenNames:function(){ws.lang.ensureLayersLoaded(b.hitch(this,"_updateLinkedScreenNames"))},_updateLinkedScreenNames:function(){ws.io.rpc({action:"GetScreenNames",automatic:!0,content:{updateMsgCounts:!0},load:b.hitch(this,function(a){this.screenNames=a.screenNames;var e=[];if(a.enabled&&this.screenNames.length>
1){if(this.screenNames.length>1){for(var f=0;f<this.screenNames.length;f++){var g=this.screenNames[f],h=g.screenName;g.newMsgCount>0&&!g.activeUser&&(h=h+" ("+g.newMsgCount+")");e.push({caption:h,onClick:b.hitch(this,"switchScreenName",g)})}e.push({caption:Config.Strings.ManageScreenNamesText,onClick:b.hitch(this,"manageScreenNames")})}else h=Config.Strings.LinkedAccountDescription+"<br><br><span class='wsLink'>"+Config.Strings.LinkedAccountLink+"</span>",e.push({caption:h,width:150,onClick:b.hitch(this,
"manageScreenNames")});this.updateLSNTimeout=setTimeout(b.hitch(this,"updateLinkedScreenNames"),this.checkLinkedScreenNamesInterval)}e.length&&this.initMegaMenu(e);Config.EnableLinkedScreenNames=a.enabled}),error:b.hitch(this,function(){this.updateLSNTimeout=setTimeout(b.hitch(this,"updateLinkedScreenNames"),this.checkLinkedScreenNamesInterval)})})},switchScreenName:function(a){ws.reporting.reportAction("Switch Screen Name");ws.io.rpc({action:"SwitchScreenName",content:{screenName:a.screenName},load:function(a){a.url?
document.location.replace(a.url):a.loginRequired&&b.publish("WSSessionExpired",[null,a.screenName,!1])},error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for SwitchScreenName-switchScreenName file:Hat.js");ws.widget.Dialogs.ok(a||"There was an error switching screen names.")}})},manageScreenNames:function(){(this.manageScreenNamesWindow=ws.io.openWindow(Config.ManageScreenNamesUrl,"","status=no,resizable=yes,menubar=no,scrollbars=no,left=250,top=150,width=570,height=460"))&&
this.checkManageScreenNamesWindow()},checkManageScreenNamesWindow:function(){this.manageScreenNamesWindow.closed?(ws.widget.Dialogs.ok(Config.Strings.ManageScreenNamesNotification),this.manageScreenNamesWindow=null):setTimeout(b.hitch(this,"checkManageScreenNamesWindow"),500)},composeMessage:function(){},checkMail:function(){},_showFF3MailToDiscovery:function(){if(!this.ff3MailToTip)this.ff3MailToTip=new ws.widget.FTUTip({name:"FF3MailTo",content:Config.Strings.FF3MailTo_FTUTip+"<div style='height:30px;margin-top:10px;'><div class='btn' style='float:left;margin-left:40px'><span class='btnLabel'>"+
Config.Strings.FF3MailTo_ButtonYes+"</span></div><div style='float:left;margin:5px 0 0 20px'><a href='#'>"+Config.Strings.NoThanks+"</a></div></div>",positionOverNode:this.screenNameNode,arrowPosition:"top",distanceArrowFromEdge:245,dimensions:{w:240},offset:{x:-233,y:30},onClick:function(){},load:b.hitch(this,function(){this.ff3MailToTip.connect(b.query(".btn",this.ff3MailToTip.message)[0],"onclick",b.hitch(this,function(){ws.reporting.reportAction("AOL mail Add on promotion for FF");ws.browser.registerMailToHandler();
this.ff3MailToTip.offset.y=2;this.ff3MailToTip.placeOnScreen();this.ff3MailToTip.message.innerHTML=ws.string.substituteParams("<div style='margin-bottom:10px'>"+Config.Strings.FF3MailTo_Added+"<div class='btn' style='margin:5px 0 15px 90px'><span class='btnLabel'>"+Config.Strings.Done+"</span></div></div>","<b>","</b>");this.ff3MailToTip.connect(b.query(".btn",this.ff3MailToTip.message)[0],"onclick",b.hitch(this,function(){this.ff3MailToTip.closeTip()}))}));this.ff3MailToTip.connect(b.query("a",this.ff3MailToTip.ftutip)[0],
"onclick",b.hitch(this,function(){this.ff3MailToTip.closeTip()}))})}),b.body().appendChild(this.ff3MailToTip.domNode),this.ff3MailToTip.startup();this.ff3MailToTip.showTip()},_blockHatAds:function(){},promoThemeAdsBlock:function(a){this.HatRevenue&&this.HatRevenue.setShowing(!a);this.promoThemeAdsBlocked=a;this._blockHatAds(this.hatAdsAreBlocked())},searchBarAdsBlock:function(a){this.searchBarAdsBlocked=a;this._blockHatAds(a)},hatAdsAreBlocked:function(){return this.searchBarAdsBlocked||this.promoThemeAdsBlocked}}));
if(!b._hasResource["ws.dom"])b._hasResource["ws.dom"]=!0,b.provide("ws.dom"),ws.dom={forEachNode:function(a,e,b){for(var a=a.childNodes,g=0;g<a.length;g++){var h=a[g],j=!1;e!=null&&(j=e(h));j||(ws.dom.forEachNode(h,e,b),b!=null&&(g+=b(h)))}},findAncestorByClass:function(a,e){for(;a;){if(b.hasClass(a,e))return a;a=a.parentNode}return null}};if(!b._hasResource["ws.sound"])b._hasResource["ws.sound"]=!0,b.provide("ws.sound"),ws.sound={play:function(a,e){if(this.available()){if(e==null||typeof e=="undefined")e=
!0;b.isIE?this._playBgsound(a):this._playFlash(a,e)}},available:function(){if(b.isIE)return!0;var a=navigator.plugins["Shockwave Flash"];if(a)var e=a.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split(".")[0];return a&&e>=8},_playBgsound:function(a){if(!this._bgsoundNode)this._bgsoundNode=document.createElement("bgsound"),b.body().appendChild(this._bgsoundNode);this._bgsoundNode.src=a},_playFlash:function(a,e){if(!this._flashMovies[a]){var f="wsSoundMovie"+this._flashCount++,
g=ws.string.substituteParams('<embed src="{swf}" FlashVars="id={id}" allowScriptAccess="always" quality="high" bgcolor="#ffffff" width="0" height="0" name="{id}" align="middle" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" />',{id:f,swf:Config.BaseSameDomainURL+"resources/common/SoundBridge.swf"}),h=document.createElement("div");document.body.appendChild(h);h.innerHTML=g;this._flashMovies[a]=document[f]}this._flashMovies[a].proxyMethods?setTimeout(b.hitch(this,
function(){this._flashMovies[a].proxyMethods("loadSound",[a,e])}),b.isSafari?500:0):ws.lang.setTimeout(this,"_playFlash",500,a,e)},_flashCount:0,_flashMovies:{}},Sound={onLoad:function(){},onSoundComplete:function(){},onID3:function(){}};b._hasResource["dijit.layout.SplitContainer"]||(b._hasResource["dijit.layout.SplitContainer"]=!0,b.provide("dijit.layout.SplitContainer"),b.declare("dijit.layout.SplitContainer",k.layout._LayoutWidget,{constructor:function(){b.deprecated("dijit.layout.SplitContainer is deprecated",
"use BorderContainer with splitter instead",2)},activeSizing:!1,sizerWidth:7,orientation:"horizontal",persist:!0,baseClass:"dijitSplitContainer",postMixInProperties:function(){this.inherited("postMixInProperties",arguments);this.isHorizontal=this.orientation=="horizontal"},postCreate:function(){this.inherited(arguments);this.sizers=[];if(b.isMozilla)this.domNode.style.overflow="-moz-scrollbars-none";if(typeof this.sizerWidth=="object")try{this.sizerWidth=parseInt(this.sizerWidth.toString())}catch(a){this.sizerWidth=
7}var e=b.doc.createElement("div");this.virtualSizer=e;e.style.position="relative";e.style.zIndex=10;e.className=this.isHorizontal?"dijitSplitContainerVirtualSizerH":"dijitSplitContainerVirtualSizerV";this.domNode.appendChild(e);b.setSelectable(e,!1)},destroy:function(){delete this.virtualSizer;b.forEach(this._ownconnects,b.disconnect);this.inherited(arguments)},startup:function(){this._started||(b.forEach(this.getChildren(),function(a,e,b){this._setupChild(a);e<b.length-1&&this._addSizer()},this),
this.persist&&this._restoreState(),this.inherited(arguments))},_setupChild:function(a){this.inherited(arguments);a.domNode.style.position="absolute";b.addClass(a.domNode,"dijitSplitPane")},_onSizerMouseDown:function(a){if(a.target.id){for(var e=0;e<this.sizers.length;e++)if(this.sizers[e].id==a.target.id)break;e<this.sizers.length&&this.beginSizing(a,e)}},_addSizer:function(a){var a=a===void 0?this.sizers.length:a,e=b.doc.createElement("div");e.id=k.getUniqueId("dijit_layout_SplitterContainer_Splitter");
this.sizers.splice(a,0,e);this.domNode.appendChild(e);e.className=this.isHorizontal?"dijitSplitContainerSizerH":"dijitSplitContainerSizerV";a=b.doc.createElement("div");a.className="thumb";e.appendChild(a);this.connect(e,"onmousedown","_onSizerMouseDown");b.setSelectable(e,!1)},removeChild:function(a){if(this.sizers.length){var e=b.indexOf(this.getChildren(),a);e!=-1&&(e==this.sizers.length&&e--,b.destroy(this.sizers[e]),this.sizers.splice(e,1))}this.inherited(arguments);this._started&&this.layout()},
addChild:function(a,e){this.inherited(arguments);this._started&&(this.getChildren().length>1&&this._addSizer(e),this.layout())},layout:function(){this.paneWidth=this._contentBox.w;this.paneHeight=this._contentBox.h;var a=this.getChildren();if(a.length){var e=this.isHorizontal?this.paneWidth:this.paneHeight;a.length>1&&(e-=this.sizerWidth*(a.length-1));var f=0;b.forEach(a,function(a){f+=a.sizeShare});var g=e/f,h=0;b.forEach(a.slice(0,a.length-1),function(a){var e=Math.round(g*a.sizeShare);a.sizeActual=
e;h+=e});a[a.length-1].sizeActual=e-h;this._checkSizes();var j=0,m=a[0].sizeActual;this._movePanel(a[0],j,m);a[0].position=j;j+=m;this.sizers&&b.some(a.slice(1),function(a,e){if(!this.sizers[e])return!0;this._moveSlider(this.sizers[e],j,this.sizerWidth);this.sizers[e].position=j;j+=this.sizerWidth;m=a.sizeActual;this._movePanel(a,j,m);a.position=j;j+=m},this)}},_movePanel:function(a,e,f){this.isHorizontal?(a.domNode.style.left=e+"px",a.domNode.style.top=0,e={w:f,h:this.paneHeight}):(a.domNode.style.left=
0,a.domNode.style.top=e+"px",e={w:this.paneWidth,h:f});a.resize?a.resize(e):b.marginBox(a.domNode,e)},_moveSlider:function(a,e,f){this.isHorizontal?(a.style.left=e+"px",a.style.top=0,b.marginBox(a,{w:f,h:this.paneHeight})):(a.style.left=0,a.style.top=e+"px",b.marginBox(a,{w:this.paneWidth,h:f}))},_growPane:function(a,e){if(a>0&&e.sizeActual>e.sizeMin)e.sizeActual-e.sizeMin>a?(e.sizeActual-=a,a=0):(a-=e.sizeActual-e.sizeMin,e.sizeActual=e.sizeMin);return a},_checkSizes:function(){var a=0,e=0,f=this.getChildren();
b.forEach(f,function(b){e+=b.sizeActual;a+=b.sizeMin});if(a<=e){var g=0;b.forEach(f,function(a){if(a.sizeActual<a.sizeMin)g+=a.sizeMin-a.sizeActual,a.sizeActual=a.sizeMin});g>0&&(f=this.isDraggingLeft?f.reverse():f,b.forEach(f,function(a){g=this._growPane(g,a)},this))}else b.forEach(f,function(b){b.sizeActual=Math.round(e*(b.sizeMin/a))})},beginSizing:function(a,e){var f=this.getChildren();this.paneBefore=f[e];this.paneAfter=f[e+1];this.isSizing=!0;this.sizingSplitter=this.sizers[e];this.cover?this.cover.style.zIndex=
5:this.cover=b.create("div",{style:{position:"absolute",zIndex:5,top:0,left:0,width:"100%",height:"100%"}},this.domNode);this.sizingSplitter.style.zIndex=6;this.originPos=b.position(f[0].domNode,!0);if(this.isHorizontal){var f=a.layerX||a.offsetX||0,g=a.pageX;this.originPos=this.originPos.x}else f=a.layerY||a.offsetY||0,g=a.pageY,this.originPos=this.originPos.y;this.startPoint=this.lastPoint=g;this.screenToClientOffset=g-f;this.dragOffset=this.lastPoint-this.paneBefore.sizeActual-this.originPos-this.paneBefore.position;
this.activeSizing||this._showSizingLine();this._ownconnects=[];this._ownconnects.push(b.connect(b.doc.documentElement,"onmousemove",this,"changeSizing"));this._ownconnects.push(b.connect(b.doc.documentElement,"onmouseup",this,"endSizing"));b.stopEvent(a)},changeSizing:function(a){if(this.isSizing)this.lastPoint=this.isHorizontal?a.pageX:a.pageY,this.movePoint(),this.activeSizing?this._updateSize():this._moveSizingLine(),b.stopEvent(a)},endSizing:function(){if(this.isSizing){if(this.cover)this.cover.style.zIndex=
-1;this.activeSizing||this._hideSizingLine();this._updateSize();this.isSizing=!1;this.persist&&this._saveState(this);b.forEach(this._ownconnects,b.disconnect)}},movePoint:function(){var a=this.lastPoint-this.screenToClientOffset;a-=this.dragOffset;a=this.legaliseSplitPoint(a);a+=this.dragOffset;this.lastPoint=a+this.screenToClientOffset},legaliseSplitPoint:function(a){a+=this.sizingSplitter.position;this.isDraggingLeft=!!(a>0);if(!this.activeSizing){var e=this.paneBefore.position+this.paneBefore.sizeMin;
a<e&&(a=e);e=this.paneAfter.position+(this.paneAfter.sizeActual-(this.sizerWidth+this.paneAfter.sizeMin));a>e&&(a=e)}a-=this.sizingSplitter.position;this._checkSizes();return a},_updateSize:function(){var a=this.lastPoint-this.dragOffset-this.originPos,e=this.paneAfter.position+this.paneAfter.sizeActual;this.paneBefore.sizeActual=a-this.paneBefore.position;this.paneAfter.position=a+this.sizerWidth;this.paneAfter.sizeActual=e-this.paneAfter.position;b.forEach(this.getChildren(),function(a){a.sizeShare=
a.sizeActual});this._started&&this.layout()},_showSizingLine:function(){this._moveSizingLine();b.marginBox(this.virtualSizer,this.isHorizontal?{w:this.sizerWidth,h:this.paneHeight}:{w:this.paneWidth,h:this.sizerWidth});this.virtualSizer.style.display="block"},_hideSizingLine:function(){this.virtualSizer.style.display="none"},_moveSizingLine:function(){b.style(this.virtualSizer,this.isHorizontal?"left":"top",this.lastPoint-this.startPoint+this.sizingSplitter.position+"px")},_getCookieName:function(a){return this.id+
"_"+a},_restoreState:function(){b.forEach(this.getChildren(),function(a,e){var f=this._getCookieName(e);if(f=b.cookie(f))if(f=parseInt(f),typeof f=="number")a.sizeShare=f},this)},_saveState:function(){this.persist&&b.forEach(this.getChildren(),function(a,e){b.cookie(this._getCookieName(e),a.sizeShare,{expires:365})},this)}}),b.extend(k._Widget,{sizeMin:10,sizeShare:10}));b._hasResource["ws.widget.WSSplitContainer"]||(b._hasResource["ws.widget.WSSplitContainer"]=!0,b.provide("ws.widget.WSSplitContainer"),
b.declare("ws.widget.WSSplitContainer",k.layout.SplitContainer,{addSizerFunc:function(a){this.sizerFunc=a},addClickFunc:function(a){this.clickFunc=a},_checkSizes:function(){var a=0,e=0,f=this.getChildren();b.forEach(f,function(b){e+=b.sizeActual;a+=b.sizeMin});if(a<=e){var g=0,h=this._forceGrow;b.forEach(f,function(a){if(a.sizeActual<a.sizeMin&&(h||!h&&a.sizeActual>a.sizeMin/2))g+=a.sizeMin-a.sizeActual,a.sizeActual=a.sizeMin});g>0&&(f=this.isDraggingLeft?f.reverse():f,b.forEach(f,function(a){g=this._growPane(g,
a)},this))}else b.forEach(f,function(b){b.sizeActual=Math.round(e*(b.sizeMin/a))})},legaliseSplitPoint:function(a){a+=this.sizingSplitter.position;this.isDraggingLeft=!!(a>0);if(!this.activeSizing){var e=this.paneBefore.position+this.paneBefore.sizeMin;this.paneBefore.collapsable?a<e&&(a=a<e-this.paneBefore.sizeMin/2?e-this.paneBefore.sizeMin:e):a<e&&(a=e);e=this.paneAfter.position+(this.paneAfter.sizeActual-(this.sizerWidth+this.paneAfter.sizeMin));this.paneAfter.collapsable?a>e&&(a=a>e+this.paneAfter.sizeMin/
2?e+this.paneAfter.sizeMin:e):a>e&&(a=e)}this.sizerFunc&&(a=this.sizerFunc(this,a));a-=this.sizingSplitter.position;this._checkSizes();return a},isClick:function(){var a=this.lastTime-this.startTime;return Math.abs(this.startPoint-this.lastPoint)<4&&a<1E3},endSizing:function(){this.inherited(arguments);b.publish("SplitContainer/EndSizing");this.lastTime=+new Date;this.isClick()&&this.clickFunc&&this.clickFunc()},beginSizing:function(){ws.html.clearSelection();this.inherited(arguments);this.startTime=
+new Date;b.publish("SplitContainer/BeginSizing")},changeSizing:function(a,e,f){if(this.isSizing)this.lastPoint=a?this.isHorizontal?a.pageX:a.pageY:this.isHorizontal?e:f,this.movePoint(),this.activeSizing?this._updateSize():this._moveSizingLine(),a&&b.stopEvent(a)},_onSizerMouseDown:function(a){var e=a.target;if(b.hasClass(e,"thumb"))e=e.parentNode;if(e.id){for(var f=0;f<this.sizers.length;f++)if(this.sizers[f].id==e.id)break;f<this.sizers.length&&this.beginSizing(a,f)}}}));b._hasResource["ws.widget.DefaultTextbox"]||
(b._hasResource["ws.widget.DefaultTextbox"]=!0,b.provide("ws.widget.DefaultTextbox"),b.provide("ws.widget.DefaultTextarea"),b.declare("ws.widget.DefaultTextbox",[k._Widget,k._Templated],{templateString:"<input type='text' maxlength='${maxlength}' id='${id}' class='wsInput ${className}' size='${size}' tabindex='${tabindex}' style='width:${fieldWidth}' dojoAttachPoint='textbox' dojoAttachEvent='onblur:_onBlur,onfocus:_onFocus,onkeyup:_onKeyUp,onkeypress:_onKeyPress,onclick: onInputClick'>",value:"",
origValue:"",defaultValue:"",doValueSelect:!1,className:"",clearableInputClassName:"",size:50,fieldWidth:"",maxlength:255,tabindex:500,startup:function(){this.setValue(this.value);if(this.value)this.origValue=this.value},getValue:function(){return this.textbox.value==this.defaultValue?"":b.trim(this.textbox.value)},getOrigValue:function(){return this.origValue},setOrigValue:function(a){this.origValue=a},setValue:function(a,e){a=a||"";this.textbox.value=b.trim(a)==""&&!e?this.defaultValue:a;this.doValueSelect&&
this.value==this.textbox.value&&setTimeout(b.hitch(this,function(){ws.html.selectInputText(this.textbox)}),100);this._updateClass()},focus:function(){this.textbox.focus()},select:function(){this.textbox.select()},_onFocus:function(){if(this.textbox.value==this.defaultValue&&!this.doValueSelect)this.textbox.value="",this.textbox.focus();this._updateClass();this.onFocus()},onFocus:function(){},_onBlur:function(a){if(b.trim(this.textbox.value)=="")this.textbox.value=this.defaultValue;this._updateClass();
this.onBlur(a)},onBlur:function(){},onInputClick:function(){b.isMoz&&this.domNode.focus()},_onKeyUp:function(a){ws.lang.setTimeout(b.hitch(this,"onChange",a),0)},onChange:function(){},_updateClass:function(){this.defaultValue!=""&&!this.doValueSelect&&b.toggleClass(this.textbox,"wsInputDefault",this.textbox.value==this.defaultValue)},_onKeyPress:function(a){var e=a.charCode||a.keyCode>=65&&a.keyCode<=90;this.textbox.value.length>=this.maxLength&&e&&a.preventDefault();this.onKeyPress(a)},onKeyPress:function(){}}),
b.declare("ws.widget.DefaultTextarea",ws.widget.DefaultTextbox,{templateString:"<textarea tabindex='${tabindex}' dojoAttachEvent='onblur:_onBlur,onfocus:_onFocus,onkeyup:_onKeyUp,onkeypress:_onKeyPress' dojoAttachPoint='textbox' class='wsInput ${className}' style='width:${fieldWidth}' rows='${rows}' cols='${cols}'>${value}</textarea>",rows:4,cols:70,maxLength:4096,_onKeyPress:function(a){var e=a.charCode||a.keyCode>=65&&a.keyCode<=90;this.textbox.value.length>=this.maxLength&&e&&a.preventDefault()}}),
b.declare("ws.widget.ClearableTextbox",ws.widget.DefaultTextbox,{templateString:"<div class='${className} clearTextbox'><input type='text' maxlength='${maxlength}' class='wsInput ${clearableInputClassName}' tabindex='${tabindex}' dojoAttachPoint='textbox' dojoAttachEvent='onblur:_onBlur,onfocus:_onFocus,onkeyup:_onKeyUp'><img dojoAttachPoint='clearButton' dojoAttachEvent='onclick:clear' src='${spacer}' class='mainSprite wsHotClearButton' style='display:none;'></div>",_onKeyUp:function(){ws.widget.ClearableTextbox.superclass._onKeyUp.apply(this,
arguments);ws.html.setShowing(this.clearButton,!!this.getValue())},clear:function(){this.setValue("");this._onKeyUp()}}));b._hasResource["ws.widget.WSMenu"]||(b._hasResource["ws.widget.WSMenu"]=!0,b.provide("ws.widget.WSMenu"),b.declare("ws.widget.WSMenu",[k._Widget,k._Templated,k._Container],{templateString:'<div class="wsMenu" style="display: none;">\t<table border=0 cellspacing=0 cellpadding=0>\t\t<tbody dojoAttachPoint="containerNode"></tbody>\t</table></div>',css:{templateString:""},scrollBarWidth:0,
scrollBarWidthHasBeenAdded:!1,menuOrient:null,padding:b.isMac&&b.isWebKit?[0,-1]:[0,5],startup:function(){b.forEach(this.getChildren(),function(a){a.startup()});this._started=!0;this.scrollBarWidth=ws.WebSuite.scrollbarWidth;this.subscribe("wsresize","close")},open:function(a,e,b,g){var h,j;typeof a=="number"&&(h=a,j=e,e=b,b=g,a=null);ws.widget.popup({popup:this,x:h,y:j,around:a,orient:this.menuOrient||b,parent:e,padding:this.padding,shadow:!1})},onOpen:function(){this.domNode.style.height="";var a=
b._getMarginSize(this.domNode),e=b.window.getBox().h;if(a.h>e){var f=this.scrollBarWidthHasBeenAdded?0:this.scrollBarWidth;this.scrollBarWidthHasBeenAdded=!0;b.marginBox(this.domNode,{h:e,w:a.w+f})}else if(this.scrollBarWidthHasBeenAdded)b.marginBox(this.domNode,{w:a.w-this.scrollBarWidth}),this.scrollBarWidthHasBeenAdded=!1},close:function(){ws.widget.popup.close(this)},onClose:function(){b.forEach(this.getChildren(),function(a){a.onClose()})},bindDomNode:function(a,e,b){this.boundNode=a;this.boundParentWidget=
e;b||this.connect(a,"onclick","openMyself")},openMyself:function(){if(this.isShowing())return this.close();this.open(this.boundNode,this.boundParentWidget)},getBorderBoxWidth:function(){if(this.isShowing())return b._getMarginSize(this.domNode).w;this.domNode.style.position="absolute";this.domNode.style.left="-9999px";this.domNode.style.top="-9999px";this.domNode.style.display="";var a=b._getMarginSize(this.domNode).w;this.domNode.style.position="";this.domNode.style.left="";this.domNode.style.top=
"";this.domNode.style.display="none";return a},processKey:function(a){var e=b.filter(this.getChildren(),function(e){return e.shortCutKey&&e.shortCutKey.toLowerCase()==a.keyChar.toLowerCase()})[0];e&&(e._onClick(),b.stopEvent(a))},hideChild:function(a){b.query("#"+this.id+" tbody tr:nth-child("+a+")").style("display","none")},showChild:function(a){b.query("#"+this.id+" tbody tr:nth-child("+a+")").style("display","")},setChecked:function(a,e){e&&this.setUnchecked();var f=this.getChildren();f&&b.forEach(a,
function(a){f[a]&&f[a].setChecked(!0)})},setUnchecked:function(a){var e=this.getChildren();if(b.isArray(a))b.forEach(a,function(a){e[a]&&e[a].setChecked(!1)});else for(a=0;a<e.length;a++)e[a].setChecked(!1)}}),b.declare("ws.widget.WSMenuItem",[k._Widget,k._Templated,k._Contained],{templateString:'<tr class="wsMenuItem" dojoAttachEvent="onclick: _onClick" title="${title}">\t<td tabIndex="-1"><div class="iconNode" dojoAttachPoint="iconNode"></div></td>\t<td tabIndex="-1" class="label" dojoAttachPoint="labelNode"></td>\t<td tabIndex="-1"><div class="checkNode" dojoAttachPoint="checkNode"></div></td></tr>',
checkOnClass:"ckonCol",checkOffClass:"ckoffCol",iconClass:null,width:0,caption:"",title:"",shortCutKey:null,disabled:!1,mouseOverColor:"#E7F1F8",isCheckable:!0,className:null,isLabel:!1,noHoverColor:!1,startup:function(){b.setSelectable(this.domNode,!1);this.domNode.title=this.title;if(this.width)this.labelNode.style.width=this.width+"px",this.domNode.style.whiteSpace="normal";this.className&&b.addClass(this.domNode,this.className);this.setChecked();this.iconClass&&b.addClass(this.iconNode,this.iconClass);
if(this.isLabel)this.disabled=!0,b.addClass(this.labelNode,"menuItemLabel");this.updateDisabled();this.labelNode.innerHTML=this.caption;this._updateMouseOverColor();this._handleHover(this.domNode);Config.EnableThemes&&this.subscribe("Theme/Change","_updateMouseOverColor")},_updateMouseOverColor:function(){this.mouseOverColor=this._getHoverColor()},_getHoverColor:function(){var a="#e4edfa";this.domNode&&!this.noHoverColor&&(b.addClass(this.domNode,"wsMenuItemHover"),a=b.style(this.domNode,"backgroundColor")||
a,b.removeClass(this.domNode,"wsMenuItemHover"));return this.noHoverColor?"#fff":a},_handleHover:function(a){this.connect(a,"onmouseenter",function(){a.style.backgroundColor=this.mouseOverColor});this.connect(a,"onmouseleave",function(){a.style.backgroundColor="#fff"})},_onClick:function(a){this.disabled||(this.domNode&&this.getParent().close(),this.onClick());b.stopEvent(a)},onClick:function(){},enable:function(){this.disabled=!1;this.updateDisabled()},disable:function(){this.disabled=!0;this.updateDisabled()},
updateDisabled:function(){b.toggleClass(this.domNode,"wsMenuItemDisabled",this.disabled)},setChecked:function(a){if(this.isCheckable){if(typeof a!="undefined")this.checked=a;typeof this.checked!="undefined"&&(b.toggleClass(this.checkNode,this.checkOnClass,this.checked),b.toggleClass(this.checkNode,this.checkOffClass,!this.checked))}},setCaption:function(a){this.labelNode.innerHTML=a},onClose:function(){this.domNode.style.backgroundColor="#fff"}}),b.declare("ws.widget.WSInputableMenuItem",ws.widget.WSMenuItem,
{templateString:'<tr class="wsMenuItem" dojoAttachEvent="onclick: _onClick">\t<td tabIndex="-1" colspan="3" class="inputableItemLabel" dojoAttachPoint="labelNode">\t\t<div class="inputContainer" dojoAttachPoint="inputContainer" dojoAttachEvent="onkeypress: _onKeyPress">\t\t\t<div dojoType="ws.widget.DefaultTextbox" className="${inputClassName}" dojoAttachPoint="input" maxlength="${maxlength}" defaultValue="${defaultValue}"></div>\t\t\t<img class="wsLargeAdd" dojoAttachPoint="newButton" dojoAttachEvent="onclick: onAdd" src="${spacer}"/>           <img style="width:35px; height:1px;" src="${spacer}"/>\t\t</div>\t</td></tr>',
widgetsInTemplate:!0,okCB:null,originalMenuItem:null,defaultValue:"",inputClassName:"newInput",maxlength:255,startup:function(){this.connect(this.getParent(),"onClose","restore")},setCaption:function(a){this.labelNode.innerHTML=a},initializeText:function(a){if(a&&a==this.input.defaultValue){var e=this.input.defaultValue;this.input.defaultValue="";this.input.setValue(a);this.input.textbox.select();setTimeout(b.hitch(this,function(){this.input.defaultValue=e}),0)}else this.input.setValue(a?a:""),this.input.textbox.select()},
_onClick:function(){},_onKeyPress:function(a){if(a.keyCode==b.keys.ENTER){if(this.okCB){var e=!1,e=this.okCB({newName:this.input.getValue()});this.restore();e||this.getParent().close()}}else a.keyCode==b.keys.ESCAPE&&this.restore(!0);a.stopPropagation()},onAdd:function(a){var e=this.input.getValue();if(e){var b=!1;this.okCB&&(b=this.okCB({newName:e}));this.restore();b||this.getParent().close()}a.stopPropagation()},restore:function(){this.originalMenuItem&&this.originalMenuItem.show();this.hide()}}),
b.declare("ws.widget.WSMenuSeparator",ws.widget.WSMenuItem,{templateString:'<tr class="wsMenuSeparator2">\t<td colspan=3>\t\t<div class="wsMenuSeparator wsMenuSeparatorTop"></div>\t\t<div class="wsMenuSeparatorBottom"></div>\t</td></tr>',isCheckable:!1,startup:function(){}}),b.declare("ws.widget.CalendarColorPickerMenuItem",ws.widget.WSMenuItem,{colors:["009712","0360EB","CC0000","E76808","808000","6600FF","008080","800080","6C6C6C","0088FF","646496","FF0080"],_getHoverColor:function(){return"#fff"},
setCurrentColor:function(){for(var a="",e=0;e<this.colors.length;e++)a+=ws.string.substituteParams("{br}<img src='{spacer}' class='wsCalCB wsCalCB_{color} {checked}'>",{spacer:Config.SpacerImageURL,color:this.colors[e],checked:" checked",br:e==this.colors.length/2?"<br>":""});this.labelNode.innerHTML=a},_onClick:function(a){a.target&&b.forEach(this.colors,function(e){b.hasClass(a.target,"wsCalCB_"+e)&&(this.onClick("#"+e),this.getParent()&&this.getParent().close())},this)}}));if(!b._hasResource["ws.calendar.calutil"])b._hasResource["ws.calendar.calutil"]=
!0,b.provide("ws.calendar.calutil"),ws.calendar.calutil={kADDRESS_STREET:0,kADDRESS_CITY:1,kADDRESS_STATE:2,kADDRESS_ZIP:3,kADDRESS_COUNTRY:4,componentColorMap:{"#009712":{border:"#009712",dark:"#009712",light:"#009712"},"#0360EB":{border:"#0360EB",dark:"#0360EB",light:"#0360EB"},"#CC0000":{border:"#CC0000",dark:"#CC0000",light:"#CC0000"},"#E76808":{border:"#E76808",dark:"#E76808",light:"#E76808"},"#808000":{border:"#808000",dark:"#808000",light:"#808000"},"#6600FF":{border:"#6600FF",dark:"#6600FF",
light:"#6600FF"},"#008080":{border:"#008080",dark:"#008080",light:"#008080"},"#800080":{border:"#800080",dark:"#800080",light:"#800080"},"#6C6C6C":{border:"#6C6C6C",dark:"#6C6C6C",light:"#6C6C6C"},"#0088FF":{border:"#0088FF",dark:"#0088FF",light:"#0088FF"},"#646496":{border:"#646496",dark:"#646496",light:"#646496"},"#FF0080":{border:"#FF0080",dark:"#FF0080",light:"#FF0080"}},componentColorMapRGBAIE:{"#009712":"#B2E6A8","#0360EB":"#AACDF5","#CC0000":"#F69E9D","#E76808":"#FED295","#808000":"#F2E7B1",
"#6600FF":"#B7ADEA","#008080":"#9DDBD6","#800080":"#C0A594","#6C6C6C":"#D7D7D7","#0088FF":"#D4E099","#646496":"#B0B0B0","#FF0080":"#F6B7D1"},componentColorMapTxt:{"#009712":"#397031","#0360EB":"#2A5581","#CC0000":"#8F2121","#E76808":"#6C450E","#808000":"#695B13","#6600FF":"#382D72","#008080":"#086D65","#800080":"#4D230A","#6C6C6C":"#656565","#0088FF":"#5F6f0E","#646496":"#292929","#FF0080":"#9F2254"},componentColorMapRGBA:{"#009712":"rgba(66,195,48,0.4)","#0360EB":"rgba(49,137,230,0.4)","#CC0000":"rgba(234,25,25,0.4)",
"#E76808":"rgba(253,148,0,0.4)","#808000":"rgba(223,197,70,0.4)","#6600FF":"rgba(81,60,204,0.4)","#008080":"rgba(20,170,158,0.4)","#800080":"rgba(104,39,0,0.4)","#6C6C6C":"rgba(155,155,155,0.4)","#0088FF":"rgba(148,178,0,0.4)","#646496":"rgba(58,58,58,0.4)","#FF0080":"rgba(233,76,139,0.4)"},initSimpleLocation:function(){return{street:"",city:"",state:"",zip:"",country:"US",originalLocationString:""}},initMapViewStruct:function(){return{width:"140",height:"140",zoom:"10",zoomCtrl:"true",viewCtrl:"false"}},
privateSetSimpleLocationField:function(a,e,f){e=b.trim(e);switch(f){case this.kADDRESS_STREET:a.street=e;break;case this.kADDRESS_CITY:a.city=e;break;case this.kADDRESS_STATE:a.state=e;break;case this.kADDRESS_ZIP:a.zip=e}},reallySimpleLocationToUSAddressParser:function(a){var e=this.initSimpleLocation();e.originalLocationString=a;var f=a.split(",");if(f.length==3){var g=b.trim(f[2]),h=g.lastIndexOf(" ");if(h>=0){var j=g.substring(h+1),j=b.trim(j),m=j.charAt(0);m!=null&&m>="0"&&m<="9"&&(f[2]=b.trim(g.substring(0,
h)),f[3]=j)}}for(g=0;g<f.length;g++)this.privateSetSimpleLocationField(e,f[g],g);f.length==2&&(j=b.trim(f[1]),g=b.trim(f[0]),j.length==5&&parseInt(j)>0?parseInt(g)>0?(this.privateSetSimpleLocationField(e,j,3),this.privateSetSimpleLocationField(e,"",1)):g.length==2&&(this.privateSetSimpleLocationField(e,"",1),this.privateSetSimpleLocationField(e,g,2),this.privateSetSimpleLocationField(e,j,3),this.privateSetSimpleLocationField(e,"",0)):(g=j,j=b.trim(f[0]),!(parseInt(j)>0)&&g.length==2&&(this.privateSetSimpleLocationField(e,
"",0),this.privateSetSimpleLocationField(e,j,1),this.privateSetSimpleLocationField(e,g,2))));if(f.length==1)if(j=b.trim(f[0]),m=j.charAt(0),m!=null&&m>="0"&&m<="9"){a=!0;if(j.length==5)for(g=1;g<5;g++){if(j.charAt(g)<"0"||j.charAt(g)>"9")a=!1}else a=!1;a?(this.privateSetSimpleLocationField(e,"",0),this.privateSetSimpleLocationField(e,"",1),this.privateSetSimpleLocationField(e,"",2),this.privateSetSimpleLocationField(e,j,3)):(this.privateSetSimpleLocationField(e,"",0),this.privateSetSimpleLocationField(e,
e.originalLocationString,1),this.privateSetSimpleLocationField(e,"",2),this.privateSetSimpleLocationField(e,"",3))}else f=a.split(/\s+/),f.length==2?(g=f[0],j=f[1],g.length==2&&this.privateSetSimpleLocationField(e,g,2),m=j.charAt(0),m!=null&&m>="0"&&m<="9"&&this.privateSetSimpleLocationField(e,j,3),this.privateSetSimpleLocationField(e,"",0),e.state.length<1&&e.zip.length<1&&this.privateSetSimpleLocationField(e,e.originalLocationString,1)):(f.length==1&&f[0].length==2?(this.privateSetSimpleLocationField(e,
"",0),this.privateSetSimpleLocationField(e,"",1),this.privateSetSimpleLocationField(e,f[0],2)):(this.privateSetSimpleLocationField(e,"",0),this.privateSetSimpleLocationField(e,e.originalLocationString,1),this.privateSetSimpleLocationField(e,"",2)),this.privateSetSimpleLocationField(e,"",3));return e},showMapLink:function(a,e){this.showMapLinkFromLocStruct(ws.calendar.calutil.reallySimpleLocationToUSAddressParser(a),e,"map")},showMapLinkFromLocStruct:function(a,e,b){if(a!=null&&(!e||this.IsLocationStructValidUSAddress(a))){e=
null;switch(b){case null:case "map":e="http://www.mapquest.com/maps/map.adp?address="+a.street+"&city="+a.city+"&state="+a.state+"&zipcode="+a.zip+"&country=US&cid=lfmaplink";break;case "to":e="http://www.mapquest.com/directions/main.adp?src=maps&1sb=revise&2v=ADDRESS&2a="+a.street+"&2c="+a.city+"&2s="+a.state+"&2z="+a.zip+"&2y=US";break;case "from":e="http://www.mapquest.com/directions/main.adp?src=maps&2sb=revise&1v=ADDRESS&1a="+a.street+"&1c="+a.city+"&1s="+a.state+"&1z="+a.zip+"&1y=US"}e!=null&&
(a=ws.io.openWindow(e,"Mapquest",""),a!=null&&(a.focus(),ws.reporting.reportAction("Show Map")))}},getMapIFrameURL:function(a,e){var b=null;return b=Config.EnableShowInlineMapFreeformParse?ws.string.substituteParams("{0}common/MapUtil.aspx?fullAddress={1}&width={2}&height={3}&zoom={4}&zoomCtrl={5}&viewCtrl={6}",Config.BasePagesURL,a.originalLocationString,e.width,e.height,e.zoom,e.zoomCtrl,e.viewCtrl):ws.string.substituteParams("{0}common/MapUtil.aspx?street={1}&city={2}&state={3}&country=US&width={4}&height={5}&zoom={6}&zoomCtrl={7}&viewCtrl={8}",
Config.BasePagesURL,a.street,a.city,a.state,e.width,e.height,e.zoom,e.zoomCtrl,e.viewCtrl)},kStateAbbrevArray:["AL","AK","AS","AZ","AR","CA","CO","CT","DE","DC","FM","FL","GA","GU","HI","ID","IL","IN","IA","KS","KY","LA","ME","MH","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","MP","OH","OK","OR","PW","PA","PR","RI","SC","SD","TN","TX","UT","VT","VI","VA","WA","WV","WI","WY"],kStateFullArray:["ALABAMA","ALASKA","AMERICAN SAMOA","ARIZONA","ARKANSAS","CALIFORNIA","COLORADO",
"CONNECTICUT","DELAWARE","DISTRICT OF COLUMBIA","FEDERATED STATES OF MICRONESIA","FLORIDA","GEORGIA","GUAM","HAWAII","IDAHO","ILLINOIS","INDIANA","IN","IOWA","KANSAS","KENTUCKY","LOUISIANA","MAINE","MARSHALL ISLANDS","MARYLAND","MASSACHUSETTS","MICHIGAN","MINNESOTA","MISSISSIPPI","MISSOURI","MONTANA","NEBRASKA","NEVADA","NEW HAMPSHIRE","NEW JERSEY","NEW MEXICO","NEW YORK","NORTH CAROLINA","NORTH DAKOTA","NORTHERN MARIANA ISLANDS","OHIO","OKLAHOMA","OREGON","PALAU","PENNSYLVANIA","PUERTO RICO","RHODE ISLAND",
"SOUTH CAROLINA","SOUTH DAKOTA","TENNESSEE","TEXAS","UTAH","VERMONT","VIRGIN ISLANDS","VIRGINIA","WASHINGTON","WEST VIRGINIA","WISCONSIN","WYOMING"],IsLocationStructValidUSAddress:function(a){var e=!1;if(a==null||a.length==0)return!1;if(Config.EnableShowInlineMapFreeformParse)return!0;if(!a.street||!a.city||!a.state)return!1;var a=a.state.toUpperCase(),f=0;a.length==2&&(f=b.indexOf(this.kStateAbbrevArray,a),f>=0&&(e=!0));return e},LocalPopulateCalendarListFromCalArray:function(a,e,b,g){if(a!=null&&
a.length>0)for(var h=0,j=b!=null,m=[],h=0;h<a.length;h++){var k=a[h],l=k[e.id],k=ws.string.escapeXml(k[e.displayName]);j?m.push({display:k,value:l,selected:l==b}):m.push({display:k,value:l,selected:0==h});g.setOptions(m)}},GetDefaultCalid:function(a){var e=ws.UserContext.UserScreenName;e+=a==0?"^0":"^1";return e},DecodeHTMLEntities:function(a){for(var e=a.match(/&#\d+;?/g),b=e?e.length:0,g=0;g<b;g++)var h=String.fromCharCode(e[g].replace(/\D/g,"")),a=a.replace(/&#\d+;?/,h);return a},DecodeHTML:function(a){if(a==
null)return null;a=a.replace(/&#38;|&amp;/g,"&");a=a.replace(/&#60;|&lt;/g,"<");a=a.replace(/&#62;|&gt;/g,">");a=a.replace(/&#34;|&quot;/g,'"');a=a.replace(/&#39;|&apos;/g,"'");return a=a.replace(/\\x2f/g,"/")},GetNext30MinuteIncrement:function(a){a.getMinutes()<30?a.setMinutes(30):(a=ws.date.add(a,ws.date.dateParts.HOUR,1),a.setMinutes(0));return a},GetTimezoneInfo:function(){var a=new Date,e=new Date(a.getFullYear(),0,1,0,0,0,0),a=new Date(a.getFullYear(),6,1,0,0,0,0),e=e.getTimezoneOffset(),a=
a.getTimezoneOffset();return ws.string.substituteParams("{0}|{1}",-e,-a)},GetTimezoneInfoInObject:function(){var a=new Date,e=new Date(a.getFullYear(),0,1,0,0,0,0),a=new Date(a.getFullYear(),6,1,0,0,0,0),e=e.getTimezoneOffset(),a=a.getTimezoneOffset(),b={};b.winterOffset=-e;b.summerOffset=-a;return b},ConvertTimeZoneStringToTZID:function(a){var a="",e=this.GetTimezoneInfoInObject();if(e!=null){var b=e.winterOffset,e=e.summerOffset;b==-480&&e==-420?a="America/Los_Angeles":b==-420&&e==-360?a="America/Denver":
b==-360&&e==-300?a="America/Chicago":b==-300&&e==-240?a="America/New_York":b==-420&&e==-420?a="America/Phoenix":b==-300&&e==-300?a="America/Indianapolis":b==-540&&e==-480?a="America/Anchorage":b==-600&&e==-600?a="Pacific/Honolulu":b==-240&&e==-180?a="America/Halifax":b==-210&&e==-150&&(a="America/St_Johns")}return a},AdjustEndTimeTo30MinsAfterStart:function(a,e,b,g,h,j){if(e.hr!=23||e.hr==23&&e.min==0)e.min==0?(b.hr=e.hr,b.min=30):(b.hr=e.hr+1,b.min=0),e=null,e=g!=null?ws.date.ParseDateFromFormat(g,
h):new Date,e.setHours(b.hr,b.min),a=ws.date.formatDateTime(e,j);return a},AdjustStartTimeTo30MinsBeforeEnd:function(a,e,b,g,h,j){if(!(b.hr==0&&b.min==0))b.min>=30?(e.hr=b.hr,e.min=0):(e.hr=b.hr-1,e.min=30),b=null,b=g!=null?ws.date.ParseDateFromFormat(g,h):new Date,b.setHours(e.hr,e.min),a=ws.date.formatDateTime(b,j);return a},showConfirmRecurDialog:function(a,e){if(a=="edit")var b=Config.Strings.RepeatEventMsg,g=[Config.Strings.RepeatEventOnly,Config.Strings.RepeatEventFuture,Config.Strings.Cancel];
else b=Config.Strings.RepeatEventDelMsg,g=[Config.Strings.RepeatEventDelOnly,Config.Strings.RepeatEventDelFuture,Config.Strings.Cancel];ws.widget.Dialogs.show(b,g,function(a){e&&e(a!=2,a==0?"CHANGE_CURRENT":"CHANGE_FUTURE")},{width:500})},getNewCalTicket:function(){return"tk"+(new Date).getTime()},getPublicCalendarURL:function(a,e){var b=ws.UserContext.ActiveScreenName.replace(/\./g,"_");return Config.PubCalEmailURL+b+"/"+(e!=null?e+"/":"")+this.encode64(a)},getPublicCalendarData:function(a,e){var b=
ws.UserContext.ActiveScreenName.replace(/\./g,"_");return Config.PubCalEmailURL+b+"/"+(e!=null?e+"/":"")+this.encode64(a)+".ics"},getPublicCalendarData2:function(a,e){var b=ws.UserContext.ActiveScreenName.replace(/\./g,"_");return Config.PubCalEmailURL+b+"/"+(e!=null?e+"/":"")+this.encode64(a)+"_ics"},getSharingTableRowNode:function(a,e){var f=b.create("tr",{onmouseover:b.hitch(e,"onMouseOverScreenNameRow"),onmouseout:b.hitch(e,"onMouseOutScreenNameRow")});f.nSn=a;if(Settings.ShowPresenceIcon){var g=
a,h=ws.presence.parseEmailAddress(g);if(h&&b.indexOf(Config.KnownDomains,h.domain)!=-1)g=h.name;g=ws.presence.getBuddyIconUrl({screenName:g});f.appendChild(b.create("td",{className:"buddyIconTD",width:"38px",innerHTML:"<img class='buddyIcon' width='32' height='32' border='1' align='absmiddle' src='"+g+"' onerror='this.src=Config.SpacerImageURL;'>"}));f.appendChild(b.create("td",{width:"155px",innerHTML:"<span style='padding-right:5px' title='"+a+"'>"+a+"</span>"}));f.appendChild(b.create("td",{align:"left",
width:"20px",innerHTML:"<div style='display:none' class='mainSprite wsHotClearButton'></div>"}))}else f.appendChild(b.create("td",{className:"buddyIconTD",width:"0px"})),f.appendChild(b.create("td",{width:"155px",innerHTML:"<span style='padding-right:5px' title='"+a+"'>"+a+"</span>"})),f.appendChild(b.create("td",{align:"left",width:"30px",innerHTML:"<div style='display:none' class='mainSprite wsHotClearButton'></div>"}));f.appendChild(b.create("td",{style:"width:155px;"}));return f},keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
encode64:function(a){var e="",b,g,h,j,m,k,l=0;do b=a.charCodeAt(l++),g=a.charCodeAt(l++),h=a.charCodeAt(l++),j=b>>2,b=(b&3)<<4|g>>4,m=(g&15)<<2|h>>6,k=h&63,isNaN(g)?m=k=64:isNaN(h)&&(k=64),e=e+this.keyStr.charAt(j)+this.keyStr.charAt(b)+this.keyStr.charAt(m)+this.keyStr.charAt(k);while(l<a.length);return e},selectedCalendarsExist:function(a){for(var e=a.getCalendarList(),a=a.calendarEnum,b=0;b<e.length;b++)if(e[b][a.selected])return!0;return!1},showNoCalendarsSelectedDialog:function(a){if(!ws.WebSuite.shownNoCalendarSelectedDialog||
a)return ws.WebSuite.shownNoCalendarSelectedDialog=!0,ws.widget.Dialogs.ok(Config.Strings.NoSelectedCalendars),!0;return!1}};b._hasResource["ws.calendar.CalendarViewModel"]||(b._hasResource["ws.calendar.CalendarViewModel"]=!0,b.provide("ws.calendar.CalendarViewModel"),b.declare("ws.calendar.CalendarViewModel",null,{constructor:function(a){this.today=this.dtend=this.dtstart=null;this.totalMatchingFilter=this.totalItems=0;this.sortDir=this.sortBy=null;this.isSuccess=!1;this.searchStr=null;this.currentServerTime=
new Date;this.isDummyCalendarAccount=!1;this.indexEnum=this.componentEnum=this.calendarEnum=this.dayBucketIndex=this.index=this.components=this.calendars=null;this.isAnonymous=this.loadDataInProgress=!1;this.currentTZIDForPulldown=this.anonymousInitTZIDOffsetStr=this.anonymousCalid="";this.isModelFetchedOnce=!1;b.subscribe("CalendarViewModel/modelUpdated",this,"doModelUpdated");b.subscribe("EditCalendar/Delete",this,"requestUpdate");b.subscribe("SettingsChanged/Calendar",this,"requestUpdateFullRefresh");
if(a)this.modelType=a.modelType},setDummyTZID:function(){var a=null;this.isDummyCalendarAccount&&(a=ws.calendar.calutil.ConvertTimeZoneStringToTZID());return a},getDefaultArgs:function(a,e){var b={calendars:!0,components:!0,index:!1,dayBucketIndex:!0,enums:!this.calendarEnum?!0:!1,dtstart:!this.dtstart?null:ws.date.formatISO8601(this.dtstart),dtend:!this.dtend?null:ws.date.formatISO8601(this.dtend),sortBy:this.sortBy,sortDir:this.sortDir,selectThisOnly:!1};if(a!=null&&a)b.index=!0;if(e!=null&&e)b.enums=
!0;b.dummyTZID=this.setDummyTZID();return b},getDefaultTaskArgs:function(){return{compType:"Todo",calendars:!0,components:!0,index:!0,dayBucketIndex:!1,enums:!0,dtstart:null,dtend:null,sortBy:null,sortDir:null,dummyTZID:this.setDummyTZID()}},searchUpdated:function(){},getSearchArgsHelper:function(a,e,b,g){e={calendars:!0,components:!0,index:!0,dayBucketIndex:!0,enums:!this.calendarEnum?!0:!1,dtstart:!this.dtstart?null:ws.date.formatISO8601(this.dtstart),dtend:!this.dtend?null:ws.date.formatISO8601(this.dtend),
search:a,searchIn:e,sortBy:b,sortDir:g,dummyTZID:this.setDummyTZID()};this.searchStr=a;this.searchUpdated();return e},getSearchArgs:function(a,e){return this.getSearchArgsHelper(a,e,this.sortBy,this.sortDir)},setSortData:function(a,e){a&&this.getData(this.getSearchArgsHelper(this.searchStr,null,a,e))},setSearchStr:function(a,e){if(!((e==null||!e)&&a==this.searchStr))this.searchStr=a,this.getData(this.getSearchArgs(this.searchStr))},getSearchString:function(){return this.searchStr},refreshSearchResult:function(){this.getData(this.getSearchArgs(this.searchStr))},
getDefaultCalendarArgs:function(){for(var a=this.getDefaultArgs(),e=this.getCalendarList().length;this.calendars["New Calendar"+e];)e++;a.displayName="New Calendar"+e;a.selected=!0;return a},getCalendarArgs:function(a,e){var b=this.getDefaultArgs(e),g;for(g in this.calendarEnum)switch(g){case "calType":case "compType":case "creatorType":var h=a[this.calendarEnum[g]];h&&(b[g]=h.toString());break;case "writable":case "selected":case "syncable":case "worldReadable":case "birthdayCal":b[g]=a[this.calendarEnum[g]]?
!0:!1;break;default:b[g]=a[this.calendarEnum[g]]}return b},getDefaultComponentArgs:function(a){a=this.getDefaultArgs(a);a.start=ws.date.formatISO8601(new Date);a.allDay=!0;a.summary="Appointment";return a},getComponentArgs:function(a){var e=this.getDefaultArgs(),b;for(b in this.componentEnum)switch(b){case "allDay":case "reminderEnabled":e[b]=a[this.componentEnum[b]]?!0:!1;break;case "start":case "recurEnd":case "end":case "completed":var g=a[this.componentEnum[b]];g&&(e[b]=ws.date.formatISO8601(g));
break;case "compType":case "recurType":(g=a[this.componentEnum[b]])&&(e[b]=g.toString());break;default:e[b]=a[this.componentEnum[b]]}return e},getComponentArgsForTask:function(a){a=this.getComponentArgs(a);a.compType="Todo";a.calendars=!0;a.components=!0;a.index=!0;a.dayBucketIndex=!1;a.enums=!0;a.sortBy=null;a.sortDir=null;return a},getDataSettingsChanged:function(){this.needsRepaint=!0;var a=!1;this.retrieveIndexOnGetDataCB!=null&&(a=this.retrieveIndexOnGetDataCB());this.getData(null,a,!0)},calRpc:function(a){if(this.isAnonymous){if(a&&
a.content&&(a.content.isAnonymous=!0,a.content.calid=this.anonymousCalid,a.content.initTZIDOffsetStr=this.anonymousInitTZIDOffsetStr,this.currentTZIDForPulldown!=""))a.content.tzidSetting=this.currentTZIDForPulldown;(!a||!(a.content&&a.content.compType=="Todo"))&&ws.io.rpcAnonymous(a)}else ws.io.rpc(a)},getData:function(a,e,f){a||(a=this.getDefaultArgs(e,f));a.forceRefreshIfExpired=!this.isModelFetchedOnce;this.loadDataInProgress=!0;this.calRpc({action:"GetCalendarData",content:a,load:b.hitch(this,
"processResponse"),error:function(a){this.loadDataInProgress=!1;window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for GetCalendarData-getData file:CalendarViewModel.js");ws.widget.Dialogs.ok(Config.Strings.Cal_ServiceTemporarilyUnavailable)}})},saveCalendar:function(a){a||(a=this.getDefaultCalendarArgs());this.loadDataInProgress=!0;this.calRpc({action:"SaveCalendar",content:a,load:b.hitch(this,function(e){this.processResponse(e,!0);a.loadCallback&&
a.loadCallback()}),error:function(e){this.loadDataInProgress=!1;a.id?a.showNotification&&(window.ws_ErrLgr&&!e&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for showNotification-saveCalendar file:CalendarViewModel.js"),ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.CalendarUpdatedError,a.displayName))):(window.ws_ErrLgr&&!e&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for SaveCalendar-saveCalendar file:CalendarViewModel.js"),
ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.CalendarAddedError,a.displayName)));a.errorCallback&&a.errorCallback()}})},deleteCalendar:function(a){if(a&&a.id)this.loadDataInProgress=!0,this.calRpc({action:"DeleteCalendar",content:a,load:b.hitch(this,function(e){this.processResponse(e,!0);a.loadCallback&&a.loadCallback()}),error:function(e){b.publish("WSFeedbackEnd",[Config.Strings.Loading]);this.loadDataInProgress=!1;window.ws_ErrLgr&&!e&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,
"Dialogs.ok shown - Error Handler for DeleteCalendar-deleteCalendar file:CalendarViewModel.js");ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.CalendarDeletedError,a.displayName));a.errorCallback&&a.errorCallback()}})},saveComponent:function(a,e){a||(a=this.getDefaultComponentArgs(e));if(e&&this.searchStr)a.search=this.searchStr,a.searchIn=null,a.sortBy=this.sortBy,a.sortDir=this.sortDir,a.ignoreCache=!0;this.loadDataInProgress=!0;this.calRpc({action:"SaveComponent",content:a,load:b.hitch(this,
function(e){this.processResponse(e,!0,a.id?"update":"create");a.loadCallback&&a.loadCallback()}),error:function(a){this.loadDataInProgress=!1;window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for SaveComponent-saveComponent file:CalendarViewModel.js");ws.widget.Dialogs.ok(Config.Strings.CalServerErrorSaving)}})},importFromFile:function(a){var e=a.formNode;delete a.formNode;this.loadDataInProgress=!0;ws.io.rpc({action:"CalendarImport",content:a,formNode:e,
load:a.load,error:a.error});this.getData()},doModelUpdated:function(a){a!=this&&a&&a.modelType==this.modelType&&this.requestUpdate()},modelUpdated:function(){},requestUpdate:function(){},requestUpdateFullRefresh:function(){},processResponse:function(a,e,f){this.loadDataInProgress=!1;if(!1===this.isModelFetchedOnce)this.isModelFetchedOnce=!0;this.dtstart=a.dtstart;this.dtend=a.dtend;this.today=a.today;this.totalItems=a.totalItems;this.totalMatchingFilter=a.totalMatchingFilter;this.sortBy=a.sortBy;
this.sortDir=a.sortDir;this.currentServerTime=a.currentServerTime;this.newComponents=[];this.isSuccess=a.isSuccess;if(a.calendars)this.calendars=a.calendars;if(a.components)this.components=a.components;if(a.index)this.index=a.index;if(a.dayBucketIndex)this.dayBucketIndex=a.dayBucketIndex;if(a.newComponents&&a.newComponents.length)this.newComponents=a.newComponents;if(a.calendarEnum)this.calendarEnum=a.calendarEnum;if(a.componentEnum)this.componentEnum=a.componentEnum;if(a.indexEnum)this.indexEnum=
a.indexEnum;if(null!==a.isDummyCalendarAccount)!0==this.isDummyCalendarAccount&&!1==a.isDummyCalendarAccount&&b.publish("CalendarViewModel/CalendarAccountCreated"),this.isDummyCalendarAccount=a.isDummyCalendarAccount;if(a.currentTZID)this.currentTZIDForPulldown=a.currentTZID;this.anonymousInitTZIDOffsetStr="";this.modelUpdated();e&&b.publish("CalendarViewModel/modelUpdated",[this]);a.reminderUpdateError?b.publish("WSFeedbackStart",[a.reminderUpdateError,!0]):f&&(f=="update"?b.publish("WSFeedbackStart",
[Config.Strings.EventUpdated,!0]):b.publish("WSFeedbackStart",[Config.Strings.EventCreated,!0]))},toggleSelectRow:function(){},deleteEvents:function(a){if(a)this.loadDataInProgress=!0,b.publish("wsapi/postEvent",["calEventDelete",{evtId:a.id}]),this.calRpc({action:"DeleteComponent",content:a,load:b.hitch(this,function(e){this.processResponse(e,!0);a.loadCallback&&a.loadCallback()}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"Error Handler for DeleteComponent-deleteEvents file:CalendarViewModel.js");
this.loadDataInProgress=!1}})},calendarComparator:function(a,e){var b=a[3],g=e[3];if(b==0&&g!=0)return-1;if(b!=0&&g==0)return 1;if(b==1&&g!=1)return-1;if(b!=1&&g==1)return 1;b=a[2].toLowerCase();g=e[2].toLowerCase();return b<=g?-1:1},isLoading:function(){return!this.isSuccess||this.loadDataInProgress},getCalendarList:function(){var a=[],e=0;if(!this.calendars)return a;for(var b in this.calendars)a[e]=this.calendars[b],e++;a.sort(this.calendarComparator);return a}}));if(!b._hasResource["dojox.grid._grid.lib"])b._hasResource["dojox.grid._grid.lib"]=
!0,b.provide("dojox.grid._grid.lib"),b.isNumber=function(a){return typeof a=="number"||a instanceof Number},b.mixin(l.grid,{na:"...",nop:function(){},getTdIndex:function(a){return a.cellIndex>=0?a.cellIndex:b.indexOf(a.parentNode.cells,a)},getTrIndex:function(a){return a.rowIndex>=0?a.rowIndex:b.indexOf(a.parentNode.childNodes,a)},getTr:function(a,e){return a&&((a.rows||0)[e]||a.childNodes[e])},getTd:function(a,e,b){return(l.grid.getTr(inTable,e)||0)[b]},findTable:function(a){for(;a&&a.tagName!="TABLE";a=
a.parentNode);return a},ascendDom:function(a,e){for(var b=a;b&&e(b);b=b.parentNode);return b},makeNotTagName:function(a){var e=a.toUpperCase();return function(a){return a.tagName!=e}},fire:function(a,e,b){var g=a&&e&&a[e];return g&&(b?g.apply(a,b):a[e]())},setStyleText:function(a,e){a.style.cssText==void 0?a.setAttribute("style",e):a.style.cssText=e},getStyleText:function(a){return a.style.cssText==void 0?a.getAttribute("style"):a.style.cssText},setStyle:function(a,e,b){a&&a.style[e]!=b&&(a.style[e]=
b)},setStyleHeightPx:function(a,e){e>=0&&l.grid.setStyle(a,"height",e+"px")},mouseEvents:["mouseover","mouseout","mousedown","mouseup","click","dblclick","contextmenu"],keyEvents:["keyup","keydown","keypress"],funnelEvents:function(a,e,f,g){for(var g=g?g:l.grid.mouseEvents.concat(l.grid.keyEvents),h=0,j=g.length;h<j;h++)b.connect(a,"on"+g[h],e,f)},removeNode:function(a){(a=b.byId(a))&&a.parentNode&&a.parentNode.removeChild(a);return a},getScrollbarWidth:function(){if(this._scrollBarWidth)return this._scrollBarWidth;
this._scrollBarWidth=18;try{var a=document.createElement("div");a.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";document.body.appendChild(a);this._scrollBarWidth=a.offsetWidth-a.clientWidth;document.body.removeChild(a);delete a}catch(e){}return this._scrollBarWidth},getRef:function(a,e,f){for(var f=f||b.global,a=a.split("."),g=a.pop(),h=0,j;f&&(j=a[h]);h++)f=j in f?f[j]:e?f[j]={}:void 0;return{obj:f,prop:g}},getProp:function(a,e,b){with(l.grid.getRef(a,
e,b))return obj&&prop&&(prop in obj?obj[prop]:e?obj[prop]={}:void 0)},indexInParent:function(a){for(var e=0,b,g=a.parentNode;b=g.childNodes[e++];)if(b==a)return e-1;return-1},cleanNode:function(a){if(a){for(var e=k.registry.filter(function(e){return e.domNode&&b.isDescendant(e.domNode,a,!0)}),f=0,g;g=e[f];f++)g.destroy();delete e}},getTagName:function(a){return(a=b.byId(a))&&a.tagName?a.tagName.toLowerCase():""},nodeKids:function(a,e){for(var b=[],g=0,h;h=a.childNodes[g++];)l.grid.getTagName(h)==
e&&b.push(h);return b},divkids:function(a){return l.grid.nodeKids(a,"div")},focusSelectNode:function(a){try{l.grid.fire(a,"focus"),l.grid.fire(a,"select")}catch(e){}},whenIdle:function(){setTimeout(b.hitch.apply(b,arguments),0)},arrayCompare:function(a,e){for(var b=0,g=a.length;b<g;b++)if(a[b]!=e[b])return!1;return a.length==e.length},arrayInsert:function(a,e,b){a.length<=e?a[e]=b:a.splice(e,0,b)},arrayRemove:function(a,e){a.splice(e,1)},arraySwap:function(a,e,b){var g=a[e];a[e]=a[b];a[b]=g},initTextSizePoll:function(a){var e=
document.createElement("div");with(e.style)left=top="0px",position="absolute",visibility="hidden";e.innerHTML="TheQuickBrownFoxJumpedOverTheLazyDog";document.body.appendChild(e);var b=e.offsetWidth;window.setInterval(function(){if(e.offsetWidth!=b)b=e.offsetWidth,l.grid.textSizeChanged()},a||200);l.grid.initTextSizePoll=l.grid.nop},textSizeChanged:function(){}}),l.grid.jobs={cancel:function(a){a&&window.clearTimeout(a)},jobs:[],job:function(a,e,b){l.grid.jobs.cancelJob(a);l.grid.jobs.jobs[a]=setTimeout(function(){delete l.grid.jobs.jobs[a];
b()},e)},cancelJob:function(a){l.grid.jobs.cancel(l.grid.jobs.jobs[a])}};b._hasResource["dojox.grid._grid.scroller"]||(b._hasResource["dojox.grid._grid.scroller"]=!0,b.provide("dojox.grid._grid.scroller"),b.declare("dojox.grid.scroller.base",null,{constructor:function(){this.pageHeights=[];this.stack=[]},rowCount:0,defaultRowHeight:10,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,lastVisibleRow:0,page:0,pageTop:0,init:function(a,
e,f){switch(arguments.length){case 3:this.rowsPerPage=f;case 2:this.keepRows=e;case 1:this.rowCount=a}this.defaultPageHeight=this.defaultRowHeight*this.rowsPerPage;this.pageCount=Math.ceil(this.rowCount/this.rowsPerPage);this.keepPages=Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2);this.invalidate();if(this.scrollboxNode)this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=b.hitch(this,"onscroll")},invalidate:function(){this.invalidateNodes();this.pageHeights=[];this.height=
this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0;this.resize()},updateRowCount:function(a){this.invalidateNodes();this.rowCount=a;oldPageCount=this.pageCount;this.pageCount=Math.ceil(this.rowCount/this.rowsPerPage);if(this.pageCount<oldPageCount)for(a=oldPageCount-1;a>=this.pageCount;a--)this.height-=this.getPageHeight(a),delete this.pageHeights[a];else this.pageCount>oldPageCount&&(this.height+=this.defaultPageHeight*(this.pageCount-oldPageCount-1)+this.calcLastPageHeight());
this.resize()},pageExists:function(){},measurePage:function(){},positionPage:function(){},repositionPages:function(){},installPage:function(){},preparePage:function(){},renderPage:function(){},removePage:function(){},pacify:function(){},pacifying:!1,pacifyTicks:200,setPacifying:function(a){if(this.pacifying!=a)this.pacifying=a,this.pacify(this.pacifying)},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var a=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;
this.setPacifying(!0);this.startPacify();return a},endPacify:function(){this.setPacifying(!1)},resize:function(){if(this.scrollboxNode)this.windowHeight=this.scrollboxNode.clientHeight;l.grid.setStyleHeightPx(this.contentNode,this.height)},calcLastPageHeight:function(){if(!this.pageCount)return 0;var a=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;return this.pageHeights[this.pageCount-1]=a},updateContentHeight:function(a){this.height+=a;this.resize()},updatePageHeight:function(a){if(this.pageExists(a)){var e=
this.getPageHeight(a),b=this.measurePage(a)||e;if((this.pageHeights[a]=b)&&e!=b)this.updateContentHeight(b-e),this.repositionPages(a)}},rowHeightChanged:function(a){this.updatePageHeight(Math.floor(a/this.rowsPerPage))},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var a=document.createElement("div");a.style.position="absolute";a.style.left="0";return a},getPageHeight:function(a){a=this.pageHeights[a];return a!==void 0?a:this.defaultPageHeight},
pushPage:function(a){return this.stack.push(a)},popPage:function(){return this.stack.shift()},findPage:function(a){for(var e=0,b=0,g=0;e<this.pageCount;e++,b+=g)if(g=this.getPageHeight(e),b+g>=a)break;this.page=e;this.pageTop=b},buildPage:function(a,e,b){this.preparePage(a,e);this.positionPage(a,b);this.installPage(a);this.renderPage(a);this.pushPage(a)},needPage:function(a,e){var b=this.getPageHeight(a),g=b;this.pageExists(a)?this.positionPage(a,e):(this.buildPage(a,this.keepPages&&this.stack.length>=
this.keepPages,e),b=this.measurePage(a)||b,(this.pageHeights[a]=b)&&g!=b&&this.updateContentHeight(b-g));return b},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(a){this.startPacify();this.findPage(a);for(var e=this.height,b=this.getScrollBottom(a),g=this.page,h=this.pageTop;g<this.pageCount&&(b<0||h<b);g++)h+=this.needPage(g,h);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,a);this.lastVisibleRow=this.getLastVisibleRow(g-1,h,b);e!=this.height&&
this.repositionPages(g-1);this.endPacify()},getScrollBottom:function(a){return this.windowHeight>=0?a+this.windowHeight:-1},processNodeEvent:function(a,e){for(var b=a.target;b&&b!=e&&b.parentNode&&b.parentNode.parentNode!=e;)b=b.parentNode;if(!b||!b.parentNode||b.parentNode.parentNode!=e)return!1;a.topRowIndex=b.parentNode.pageIndex*this.rowsPerPage;a.rowIndex=a.topRowIndex+l.grid.indexInParent(b);a.rowTarget=b;return!0},processEvent:function(a){return this.processNodeEvent(a,this.contentNode)},dummy:0}),
b.declare("dojox.grid.scroller",l.grid.scroller.base,{constructor:function(){this.pageNodes=[]},renderRow:function(){},removeRow:function(){},getDefaultNodes:function(){return this.pageNodes},getDefaultPageNode:function(a){return this.getDefaultNodes()[a]},positionPageNode:function(a,e){a.style.top=e+"px"},getPageNodePosition:function(a){return a.offsetTop},repositionPageNodes:function(a,e){for(var b=0,g=0;g<this.stack.length;g++)b=Math.max(this.stack[g],b);for(var h=(g=e[a])?this.getPageNodePosition(g)+
this.getPageHeight(a):0,j=a+1;j<=b;j++){if(g=e[j]){if(this.getPageNodePosition(g)==h)break;this.positionPage(j,h)}h+=this.getPageHeight(j)}},invalidatePageNode:function(a,e){var b=e[a];if(b)delete e[a],this.removePage(a,b),l.grid.cleanNode(b),b.innerHTML="";return b},preparePageNode:function(a,e,b){e=e===null?this.createPageNode():this.invalidatePageNode(e,b);e.pageIndex=a;e.id="page-"+a;b[a]=e},pageExists:function(a){return Boolean(this.getDefaultPageNode(a))},measurePage:function(a){return this.getDefaultPageNode(a).offsetHeight},
positionPage:function(a,e){this.positionPageNode(this.getDefaultPageNode(a),e)},repositionPages:function(a){this.repositionPageNodes(a,this.getDefaultNodes())},preparePage:function(a,e){this.preparePageNode(a,e?this.popPage():null,this.getDefaultNodes())},installPage:function(a){this.contentNode.appendChild(this.getDefaultPageNode(a))},destroyPage:function(a){a=this.invalidatePageNode(a,this.getDefaultNodes());l.grid.removeNode(a)},renderPage:function(a){var e=this.pageNodes[a],b=0;for(a*=this.rowsPerPage;b<
this.rowsPerPage&&a<this.rowCount;b++,a++)this.renderRow(a,e)},removePage:function(a){var e=0;for(a*=this.rowsPerPage;e<this.rowsPerPage;e++,a++)this.removeRow(a)},getPageRow:function(a){return a*this.rowsPerPage},getLastPageRow:function(a){return Math.min(this.rowCount,this.getPageRow(a+1))-1},getFirstVisibleRowNodes:function(a,e,b,g){for(var h=this.getPageRow(a),a=l.grid.divkids(g[a]),g=0,j=a.length;g<j&&e<b;g++,h++)e+=a[g].offsetHeight;return h?h-1:h},getFirstVisibleRow:function(a,e,b){if(!this.pageExists(a))return 0;
return this.getFirstVisibleRowNodes(a,e,b,this.getDefaultNodes())},getLastVisibleRowNodes:function(a,e,b,g){for(var h=this.getLastPageRow(a),a=l.grid.divkids(g[a]),g=a.length-1;g>=0&&e>b;g--,h--)e-=a[g].offsetHeight;return h+1},getLastVisibleRow:function(a,e,b){if(!this.pageExists(a))return 0;return this.getLastVisibleRowNodes(a,e,b,this.getDefaultNodes())},findTopRowForNodes:function(a,e){for(var b=l.grid.divkids(e[this.page]),g=0,h=b.length,j=this.pageTop,m;g<h;g++)if(m=b[g].offsetHeight,j+=m,j>=
a)return this.offset=m-(j-a),g+this.page*this.rowsPerPage;return-1},findScrollTopForNodes:function(a,e){for(var b=Math.floor(a/this.rowsPerPage),g=0,h=0;h<b;h++)g+=this.getPageHeight(h);this.pageTop=g;this.needPage(b,this.pageTop);for(var j=l.grid.divkids(e[b]),b=a-this.rowsPerPage*b,h=0,m=j.length;h<m&&h<b;h++)g+=j[h].offsetHeight;return g},findTopRow:function(a){return this.findTopRowForNodes(a,this.getDefaultNodes())},findScrollTop:function(a){return this.findScrollTopForNodes(a,this.getDefaultNodes())},
dummy:0}),b.declare("dojox.grid.scroller.columns",l.grid.scroller,{constructor:function(a){this.setContentNodes(a)},setContentNodes:function(a){this.colCount=(this.contentNodes=a)?this.contentNodes.length:0;this.pageNodes=[];for(a=0;a<this.colCount;a++)this.pageNodes[a]=[]},getDefaultNodes:function(){return this.pageNodes[0]||[]},scroll:function(a){this.colCount&&l.grid.scroller.prototype.scroll.call(this,a)},resize:function(){if(this.scrollboxNode)this.windowHeight=this.scrollboxNode.clientHeight;
for(var a=0;a<this.colCount;a++)l.grid.setStyleHeightPx(this.contentNodes[a],this.height)},positionPage:function(a,e){for(var b=0;b<this.colCount;b++)this.positionPageNode(this.pageNodes[b][a],e)},preparePage:function(a,e){for(var b=e?this.popPage():null,g=0;g<this.colCount;g++)this.preparePageNode(a,b,this.pageNodes[g])},installPage:function(a){for(var e=0;e<this.colCount;e++)this.contentNodes[e].appendChild(this.pageNodes[e][a])},destroyPage:function(a){for(var e=0;e<this.colCount;e++)l.grid.removeNode(this.invalidatePageNode(a,
this.pageNodes[e]))},renderPage:function(a){for(var e=[],b=0;b<this.colCount;b++)e[b]=this.pageNodes[b][a];b=0;for(a*=this.rowsPerPage;b<this.rowsPerPage&&a<this.rowCount;b++,a++)this.renderRow(a,e)}}));b._hasResource["dojox.grid._grid.drag"]||(b._hasResource["dojox.grid._grid.drag"]=!0,b.provide("dojox.grid._grid.drag"),function(){var a=l.grid.drag={};a.dragging=!1;a.hysteresis=2;a.capture=function(a){a.setCapture?a.setCapture():(document.addEventListener("mousemove",a.onmousemove,!0),document.addEventListener("mouseup",
a.onmouseup,!0),document.addEventListener("click",a.onclick,!0))};a.release=function(a){a.releaseCapture?a.releaseCapture():(document.removeEventListener("click",a.onclick,!0),document.removeEventListener("mouseup",a.onmouseup,!0),document.removeEventListener("mousemove",a.onmousemove,!0))};a.start=function(e,b,g,h,j){if(e&&!a.dragging)a.dragging=!0,a.elt=e,a.events={drag:b||l.grid.nop,end:g||l.grid.nop,start:j||l.grid.nop,oldmove:e.onmousemove,oldup:e.onmouseup,oldclick:e.onclick},a.positionX=h&&
"screenX"in h?h.screenX:!1,a.positionY=h&&"screenY"in h?h.screenY:!1,a.started=a.position===!1,e.onmousemove=a.mousemove,e.onmouseup=a.mouseup,e.onclick=a.click,a.capture(a.elt)};a.end=function(){a.release(a.elt);a.elt.onmousemove=a.events.oldmove;a.elt.onmouseup=a.events.oldup;a.elt.onclick=a.events.oldclick;a.elt=null;try{a.started&&a.events.end()}finally{a.dragging=!1}};a.calcDelta=function(e){e.deltaX=e.screenX-a.positionX;e.deltaY=e.screenY-a.positionY};a.hasMoved=function(e){return Math.abs(e.deltaX)+
Math.abs(e.deltaY)>a.hysteresis};a.mousemove=function(e){e=b.fixEvent(e);b.stopEvent(e);a.calcDelta(e);if(!a.started&&a.hasMoved(e))a.events.start(e),a.started=!0;a.started&&a.events.drag(e)};a.mouseup=function(e){b.stopEvent(b.fixEvent(e));a.end()};a.click=function(a){b.stopEvent(b.fixEvent(a))}}());if(!b._hasResource["dojox.grid._grid.builder"])b._hasResource["dojox.grid._grid.builder"]=!0,b.provide("dojox.grid._grid.builder"),b.declare("dojox.grid.Builder",null,{constructor:function(a){this.view=
a;this.grid=a.grid},view:null,_table:'<table class="dojoxGrid-row-table" border="0" cellspacing="0" cellpadding="0" role="wairole:presentation">',generateCellMarkup:function(a,e,b,g){var h=[],g=g?['<th tabIndex="-1" role="wairole:columnheader"']:['<td tabIndex="-1" role="wairole:gridcell"'];a.colSpan&&g.push(' colspan="',a.colSpan,'"');a.rowSpan&&g.push(' rowspan="',a.rowSpan,'"');g.push(' class="dojoxGrid-cell ');a.classes&&g.push(a.classes," ");b&&g.push(b," ");h.push(g.join(""));h.push("");g=['" idx="',
a.index,'" style="'];g.push(a.styles,e||"");a.unitWidth&&g.push("width:",a.unitWidth,";");h.push(g.join(""));h.push("");g=['"'];a.attrs&&g.push(" ",a.attrs);g.push(">");h.push(g.join(""));h.push("");h.push("</td>");return h},isCellNode:function(a){return Boolean(a&&a.getAttribute&&a.getAttribute("idx"))},getCellNodeIndex:function(a){return a?Number(a.getAttribute("idx")):-1},getCellNode:function(a,e){for(var b=0,g;g=l.grid.getTr(a.firstChild,b);b++)for(var h=0,j;j=g.cells[h];h++)if(this.getCellNodeIndex(j)==
e)return j},findCellTarget:function(a,e){for(var b=a;b&&!this.isCellNode(b)&&b!=e;)b=b.parentNode;return b!=e?b:null},baseDecorateEvent:function(a){a.dispatch="do"+a.type;a.grid=this.grid;a.sourceView=this.view;a.cellNode=this.findCellTarget(a.target,a.rowNode);a.cellIndex=this.getCellNodeIndex(a.cellNode);a.cell=a.cellIndex>=0?this.grid.getCell(a.cellIndex):null},findTarget:function(a,e){for(var b=a;b&&!(e in b)&&b!=this.domNode;)b=b.parentNode;return b!=this.domNode?b:null},findRowTarget:function(a){return this.findTarget(a,
l.grid.rowIndexTag)},isIntraNodeEvent:function(a){try{return a.cellNode&&a.relatedTarget&&b.isDescendant(a.relatedTarget,a.cellNode)}catch(e){return!1}},isIntraRowEvent:function(a){try{var e=a.relatedTarget&&this.findRowTarget(a.relatedTarget);return!e&&a.rowIndex==-1||e&&a.rowIndex==e.gridRowIndex}catch(b){return!1}},dispatchEvent:function(a){if(a.dispatch in this)return this[a.dispatch](a)},domouseover:function(a){if(a.cellNode&&a.cellNode!=this.lastOverCellNode)this.lastOverCellNode=a.cellNode,
this.grid.onMouseOver(a);this.grid.onMouseOverRow(a)},domouseout:function(a){if(a.cellNode&&a.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(a,this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(a),!this.isIntraRowEvent(a)))this.grid.onMouseOutRow(a)}}),b.declare("dojox.grid.contentBuilder",l.grid.Builder,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var a=this.grid.get,e=this.view.structure.rows,b=0,g;g=e[b];b++)for(var h=0,j;j=g[h];h++)j.get=j.get||
j.value==void 0&&a,j.markup=this.generateCellMarkup(j,j.cellStyles,j.cellClasses,!1)},generateHtml:function(a,e){var b=[this._table],g=this.view,h=g.onBeforeRow,g=g.structure.rows;h&&h(e,g);for(var h=0,j;j=g[h];h++)if(!j.hidden&&!j.header){b.push(!j.invisible?"<tr>":'<tr class="dojoxGrid-invisible">');for(var m=0,k,l,n,p;k=j[m];m++)l=k.markup,n=k.customClasses=[],p=k.customStyles=[],l[5]=k.format(a),l[1]=n.join(" "),l[3]=p.join(";"),b.push.apply(b,l);b.push("</tr>")}b.push("</table>");return b.join("")},
decorateEvent:function(a){a.rowNode=this.findRowTarget(a.target);if(!a.rowNode)return!1;a.rowIndex=a.rowNode[l.grid.rowIndexTag];this.baseDecorateEvent(a);a.cell=this.grid.getCell(a.cellIndex);return!0}}),b.declare("dojox.grid.headerBuilder",l.grid.Builder,{bogusClickTime:0,overResizeWidth:4,minColWidth:1,_table:'<table class="dojoxGrid-row-table" border="0" cellspacing="0" cellpadding="0" role="wairole:presentation"',update:function(){this.tableMap=new l.grid.tableMap(this.view.structure.rows)},
generateHtml:function(a,e){var b=[this._table],g=this.view.structure.rows;this.view.viewWidth&&b.push([' style="width:',this.view.viewWidth,';"'].join(""));b.push(">");l.grid.fire(this.view,"onBeforeRow",[-1,g]);for(var h=0,j;j=g[h];h++)if(!j.hidden){b.push(!j.invisible?"<tr>":'<tr class="dojoxGrid-invisible">');for(var m=0,k,o;k=j[m];m++)k.customClasses=[],k.customStyles=[],o=this.generateCellMarkup(k,k.headerStyles,k.headerClasses,!0),o[5]=e!=void 0?e:a(k),o[3]=k.customStyles.join(";"),o[1]=k.customClasses.join(" "),
b.push(o.join(""));b.push("</tr>")}b.push("</table>");return b.join("")},getCellX:function(a){var e=a.layerX;if(b.isMoz){var f=l.grid.ascendDom(a.target,l.grid.makeNotTagName("th"));e-=f&&f.offsetLeft||0}f=l.grid.ascendDom(a.target,function(){if(!f||f==a.cellNode)return!1;e+=f.offsetLeft<0?0:f.offsetLeft;return!0});return e},decorateEvent:function(a){this.baseDecorateEvent(a);a.rowIndex=-1;a.cellX=this.getCellX(a);return!0},prepareLeftResize:function(a){var e=l.grid.getTdIndex(a.cellNode);a.cellNode=
e?a.cellNode.parentNode.cells[e-1]:null;a.cellIndex=a.cellNode?this.getCellNodeIndex(a.cellNode):-1;return Boolean(a.cellNode)},canResize:function(a){if(!a.cellNode||a.cellNode.colSpan>1)return!1;a=this.grid.getCell(a.cellIndex);return!a.noresize&&!a.isFlex()},overLeftResizeArea:function(a){return a.cellIndex>0&&a.cellX<this.overResizeWidth&&this.prepareLeftResize(a)},overRightResizeArea:function(a){return a.cellNode&&a.cellX>=a.cellNode.offsetWidth-this.overResizeWidth},domousemove:function(a){var e=
this.overRightResizeArea(a)?"e-resize":this.overLeftResizeArea(a)?"w-resize":"";e&&!this.canResize(a)&&(e="not-allowed");a.sourceView.headerNode.style.cursor=e||""},domousedown:function(a){l.grid.drag.dragging||(this.overRightResizeArea(a)||this.overLeftResizeArea(a))&&this.canResize(a)&&this.beginColumnResize(a)},doclick:function(a){if((new Date).getTime()<this.bogusClickTime)return b.stopEvent(a),!0},beginColumnResize:function(a){b.stopEvent(a);for(var e=[],f=this.tableMap.findOverlappingNodes(a.cellNode),
g=0,h;h=f[g];g++)e.push({node:h,index:this.getCellNodeIndex(h),width:h.offsetWidth});e={view:a.sourceView,node:a.cellNode,index:a.cellIndex,w:a.cellNode.clientWidth,spanners:e};l.grid.drag.start(a.cellNode,b.hitch(this,"doResizeColumn",e),b.hitch(this,"endResizeColumn",e),a)},doResizeColumn:function(a,e){var b=a.w+e.deltaX;if(b>=this.minColWidth){for(var g=0,h,j;h=a.spanners[g];g++)j=h.width+e.deltaX,h.node.style.width=j+"px",a.view.setColWidth(h.index,j);a.node.style.width=b+"px";a.view.setColWidth(a.index,
b)}if(a.view.flexCells&&!a.view.testFlexCells())(b=l.grid.findTable(a.node))&&(b.style.width="")},endResizeColumn:function(a){this.bogusClickTime=(new Date).getTime()+30;setTimeout(b.hitch(a.view,"update"),50)}}),b.declare("dojox.grid.tableMap",null,{constructor:function(a){this.mapRows(a)},map:null,mapRows:function(a){if(a.length){this.map=[];for(var e=0,b;a[e];e++)this.map[e]=[];for(e=0;b=a[e];e++)for(var g=0,h=0,j,m;j=b[g];g++){for(;this.map[e][h];)h++;this.map[e][h]={c:g,r:e};m=j.rowSpan||1;j=
j.colSpan||1;for(var k=0;k<m;k++)for(var l=0;l<j;l++)this.map[e+k][h+l]=this.map[e][h];h+=j}}},dumpMap:function(){for(var a=0,e,b="";e=this.map[a];a++,b="")for(var g=0,h;h=e[g];g++)b+=h.r+","+h.c+"   "},getMapCoords:function(a,e){for(var b=0,g;g=this.map[b];b++)for(var h=0,j;j=g[h];h++)if(j.c==e&&j.r==a)return{j:b,i:h};return{j:-1,i:-1}},getNode:function(a,e,b){return(a=a&&a.rows[e])&&a.cells[b]},_findOverlappingNodes:function(a,e,b){for(var g=[],e=this.getMapCoords(e,b),h=this.map[e.j],b=0;h=this.map[b];b++)if(b!=
e.j)with(h[e.i])(h=this.getNode(a,r,c))&&g.push(h);return g},findOverlappingNodes:function(a){return this._findOverlappingNodes(l.grid.findTable(a),l.grid.getTrIndex(a.parentNode),l.grid.getTdIndex(a))}}),l.grid.rowIndexTag="gridRowIndex";b._hasResource["dojox.grid._grid.view"]||(b._hasResource["dojox.grid._grid.view"]=!0,b.provide("dojox.grid._grid.view"),b.declare("dojox.GridView",[k._Widget,k._Templated],{defaultWidth:"18em",viewWidth:"",templateString:'<div class="dojoxGrid-view"><div class="dojoxGrid-header" dojoAttachPoint="headerNode"><div style="width: 9000em"><div dojoAttachPoint="headerContentNode"></div></div></div><input type="checkbox" class="dojoxGrid-hidden-focus" dojoAttachPoint="hiddenFocusNode" /><input type="checkbox" class="dojoxGrid-hidden-focus" /><div class="dojoxGrid-scrollbox" dojoAttachPoint="scrollboxNode"><div class="dojoxGrid-content" dojoAttachPoint="contentNode" hidefocus="hidefocus"></div></div></div>',
themeable:!1,classTag:"dojoxGrid",marginBottom:0,rowPad:2,postMixInProperties:function(){this.rowNodes=[]},postCreate:function(){b.connect(this.scrollboxNode,"onscroll",b.hitch(this,"doscroll"));l.grid.funnelEvents(this.contentNode,this,"doContentEvent",["mouseover","mouseout","click","dblclick","contextmenu"]);l.grid.funnelEvents(this.headerNode,this,"doHeaderEvent",["dblclick","mouseover","mouseout","mousemove","mousedown","click","contextmenu"]);this.content=new l.grid.contentBuilder(this);this.header=
new l.grid.headerBuilder(this)},destroy:function(){l.grid.removeNode(this.headerNode);this.inherited("destroy",arguments)},focus:function(){b.isSafari||b.isOpera?this.hiddenFocusNode.focus():this.scrollboxNode.focus()},setStructure:function(a){a=this.structure=a;this.viewWidth=a.width&&b.isNumber(a.width)?a.width+"em":a.width||this.viewWidth;this.onBeforeRow=a.onBeforeRow;if(this.noscroll=a.noscroll)this.scrollboxNode.style.overflow="hidden";this.testFlexCells();this.updateStructure()},testFlexCells:function(){this.flexCells=
!1;for(var a=0,e;e=this.structure.rows[a];a++)for(var b=0,g;g=e[b];b++)g.view=this,this.flexCells=this.flexCells||g.isFlex();return this.flexCells},updateStructure:function(){this.header.update();this.content.update()},getScrollbarWidth:function(){return this.noscroll?0:l.grid.getScrollbarWidth()},getColumnsWidth:function(){return this.headerContentNode.firstChild.offsetWidth},getWidth:function(){return this.viewWidth||this.getColumnsWidth()+this.getScrollbarWidth()+"px"},getContentWidth:function(){return Math.max(0,
b._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px"},render:function(){this.scrollboxNode.style.height="";this.renderHeader()},renderHeader:function(){this.headerContentNode.innerHTML=this.header.generateHtml(this._getHeaderContent);if(this.headerContentNode.childNodes.length>0&&this.grid.getSortIndex()>=0){var a=this.grid.getSortIndex(),e=this.headerContentNode.childNodes[0].childNodes[0].childNodes[0].childNodes;e[a-1]&&b.addClass(e[a-1],"dojoxGrid-sort-col-prevSibling");e[a]&&b.addClass(e[a],
"dojoxGrid-sort-col")}},_getHeaderContent:function(a){var e=a.name||a.grid.getCellName(a);if(a.index!=a.grid.getSortIndex())return e;return['<div class="',a.grid.sortInfo>0?"dojoxGrid-sort-down":"dojoxGrid-sort-up",'">',e,"</div>"].join("")},resize:function(){this.resizeHeight();this.resizeWidth()},hasScrollbar:function(){return this.scrollboxNode.clientHeight!=this.scrollboxNode.offsetHeight},resizeHeight:function(){if(!this.grid.autoHeight){var a=this.domNode.clientHeight;this.hasScrollbar()||(a-=
l.grid.getScrollbarWidth());l.grid.setStyleHeightPx(this.scrollboxNode,a)}},resizeWidth:function(){if(this.flexCells)this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth;var a=this.scrollboxNode.offsetWidth-this.getScrollbarWidth(),a=Math.max(a,this.getColumnsWidth())+"px";with(this.contentNode)style.width="",style.width=a},setSize:function(a,e){with(this.domNode.style)a&&(width=a),height=e>=0?e+"px":"";with(this.headerNode.style)a&&(width=a)},renderRow:function(a,
e){var b=this.createRowNode(a);this.buildRow(a,b,e);this.grid.edit.restore(this,a);return b},createRowNode:function(a){var e=document.createElement("div");e.className=this.classTag+"-row";e[l.grid.rowIndexTag]=a;return this.rowNodes[a]=e},buildRow:function(a,e){this.buildRowContent(a,e);this.styleRow(a,e)},buildRowContent:function(a,e){e.innerHTML=this.content.generateHtml(a,a);if(this.flexCells)e.firstChild.style.width=this.contentWidth},rowRemoved:function(a){this.grid.edit.save(this,a);delete this.rowNodes[a]},
getRowNode:function(a){return this.rowNodes[a]},getCellNode:function(a,e){var b=this.getRowNode(a);if(b)return this.content.getCellNode(b,e)},styleRow:function(a,e){e._style=l.grid.getStyleText(e);this.styleRowNode(a,e)},styleRowNode:function(a,e){e&&this.doStyleRowNode(a,e)},doStyleRowNode:function(a,e){this.grid.styleRowNode(a,e)},updateRow:function(a){var e=this.getRowNode(a);if(e)e.style.height="",this.buildRow(a,e);return e},updateRowStyles:function(a){this.styleRowNode(a,this.getRowNode(a))},
lastTop:0,doscroll:function(){this.headerNode.scrollLeft=this.scrollboxNode.scrollLeft;var a=this.scrollboxNode.scrollTop;a!=this.lastTop&&this.grid.scrollTo(a)},setScrollTop:function(a){this.lastTop=a;this.scrollboxNode.scrollTop=a;return this.scrollboxNode.scrollTop},doContentEvent:function(a){if(this.content.decorateEvent(a))this.grid.onContentEvent(a)},doHeaderEvent:function(a){if(b.isMac&&b.isFF&&a.type=="mousedown"&&a.button==2)a.type="contextmenu";if(this.header.decorateEvent(a))this.grid.onHeaderEvent(a)},
dispatchContentEvent:function(a){return this.content.dispatchEvent(a)},dispatchHeaderEvent:function(a){return this.header.dispatchEvent(a)},setColWidth:function(a,e){this.grid.setCellWidth(a,e+"px")},update:function(){var a=this.scrollboxNode.scrollLeft;this.content.update();this.grid.update();this.scrollboxNode.scrollLeft=a}}));b._hasResource["dojox.grid._grid.views"]||(b._hasResource["dojox.grid._grid.views"]=!0,b.provide("dojox.grid._grid.views"),b.declare("dojox.grid.views",null,{constructor:function(a){this.grid=
a},defaultWidth:200,views:[],resize:function(){this.onEach("resize")},render:function(){this.onEach("render");this.normalizeHeaderNodeHeight()},addView:function(a){a.idx=this.views.length;this.views.push(a)},destroyViews:function(){for(var a=0,e;e=this.views[a];a++)e.destroy();this.views=[]},getContentNodes:function(){for(var a=[],e=0,b;b=this.views[e];e++)a.push(b.contentNode);return a},forEach:function(a){for(var e=0,b;b=this.views[e];e++)a(b,e)},onEach:function(a,e){for(var e=e||[],b=0,g;g=this.views[b];b++)a in
g&&g[a].apply(g,e)},normalizeHeaderNodeHeight:function(){for(var a=[],e=0,b;b=this.views[e];e++)b.headerContentNode.firstChild&&a.push(b.headerContentNode);this.normalizeRowNodeHeights(a)},normalizeRowNodeHeights:function(){},renormalizeRow:function(a){for(var e=[],b=0,g,h;(g=this.views[b])&&(h=g.getRowNode(a));b++)h.firstChild.style.height="",e.push(h);this.normalizeRowNodeHeights(e)},getViewWidth:function(a){return this.views[a].getWidth()||this.defaultWidth},measureHeader:function(){this.forEach(function(a){a.headerContentNode.style.height=
""});var a=0;this.forEach(function(e){a=Math.max(e.headerNode.offsetHeight,a)});return a},measureContent:function(){var a=0;this.forEach(function(e){a=Math.max(e.domNode.offsetHeight,a)});return a},findClient:function(){var a=this.grid.elasticView||-1;if(a<0)for(var e=1,b;b=this.views[e];e++)if(b.viewWidth){for(e=1;b=this.views[e];e++)if(!b.viewWidth){a=e;break}break}a<0&&(a=Math.floor(this.views.length/2));return a},_arrange:function(a,e,b,g){var h,j,m,k=this.views.length,l=b<=0?k:this.findClient(),
n=function(a,e,b){with(a.domNode.style)left=e+"px",top=b+"px";with(a.headerNode.style)left=e+"px",top=0};for(h=0;(j=this.views[h])&&h<l;h++)m=this.getViewWidth(h),j.setSize(m,g),n(j,a,e),m=j.domNode.offsetWidth,a+=m;h++;for(var p=k-1;(j=this.views[p])&&h<=p;p--)m=this.getViewWidth(p),j.setSize(m,g),m=j.domNode.offsetWidth,b-=m,n(j,b,e);l<k&&(j=this.views[l],m=Math.max(1,b-a),j.setSize(m+"px",g),n(j,a,e));return a},arrange:function(a,e,b,g){b=this._arrange(a,e,b,g);this.resize();return b},renderRow:function(a,
e){for(var b=[],g=0,h,j;(h=this.views[g])&&(j=e[g]);g++)h=h.renderRow(a),j.appendChild(h),b.push(h);this.normalizeRowNodeHeights(b)},rowRemoved:function(a){this.onEach("rowRemoved",[a])},updateRow:function(a,e){for(var b=0,g;g=this.views[b];b++)g.updateRow(a,e);this.renormalizeRow(a)},updateRowStyles:function(a){this.onEach("updateRowStyles",[a])},setScrollTop:function(a){for(var e=a,b=0,g;g=this.views[b];b++)e=g.setScrollTop(a);return e},getFirstScrollingView:function(){for(var a=0,e;e=this.views[a];a++)if(e.hasScrollbar())return e}}));
b._hasResource["dojox.grid._grid.cell"]||(b._hasResource["dojox.grid._grid.cell"]=!0,b.provide("dojox.grid._grid.cell"),b.declare("dojox.grid.cell",null,{styles:"",constructor:function(a){b.mixin(this,a);if(this.editor)this.editor=new this.editor(this)},format:function(a){var e,b=this.grid.edit.info,g=this.get?this.get(a):this.value;return this.editor&&(this.editor.alwaysOn||b.rowIndex==a&&b.cell==this)?this.editor.format(g,a):(e=this.formatter)?e.call(this,g,a):g},getNode:function(a){return this.view.getCellNode(a,
this.index)},isFlex:function(){var a=this.unitWidth;return a&&(a=="auto"||a.slice(-1)=="%")},applyEdit:function(a,e){this.grid.edit.applyCellEdit(a,this,e)},cancelEdit:function(a){this.grid.doCancelEdit(a)},_onEditBlur:function(a){this.grid.edit.isEditCell(a,this.index)&&this.grid.edit.apply()},registerOnBlur:function(a,e){this.commitOnBlur&&b.connect(a,"onblur",function(){setTimeout(b.hitch(this,"_onEditBlur",e),250)})}}));b._hasResource["dojox.grid._grid.layout"]||(b._hasResource["dojox.grid._grid.layout"]=
!0,b.provide("dojox.grid._grid.layout"),b.declare("dojox.grid.layout",null,{constructor:function(a){this.grid=a},cells:null,structure:null,defaultWidth:"6em",setStructure:function(a){this.fieldIndex=0;this.cells=[];for(var e=this.structure=[],b=0,g;g=a[b];b++)e.push(this.addViewDef(g));this.cellCount=this.cells.length},addViewDef:function(a){this._defaultCellProps=a.defaultCell||{};return b.mixin({},a,{rows:this.addRowsDef(a.rows||a.cells)})},addRowsDef:function(a){for(var e=[],b=0,g;a&&(g=a[b]);b++)e.push(this.addRowDef(b,
g));return e},addRowDef:function(a,e){for(var b=[],g=0,h;h=e[g];g++)h=this.addCellDef(a,g,h),b.push(h),this.cells.push(h);return b},addCellDef:function(a,e,f){var g=0,g=f.colSpan>1?0:isNaN(f.width)?f.width||this.defaultWidth:f.width+"em",h=f.field!=void 0?f.field:f.get?-1:this.fieldIndex;if(f.field!=void 0||!f.get)this.fieldIndex=(f.field>-1?f.field:this.fieldIndex)+1;return new l.grid.cell(b.mixin({},this._defaultCellProps,f,{grid:this.grid,subrow:a,layoutIndex:e,index:this.cells.length,fieldIndex:h,
unitWidth:g}))}}));b._hasResource["dojox.grid._grid.rows"]||(b._hasResource["dojox.grid._grid.rows"]=!0,b.provide("dojox.grid._grid.rows"),b.declare("dojox.grid.rows",null,{constructor:function(a){this.grid=a},linesToEms:2,defaultRowHeight:1,overRow:-2,getHeight:function(){return""},getDefaultHeightPx:function(){return 32},prepareStylingRow:function(a,e){return{index:a,node:e,odd:Boolean(a&1),selected:this.grid.selection.isSelected(a),over:this.isOver(a),customStyles:"",customClasses:"dojoxGrid-row"}},
styleRowNode:function(a,e){var b=this.prepareStylingRow(a,e);this.grid.onStyleRow(b);this.applyStyles(b)},applyStyles:function(a){with(a)node.className=customClasses,a=node.style.height,l.grid.setStyleText(node,customStyles+";"+(node._style||"")),node.style.height=a},updateStyles:function(a){this.grid.updateRowStyles(a)},setOverRow:function(a){var e=this.overRow;this.overRow=a;e!=this.overRow&&e>=0&&this.updateStyles(e);this.updateStyles(this.overRow)},isOver:function(a){return this.overRow==a}}));
b._hasResource["dojox.grid._grid.focus"]||(b._hasResource["dojox.grid._grid.focus"]=!0,b.provide("dojox.grid._grid.focus"),b.declare("dojox.grid.focus",null,{constructor:function(a){this.grid=a;this.cell=null;this.rowIndex=-1;b.connect(this.grid.domNode,"onfocus",this,"doFocus")},tabbingOut:!1,focusClass:"dojoxGrid-cell-focus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()},isFocusCell:function(a,e){return this.cell==a&&this.rowIndex==e},isLastFocusCell:function(){return this.rowIndex==
this.grid.rowCount-1&&this.cell.index==this.grid.layout.cellCount-1},isFirstFocusCell:function(){return this.rowIndex==0&&this.cell.index==0},isNoFocusCell:function(){return this.rowIndex<0||!this.cell},_focusifyCellNode:function(a){var e=this.cell&&this.cell.getNode(this.rowIndex);if(e){b.toggleClass(e,this.focusClass,a);this.scrollIntoView();try{this.grid.edit.isEditing()||l.grid.fire(e,"focus")}catch(f){}}},scrollIntoView:function(){if(this.cell){var a=this.cell,e=a.view.scrollboxNode,b={w:e.clientWidth,
l:e.scrollLeft,t:e.scrollTop,h:e.clientHeight},g=a.getNode(this.rowIndex),a=a.view.getRowNode(this.rowIndex),h=this.grid.scroller.findScrollTop(this.rowIndex);if(g.offsetLeft+g.offsetWidth>b.l+b.w)e.scrollLeft=g.offsetLeft+g.offsetWidth-b.w;else if(g.offsetLeft<b.l)e.scrollLeft=g.offsetLeft;h+a.offsetHeight>b.t+b.h?this.grid.setScrollTop(h+a.offsetHeight-b.h):h<b.t&&this.grid.setScrollTop(h)}},styleRow:function(a){a.index==this.rowIndex&&this._focusifyCellNode(!0)},setFocusIndex:function(a,e){this.setFocusCell(this.grid.getCell(e),
a)},setFocusCell:function(a,e){if(a&&!this.isFocusCell(a,e))this.tabbingOut=!1,this.focusGrid(),this._focusifyCellNode(!1),this.cell=a,this.rowIndex=e,this._focusifyCellNode(!0);if(b.isOpera)setTimeout(b.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);else this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){var a=this.rowIndex,e=this.cell.index+1,b=this.grid.layout.cellCount-1,g=this.grid.rowCount-1;e>b&&(e=0,a++);a>g&&(e=b,a=g);this.setFocusIndex(a,e)},previous:function(){var a=
this.rowIndex||0,e=(this.cell.index||0)-1;e<0&&(e=this.grid.layout.cellCount-1,a--);a<0&&(e=a=0);this.setFocusIndex(a,e)},move:function(a,e){var b=this.rowIndex;this.setFocusIndex(Math.min(this.grid.rowCount-1,Math.max(0,b+a)),Math.min(this.grid.layout.cellCount-1,Math.max(0,this.cell.index+e)));a&&this.grid.updateRow(b)},previousKey:function(a){this.isFirstFocusCell()?this.tabOut(this.grid.domNode):(b.stopEvent(a),this.previous())},nextKey:function(a){this.isLastFocusCell()?this.tabOut(this.grid.lastFocusNode):
(b.stopEvent(a),this.next())},tabOut:function(a){this.tabbingOut=!0;a.focus()},focusGrid:function(){l.grid.fire(this.focusView,"focus");this._focusifyCellNode(!0)},doFocus:function(a){if(!(a&&a.target!=a.currentTarget))!this.tabbingOut&&this.isNoFocusCell()&&this.setFocusIndex(0,0),this.tabbingOut=!1}}));b._hasResource["dojox.grid._grid.selection"]||(b._hasResource["dojox.grid._grid.selection"]=!0,b.provide("dojox.grid._grid.selection"),b.declare("dojox.grid.selection",null,{constructor:function(a){this.grid=
a;this.selected=[]},multiSelect:!0,selected:null,updating:0,selectedIndex:-1,onCanSelect:function(a){return this.grid.onCanSelect(a)},onCanDeselect:function(a){return this.grid.onCanDeselect(a)},onSelected:function(a){return this.grid.onSelected(a)},onDeselected:function(a){return this.grid.onDeselected(a)},onChanging:function(){},onChanged:function(){return this.grid.onSelectionChanged()},isSelected:function(a){return this.selected[a]},getFirstSelected:function(){for(var a=0,e=this.selected.length;a<
e;a++)if(this.selected[a])return a;return-1},getNextSelected:function(a){a+=1;for(var e=this.selected.length;a<e;a++)if(this.selected[a])return a;return-1},getSelected:function(){for(var a=[],e=0,b=this.selected.length;e<b;e++)this.selected[e]&&a.push(e);return a},getSelectedCount:function(){for(var a=0,e=0;e<this.selected.length;e++)this.selected[e]&&a++;return a},beginUpdate:function(){if(this.updating==0)this.onChanging();this.updating++},endUpdate:function(){this.updating--;if(this.updating==
0)this.onChanged()},select:function(a){this.unselectAll(a);this.addToSelection(a)},addToSelection:function(a){a=Number(a);if(this.selected[a])this.selectedIndex=a;else if(this.onCanSelect(a)!==!1)this.selectedIndex=a,this.beginUpdate(),this.selected[a]=!0,this.grid.onSelected(a),this.endUpdate()},deselect:function(a){a=Number(a);if(this.selectedIndex==a)this.selectedIndex=-1;this.selected[a]&&this.onCanDeselect(a)!==!1&&(this.beginUpdate(),delete this.selected[a],this.grid.onDeselected(a),this.endUpdate())},
setSelected:function(a,e){this[e?"addToSelection":"deselect"](a)},toggleSelect:function(a){this.setSelected(a,!this.selected[a])},insert:function(a){this.selected.splice(a,0,!1);this.selectedIndex>=a&&this.selectedIndex++},remove:function(a){this.selected.splice(a,1);this.selectedIndex>=a&&this.selectedIndex--},unselectAll:function(a){for(var e in this.selected)e!=a&&this.selected[e]===!0&&this.deselect(e)},shiftSelect:function(a,e){var b=a>=0?a:e,g=e;b>g&&(g=b,b=e);for(;b<=g;b++)this.addToSelection(b)},
clickSelect:function(a,e,b){this.beginUpdate();if(this.multiSelect){var g=this.selectedIndex;e||this.unselectAll(a);b?this.shiftSelect(g,a):e?this.toggleSelect(a):this.addToSelection(a)}else this.select(a);this.endUpdate()},clickSelectEvent:function(a){this.clickSelect(a.rowIndex,a.ctrlKey,a.shiftKey)},clear:function(){this.beginUpdate();this.unselectAll();this.endUpdate()}}));b._hasResource["dojox.grid._grid.edit"]||(b._hasResource["dojox.grid._grid.edit"]=!0,b.provide("dojox.grid._grid.edit"),b.declare("dojox.grid.edit",
null,{constructor:function(a){this.grid=a;this.connections=[];b.isIE&&this.connections.push(b.connect(document.body,"onfocus",b.hitch(this,"_boomerangFocus")))},info:{},destroy:function(){b.forEach(this.connections,function(a){b.disconnect(a)})},cellFocus:function(a,e){this.grid.singleClickEdit||this.isEditRow(e)?this.setEditCell(a,e):this.apply();(this.isEditing()||a&&(a.editor||0).alwaysOn)&&this._focusEditor(a,e)},rowClick:function(a){this.isEditing()&&!this.isEditRow(a.rowIndex)&&this.apply()},
styleRow:function(a){a.index==this.info.rowIndex&&(a.customClasses+=" dojoxGrid-row-editing")},dispatchEvent:function(a){var e=a.cell;return(e=e&&e.editor)&&e.dispatchEvent(a.dispatch,a)},isEditing:function(){return this.info.rowIndex!==void 0},isEditCell:function(a,e){return this.info.rowIndex===a&&this.info.cell.index==e},isEditRow:function(a){return this.info.rowIndex===a},setEditCell:function(a,e){this.isEditCell(e,a.index)||this.start(a,e,this.isEditRow(e)||a.editor)},_focusEditor:function(a,
e){l.grid.fire(a.editor,"focus",[e])},focusEditor:function(){this.isEditing()&&this._focusEditor(this.info.cell,this.info.rowIndex)},_boomerangWindow:500,_shouldCatchBoomerang:function(){return this._catchBoomerang>(new Date).getTime()},_boomerangFocus:function(){if(this._shouldCatchBoomerang())this.grid.focus.focusGrid(),this.focusEditor(),this._catchBoomerang=0},_doCatchBoomerang:function(){if(b.isIE)this._catchBoomerang=(new Date).getTime()+this._boomerangWindow},start:function(a,e,b){this.grid.beginUpdate();
this.editorApply();this.isEditing()&&!this.isEditRow(e)&&(this.applyRowEdit(),this.grid.updateRow(e));b?(this.info={cell:a,rowIndex:e},this.grid.doStartEdit(a,e),this.grid.updateRow(e)):this.info={};this.grid.endUpdate();this.grid.focus.focusGrid();this._focusEditor(a,e);this._doCatchBoomerang()},_editorDo:function(a){var e=this.info.cell;e&&e.editor&&e.editor[a](this.info.rowIndex)},editorApply:function(){this._editorDo("apply")},editorCancel:function(){this._editorDo("cancel")},applyCellEdit:function(a,
e,b){this.grid.doApplyCellEdit(a,b,e.fieldIndex)},applyRowEdit:function(){this.grid.doApplyEdit(this.info.rowIndex)},apply:function(){if(this.isEditing())this.grid.beginUpdate(),this.editorApply(),this.applyRowEdit(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang()},cancel:function(){if(this.isEditing())this.grid.beginUpdate(),this.editorCancel(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang()},save:function(a,e){var b=
this.info.cell;this.isEditRow(a)&&(!e||b.view==e)&&b.editor&&b.editor.save(b,this.info.rowIndex)},restore:function(a,e){var b=this.info.cell;this.isEditRow(e)&&b.view==a&&b.editor&&b.editor.restore(b,this.info.rowIndex)}}));b._hasResource["dojox.grid._grid.rowbar"]||(b._hasResource["dojox.grid._grid.rowbar"]=!0,b.provide("dojox.grid._grid.rowbar"),b.declare("dojox.GridRowView",l.GridView,{defaultWidth:"3em",noscroll:!0,padBorderWidth:2,buildRendering:function(){this.inherited("buildRendering",arguments);
this.scrollboxNode.style.overflow="hidden";this.headerNode.style.visibility="hidden"},getWidth:function(){return this.viewWidth||this.defaultWidth},buildRowContent:function(a,e){e.innerHTML='<table style="width:'+(this.contentNode.offsetWidth-this.padBorderWidth)+'px;" role="wairole:presentation"><tr><td class="dojoxGrid-rowbar-inner"></td></tr></table>'},renderHeader:function(){},resize:function(){this.resizeHeight()},doStyleRowNode:function(a,e){var b=["dojoxGrid-rowbar"];this.grid.rows.isOver(a)&&
b.push("dojoxGrid-rowbar-over");this.grid.selection.isSelected(a)&&b.push("dojoxGrid-rowbar-selected");e.className=b.join(" ")},domouseover:function(a){this.grid.onMouseOverRow(a)},domouseout:function(a){if(!this.isIntraRowEvent(a))this.grid.onMouseOutRow(a)}}));if(!b._hasResource["dojox.grid._grid.publicEvents"])b._hasResource["dojox.grid._grid.publicEvents"]=!0,b.provide("dojox.grid._grid.publicEvents"),l.grid.publicEvents={cellOverClass:"dojoxGrid-cell-over",onKeyEvent:function(a){this.dispatchKeyEvent(a)},
onContentEvent:function(a){this.dispatchContentEvent(a)},onHeaderEvent:function(a){this.dispatchHeaderEvent(a)},onStyleRow:function(a){with(a)customClasses+=(odd?" dojoxGrid-row-odd":"")+(selected?" dojoxGrid-row-selected":"")+(over?" dojoxGrid-row-over":"");this.focus.styleRow(a);this.edit.styleRow(a)},onKeyDown:function(a){if(!a.altKey&&!a.ctrlKey&&!a.metaKey)switch(a.keyCode){case b.keys.ESCAPE:this.edit.cancel();break;case b.keys.ENTER:a.shiftKey||(a=this.edit.isEditing(),this.edit.apply(),a||
this.edit.setEditCell(this.focus.cell,this.focus.rowIndex));break;case b.keys.TAB:this.focus[a.shiftKey?"previousKey":"nextKey"](a);break;case b.keys.LEFT_ARROW:!this.edit.isEditing()&&this.focus.cell&&this.focus.move(0,-1);break;case b.keys.RIGHT_ARROW:!this.edit.isEditing()&&this.focus.cell&&this.focus.move(0,1);break;case b.keys.UP_ARROW:!this.edit.isEditing()&&this.focus.cell&&this.focus.move(-1,0);break;case b.keys.DOWN_ARROW:!this.edit.isEditing()&&this.focus.cell&&this.focus.move(1,0)}},onMouseOver:function(a){a.rowIndex==
-1?this.onHeaderCellMouseOver(a):this.onCellMouseOver(a)},onMouseOut:function(a){a.rowIndex==-1?this.onHeaderCellMouseOut(a):this.onCellMouseOut(a)},onMouseOverRow:function(a){this.rows.isOver(a.rowIndex)||(this.rows.setOverRow(a.rowIndex),a.rowIndex==-1?this.onHeaderMouseOver(a):this.onRowMouseOver(a))},onMouseOutRow:function(a){if(this.rows.isOver(-1))this.onHeaderMouseOut(a);else this.rows.isOver(-2)||(this.rows.setOverRow(-2),this.onRowMouseOut(a))},onCellMouseOver:function(a){b.addClass(a.cellNode,
this.cellOverClass)},onCellMouseOut:function(a){b.removeClass(a.cellNode,this.cellOverClass)},onCellClick:function(a){this.focus.setFocusCell(a.cell,a.rowIndex);this.onRowClick(a)},onCellDblClick:function(a){this.edit.setEditCell(a.cell,a.rowIndex);this.onRowDblClick(a)},onCellContextMenu:function(a){this.onRowContextMenu(a)},onCellFocus:function(a,e){this.edit.cellFocus(a,e)},onRowClick:function(a){this.edit.rowClick(a);this.selection.clickSelectEvent(a)},onRowDblClick:function(){},onRowMouseOver:function(){},
onRowMouseOut:function(){},onRowContextMenu:function(a){b.stopEvent(a)},onHeaderMouseOver:function(){},onHeaderMouseOut:function(){},onHeaderCellMouseOver:function(a){b.addClass(a.cellNode,this.cellOverClass)},onHeaderCellMouseOut:function(a){b.removeClass(a.cellNode,this.cellOverClass)},onHeaderClick:function(){},onHeaderCellClick:function(a){this.setSortIndex(a.cell.index);this.onHeaderClick(a)},onHeaderDblClick:function(){},onHeaderCellDblClick:function(a){this.onHeaderDblClick(a)},onHeaderCellContextMenu:function(a){this.onHeaderContextMenu(a)},
onHeaderContextMenu:function(a){b.stopEvent(a)},onStartEdit:function(){},onApplyCellEdit:function(){},onCancelEdit:function(){},onApplyEdit:function(){},onCanSelect:function(){return!0},onCanDeselect:function(){return!0},onSelected:function(a){this.updateRowStyles(a)},onDeselected:function(a){this.updateRowStyles(a)},onSelectionChanged:function(){}};b._hasResource["dojox.grid.VirtualGrid"]||(b._hasResource["dojox.grid.VirtualGrid"]=!0,b.provide("dojox.grid.VirtualGrid"),b.declare("dojox.VirtualGrid",
[k._Widget,k._Templated],{templateString:'<div class="dojoxGrid" hidefocus="hidefocus" role="wairole:grid"><div class="dojoxGrid-master-header" dojoAttachPoint="headerNode"></div><div class="dojoxGrid-master-view" dojoAttachPoint="viewsNode"></div><span dojoAttachPoint="lastFocusNode" tabindex="0"></span></div>',classTag:"dojoxGrid",get:function(){},rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:!1,autoHeight:!1,autoRender:!0,defaultHeight:"15em",structure:"",elasticView:-1,singleClickEdit:!1,sortInfo:0,
themeable:!0,buildRendering:function(){this.inherited(arguments);if(this.get==l.VirtualGrid.prototype.get)this.get=null;if(!this.domNode.getAttribute("tabIndex"))this.domNode.tabIndex="0";this.createScroller();this.createLayout();this.createViews();this.createManagers();l.grid.initTextSizePoll();this.connect(l.grid,"textSizeChanged","textSizeChanged");l.grid.funnelEvents(this.domNode,this,"doKeyEvent",l.grid.keyEvents);this.connect(this,"onShow","renderOnIdle")},postCreate:function(){this.styleChanged=
this._styleChanged;this.setStructure(this.structure)},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;this.edit.destroy();this.views.destroyViews();this.inherited(arguments)},styleChanged:function(){this.setStyledClass(this.domNode,"")},_styleChanged:function(){this.styleChanged();this.update()},textSizeChanged:function(){setTimeout(b.hitch(this,"_textSizeChanged"),1)},_textSizeChanged:function(){this.domNode&&(this.views.forEach(function(a){a.content.update()}),this.render())},
sizeChange:function(){l.grid.jobs.job(this.id+"SizeChange",50,b.hitch(this,"update"))},renderOnIdle:function(){setTimeout(b.hitch(this,"render"),1)},createManagers:function(){this.rows=new l.grid.rows(this);this.focus=new l.grid.focus(this);this.selection=new l.grid.selection(this);this.edit=new l.grid.edit(this)},createScroller:function(){this.scroller=new l.grid.scroller.columns;this.scroller.renderRow=b.hitch(this,"renderRow");this.scroller.removeRow=b.hitch(this,"rowRemoved")},createLayout:function(){this.layout=
new l.grid.layout(this)},createViews:function(){this.views=new l.grid.views(this);this.views.createView=b.hitch(this,"createView")},createView:function(a){a=new (eval(a))({grid:this});this.viewsNode.appendChild(a.domNode);this.headerNode.appendChild(a.headerNode);this.views.addView(a);return a},buildViews:function(){for(var a=0,e;e=this.layout.structure[a];a++)this.createView(e.type||"dojox.GridView").setStructure(e);this.scroller.setContentNodes(this.views.getContentNodes())},setStructure:function(a){this.views.destroyViews();
if((this.structure=a)&&b.isString(this.structure))this.structure=l.grid.getProp(this.structure);if(!this.structure)this.structure=window.layout;this.structure&&(this.layout.setStructure(this.structure),this._structureChanged())},_structureChanged:function(){this.buildViews();this.autoRender&&this.render()},resize:function(){if(this.domNode.parentNode){var a=b._getPadBorderExtents(this.domNode);if(this.autoHeight)this.domNode.style.height="auto",this.viewsNode.style.height="";else if(!(this.flex>0)&&
this.domNode.clientHeight<=a.h)this.domNode.parentNode==document.body?this.domNode.style.height=this.defaultHeight:this.fitTo="parent";if(this.fitTo=="parent"){var e=b._getContentBox(this.domNode.parentNode).h;b.marginBox(this.domNode,{h:Math.max(0,e)})}e=this.views.measureHeader();this.headerNode.style.height=e+"px";e=this.autoHeight?-1:Math.max(this.domNode.clientHeight-e,0)||0;this.autoWidth?this.domNode.style.width=this.views.arrange(1,0,0,e)+"px":this.views.arrange(1,0,this.domNode.clientWidth||
this.domNode.offsetWidth-a.w,e);this.scroller.windowHeight=e;this.scroller.defaultRowHeight=this.rows.getDefaultHeightPx()+1;this.postresize()}},resizeHeight:function(){var a=this.views.measureHeader();this.headerNode.style.height=a+"px";a=this.autoHeight?-1:Math.max(this.domNode.clientHeight-a,0)||0;this.views.onEach("setSize",[0,a]);this.views.onEach("resizeHeight");this.scroller.windowHeight=a},render:function(){if(this.domNode)this.update=this.defaultUpdate,this.scroller.init(this.rowCount,this.keepRows,
this.rowsPerPage),this.prerender(),this.setScrollTop(0),this.postrender()},prerender:function(){this.views.render();this.resize()},postrender:function(){this.postresize();this.focus.initFocusView();b.setSelectable(this.domNode,!1)},postresize:function(){if(this.autoHeight)this.viewsNode.style.height=this.views.measureContent()+"px"},renderRow:function(a,e){this.views.renderRow(a,e)},rowRemoved:function(a){this.views.rowRemoved(a)},invalidated:null,updating:!1,beginUpdate:function(){this.invalidated=
[];this.updating=!0},endUpdate:function(){this.updating=!1;var a=this.invalidated;if(a.all)this.update();else if(a.rowCount!=void 0)this.updateRowCount(a.rowCount);else for(r in a)this.updateRow(Number(r));this.invalidated=null},defaultUpdate:function(){this.updating?this.invalidated.all=!0:(this.prerender(),this.scroller.invalidateNodes(),this.setScrollTop(this.scrollTop),this.postrender())},update:function(){this.render()},updateRow:function(a){a=Number(a);this.updating?this.invalidated[a]=!0:(this.views.updateRow(a,
this.rows.getHeight(a)),this.scroller.rowHeightChanged(a))},updateRowCount:function(a){this.updating?this.invalidated.rowCount=a:(this.rowCount=a,this.scroller.updateRowCount(a),this.setScrollTop(this.scrollTop),this.resize())},updateRowStyles:function(a){this.views.updateRowStyles(a)},rowHeightChanged:function(a){this.views.renormalizeRow(a);this.scroller.rowHeightChanged(a)},fastScroll:!0,delayScroll:!1,scrollRedrawThreshold:b.isIE?100:50,scrollTo:function(a){if(this.fastScroll){var e=Math.abs(this.lastScrollTop-
a);this.lastScrollTop=a;e>this.scrollRedrawThreshold||this.delayScroll?(this.delayScroll=!0,this.scrollTop=a,this.views.setScrollTop(a),l.grid.jobs.job("dojoxGrid-scroll",200,b.hitch(this,"finishScrollJob"))):this.setScrollTop(a)}else this.setScrollTop(a)},finishScrollJob:function(){this.delayScroll=!1;this.setScrollTop(this.scrollTop)},setScrollTop:function(a){this.scrollTop=this.views.setScrollTop(a);this.scroller.scroll(this.scrollTop)},scrollToRow:function(a){this.setScrollTop(this.scroller.findScrollTop(a)+
1)},styleRowNode:function(a,e){e&&this.rows.styleRowNode(a,e)},getCell:function(a){return this.layout.cells[a]},setCellWidth:function(a,e){this.getCell(a).unitWidth=e},getCellName:function(a){return"Cell "+a.index},canSort:function(){},sort:function(){},getSortAsc:function(a){a=a==void 0?this.sortInfo:a;return Boolean(a>0)},getSortIndex:function(a){a=a==void 0?this.sortInfo:a;return Math.abs(a)-1},setSortIndex:function(a,e){var b=a+1;e!=void 0?b*=e?1:-1:this.getSortIndex()==a&&(b=-this.sortInfo);
this.setSortInfo(b)},setSortInfo:function(a){if(this.canSort(a))this.sortInfo=a,this.sort(),this.update()},doKeyEvent:function(a){a.dispatch="do"+a.type;this.onKeyEvent(a)},_dispatch:function(a,e){if(a in this)return this[a](e)},dispatchKeyEvent:function(a){this._dispatch(a.dispatch,a)},dispatchContentEvent:function(a){this.edit.dispatchEvent(a)||a.sourceView.dispatchContentEvent(a)||this._dispatch(a.dispatch,a)},dispatchHeaderEvent:function(a){a.sourceView.dispatchHeaderEvent(a)||this._dispatch("doheader"+
a.type,a)},dokeydown:function(a){this.onKeyDown(a)},doclick:function(a){if(a.cellNode)this.onCellClick(a);else this.onRowClick(a)},dodblclick:function(a){if(a.cellNode)this.onCellDblClick(a);else this.onRowDblClick(a)},docontextmenu:function(a){if(a.cellNode)this.onCellContextMenu(a);else this.onRowContextMenu(a)},doheaderclick:function(a){if(a.cellNode)this.onHeaderCellClick(a);else this.onHeaderClick(a)},doheaderdblclick:function(a){if(a.cellNode)this.onHeaderCellDblClick(a);else this.onHeaderDblClick(a)},
doheadercontextmenu:function(a){if(a.cellNode)this.onHeaderCellContextMenu(a);else this.onHeaderContextMenu(a)},doStartEdit:function(a,e){this.onStartEdit(a,e)},doApplyCellEdit:function(a,e,b){this.onApplyCellEdit(a,e,b)},doCancelEdit:function(a){this.onCancelEdit(a)},doApplyEdit:function(a){this.onApplyEdit(a)},addRow:function(){this.updateRowCount(this.rowCount+1)},removeSelectedRows:function(){this.updateRowCount(Math.max(0,this.rowCount-this.selection.getSelected().length));this.selection.clear()}}),
b.mixin(l.VirtualGrid.prototype,l.grid.publicEvents));if(!b._hasResource["dojox.grid._data.fields"])b._hasResource["dojox.grid._data.fields"]=!0,b.provide("dojox.grid._data.fields"),b.declare("dojox.grid.data.Mixer",null,{constructor:function(){this.defaultValue={};this.values=[]},count:function(){return this.values.length},clear:function(){this.values=[]},build:function(a){var e=b.mixin({owner:this},this.defaultValue);e.key=a;return this.values[a]=e},getDefault:function(){return this.defaultValue},
setDefault:function(){for(var a=0,e;e=arguments[a];a++)b.mixin(this.defaultValue,e)},get:function(a){return this.values[a]||this.build(a)},_set:function(a){for(var e=this.get(a),f=1;f<arguments.length;f++)b.mixin(e,arguments[f]);this.values[a]=e},set:function(){if(!(arguments.length<1)){var a=arguments[0];if(b.isArray(a)){a.length&&a[0]["default"]&&this.setDefault(a.shift());for(var e=0,f=a.length;e<f;e++)this._set(e,a[e])}else this._set.apply(this,arguments)}},insert:function(a,e){a>=this.values.length?
this.values[a]=e:this.values.splice(a,0,e)},remove:function(a){this.values.splice(a,1)},swap:function(a,e){l.grid.arraySwap(this.values,a,e)},move:function(a,e){l.grid.arrayMove(this.values,a,e)}}),l.grid.data.compare=function(a,e){return a>e?1:a==e?0:-1},b.declare("dojox.grid.data.Field",null,{constructor:function(a){this.name=a;this.compare=l.grid.data.compare},na:l.grid.na}),b.declare("dojox.grid.data.Fields",l.grid.data.Mixer,{constructor:function(a){this.defaultValue=new (a?a:l.grid.data.Field)},
indexOf:function(a){for(var e=0;e<this.values.length;e++){var b=this.values[e];if(b&&b.key==a)return e}return-1}});if(!b._hasResource["dojox.grid._data.model"])b._hasResource["dojox.grid._data.model"]=!0,b.provide("dojox.grid._data.model"),b.declare("dojox.grid.data.Model",null,{constructor:function(a,e){this.observers=[];this.fields=new l.grid.data.Fields;a&&this.fields.set(a);this.setData(e)},count:0,updating:0,observer:function(a,e){this.observers.push({o:a,p:e||"model"})},notObserver:function(a){for(var e=
0,b;b=this.observers[e];e++)if(b.o==a){this.observers.splice(e,1);break}},notify:function(a,e){if(!this.isUpdating())for(var b=e||[],g=0,h,j;j=this.observers[g];g++)h=j.p+a,j=j.o,h in j&&j[h].apply(j,b)},clear:function(){this.fields.clear();this.clearData()},beginUpdate:function(){this.updating++},endUpdate:function(){this.updating&&this.updating--},isUpdating:function(){return Boolean(this.updating)},clearData:function(){this.setData(null)},change:function(){this.notify("Change",arguments)},insertion:function(){this.notify("Insertion",
arguments);this.notify("Change",arguments)},removal:function(){this.notify("Removal",arguments);this.notify("Change",arguments)},insert:function(){if(!this._insert.apply(this,arguments))return!1;this.insertion.apply(this,b._toArray(arguments,1));return!0},remove:function(){if(!this._remove.apply(this,arguments))return!1;this.removal.apply(this,arguments);return!0},canSort:function(){return this.sort!=null},makeComparator:function(a){for(var e,b,g=null,h=a.length-1;h>=0;h--)e=a[h],b=Math.abs(e)-1,
b>=0&&(b=this.fields.get(b),g=this.generateComparator(b.compare,b.key,e>0,g));return g},sort:null,dummy:0}),b.declare("dojox.grid.data.Rows",l.grid.data.Model,{allChange:function(){this.notify("AllChange",arguments);this.notify("Change",arguments)},rowChange:function(){this.notify("RowChange",arguments)},datumChange:function(){this.notify("DatumChange",arguments)},beginModifyRow:function(a){this.cache[a]||(this.cache[a]=this.copyRow(a))},endModifyRow:function(a){var e=this.cache[a];if(e){var b=this.getRow(a);
l.grid.arrayCompare(e,b)||this.update(e,b,a);delete this.cache[a]}},cancelModifyRow:function(a){var e=this.cache[a];e&&(this.setRow(e,a),delete this.cache[a])},generateComparator:function(a,e,b,g){return function(h,j){var m=a(h[e],j[e]);return m?b?m:-m:g&&g(h,j)}}}),b.declare("dojox.grid.data.Table",l.grid.data.Rows,{constructor:function(){this.cache=[]},colCount:0,data:null,cache:null,measure:function(){this.count=this.getRowCount();this.colCount=this.getColCount();this.allChange()},getRowCount:function(){return this.data?
this.data.length:0},getColCount:function(){return this.data&&this.data.length?this.data[0].length:this.fields.count()},badIndex:function(){},isGoodIndex:function(a,e){return a>=0&&a<this.count&&(arguments.length<2||e>=0&&e<this.colCount)},getRow:function(a){return this.data[a]},copyRow:function(a){return this.getRow(a).slice(0)},getDatum:function(a,e){return this.data[a][e]},get:function(){throw'Plain "get" no longer supported. Use "getRow" or "getDatum".';},setData:function(a){this.data=a||[];this.allChange()},
setRow:function(a,e){this.data[e]=a;this.rowChange(a,e);this.change()},setDatum:function(a,e,b){this.data[e][b]=a;this.datumChange(a,e,b)},set:function(){throw'Plain "set" no longer supported. Use "setData", "setRow", or "setDatum".';},setRows:function(a,e){for(var b=0,g=a.length,h=e;b<g;b++,h++)this.setRow(a[b],h)},update:function(){return!0},_insert:function(a,e){l.grid.arrayInsert(this.data,e,a);this.count++;return!0},_remove:function(a){for(var e=a.length-1;e>=0;e--)l.grid.arrayRemove(this.data,
a[e]);this.count-=a.length;return!0},sort:function(){this.data.sort(this.makeComparator(arguments))},swap:function(a,e){l.grid.arraySwap(this.data,a,e);this.rowChange(this.getRow(a),a);this.rowChange(this.getRow(e),e);this.change()},dummy:0}),b.declare("dojox.grid.data.Objects",l.grid.data.Table,{constructor:function(a){a||this.autoAssignFields()},autoAssignFields:function(){var a=this.data[0],e=0,b;for(b in a)this.fields.get(e++).key=b},getDatum:function(a,e){return this.data[a][this.fields.get(e).key]}}),
b.declare("dojox.grid.data.Dynamic",l.grid.data.Table,{constructor:function(){this.page=[];this.pages=[]},page:null,pages:null,rowsPerPage:100,requests:0,bop:-1,eop:-1,clearData:function(){this.pages=[];this.bop=this.eop=-1;this.setData([])},getRowCount:function(){return this.count},getColCount:function(){return this.fields.count()},setRowCount:function(a){this.count=a;this.change()},requestsPending:function(){},rowToPage:function(a){return this.rowsPerPage?Math.floor(a/this.rowsPerPage):a},pageToRow:function(a){return this.rowsPerPage?
this.rowsPerPage*a:a},requestRows:function(){},rowsProvided:function(){this.requests--;this.requests==0&&this.requestsPending(!1)},requestPage:function(a){var a=this.pageToRow(a),e=Math.min(this.rowsPerPage,this.count-a);e>0&&(this.requests++,this.requestsPending(!0),setTimeout(b.hitch(this,"requestRows",a,e),1))},needPage:function(a){this.pages[a]||(this.pages[a]=!0,this.requestPage(a))},preparePage:function(a){if(a<this.bop||a>=this.eop)a=this.rowToPage(a),this.needPage(a),this.bop=a*this.rowsPerPage,
this.eop=this.bop+(this.rowsPerPage||this.count)},isRowLoaded:function(a){return Boolean(this.data[a])},removePages:function(a){for(var e=0,b;(b=a[e])!=void 0;e++)this.pages[this.rowToPage(b)]=!1;this.bop=this.eop=-1},remove:function(a){this.removePages(a);l.grid.data.Table.prototype.remove.apply(this,arguments)},getRow:function(a){var e=this.data[a];e||this.preparePage(a);return e},getDatum:function(a,e){var b=this.getRow(a);return b?b[e]:this.fields.get(e).na},setDatum:function(a,e,b){var g=this.getRow(e);
g&&(g[b]=a,this.datumChange(a,e,b))},canSort:function(){return!1}}),l.grid.data.table=l.grid.data.Table,l.grid.data.dynamic=l.grid.data.Dyanamic,b.declare("dojox.grid.data.DojoData",l.grid.data.Dynamic,{constructor:function(a,e,f){this.count=1;this._rowIdentities={};f&&b.mixin(this,f);if(this.store)a=this.store.getFeatures(),this._canNotify=a["dojo.data.api.Notification"],this._canWrite=a["dojo.data.api.Write"],this._canNotify&&b.connect(this.store,"onSet",this,"_storeDatumChange")},markupFactory:function(a){return new l.grid.data.DojoData(null,
null,a)},query:{name:"*"},store:null,_canNotify:!1,_canWrite:!1,_rowIdentities:{},clientSort:!1,setData:function(a){this.store=a;this.data=[];this.allChange()},setRowCount:function(a){this.count=a;this.allChange()},beginReturn:function(a){this.count!=a&&this.setRowCount(a)},_setupFields:function(a){if(!this.fields._nameMaps){var e={},a=b.map(this.store.getAttributes(a),function(a,b){e[a]=b;e[b+".idx"]=a;return{name:a,key:a}},this);this.fields._nameMaps=e;this.fields.set(a);this.notify("FieldsChange")}},
_getRowFromItem:function(){},processRows:function(a,e){a&&(this._setupFields(a[0]),b.forEach(a,function(a,g){var h={};h.__dojo_data_item=a;b.forEach(this.fields.values,function(e){h[e.name]=this.store.getValue(a,e.name)||""},this);this._rowIdentities[this.store.getIdentity(a)]=e.start+g;this.setRow(h,e.start+g)},this))},requestRows:function(a){this.store.fetch({start:a||0,count:this.rowsPerPage,query:this.query,onBegin:b.hitch(this,"beginReturn"),onComplete:b.hitch(this,"processRows")})},getDatum:function(a,
e){var b=this.getRow(a),g=this.fields.values[e];return b&&g?b[g.name]:g?g.na:"?"},setDatum:function(a,e,b){var g=this.fields._nameMaps[b+".idx"];g&&(this.data[e][g]=a,this.datumChange(a,e,b))},copyRow:function(a){var e={},b={},a=this.getRow(a),g;for(g in a)a[g]!=b[g]&&(e[g]=a[g]);return e},_attrCompare:function(a,e){b.forEach(this.fields.values,function(b){if(a[b.name]!=e[b.name])return!1},this);return!0},endModifyRow:function(a){var e=this.cache[a];if(e){var b=this.getRow(a);this._attrCompare(e,
b)||this.update(e,b,a);delete this.cache[a]}},cancelModifyRow:function(a){var e=this.cache[a];e&&(this.setRow(e,a),delete this.cache[a])},_storeDatumChange:function(a,e,b,g){a=this._rowIdentities[this.store.getIdentity(a)];this.getRow(a)[e]=g;this.notify("DatumChange",[g,a,this.fields._nameMaps[e]])},datumChange:function(a,e,b){this._canWrite?this.store.setValue(this.getRow(e).__dojo_data_item,this.fields._nameMaps[b+".idx"],a):this.notify("DatumChange",arguments)},insertion:function(){this.notify("Insertion",
arguments);this.notify("Change",arguments)},removal:function(){this.notify("Removal",arguments);this.notify("Change",arguments)},canSort:function(){return this.clientSort}});if(!b._hasResource["dojox.grid._data.editors"])b._hasResource["dojox.grid._data.editors"]=!0,b.provide("dojox.grid._data.editors"),b.provide("dojox.grid.editors"),b.declare("dojox.grid.editors.Base",null,{constructor:function(a){this.cell=a},_valueProp:"value",_formatPending:!1,format:function(){},needFormatNode:function(a,e){this._formatPending=
!0;l.grid.whenIdle(this,"_formatNode",a,e)},cancelFormatNode:function(){this._formatPending=!1},_formatNode:function(a,e){if(this._formatPending)this._formatPending=!1,b.setSelectable(this.cell.grid.domNode,!0),this.formatNode(this.getNode(e),a,e)},getNode:function(a){return(this.cell.getNode(a)||0).firstChild||0},formatNode:function(a,e,f){b.isIE?l.grid.whenIdle(this,"focus",f,a):this.focus(f,a)},dispatchEvent:function(a,e){if(a in this)return this[a](e)},getValue:function(a){return this.getNode(a)[this._valueProp]},
setValue:function(a,e){var b=this.getNode(a);b&&(b[this._valueProp]=e)},focus:function(a,e){l.grid.focusSelectNode(e||this.getNode(a))},save:function(a){this.value=this.value||this.getValue(a)},restore:function(a){this.setValue(a,this.value)},_finish:function(){b.setSelectable(this.cell.grid.domNode,!1);this.cancelFormatNode(this.cell)},apply:function(a){this.cell.applyEdit(this.getValue(a),a);this._finish(a)},cancel:function(a){this.cell.cancelEdit(a);this._finish(a)}}),l.grid.editors.base=l.grid.editors.Base,
b.declare("dojox.grid.editors.Input",l.grid.editors.Base,{constructor:function(){this.keyFilter=this.keyFilter||this.cell.keyFilter},keyFilter:null,format:function(a,e){this.needFormatNode(a,e);return'<input class="dojoxGrid-input" type="text" value="'+a+'">'},formatNode:function(a,e,b){this.inherited(arguments);this.cell.registerOnBlur(a,b)},doKey:function(a){this.keyFilter&&String.fromCharCode(a.charCode).search(this.keyFilter)==-1&&b.stopEvent(a)},_finish:function(a){this.inherited(arguments);
var e=this.getNode(a);try{l.grid.fire(e,"blur")}catch(b){}}}),l.grid.editors.input=l.grid.editors.Input,b.declare("dojox.grid.editors.Select",l.grid.editors.Input,{constructor:function(){this.options=this.options||this.cell.options;this.values=this.values||this.cell.values||this.options},format:function(a,e){this.needFormatNode(a,e);for(var b=['<select class="dojoxGrid-select">'],g=0,h;(h=this.options[g])&&this.values[g];g++)b.push("<option",a==h?" selected":"",">",h,"</option>");b.push("</select>");
return b.join("")},getValue:function(a){var e=this.getNode(a);if(e)return a=e.selectedIndex,e=e.options[a],this.cell.returnIndex?a:e.value||e.innerHTML}}),l.grid.editors.select=l.grid.editors.Select,b.declare("dojox.grid.editors.AlwaysOn",l.grid.editors.Input,{alwaysOn:!0,_formatNode:function(a,e){this.formatNode(this.getNode(e),a,e)},applyStaticValue:function(a){var e=this.cell.grid.edit;e.applyCellEdit(this.getValue(a),this.cell,a);e.start(this.cell,a,!0)}}),l.grid.editors.alwaysOn=l.grid.editors.AlwaysOn,
b.declare("dojox.grid.editors.Bool",l.grid.editors.AlwaysOn,{_valueProp:"checked",format:function(a){return'<input class="dojoxGrid-input" type="checkbox"'+(a?' checked="checked"':"")+' style="width: auto" />'},doclick:function(a){a.target.tagName=="INPUT"&&this.applyStaticValue(a.rowIndex)}}),l.grid.editors.bool=l.grid.editors.Bool;b._hasResource["dojox.grid.Grid"]||(b._hasResource["dojox.grid.Grid"]=!0,b.provide("dojox.grid.Grid"),b.declare("dojox.Grid",l.VirtualGrid,{model:"dojox.grid.data.Table",
postCreate:function(){if(this.model){var a=this.model;b.isString(a)&&(a=b.getObject(a));this.model=b.isFunction(a)?new a:a;this._setModel(this.model)}this.inherited(arguments)},destroy:function(){this.setModel(null);this.inherited(arguments)},_structureChanged:function(){this.indexCellFields();this.inherited(arguments)},_setModel:function(a){if(this.model=a)this.model.observer(this),this.model.measure(),this.indexCellFields()},setModel:function(a){this.model&&this.model.notObserver(this);this._setModel(a)},
get:function(a){return this.grid?this.grid.model.getDatum(a,this.fieldIndex):this.model.getDatum(a,this.fieldIndex)},modelAllChange:function(){this.rowCount=this.model?this.model.getRowCount():0;this.updateRowCount(this.rowCount)},modelRowChange:function(a,e){this.updateRow(e)},modelDatumChange:function(a,e){this.updateRow(e)},modelFieldsChange:function(){this.indexCellFields();this.render()},modelInsertion:function(){this.updateRowCount(this.model.getRowCount())},modelRemoval:function(){this.updateRowCount(this.model.getRowCount())},
getCellName:function(a){var e=this.model.fields.values,b=a.fieldIndex;return b>=0&&b<e.length&&e[b].name||this.inherited(arguments)},indexCellFields:function(){for(var a=this.layout.cells,e=0,f;a&&(f=a[e]);e++)if(b.isString(f.field))f.fieldIndex=this.model.fields.indexOf(f.field)},refresh:function(){this.edit.cancel();this.model.measure()},canSort:function(a){return(a=this.getSortField(a))&&this.model.canSort(a)},getSortField:function(a){return(this.getCell(this.getSortIndex(a)).fieldIndex+1)*(this.sortInfo>
0?1:-1)},sort:function(){this.edit.apply();this.model.sort(this.getSortField())},addRow:function(a,e){this.edit.apply();var b=e||-1;b<0&&(b=this.selection.getFirstSelected()||0);b<0&&(b=0);this.model.insert(a,b);this.model.beginModifyRow(b);for(var g=0,h;(h=this.getCell(g))&&!h.editor;g++);h&&h.editor&&this.edit.setEditCell(h,b)},removeSelectedRows:function(){this.edit.apply();var a=this.selection.getSelected();a.length&&(this.model.remove(a),this.selection.clear())},canEdit:function(a,e){return this.model.canModify?
this.model.canModify(e):!0},doStartEdit:function(a,e){var b=this.canEdit(a,e);b&&(this.model.beginModifyRow(e),this.onStartEdit(a,e));return b},doApplyCellEdit:function(a,e,b){this.model.setDatum(a,e,b);this.onApplyCellEdit(a,e,b)},doCancelEdit:function(a){this.model.cancelModifyRow(a);this.onCancelEdit.apply(this,arguments)},doApplyEdit:function(a){this.model.endModifyRow(a);this.onApplyEdit(a)},styleRowState:function(a){if(this.model.getState){for(var e=this.model.getState(a.index),b="",g=0,h=["inflight",
"error","inserting"],j;j=h[g];g++)if(e[j]){b=" dojoxGrid-row-"+j;break}a.customClasses+=b}},onStyleRow:function(a){this.styleRowState(a);this.inherited(arguments)},junk:0}));if(!b._hasResource["ws.widget.ListView"])b._hasResource["ws.widget.ListView"]=!0,b.provide("ws.widget.ListView"),l.Grid.prototype.css={templateString:""},l.GridView.prototype._doscroll=l.GridView.prototype.doscroll,l.GridView.prototype.doscroll=function(a){window.clearTimeout(this.scrollTimeout);var e=b.isWebKit?800:400;this.scrollTimeout=
ws.lang.setTimeout(b.hitch(this,"_doscroll"),e,a)},b.declare("ws.widget.ListView",[k._Widget,k._Templated],{widgetsInTemplate:!0,_earlyTemplatedStartup:!0,speedUp:!1,wrapperModelClass:null,fixedRowHeight:!0,cellWidthPad:16,quickActionCol:3,showHeader:!0,dragType:null,preventFixColumns:!1,pinMenu:-1,css:{templateString:""},setModel:function(a){if(a!==this.model)this.model=a,this.gridModel=this.wrapperModelClass?new this.wrapperModelClass(null,null,this.model):this.model,this.initView()},initView:function(){b.toggleClass(this.domNode,
"listViewFixedRowHeight",this.fixedRowHeight);var a=this.grid;this.grid.ownerListView=this;this.adjustColumnsForWebKit();this.updateColumns();a.onCellClick=b.hitch(this,"onCellClick");a.onStyleRow=b.hitch(this,"onStyleRow");a.onHeaderCellClick=b.hitch(this,"onHeaderCellClick");this.initHoverControl();b.connect(a,"onMoveColumn",this,"onMoveColumn");b.connect(a,"onEndDragColumn",this,"onEndMoveColumn");b.connect(a,"onHeaderContextMenu",this,"onHeaderContextMenu");this.initDrag();b.connect(a,"buildViews",
this,"initDrag");this.grid.domNode.onfocus=null;b.connect(this.gridModel,"modelUpdated",b.hitch(this,function(){this.gridModel.allChange();this.updateHeader();this.updateZeroRowsView();this.updateToolbarState()}));a.fastScroll=!1;a.setModel(this.gridModel);this.updateZeroRowsView();this.updateToolbarState();k.byId(this.grid.domNode.parentNode.getAttribute("widgetId")).onResized=b.hitch(this,function(){this.grid.resize();this.autosizeColumns()})},onResized:function(){if(this.stackWidget&&this.stackWidget.resize)this.stackWidget.resize();
else if(this.layoutWidget)this.domNode.style.overflow="hidden",this.layoutWidget.resize(b.contentBox(this.domNode))},updateGrid:function(){this.autosizeColumns();this.updateHeader();this.grid.update()},onCellClick:function(a){var e="Select"in this.gridModel.columns,f=b.hitch(this,function(){this.model.toggleSelectRow(a.rowIndex);this.lastSelectRow=a.rowIndex;this.updateHeader();this.updateToolbarState()}),g=this.model.getCurrentRow?this.model.getCurrentRow():-1;if(e&&a.shiftKey){if(g!=-1)this.model.toggleSelectRow(g,
!0),this.lastSelectRow=g;this.model.selectRange&&"lastSelectRow"in this?(e=this.gridModel.getDatum(this.lastSelectRow,this.gridModel.columns.Select)[0]=="ON",this.model.selectRange(Math.min(this.lastSelectRow,a.rowIndex),Math.max(this.lastSelectRow,a.rowIndex),e,b.hitch(this,function(){this.lastSelectRow=a.rowIndex;this.updateHeader();this.updateToolbarState()}))):(this.model.toggleSelectRow(a.rowIndex),this.lastSelectRow=a.rowIndex,this.updateHeader(),this.updateToolbarState())}else if(e&&(b.isMac?
a.metaKey:a.ctrlKey))g!=-1&&this.model.toggleSelectRow(g,!0),f();else switch(a.cellIndex){case this.gridModel.columns.Select:f();break;case this.gridModel.columns.Hover:this.handleHoverControlClick(a);break;default:this.handleCellClick(a)}},handleCellClick:function(){},updateToolbarState:function(){},onHeaderContextMenu:function(){},onHeaderColumnChange:function(){},initDrag:function(){this.dragSource&&this.dragSource.unregister();this.dragType&&ws.lang.ensureLayersLoadedSoon(b.hitch(this,function(){this.dragSource=
new ws.dnd.GridDragSource(this.grid.views.views[0].contentNode,this.dragType,this)}))},scrollToRow:function(a){this.grid.views.views[0].scrollboxNode.scrollTop=this.grid.scroller.findScrollTop(a)},onStyleRow:function(a){this.disableHover||(a.customClasses+=this.pinMenu!=-1?a.index==this.pinMenu?" dojoxGrid-row-over":"":a.over?" dojoxGrid-row-over":"");a.customClasses+=" "+this.getRowClasses(a.index).join(" ")},getRowClasses:function(a){var e=[];"Select"in this.gridModel.columns&&this.gridModel.getDatum(a,
this.gridModel.columns.Select)[0]=="ON"&&e.push("row-selected");this.model.isCurrentRow&&this.model.isCurrentRow(a)&&e.push("row-current");return e},initHoverControl:function(){this.gridModel.getHoverColumnCB=b.hitch(this,"getHoverColumn");b.connect(this.grid,"onMouseOverRow",b.hitch(this,"onMouseOverRow"));b.connect(this.grid,"onMouseOutRow",b.hitch(this,"onMouseOutRow"));b.connect(document.body,"onmouseover",b.hitch(this,"handleMouseOverNotRow"));this.rightClickMenuDefinition&&b.connect(this.grid,
"onRowContextMenu",this,"onContextMenu");this.disableHover=!1;b.subscribe("dragStart",this,function(){this.disableHover=!0});b.subscribe("dragEnd",this,function(){this.disableHover=!1})},getHoverColumn:function(a,e){var b=this.getQuickActionMenu(!0),b=b&&b.isShowing()?this.quickActionRow:this.grid.rows.overRow;return a==b&&!this.disableHover&&this.pinMenu==-1?e?e+this.hoverColumnHtml:this.hoverColumnHtml:e?e:""},_overRow:-1,onMouseOverRow:function(a){if(a.rowIndex!=this._overRow&&"Hover"in this.gridModel.columns)this._overRow!=
-1&&this.grid.updateRow(this._overRow),this._overRow=a.rowIndex,this.grid.updateRow(a.rowIndex)},handleMouseOverNotRow:function(a){if(this.domNode.style.display!="none"){if(b.isIE){if(a.target.parentNode==null)return;for(var e=this.grid.views.views[0].scrollboxNode,a=a.target;a;){if(a.nodeType==11)return;if(a==e)return;a=a.parentNode}}else if(a.rowNode)return;e=this.grid.rows.overRow;e>-1&&(this.grid.rows.setOverRow(-1),this.onMouseOutRow({rowIndex:e}))}},onMouseOutRow:function(a){if("Hover"in this.gridModel.columns)this._overRow=
-1,this.grid.updateRow(a.rowIndex)},onMouseMove:function(a){var e=!0;if(b.isIE){if(typeof this._lastMouseX=="undefined")this._lastMouseX=a.pageX,this._lastMouseY=a.pageY;e=a.pageX-this._lastMouseX!=0&&a.pageY-this._lastMouseY!=0?!0:!1}if(e)this.grid.onMouseOverRow=this._origMouseOverRow,b.disconnect(this._mouseMoveConnect),this._mouseMoveConnect=null,this._lastMouseX=this._lastMouseY=void 0},getQuickActionMenu:function(a){return this.quickActionMenu?this.quickActionMenu:a?null:(this.createQuickActionMenu(),
this.quickActionMenu)},getRightClickMenu:function(a){if(!this.rightClickMenu&&!a)this.rightClickMenu=ws.widget.createMenu(this.rightClickMenuDefinition),b.connect(this.rightClickMenu,"onClose",this,"OnCloseContextMenu");return this.rightClickMenu},handleHoverControlClick:function(a){if(b.hasClass(a.target,"quickActionHover")){var e=this.getQuickActionMenu();e.isShowing()&&this.quickActionRow==a.rowIndex?e.close():(this.quickActionRow=a.rowIndex,this.updateQuickActionMenu(e),e.open(a.target),this.selectOnlyQuickActionRow())}},
onContextMenu:function(a){b.stopEvent(a);var e=this.getRightClickMenu();e.isShowing()&&e.close();this.quickActionRow=this.pinMenu=a.rowIndex;this.updateRightClickMenu(e);e.open(a.pageX,a.pageY);this.selectOnlyQuickActionRow()},OnCloseContextMenu:function(){var a=this.pinMenu;this.pinMenu=-1;this.grid.updateRow(a)},selectOnlyQuickActionRow:function(){this.model.isAnySelected&&this.model.isAnySelected()&&(this.model.deselectAll(),this.model.toggleSelectRow(this.quickActionRow))},createQuickActionMenu:function(){this.quickActionMenu=
ws.widget.createMenu(this.quickActionMenuDefinition);b.connect("after",this.quickActionMenu,"close",b.hitch(this,function(){this.grid.update(this.quickActionRow,this.gridModel.columns.Hover)}));return this.quickActionMenu},updateQuickActionMenu:function(){},createRightClickMenu:function(){},onHeaderCellClick:function(a){this.gridModel&&a.cell.index==this.gridModel.columns.Select&&this.model.selectAll?this.model.isAllInViewSelected()?this.model.deselectAll():this.model.selectAll():this.grid.setSortIndex(a.cell.index);
ws.widget.popup.closeAllPopups()},updateHeader:function(){if(this.showHeader&&this.gridModel&&"Select"in this.gridModel.columns){var a;this.model.isAllInViewSelected?a=this.model.isAllInViewSelected():(a=this.model&&this.model.isAllSelReal(),this.model&&this.model.getSearchString&&this.model.getSearchString()!=null&&this.model.getRowCount()==ws.lang.getPropCount(this.model.selectedUids)&&(a=!0));this.grid.views.views[0].structure.rows[0][this.gridModel.columns.Select].name="<div class='gridIcon "+
(a?"ws_image_chkOnIcon":"ws_image_chkOffIcon")+"'></div>";this.grid.views.views[0].renderHeader()}else this.grid.headerNode.style.display="none"},updateZeroRowsView:function(){var a=this.gridModel.getRowCount()==0,e=this.model.isLoading&&this.model.isLoading(),f=this.model.isErrorState&&this.model.isErrorState();if(a&&!this.zeroRowsNode)this.zeroRowsNode=document.createElement("div"),this.zeroRowsNode.className="loading",this.grid.domNode.appendChild(this.zeroRowsNode),ws&&ws.WebSuite&&ws.WebSuite.SidePanel&&
ws.WebSuite.SidePanel.setupAdScroll(this.zeroRowsNode);if(this.zeroRowsNode){if(a){if(e&&this.domNode.style.display!="none")this.lastLoadingMsg=this.getLoadingMessage(),b.publish("WSFeedbackStart",[this.lastLoadingMsg]);this.createZeroRowsMessage();this.setupZeroRowsMessage(e,f)}!e&&this.lastLoadingMsg&&b.publish("WSFeedbackEnd",[this.lastLoadingMsg]);this.grid.headerNode.style.visibility=a?"hidden":"";this.grid.viewsNode.style.visibility=a?"hidden":"";ws.html.setShowing(this.zeroRowsNode,a)}},getLoadingMessage:function(){return Config.Strings.Loading},
getErrorMessage:function(){return Config.Strings.Error},getZeroRowsMessage:function(){return Config.Strings.NoMatchesFound},createZeroRowsMessage:function(){var a="<div class='emsg' style='display:none'>"+this.getErrorMessage()+"</div>",e="<div class='zmsg' style='display:none'>"+this.getZeroRowsMessage()+"</div>";this.zeroRowsNode.innerHTML="<table><tr><td valign='center'><div class='lmsg' style='display:none'></div>"+a+e+"</td></tr></table>";this.postCreateZeroRowsMessage()},postCreateZeroRowsMessage:function(){},
setupZeroRowsMessage:function(a,e){var f=b.query(".lmsg",this.zeroRowsNode)[0],g=b.query(".emsg",this.zeroRowsNode)[0],h=b.query(".zmsg",this.zeroRowsNode)[0];ws.html.setShowing(f,!1);ws.html.setShowing(g,!1);ws.html.setShowing(h,!1);a?ws.html.setShowing(f,!0):e?ws.html.setShowing(g,!0):(this.beforeShowZeroRowsMessage(),ws.html.setShowing(h,!0))},beforeShowZeroRowsMessage:function(){},baseSprites:{chkBox:{NONE:"",ON:"ckonCol",OFF:"ckoffCol"}},getColMinMax:function(a){var e={min:50,max:0};if(this.columnDefaults){a=
this.columnDefaults[a];if(a.min)e.min=a.min;if(a.max)e.max=a.max}return e},limitMinMax:function(a,e){var b=e;if(e<a.min)b=a.min;else if(e>a.max)b=a.max;return b},autosizeColumns:function(a,e){var f=this.gridModel.columns[this.autosizeColumnId],g=this.grid.views.views[0];if(f>=0){var h=b.contentBox(this.grid.domNode).w-(a?0:18);if(!(h<0)){for(var j=g.structure.rows[0],m=this.getColMinMax(j[f].id),k=b.isSafari?0:this.cellWidthPad,l=0;l<j.length;l++){var n=j[l];n.index!=f&&!n.hidden&&(h-=parseInt(n.unitWidth)+
k)}h-=k+(e?e:0);if(h<m.min)h=m.min;j=0;if(m.max)j=m.max,this.autoWidthSizedTo&&(j=this.autoWidthSizedTo-k);if(j&&h>j)h=j,this.autosizeColumnWidth=0;h!=this.autosizeColumnWidth&&g.setColWidth(f,h);this.autosizeColumnWidth=h;b.isWebKit?ws.lang.setTimeout(g,"update",0):g.update()}}else g.update()},checkColumnSizes:function(a){var e=this.gridModel.columns[this.autosizeColumnId];if(e>=0){for(var f=b.contentBox(this.grid.domNode).w-18,g=this.grid.views.views[0],h=g.structure.rows[0],j=b.isSafari?0:this.cellWidthPad,
m=this.getColMinMax(h[e].id),k=h[a],l=this.getColMinMax(k.id),n=0;n<h.length;n++){var p=h[n];p.index!=e&&!p.hidden&&(f-=p.index==a?this.limitMinMax(l,parseInt(p.unitWidth)+j):parseInt(p.unitWidth)+j)}f-=j;n=Math.max(m.min,f);k=parseInt(k.unitWidth)+j;h=parseInt(h[e].unitWidth)+j;a==e?k>f?(g.setColWidth(e,n),this.autoWidthSizedTo=n):k<m.min?(g.setColWidth(e,m.min),this.autoWidthSizedTo=m.min):this.autoWidthSizedTo=k:(l=this.limitMinMax(l,k),l!=k&&g.setColWidth(a,l),h>f&&(n=this.limitMinMax(m,f),g.setColWidth(e,
n)));g.update()}},onMoveColumn:function(a,e){var f=b.hitch(this,function(a){var e=b.filter(this.columns,function(a){return!a.hidden});if(a>=e.length)return this.columns.length;return b.indexOf(this.columns,e[a])}),a=f(a),e=f(e);l.grid.arrayMove(this.columns,a,e);for(f=0;f<this.columns.length;f++)this.gridModel.columns[this.columns[f].id]=f},onEndMoveColumn:function(){this.updateColumns();this.onHeaderColumnChange()},_onKeyPress:function(a){if(this.isShowing()){var e=!1,f=this.grid,g=f.views.views[0],
h=this.model.getCurrentRow?this.model.getCurrentRow():-1;if(h==-1)h=f.rows.overRow;var j=-1,m=this.gridModel.getRowCount(),k=Math.floor(f.scroller.pageHeights[0]/Math.min(m,f.scroller.rowsPerPage)),l=this.grid.views.views[0].scrollboxNode.offsetHeight,n=!1;if(Config.EnableKeyboardShortcuts&&a.keyChar&&b.isString(a.keyChar)&&!a.ctrlKey&&!a.altKey&&!a.metaKey){if(h>=0)switch(a.keyChar.toLowerCase()){case Config.Strings.KeyListToggleCheckItem:this.model.toggleSelectRow(h);this.lastSelectRow=h;this.updateHeader();
this.updateToolbarState();e=!0;break;case Config.Strings.KeyListOpenQuickActionMenu:ws.lang.ensureLayersLoaded(b.hitch(this,function(){var a=this.getQuickActionMenu(!1);a&&a.isShowing()&&this.quickActionRow!=h&&a.close();var e=g.getCellNode(h,this.quickActionCol);if(e){this.quickActionRow=h;this.updateQuickActionMenu(a);for(var f=null,j=0;j<e.childNodes.length;j++)if(b.hasClass(e.childNodes[j],"quickActionHover")){f=e.childNodes[j];break}f&&a.open(f);this.selectOnlyQuickActionRow()}})),e=!0}}else if(Config.EnableKeyboardShortcuts){if(ws.widget.popup.isAnyPopupOpen())return;
var p=a.keyCode;if(b.isMac&&a.metaKey)if(a.keyCode==b.keys.UP_ARROW)p=b.keys.PAGE_UP;else if(a.keyCode==b.keys.DOWN_ARROW)p=b.keys.PAGE_DOWN;else if(a.keyCode==b.keys.LEFT_ARROW)p=b.keys.HOME;else if(a.keyCode==b.keys.RIGHT_ARROW)p=b.keys.END;switch(p){case b.keys.UP_ARROW:h<0&&(h=Math.floor((g.scrollboxNode.scrollTop+this.grid.scroller.windowHeight)/k));h>=1&&(j=h-1);n=e=!0;break;case b.keys.DOWN_ARROW:h<0&&(h=Math.floor(g.scrollboxNode.scrollTop/k));h+1<m&&(j=h+1);n=e=!0;break;case b.keys.PAGE_UP:h<
0&&(h=Math.min(this.grid.scroller.lastVisibleRow,m-1));j=this.grid.scroller.firstVisibleRow;if(h==j||h==j+1)j=h-Math.floor(l/k),j=Math.max(0,j);n=e=!0;break;case b.keys.PAGE_DOWN:if(h<0)h=this.grid.scroller.firstVisibleRow;j=this.grid.scroller.lastVisibleRow;if(h==j||h==j-1)j=h+Math.floor(l/k);j=Math.min(j,m-1);n=e=!0;break;case b.keys.HOME:j=0;n=e=!0;break;case b.keys.END:j=m-1;n=e=!0;break;case b.keys.DELETE:k=[];b.isFunction(this.model.getSelectedUids)?k=this.model.getSelectedUids():b.isFunction(this.gridModel.getSelectedUids)&&
(k=this.gridModel.getSelectedUids());if(k.length)this.onDelKeyPress(k);else if(h>=0)this.onDelKeyPress(h);e=!0;break;case b.keys.BACKSPACE:if(b.isMac){k=[];b.isFunction(this.model.getSelectedUids)?k=this.model.getSelectedUids():b.isFunction(this.gridModel.getSelectedUids)&&(k=this.gridModel.getSelectedUids());if(k.length)this.onDelKeyPress(k);else if(h>=0)this.onDelKeyPress(h);e=!0}break;case b.keys.ENTER:if(h>=0)this.onEnterKeyPress(h);e=!0}}if(j!=-1){if((this.model.getCurrentRow?this.model.getCurrentRow():
-1)!=-1){if(k=f.rows.overRow,f.rows.setOverRow(-1),this.onMouseOutRow({rowIndex:k}),this.setCurrentRow(j),!this._mouseMoveConnect){if(!this._origMouseOverRow)this._origMouseOverRow=this.grid.onMouseOverRow;this.grid.onMouseOverRow=function(){};this._mouseMoveConnect=b.connect(b.doc.documentElement,"onmousemove",this,"onMouseMove")}}else this.clearMouseHandler(),k=f.rows.overRow,f.rows.setOverRow(j),this.onMouseOutRow({rowIndex:k}),this.onMouseOverRow({rowIndex:j});n&&this.scrollIntoView(j)}if(e)a.preventDefault();
else this.onOtherKeyPress(a,h)}},setCurrentRow:function(){},scrollOnKeyPress:function(a){this.clearMouseHandler();this.grid.views.views[0].scrollboxNode.scrollTop=a},clearMouseHandler:function(){if(!this._origMouseOverRow)this._origMouseOverRow=this.grid.onMouseOverRow;if(!this._origMouseOutRow)this._origMouseOutRow=this.grid.onMouseOutRow;this.grid.onMouseOverRow=function(){};this.grid.onMouseOutRow=function(){};ws.lang.setTimeout(this,"restoreMouseHandler",150)},restoreMouseHandler:function(){this.grid.onMouseOverRow=
this._origMouseOverRow;this.grid.onMouseOutRow=this._origMouseOutRow},scrollIntoView:function(a){if(!(a<0)){var e=this.grid.scroller,b=this.grid.views.views[0].scrollboxNode,g=Math.floor(e.pageHeights[0]/Math.min(this.gridModel.getRowCount(),e.rowsPerPage)),e=Math.floor(b.offsetHeight/g),b=Math.floor(b.scrollTop/g),g=-1;b>a?g=a:b+e<=a&&(g=a-e+1);g!=-1&&(this.clearMouseHandler(),this.scrollToRow(g))}},onEnterKeyPress:function(){},onDelKeyPress:function(){},onOtherKeyPress:function(){},toggleColumn:function(a,
e){var b=!1;if(a=="RESET")b=!0,this.autoWidthSizedTo=0,this.initColumns(!0),this.adjustColumnsForWebKit(),this.grid.setSortIndex(Math.abs(this.defSort),this.defSort>=0);else{var g=this.columns[ws.lang.findByProp(this.columns,"id",a)];typeof e=="undefined"&&(b=!0,e=!g.hidden);g.hidden=e}this.updateColumns();if(b)this.onHeaderColumnChange(null,a=="RESET")},adjustColumnsForWebKit:function(){b.isSafari&&b.forEach(this.columns,function(a){a.width=parseInt(a.width)+this.cellWidthPad+"px"},this)},updateColumns:function(){for(var a=
0,e=0;e<this.columns.length;e++){var f=this.columns[e];f.hidden?this.gridModel.columns[f.id]=-1:(this.gridModel.columns[f.id]=a,a++)}a=b.filter(this.columns,function(a){return!a.hidden});if(this.grid.sortInfo!=0&&this.grid.views.views[0]){f=b.query("th.dojoxGrid-cell",this.grid.headerNode);for(e=0;e<f.length;e++){var g=f[e];if(g.children&&g.children.length>0&&g.children[0].className.indexOf("dojoxGrid-sort")!=-1){this.grid.sortInfo=(this.grid.sortInfo<0?-1:1)*(e+1);break}}}this.grid.setStructure([{cells:[a]}]);
this.autosizeColumnWidth=0;this.autosizeColumns()},formatSprite:function(a,e){if(e){var b=e.sort&&e[1]||"",e=e.sort&&e[0]||e,g=a&&a[e]?a[e]:null;return g?ws.string.substituteParams("<div class='gridIcon %{0}' title='%{1}'></div>",g,b):""}}}),l.GridView.prototype.hasScrollbar=function(){return!0},b.extend(l.grid.headerBuilder,{endResizeColumn:function(a){this.grid&&this.grid.ownerListView&&(this.grid.ownerListView.checkColumnSizes(a.index),this.grid.ownerListView.onHeaderColumnChange())},beginMoveColumn:function(a){b.stopEvent(a);
if(a.cellNode&&a.cellNode.parentNode){var e={headerNode:a.cellNode.parentNode,colIndex:a.cellIndex,cellNode:a.cellNode,rowLeft:b._abs(this.grid.views.views[0].headerNode,!0).x},f=b.hitch(this,"startDragColumn",e),g=b.hitch(this,"doDragColumn",e),e=b.hitch(this,"endDragColumn",e);l.grid.drag.start(a.cellNode.parentNode,g,e,a,f)}},startDragColumn:function(a){this.moving=!0;this.cols=this.grid.views.views[0].structure.cells[0];a.cellNode.style.backgroundColor="#ddd";a.headerNode.style.cursor="move"},
doDragColumn:function(a,e){var b=this.findColumnByX(a.colIndex,e.clientX-a.rowLeft);if(b>=0&&b!=a.colIndex)this.moveColumn(a.colIndex,b),a.colIndex=b},endDragColumn:function(a){a.headerNode.style.cursor="";a.cellNode.style.backgroundColor="";this.moving=!1;this.grid.onEndDragColumn()},findColumnByX:function(a,e){for(var b=0,g=0,h;b<this.cols.length;b++)if(h=parseInt(this.cols[b].width)){if(g+h>e)return h/=2,b>a?g+h<e?b:a:g+h>e?b:a;g+=h+6}return-1},moveColumn:function(a,e){var f=e>a?1:0,g=e+f,h=b.query(".dojoxGrid-cell",
this.grid.views.views[0].headerContentNode);if(h.length-1>e)h[0].parentNode.insertBefore(h[a],h[g]),l.grid.arrayMove(this.cols,a,g),this.grid.onMoveColumn(a,g,f),f=this.grid.getSortIndex(),h=this.grid.sortInfo<0,f=l.grid.moveIndex(f,a,g),this.grid.sortInfo=h?-f:f+1},domousemove:function(a){var e=this.overRightResizeArea(a)?b.isIE<9?"e-resize":"ew-resize":this.overLeftResizeArea(a)?b.isIE<9?"w-resize":"ew-resize":"";e&&!this.canResize(a)&&(e="default");var f=a.cellIndex>=0&&this.grid.views.views[0].structure.cells[0][a.cellIndex];
!e&&f&&this.grid.model.canSort(a.cellIndex+1)&&(e="pointer");a.sourceView.headerNode.style.cursor=e||""},overLeftResizeArea:function(a){var e=b.isIE>=9?a.offsetX:a.cellX;return a.cellIndex>0&&e<this.overResizeWidth&&this.prepareLeftResize(a)},overRightResizeArea:function(a){var e=b.isIE>=9?a.offsetX:a.cellX;return a.cellNode&&e>=a.cellNode.offsetWidth-this.overResizeWidth},domousedown:function(a){l.grid.drag.dragging||((this.overRightResizeArea(a)||this.overLeftResizeArea(a))&&this.canResize(a)?this.beginColumnResize(a):
this.beginMoveColumn(a))}}),b.extend(l.Grid,{onMoveColumn:function(){},onEndDragColumn:function(){},onKeyDown:function(){}}),b.mixin(l.grid,{arrayMove:function(a,e,b){var g=a[e];a.splice(e,1);l.grid.arrayInsert(a,b<e?b:b-1,g)},moveIndex:function(a,e,b){if(a==e)return b-(a<b);return a-(a>e)+(a>=b)}});b._hasResource["ws.widget.WSDatePicker"]||(b._hasResource["ws.widget.WSDatePicker"]=!0,b.provide("ws.widget.WSDatePicker"),b.declare("ws.widget.WSDatePicker",[k._Widget,k._Templated],{templateString:b.cache("ws.widget",
"WSDatePicker.html",'<div class="WSDatePicker" dojoAttachPoint="WSDatePickerDiv" style="overflow: hidden;position:relative;">\r\n    <div dojoAttachPoint="topNav" class="topNav">\r\n        <div class="topNavChild">\r\n            <div class="mainSprite prevButton" dojoAttachEvent="onclick: decrementMonth"></div>\r\n            <div class="mainSprite nextButton" dojoAttachEvent="onclick: incrementMonth"></div>\r\n        </div>\r\n    </div>\r\n    <div class="nav">\r\n        <div class="mainSprite prevButton" dojoAttachEvent="onclick: decrementMonth"></div>\r\n    </div>\r\n    <div dojoAttachPoint="datePickerMain" style="float:left">\r\n        <table border="0" cellpadding="0" cellspacing="0" class="calTable">\r\n            <tbody dojoAttachPoint="datePickerBody">\r\n                <tr>\r\n                    <td colspan="7" class="monthYear"><span dojoAttachPoint="monthYearNode" class="monthyear"></span></td>\r\n                </tr>\r\n                <tr dojoAttachPoint="datePickerDaysOfWeek" class="days">\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                </tr>\r\n                <tr class="dates">\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                </tr>\r\n                <tr class="dates">\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                </tr>\r\n                <tr class="dates">\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                </tr>\r\n                <tr class="dates">\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                </tr>\r\n                <tr class="dates" style="display:none" dojoAttachPoint="fifthWeekRow">\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                </tr>\r\n                <tr class="dates" style="display:none" dojoAttachPoint="sixthWeekRow">\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate"><span></span></td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n        <div class="verticalRule"></div>\r\n        <table border="0" cellpadding="0" cellspacing="0" class="calTable calTable2">\r\n            <tbody dojoAttachPoint="datePickerBody2">\r\n                <tr style="display:none">\r\n                    <td  class="monthYear" colspan="7"><span dojoAttachPoint="monthYearNode2" class="monthyear"></span></td>\r\n                </tr>\r\n                <tr style="display:none"  dojoAttachPoint="datePickerDaysOfWeek2" class="days">\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                    <td><span></span></td>\r\n                </tr>\r\n                <tr class="dates" style="display:none">\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                </tr>\r\n                <tr class="dates" style="display:none">\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                </tr>\r\n                <tr class="dates" style="display:none">\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                </tr>\r\n                <tr class="dates" style="display:none">\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                </tr>\r\n                <tr class="dates" style="display:none" dojoAttachPoint="fifthWeekRow2">\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                </tr>\r\n                <tr class="dates" style="display:none" dojoAttachPoint="sixthWeekRow2">\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                    <td dojoAttachEvent="onclick: onSelectDate2"><span></span></td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n\r\n    </div>\r\n    <div class="nav">\r\n        <div class="mainSprite nextButton" dojoAttachEvent="onclick: incrementMonth"></div>\r\n    </div>\r\n    <div dojoAttachPoint="datePickerFoot" style="clear:both;text-align: center;">\r\n            <span class="todayContainer" dojoAttachEvent="onclick: selectToday"><div class="iconToday mainSprite"></div><span class="wsLink" dojoAttachPoint="todayNode"></span></span>\r\n    </div>\r\n</div>\r\n'),
css:{templateString:""},gridHeadDateFormat:Config.Strings.DatePickerHeaderDateFormat,gridFooterDateFormat:Config.Strings.DatePickerFooterDateFormat,hideTodayLink:!1,hideBorder:!1,startup:function(){this.dateCells=this.dateRows=this.viewEnd=this.viewStart=this.selectedDate=this.displayDate=this.today=this.now=null;this.startRow=2;this.endRow=7;this.numRowsBeingDisplayed=5;this.dateRows=this.datePickerBody.rows;this.dateCells=[];for(var a,e=this.startRow;e<=this.endRow;e++){a=this.dateRows[e];this.dateCells[e-
this.startRow]=[];a=a.cells;for(var b=0;b<a.length;b++)this.dateCells[e-this.startRow][b]=a[b],this.dateCells[e-this.startRow][b]._dayOffset=(e-this.startRow)*7+b}b=0;for(a=[];b<ws.date.abbrevDays.length;)e=(ws.date.firstDayOfWeek+b)%ws.date.abbrevDays.length,a[b]=ws.date.abbrevDays[e],b++;b=this.datePickerDaysOfWeek.getElementsByTagName("span");for(e=0;e<b.length;e++)b[e].innerHTML=a[e];this.setDate(null);if(this.hideTodayLink)this.datePickerFoot.style.display="none";if(this.hideBorder)this.WSDatePickerDiv.style.border=
"none"},selectDateConnect:function(){},updateUI:function(a){var e={};a&&(e=a);this.monthYearNode.innerHTML=ws.date.formatDateTime(this.displayDate,this.gridHeadDateFormat);for(var f=a=null,g=this.viewStart,h=this.endRow-this.startRow+1,j=0,j=0;j<h;j++)if(j==h-1&&g.getMonth()!=this.displayDate.getMonth()){this.sixthWeekRow.style.display="none";break}else if(j==h-2&&g.getMonth()!=this.displayDate.getMonth()){this.fifthWeekRow.style.display="none";break}else{if(j==h-1)this.sixthWeekRow.style.display=
"";if(j==h-2)this.fifthWeekRow.style.display="";for(var k=0;k<this.dateCells[j].length;k++){a=this.dateCells[j][k];b.removeClass(a);f=a.childNodes[0];if(g.getMonth()!=this.displayDate.getMonth())b.addClass(a,"empty"),f.innerHTML="";else{var l=g.getDate();f.style.fontWeight=e[l]?"bold":"normal";f.innerHTML=g.getDate()}l="";f.innerHTML!=""&&(g.getTime()==this.today.getTime()&&(l="today"),g.getTime()==this.selectedDate.getTime()&&(l="selected"));l&&b.addClass(a,l);g=ws.date.add(g,ws.date.dateParts.DAY,
1)}}this.numRowsBeingDisplayed=j;e=ws.date.formatDateTime(this.today,this.gridFooterDateFormat);this.todayNode.innerHTML=Config.Strings.TodayIs+e},getNumRows:function(){return this.numRowsBeingDisplayed},setDate:function(a){this.now=new Date;this.today=new Date(this.now.getFullYear(),this.now.getMonth(),this.now.getDate());this.displayDate=a;if(this.displayDate==null)this.displayDate=new Date(this.now.getFullYear(),this.now.getMonth(),this.now.getDate());if(this.selectedDate==null)this.selectedDate=
new Date(this.now.getFullYear(),this.now.getMonth(),this.now.getDate());this.viewStart=ws.date.getFirstDayInMonthView(this.displayDate);this.viewEnd=ws.date.getLastDayInMonthView(this.displayDate);this.updateUI()},decrementMonth:function(){this.setDate(ws.date.add(this.displayDate,ws.date.dateParts.MONTH,-1))},incrementMonth:function(){this.setDate(ws.date.incrementMonth(this.displayDate))},onSelectDate:function(a){if((a=a.currentTarget)&&a.childNodes[0].innerHTML!="")this.selectedDate=ws.date.add(this.viewStart,
ws.date.dateParts.DAY,a._dayOffset),this.setDate(this.selectedDate),this.selectDateConnect(this.selectedDate)},displayForPublicView:function(){this.datePickerFoot.style.display="none";this.WSDatePickerDiv.style.border="none";b.query(".nav",this.domNode).forEach(function(a){a.style.display="none"});b.style(this.datePickerMain,"float","none");this.topNav.style.display="block"},selectToday:function(){this.selectedDate=this.today;this.setDate(this.selectedDate);this.selectDateConnect(this.selectedDate)},
onSelectDate2:function(){}}),b.declare("ws.widget.WSDualDatePicker",ws.widget.WSDatePicker,{startup:function(){this.inherited(arguments);this.startRow2=2;this.endRow2=7;this.viewStart2=null;var a;this.dateRows=this.datePickerBody2.rows;this.dateRows[0].style.display="";this.dateRows[1].style.display="";for(var e=this.dateCells.length,b=this.startRow2;b<=this.endRow2;b++){a=this.dateRows[b];a.style.display="";this.dateCells[e]=[];a=a.cells;for(var g=0;g<a.length;g++)this.dateCells[e][g]=a[g],this.dateCells[e][g]._dayOffset=
(b-this.startRow2)*7+g;e++}a=0;for(e=[];a<ws.date.abbrevDays.length;)b=(ws.date.firstDayOfWeek+a)%ws.date.abbrevDays.length,e[a]=ws.date.abbrevDays[b],a++;a=this.datePickerDaysOfWeek2.getElementsByTagName("span");for(b=0;b<a.length;b++)a[b].innerHTML=e[b]},updateUI:function(){ws.widget.WSDualDatePicker.superclass.updateUI.call(this);var a=ws.date.incrementMonth(this.displayDate);this.monthYearNode2.innerHTML=ws.date.formatDateTime(a,this.gridHeadDateFormat);this.viewStart2=ws.date.getFirstDayInMonthView(a);
for(var e=null,f=null,g=this.viewStart2,e=this.dateCells.length/2,h=e+(this.endRow2-this.startRow2),j=e;j<=h;j++)if(j==h-1&&g.getMonth()!=a.getMonth()){this.sixthWeekRow2.style.display="none";break}else if(j==h-2&&g.getMonth()!=a.getMonth()){this.fifthWeekRow2.style.display="none";break}else{if(j==h-1)this.sixthWeekRow2.style.display="";if(j==h-2)this.fifthWeekRow2.style.display="";for(var k=0;k<this.dateCells[j].length;k++){e=this.dateCells[j][k];b.removeClass(e);f=e.childNodes[0];g.getMonth()!=
a.getMonth()?(b.addClass(e,"empty"),f.innerHTML=""):f.innerHTML=g.getDate();var l="";f.innerHTML!=""&&(g.getTime()==this.today.getTime()&&(l="today"),g.getTime()==this.selectedDate.getTime()&&(l="selected"));l&&b.addClass(e,l);g=ws.date.add(g,ws.date.dateParts.DAY,1)}}},onSelectDate2:function(a){if((a=a.currentTarget)&&a.childNodes[0].innerHTML!="")this.selectedDate=ws.date.add(this.viewStart2,ws.date.dateParts.DAY,a._dayOffset),this.setDate(this.selectedDate),this.selectDateConnect(this.selectedDate)},
decrementMonth:function(){this.setDate(ws.date.add(this.displayDate,ws.date.dateParts.MONTH,-2))},incrementMonthHelper:function(){this.setDate(ws.date.incrementMonth(this.displayDate))},incrementMonth:function(a){this.incrementMonthHelper(a);this.incrementMonthHelper(a)}}));b._hasResource["ws.widget.PopupDatePicker"]||(b._hasResource["ws.widget.PopupDatePicker"]=!0,b.provide("ws.widget.PopupDatePicker"),b.declare("ws.widget.PopupDatePicker",[k._Widget,k._Templated],{templateString:'<div dojoAttachPoint="containerNode" class="wsMenu" style="display:none"><div style="display:none" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick: closeDatePicker"></div></div>',
_earlyTemplatedStartup:!0,width:245,closeOnMouseOut:!1,displayDate:null,hidePickerOnSetDate:!1,useCloseButton:!1,startup:function(){if(!this._started&&(this._started=!0,this.hideTimeout=null,this.datePicker=new ws.widget.WSDatePicker,this.containerNode.appendChild(this.datePicker.domNode),this.datePicker.startup(),b.marginBox(this.domNode,{w:this.width}),this.datePicker.setDate(this.displayDate),this.hidePickerOnSetDate&&this.connect(this.datePicker,"selectDateConnect","hidePopup"),this.setupCloseOnMouseOutHandlers(),
this.useCloseButton))this.containerNode.firstChild.style.display="block"},onOpen:function(){},setupCloseOnMouseOutHandlers:function(){if(this.closeOnMouseOut)this.mouseOverEvt=this.connect(this.domNode,"onmouseover","cancelTimeouts"),this.mouseOutEvt=this.connect(this.domNode,"onmouseout","hidePopup")},setDate:function(a){this.displayDate=a;this.datePicker.setDate(this.displayDate);this.hidePickerOnSetDate&&this.hidePopup()},initializeDate:function(a){this.displayDate=a;this.datePicker.setDate(this.displayDate)},
cancelTimeouts:function(){if(this.hideTimeout!=null)clearTimeout(this.hideTimeout),this.hideTimeout=null},hidePopup:function(){this.cancelTimeouts();this.hideTimeout=ws.lang.setTimeout(this,"delayedHidePopup",10)},delayedHidePopup:function(){if(this.hideTimeout!=null)this.hideTimeout=null,ws.widget.popup.close(this)},getSelectedDate:function(){return this.datePicker.selectedDate},closeDatePicker:function(){ws.widget.popup.close(this)}}),b.declare("ws.widget.PopupDualDatePicker",ws.widget.PopupDatePicker,
{startup:function(){this.hideTimeout=null;this.datePicker=new ws.widget.WSDualDatePicker;this.containerNode.appendChild(this.datePicker.domNode);b.style(this.containerNode.firstChild,"zIndex","1");this.datePicker.startup();b.addClass(this.datePicker.domNode,"dual");this.datePicker.setDate(this.displayDate);this.setupCloseOnMouseOutHandlers();if(this.useCloseButton)this.containerNode.firstChild.style.display="block"}}));b._hasResource["ws.widget.WSTimePicker"]||(b._hasResource["ws.widget.WSTimePicker"]=
!0,b.provide("ws.widget.WSTimePicker"),b.declare("ws.widget.WSTimePicker",[k._Widget,k._Templated],{templateString:b.cache("ws.widget","WSTimePicker.html",'<div dojoAttachPoint="timePickerContainer" class="WSTimePicker">\r\n\t<table dojoAttachPoint="timePickerBody" class="pickerBody" border="0" cellpadding="0" cellspacing="0">\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t\t<tr><td dojoAttachEvent="onmouseover: onMouseOverTime, onmouseout: onMouseOutTime, onclick: onSelectTime"><a href="#"></a></td></tr>\r\n\t</table>\r\n</div>\r\n'),
css:{templateString:""},timeFormat:Config.Strings.CalTimeFormatRange1,startup:function(){this.selectedCell=null;this.selectedTime="";this.timeLinks=[];for(var a,e,f,g=new Date,h=0;h<48;h++)a=b.query(">",this.timePickerBody.rows[h])[0],a=b.query("a",a)[0],h%2?(e=Math.floor(h/2),f=30):(e=h/2,f=0),g.setHours(e,f),a.innerHTML=ws.date.formatDateTime(g,this.timeFormat),this.timeLinks[h]=a;b.isFF&&b.addClass(this.timePickerBody,"pickerBodyFF");this.setTime(null)},selectTimeConnect:function(){},updateUI:function(){},
setTime:function(a){this.selectedCell&&b.removeClass(this.selectedCell,"selected");if(a){var e=a.getHours(),a=a.getMinutes(),e=e*2+(a>0?1:0)+(a>30?1:0);e==48&&(e=0);this.selectedCell=b.query(">",this.timePickerBody.rows[e])[0];b.addClass(this.selectedCell,"selected");this.selectedTime=b.query("a",this.selectedCell)[0].innerHTML;this.timePickerContainer.scrollTop=e*20}else this.timePickerContainer.scrollTop=0;this.updateUI()},onSelectTime:function(a){if((a=a.currentTarget)&&a.childNodes[0].innerHTML!=
"")this.selectedCell&&b.removeClass(this.selectedCell,"selected"),this.selectedCell=a,b.addClass(a,"selected"),this.selectedTime=a.childNodes[0].innerHTML,this.selectTimeConnect(this.selectedTime)},onMouseOverTime:function(a){(a=a.currentTarget)&&a.childNodes[0].innerHTML!=""&&b.addClass(a,"hovered")},onMouseOutTime:function(a){(a=a.currentTarget)&&a.childNodes[0].innerHTML!=""&&b.removeClass(a,"hovered")}}));b._hasResource["ws.widget.PopupTimePicker"]||(b._hasResource["ws.widget.PopupTimePicker"]=
!0,b.provide("ws.widget.PopupTimePicker"),b.declare("ws.widget.PopupTimePicker",[k._Widget,k._Templated],{templateString:'<div dojoAttachPoint="containerNode" class="wsMenu" style="display:none"></div>',width:100,closeOnMouseOut:!1,displayTime:null,hidePickerOnSetTime:!1,startup:function(){this.hideTimeout=null;this.timePicker=new ws.widget.WSTimePicker;this.containerNode.appendChild(this.timePicker.domNode);this.timePicker.startup();b.marginBox(this.domNode,{w:this.width});this.timePicker.setTime(this.displayTime);
this.hidePickerOnSetTime&&this.connect(this.timePicker,"selectTimeConnect","hidePopup");this.setupCloseOnMouseOutHandlers()},onOpen:function(){},setTime:function(a){this.displayTime=a;this.timePicker.setTime(this.displayTime);this.hidePickerOnSetTime&&this.hidePopup()},initializeTime:function(a){this.displayTime=a;this.timePicker.setTime(this.displayTime)},setupCloseOnMouseOutHandlers:function(){if(this.closeOnMouseOut)this.mouseOverFncLink=this.connect(this.domNode,"onmouseover","cancelTimeouts"),
this.mouseOutFncLink=this.connect(this.domNode,"onmouseout","hidePopup")},cancelTimeouts:function(){if(this.hideTimeout!=null)clearTimeout(this.hideTimeout),this.hideTimeout=null},hidePopup:function(){this.cancelTimeouts();this.hideTimeout=ws.lang.setTimeout(this,"delayedHidePopup",10)},delayedHidePopup:function(){if(this.hideTimeout!=null)this.hideTimeout=null,ws.widget.popup.close(this)},getSelectedTime:function(){return this.timePicker.selectedTime}}));b._hasResource["ws.widget.WSSelect"]||(b._hasResource["ws.widget.WSSelect"]=
!0,b.provide("ws.widget.WSSelect"),b.declare("ws.widget.WSSelect",[k._Widget,k._Templated,k._Container],{options:null,currentValue:-1,id:"",className:"",tabindex:"",title:"",enabled:!0,isMenuDirty:!1,optionalLabelPrefix:null,staticMenuHeader:null,useTinyArrow:!1,disableCheck:!1,disableMouseStates:!1,size:"byValue",templateString:'<div id="${id}" tabindex="${tabindex}" class="wsSelect ${className}" title="${title}" dojoAttachEvent="onclick: toggleMenu, onkeypress: onKeyPress, onmousedown:_onMouseDown, onmouseup:_onMouseUp, onmouseout:_onMouseOut, onmouseover:onMouseOver">\t<div class="option" dojoAttachPoint="currentValueNode"></div>\t<div class="wsArrow" dojoAttachPoint="arrowNode"></div></div>',
css:{templateString:""},constructor:function(a){if(a&&a.options){for(var e=[],a=a.options,b=0;b<a.length;b++)e.push({display:a[b].display,value:a[b].value,selected:a[b].selected});if(e!=null)this.options=e}},buildRendering:function(){var a=[];if(this.srcNodeRef!=null)for(var e=this.srcNodeRef.getElementsByTagName("li"),b=0;b<e.length;b++)a.push({display:e[b].innerHTML,value:""+e[b].getAttribute("value"),selected:e[b].getAttribute("selected")=="true"});if(this.options==null)this.options=a;this.inherited(arguments)},
startup:function(){this.setOptions(this.options);this.disableMouseStates||ws.html.addHoverClass(this.domNode,"wsSelectHover");if(this.useTinyArrow)this.arrowNode.className="wsTinyArrow",b.isIE&&setTimeout(b.hitch(this,"fixArrow"),10)},fixArrow:function(){if(this.arrowNode!=null)this.arrowNode.style.zoom="",this.arrowNode.style.zoom=1},setOptions:function(a){this.options=a;this.isMenuDirty=!0;for(var e=0,f=0;f<a.length;f++)a[f].selected&&(e=f);a.length>0&&this.setOption(e);this.enabled=a.length>1;
b.toggleClass(this.domNode,"wsSelectDisabled",!this.enabled)},getMenu:function(){if(this.menu&&!this.isMenuDirty)return this.menu;this.menu?this.menu.destroyDescendants():this.createMenu();for(var a=0;a<this.options.length;a++){var e;e=this.options[a].isSeparator?new ws.widget.WSMenuSeparator:new ws.widget.WSMenuItem({caption:this.options[a].display,disabled:this.options[a].disabled,checked:this.disableCheck?!1:this.options[a].checked});if(!this.options[a].disabled)this.options[a]._onClick?e._onClick=
this.options[a]._onClick:e.onClick=b.hitch(this,"setOption",a,!0);this.menu.addChild(e);e.startup()}this.isMenuDirty=!1;return this.menu},createMenu:function(){this.menu=new ws.widget.WSMenu;this.menu.startup();b.body().appendChild(this.menu.domNode)},toggleMenu:function(){var a=this.getMenu();a.isShowing()||!this.enabled?a.close():a.open(this.domNode)},onKeyPress:function(a){a.keyCode==b.keys.ENTER&&ws.lang.setTimeout(this,function(){this.toggleMenu()},0)},sizeMyself:function(){if(this.size=="byMenu")var a=
this.getMenu().getBorderBoxWidth()-18;else this.size=="byValue"?(this.currentValueNode.style.width="",a=b._getMarginSize(this.currentValueNode).w+18):a=parseInt(this.size);b.contentBox(this.currentValueNode,{w:a});b.isIE&&setTimeout(b.hitch(this,"fixButtons"),10)},setOptionalLabelPrefixHTML:function(a){this.optionalLabelPrefix=a},setOption:function(a,e){if(!this.staticMenuHeader&&this.currentValue!=this.options[a].value)this.currentValueNode.innerHTML=this.optionalLabelPrefix!=null?this.optionalLabelPrefix+
this.options[a].display:this.options[a].display;if(this.staticMenuHeader!=null)this.currentValueNode.innerHTML=this.staticMenuHeader;this.currentValueNode.style.display=this.currentValueNode.innerHTML==""?"none":"";this.currentValue=this.options[a].value;this.currentIndex=a;this.sizeMyself();e&&this.valueChanged()},setOptionByValue:function(a){for(var e=0;e<this.options.length;e++)if(this.options[e].value==a)return this.setOption(e),!0;return!1},setClass:function(a){this.domNode.className="wsSelect "+
a},fixButtons:function(){if(this.domNode!=null)this.domNode.style.position="static",this.domNode.style.position="relative"},_onMouseDown:function(a){this.disabled||(this.disableMouseStates||b.addClass(this.domNode,"wsSelectClick"),this.onMouseDown(a))},_onMouseUp:function(a){this.disabled||(this.disableMouseStates||b.removeClass(this.domNode,"wsSelectClick"),this.onMouseUp(a))},_onMouseOut:function(a){this.disabled||(this.disableMouseStates||b.removeClass(this.domNode,"wsSelectClick"),this.onMouseOut(a))},
onMouseOver:function(){},onMouseDown:function(){},onMouseUp:function(){},onMouseOut:function(){},valueChanged:function(){}}));if(!b._hasResource["ws.panels.TaskPanel"])b._hasResource["ws.panels.TaskPanel"]=!0,b.provide("ws.panels.TaskPanel"),b.declare("ws.panels.TaskGridModel",l.grid.data.Dynamic,{task:{taskCount:0,taskCalId:[],taskUId:[],taskName:[],taskCompleted:[],taskDueDate:[],taskStatus:[],taskReminderEnabled:[]},taskList:null,compEnum:null,columns:{Completed:0,TaskName:1,Hover:2},modelUpdated:function(){},
constructor:function(a,e,b){this.model=b},getDatum:function(a,e){var b=this.getTaskData(a);if(b==null)return Config.Strings.TaskError;var g="",h="",j="";b.taskDueDate&&(g=ws.date.formatDateTime(new Date(b.taskDueDate),Config.Strings.Panel_EventPanel_DateFormat),h=b.taskCompleted?'<span style="color: #D8D6D3;font-size:11px;">'+g+"</span>":'<span style="color: #76B144;font-size:11px;">'+g+"</span>");b.taskReminderEnabled&&Config.ShowReminderTask&&!b.taskCompleted&&(j='<img src="'+Config.SpacerImageURL+
'" class="mainSprite reminderSmIcon">');g=ws.string.escapeXml(b.taskName||"");if(h||j)g+="<br />";g+=h;g+="&nbsp;"+j;switch(e){case this.columns.Completed:return b.taskCompleted?"ON":"OFF";case this.columns.TaskName:return this.getHoverColumnCB?this.getHoverColumnCB(a,g):"";default:return"Invalid Column"}},getRow:function(a){a=this.getTaskData(a);if(a==null)return["",""];var e=a.taskCompleted?"ON":"OFF",b=a.taskName;if(a.taskDueDate)var g=null,g=ws.date.formatDateTime(new Date(a.taskDueDate),Config.Strings.Panel_EventPanel_DateFormat),
g=a.taskCompleted?'<span style="color: #D8D6D3; font-size:11px;">'+g+"</span>":'<span style="color: #76B144; font-size:11px;">'+g+"</span>",b=b+"&nbsp&nbsp"+g;a.taskReminderEnabled&&Config.ShowReminderTask&&!a.taskCompleted&&(b='NaN<div class="taskpanel reminderSmIcon"></div>');return[e,b]},getTaskData:function(a){return{taskName:this.task.taskName[a],taskCompleted:this.task.taskCompleted[a],taskDueDate:this.task.taskDueDate[a],taskReminderEnabled:this.task.taskReminderEnabled[a]}},getRowCount:function(){return this.task==
null?0:this.task.taskCount}}),b.declare("ws.panels.TaskPanel",ws.widget.ListView,{templateString:b.cache("ws.panels","TaskPanel.html",'<div style="width:220px">\r\n    <div class="listView taskPanel" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget" style="background-color:#fff; width:200px; height: 100%;">\r\n        <div layoutAlign="top" dojoType="ws.widget.Pane" dojoAttachPoint="taskFormPane">\r\n\t\t\t<div class="todoPanelLabelDiv" dojoAttachPoint="todoPanelLabelDiv">\r\n\t\t\t\t<span class="todoPanelLabel">${Panel_TodoLabel}</span>\r\n\t\t\t\t<div class="mainSprite wsSmallCloseBtn" dojoAttachEvent="onclick:close"></div>\r\n\t\t\t</div>\r\n            <div class="addTaskCntr">\r\n\t\t\t\t<div class="wsInput addTaskInput">\r\n\t\t\t\t\t<input type="text" dojoAttachPoint="addTaskInputNode" maxlength="100" dojoAttachEvent="onfocus: onFocus, onblur: onBlur, onkeypress: onAddTaskKeyPress" class="default wsInputBare"/>\r\n\t\t\t\t\t<div title="${EnterTask}" class="wsSmallAddButton" dojoAttachPoint="addTaskImage" dojoAttachEvent="onclick:onClickAddFromInput"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="moreDetailLink wsLink" dojoAttachEvent="onclick: openMoreDetails" dojoAttachPoint="moreDetailLink">${MoreDetails}</div>\r\n\t\t\t\t\r\n\t\t\t\t<div class="moreDetailsCntr" dojoAttachPoint="moreDetailsCntr" style="display:none">\r\n\t\t\t\t\t<div class="dueDateDiv">\r\n\t\t\t\t\t\t<label>${DueDate}</label>\r\n\t\t\t\t\t\t<div class="wsInput datePickerInput" dojoAttachPoint="dueDateInputCntr">\r\n\t\t\t\t\t\t\t<input type="text" value="${Optional}" dojoAttachPoint="dueDateInput" readonly class="wsInputBare dueDateInput default" dojoAttachEvent="onblur: reminderOnBlur, onfocus: reminderOnFocus, onchange: onChange"/>\r\n\t\t\t\t\t\t\t<div class="mainSprite iconCalendar"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div> \r\n\t\t\t\t\t<div dojoAttachPoint="reminderMenuRow">\r\n\t\t\t\t\t\t<ul dojoType="ws.widget.WSSelect" dojoAttachPoint="reminderMenu">\r\n\t\t\t\t\t\t\t<li value="noReminder">${NoReminder}</li>\r\n\t\t\t\t\t\t\t<li value="remindAt" selected="true">${RemindMeAt2}</li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div dojoAttachPoint="reminderDetailsRow" class="reminderDetailsDiv">\r\n\t\t\t\t\t\t<div style="padding-bottom:5px">\r\n\t\t\t\t\t\t\t<label>${Time}</label>\r\n\t\t\t\t\t\t\t<input type="text" class="wsInput reminderTimeSelectDefault" dojoAttachPoint="reminderTimeSelect" />\t\r\n\t\t\t\t\t\t</div>\t\t\t\t\t\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<ul dojoType="ws.widget.WSSelect" dojoAttachPoint="dueDateSelect">\r\n\t\t\t\t\t\t\t\t<li value="Default">${OnDueDate}</li>\r\n\t\t\t\t\t\t\t\t<li value="OneDayBefore">${OneDayBefore}</li>\r\n\t\t\t\t\t\t\t\t<li value="TwoDaysBefore">${TwoDaysBefore}</li>\r\n\t\t\t\t\t\t\t\t<li value="OneWeekBefore">${OneWeekBefore}</li>\r\n\t\t\t\t\t\t\t\t<li value="OnThisDate">${OnThisDate}</li>\r\n\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t<div class="wsInput datePickerInput remindDateInput" dojoAttachPoint="remindAtEndInputCntr" style="display:none">\r\n\t\t\t\t\t\t\t\t<input type="text" value="" readonly dojoAttachPoint="remindAtEndInput" class="wsInputBare" />\r\n\t\t\t\t\t\t\t\t<div class="mainSprite iconCalendar"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div dojoAttachPoint="addNoteInputRow" class="addNoteInputDiv">\r\n\t\t\t\t\t\t<label>${Panel_TodoPanel_Note}</label>\r\n\t\t\t\t\t\t<textarea dojoAttachEvent="onclick:changeDefaultTextForNote" dojoAttachPoint="addNoteInput" class="addNoteInputDefault" wrap="virtual"></textarea>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div dojoType="ws.widget.PopupDatePicker" dojoAttachPoint="dueDatePopupPicker" width="235" hidePickerOnSetDate="true" closeOnMouseOut="true"></div>\r\n\t\t\t\t\t<div dojoType="ws.widget.PopupTimePicker" dojoAttachPoint="eventTimePopupPicker" closeOnMouseOut="true"></div>\r\n\t\t\r\n\t\t\t\t\t<div dojoAttachPoint="toolbar" dojoType="ws.widget.WSToolbar" vizType="Bare" style="width:202px">\r\n\t\t\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachPoint="updateBtn" dojoAttachEvent="onClick:updateTask" toolbarPosition="right">${AddItem}</div>\r\n\t\t\t\t\t\t<div dojotype="ws.widget.Button" type="Bare" dojoAttachEvent="onClick:onCancel" toolbarPosition="right">${Cancel}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n        </div>\r\n        <div dojoType="ws.widget.Pane" layoutAlign="client" dojoAttachPoint="tasksGridPane" style="height:100%">\r\n\t\t\t<div dojoAttachPoint="grid" dojoType="dojox.Grid" style="height:100%"></div>\r\n        </div>\r\n\t\t<div layoutAlign="bottom" dojoType="ws.widget.Pane" class="clearCompleted" dojoAttachPoint="clearCompletedPane" style="display:none">\r\n\t\t\t<span class="wsLink" dojoAttachEvent="onclick: onClearCompleted">${ClearCompleted}</span>\r\n\t\t</div>\r\n    </div>\r\n</div>\r\n'),
css:{templateString:""},wrapperModelClass:ws.panels.TaskGridModel,addTaskInputNodeDefaultValue:Config.Strings.EnterTask,dueDateInputDefaultValue:Config.Strings.Optional,fixedRowHeight:!1,taskListInitializedFlag:!1,addTaskFlag:!1,deleteTaskFlag:!1,updateTaskFlag:!1,deletedTaskUId:null,deleteTaskHoverFlag:!1,hoverColumnHtml:'<div class="taskCloseBtnCntr"><div class="mainSprite wsSmallCloseBtn"></div></div>',isAnonymous:!1,autosizeColumnId:"TaskName",dateHasBeenChosen:!1,timeFormat:Config.Strings.CalTimeFormatRange1,
timeFormatShort:Config.Strings.CalTimeFormatRange2,noteFlag:!1,currentTaskUID:null,hasCompleted:!1,defaultHeight:227,doHideTodoList:!1,numHoursShowCompleted:24,_sortBy:"DueTime",_sortDir:"Decending",startup:function(a){a={modelType:"todo"};a=new ws.calendar.CalendarViewModel(a);a.isAnonymous=this.isAnonymous;this.setModel(a);this.addTaskInputNode.value=this.addTaskInputNodeDefaultValue;ws.WebSuite.taskPanel=this;this.doHideTodoList&&(this.tasksGridPane.hide(),this.clearCompletedPane.hide());this.layoutWidget.domNode.style.height=
this.defaultHeight+"px";this.subscribe("wsresize","adjustPosition");this.startupMoreDetails()},open:function(a,e,b,g,h){this.around=a;this.orient=e;this.padding=b;this.pointerSide=g;this.nudge=h;ws.widget.popup({popup:this,around:a,orient:e,padding:b});ws.widget.pointer({node:this.domNode,side:g,target:a,nudge:h});this.clearTaskInput();this.resize()},close:function(){ws.widget.popup.close(this)},onCancel:function(){if(this.onCancelCB)this.onCancelCB();this.clearTaskInput()},initView:function(){this.columns=
[{id:"Completed",width:"15px",canResize:!1,sortable:!1,formatter:b.hitch(this,"formatSprite",this.baseSprites.chkBox)},{id:"TaskName",width:"90px",canResize:!1,sortable:!1}];this.inherited(arguments);this.gridModel.grid=this.grid;this.initializeTaskList();b.connect(this.model,"modelUpdated",this,"modelUpdated");b.connect(this.model,"requestUpdate",b.hitch(this,function(){var a=this.model.getDefaultTaskArgs();a.sortBy=this._sortBy;a.sortDir=this._sortDir;this.model.getData(a)}));b.connect(this.grid,
"onRowContextMenu",this,"onContextMenu");if(Settings.ToDo_LastClearedCompleted_Timestamp)this.lastClearedTime=(new Date(parseFloat(Settings.ToDo_LastClearedCompleted_Timestamp))).getTime()},onResized:function(){this.inherited(arguments)},getAddTaskArgs:function(a){var e=this.model.getDefaultTaskArgs();e.sortBy=this._sortBy;e.sortDir=this._sortDir;e.start=ws.date.formatISO8601(new Date);e.summary=a;return e},getDeleteTaskArgs:function(a){var e=this.model.getDefaultTaskArgs();e.sortBy=this._sortBy;
e.sortDir=this._sortDir;e.calid=this.gridModel.task.taskCalId[a];e.id=this.gridModel.task.taskUId[a];return e},getZeroRowsMessage:function(){return Config.Strings.Panel_TodoPanel_EmptyList},initializeTaskList:function(){this.gridModel.taskList=[];var a=this.model.getDefaultTaskArgs();a.sortBy=this._sortBy;a.sortDir=this._sortDir;this.gridModel.model.getData(a)},autosizeColumns:function(){this.inherited(arguments);b.toggleClass(this.grid.domNode,"noscroll",this.grid.views.views[0].noscroll)},modelUpdated:function(){this.taskListInitializedFlag?
this.addTaskFlag?(this.cleanLists(),this.buildTaskList(),this.addTaskFlag=!1):this.deleteTaskFlag?(this.cleanLists(),this.buildTaskList(),this.deleteTaskFlag=!1):this.updateTaskFlag?(this.cleanLists(),this.buildTaskList(),this.updateTaskFlag=!1):(this.cleanLists(),this.buildTaskList()):(this.buildTaskList(),this.taskListInitializedFlag=!0)},cleanLists:function(){this.gridModel.task.taskCalId=[];this.gridModel.task.taskUId=[];this.gridModel.task.taskName=[];this.gridModel.task.taskDueDate=[];this.gridModel.task.taskCompleted=
[];this.gridModel.task.taskStatus=[];this.gridModel.task.taskReminderEnabled=[];this.gridModel.task.taskCount=0},onClearCompleted:function(){ws.widget.OkCancelDialog.alert(Config.Strings.ClearCompletedDialog,b.hitch(this,function(a){if(a)this.lastClearedTime=(new Date).getTime(),ws.settings.saveNow({ToDo_LastClearedCompleted_Timestamp:this.lastClearedTime.toString()}),this.cleanLists(),this.buildTaskList(!0)}),!0)},buildTaskList:function(a){var e=this.gridModel.model.index,b=this.gridModel.model.components,
g=this.gridModel.model.componentEnum;this.gridModel.compEnum=g;for(var h=null,h=null,j=!1,k=new Date,j=null,l=!1,o=0;o<e.length;o++){h=e[o];componentName=h[0];h=b[componentName];j=!1;h[g.completed]==null?j=!0:a||(j=ws.date.add(h[g.completed],ws.date.dateParts.HOUR,this.numHoursShowCompleted),j=this.lastClearedTime?j>=k&&h[g.completed].getTime()>this.lastClearedTime:j>=k);j&&!l&&(l=!!h[g.completed]);var n=h[g.summary];h[g.summary].length>48&&(n=ws.string.summary(h[g.summary],47));j&&(this.gridModel.task.taskCalId.push(h[g.calid]),
this.gridModel.task.taskUId.push(h[g.id]),this.gridModel.task.taskName.push(n),this.gridModel.task.taskDueDate.push(h[g.end]),this.gridModel.task.taskCompleted.push(h[g.completed]),this.gridModel.task.taskStatus.push(h[g.status]),this.gridModel.task.taskReminderEnabled.push(h[g.reminderEnabled]),this.gridModel.task.taskCount+=1)}this.orderTaskList();this.gridModel.modelUpdated();this.hasCompleted=l;this.moreDetailsCntr.style.display=="none"&&this.tasksGridPane.isShowing()&&this.clearCompletedPane.setShowing(l);
this.adjustHeight();this.layoutWidget.layout()},onFocus:function(){if(b.hasClass(this.addTaskInputNode,"default"))this.addTaskInputNode.value="",b.removeClass(this.addTaskInputNode,"default"),b.removeClass(this.addTaskImage,"wsSmallAddDisabled"),b.addClass(this.addTaskImage,"wsSmallAddButton"),this.addTaskInputNode.focus()},onBlur:function(){if(b.trim(this.addTaskInputNode.value)=="")this.addTaskInputNode.value=this.addTaskInputNodeDefaultValue,b.addClass(this.addTaskInputNode,"default"),b.removeClass(this.addTaskImage,
"wsSmallAddButton"),b.addClass(this.addTaskImage,"wsSmallAddDisabled")},clearTaskInput:function(){b.addClass(this.addTaskInputNode,"default");this.addTaskInputNode.value=this.addTaskInputNodeDefaultValue;b.removeClass(this.addTaskImage,"wsSmallAddButton");b.addClass(this.addTaskImage,"wsSmallAddDisabled");this.addTaskInputNode.blur();this.currentTaskUID=null;this.closeMoreDetails()},onAddTaskKeyPress:function(a){a.keyCode==b.keys.ENTER?this.updateTask():a.keyCode==b.keys.ESCAPE&&clearTaskInput()},
handleHoverControlClick:function(a){if(!this.deleteTaskHoverFlag&&(this.deleteTaskHoverFlag=!0,b.hasClass(a.target,"wsSmallCloseBtn")&&this.deleteTaskHoverFlag))this.deleteTaskHoverFlag=!1,this.deleteTask(a.rowIndex)},handleCellClick:function(a){if(b.hasClass(a.target,"wsSmallCloseBtn"))return this.handleHoverControlClick(a);switch(a.cellIndex){case this.gridModel.columns.TaskName:this.editTask(a.rowIndex);break;case this.gridModel.columns.Completed:this.gridModel.task.taskCompleted[a.rowIndex]?this.markIncomplete(a.rowIndex):
this.markComplete(a.rowIndex)}this.gridModel.modelUpdated()},editTask:function(a){this.updateBtn.setLabel(Config.Strings.UpdateItem);this.dateHasBeenChosen=!1;this.populateFields(this.gridModel.task.taskUId[a])},markIncomplete:function(a){var e=this.gridModel.model.components,f=this.gridModel.model.componentEnum;this.gridModel.task.taskCompleted[a]=null;this.gridModel.task.taskStatus[a]=5;taskComponent=e[this.gridModel.task.taskUId[a]];e=this.gridModel.model.getComponentArgsForTask(taskComponent);
e.sortBy=this._sortBy;e.sortDir=this._sortDir;e.completed=null;e.status="In_Progress";e.percentComplete=0;if(this.gridModel.task.taskDueDate[a])e.end=ws.date.formatISO8601(taskComponent[f.end]);if(this.gridModel.task.taskReminderEnabled[a])e.reminderEnabled=!0,e.reminderLeadTime=taskComponent[f.reminderLeadTime],e.reminderDeliveryOptions=taskComponent[f.reminderDeliveryOptions];e.loadCallback=b.hitch(this,function(){b.publish("WSFeedbackStart",[Config.Strings.ToDoMarkedIncomplete,!0])});this.gridModel.model.saveComponent(e);
this.addUncheckedEventToList(a)},markComplete:function(a){var e=this.gridModel.model.componentEnum;taskComponent=this.gridModel.model.components[this.gridModel.task.taskUId[a]];var f=ws.date.formatISO8601(new Date);this.gridModel.task.taskCompleted[a]=f;this.gridModel.task.taskStatus[a]=2;var g=this.gridModel.model.getComponentArgsForTask(taskComponent);g.completed=f;g.status="Completed";g.percentComplete=100;g.sortBy=this._sortBy;g.sortDir=this._sortDir;if(this.gridModel.task.taskDueDate[a])g.end=
ws.date.formatISO8601(taskComponent[e.end]);if(this.gridModel.task.taskReminderEnabled[a])g.reminderEnabled=!0,g.reminderLeadTime=taskComponent[e.reminderLeadTime],g.reminderDeliveryOptions=taskComponent[e.reminderDeliveryOptions];g.loadCallback=b.hitch(this,function(){b.publish("WSFeedbackStart",[Config.Strings.ToDoMarkedCompleted,!0])});this.gridModel.model.saveComponent(g);this.moveTaskToEndOfList(a)},getRowClasses:function(a){var e=ws.panels.TaskPanel.superclass.getRowClasses.apply(this,arguments);
e.push("default");this.gridModel.task.taskCompleted[a]&&e.push("completedTask");return e},deleteTask:function(a){this.editDetailCard&&this.editDetailCard.closeCard();this.deleteTaskFlag=!0;a=this.getDeleteTaskArgs(a);a.loadCallback=b.hitch(this,function(){b.publish("WSFeedbackStart",[Config.Strings.ToDoDeleted,!0])});this.gridModel.model.deleteEvents(a)},addUncheckedEventToList:function(a){if(a!=0){var e=this.gridModel.task.taskCalId[a],b=this.gridModel.task.taskUId[a],g=this.gridModel.task.taskName[a],
h=this.gridModel.task.taskDueDate[a],j=this.gridModel.task.taskCompleted[a],k=this.gridModel.task.taskStatus[a],l=this.gridModel.task.taskReminderEnabled[a];if(h){this.gridModel.task.taskCalId.splice(a,1);this.gridModel.task.taskUId.splice(a,1);this.gridModel.task.taskName.splice(a,1);this.gridModel.task.taskDueDate.splice(a,1);this.gridModel.task.taskCompleted.splice(a,1);this.gridModel.task.taskStatus.splice(a,1);this.gridModel.task.taskReminderEnabled.splice(a,1);for(a=a=0;a<this.gridModel.task.taskCount;a++){if(h<=
this.gridModel.task.taskDueDate[a])break;if(!this.gridModel.task.taskDueDate[a])break}this.gridModel.task.taskCalId.splice(a,0,e);this.gridModel.task.taskUId.splice(a,0,b);this.gridModel.task.taskName.splice(a,0,g);this.gridModel.task.taskDueDate.splice(a,0,h);this.gridModel.task.taskCompleted.splice(a,0,j);this.gridModel.task.taskStatus.splice(a,0,k);this.gridModel.task.taskReminderEnabled.splice(a,0,l)}}},moveTaskToEndOfList:function(a){for(var e=[],b=[],g=[],h=[],j=[],k=[],l=[],o=this.gridModel.task.taskCalId[a],
n=this.gridModel.task.taskUId[a],p=this.gridModel.task.taskName[a],x=this.gridModel.task.taskDueDate[a],q=this.gridModel.task.taskCompleted[a],w=this.gridModel.task.taskStatus[a],s=this.gridModel.task.taskReminderEnabled[a],u=0;u<this.gridModel.task.taskCount;u++)a!=u&&(e.push(this.gridModel.task.taskCalId[u]),b.push(this.gridModel.task.taskUId[u]),g.push(this.gridModel.task.taskName[u]),h.push(this.gridModel.task.taskDueDate[u]),j.push(this.gridModel.task.taskCompleted[u]),k.push(this.gridModel.task.taskStatus[u]),
l.push(this.gridModel.task.taskReminderEnabled[u]));e.push(o);b.push(n);g.push(p);h.push(x);j.push(q);k.push(w);l.push(s);this.gridModel.task.taskCalId=e;this.gridModel.task.taskUId=b;this.gridModel.task.taskName=g;this.gridModel.task.taskDueDate=h;this.gridModel.task.taskCompleted=j;this.gridModel.task.taskStatus=k;this.gridModel.task.taskReminderEnabled=l},orderTaskList:function(){for(var a=[],e=[],b=[],g=[],h=[],j=[],k=[],l=[],o=[],n=[],p=[],x=[],q=[],w=[],s=this.gridModel.task,u=0;u<s.taskCount;u++)s.taskCompleted[u]?
(l.push(s.taskCalId[u]),o.push(s.taskUId[u]),n.push(s.taskName[u]),p.push(s.taskDueDate[u]),x.push(s.taskCompleted[u]),q.push(s.taskStatus[u]),w.push(s.taskReminderEnabled[u])):(a.push(s.taskCalId[u]),e.push(s.taskUId[u]),b.push(s.taskName[u]),g.push(s.taskDueDate[u]),h.push(s.taskCompleted[u]),j.push(s.taskStatus[u]),k.push(s.taskReminderEnabled[u]));s.taskCalId=a.concat(l.reverse());s.taskUId=e.concat(o.reverse());s.taskName=b.concat(n.reverse());s.taskDueDate=g.concat(p.reverse());s.taskCompleted=
h.concat(x.reverse());s.taskStatus=j.concat(q.reverse());s.taskReminderEnabled=k.concat(w.reverse())},openMoreDetails:function(){this.moreDetailLink.style.display="none";this.moreDetailsCntr.style.display="";this.tasksGridPane.hide();this.clearCompletedPane.setShowing(!1);this.reminderMenu.sizeMyself();this.dueDateSelect.sizeMyself();this.toolbar.layout();this.adjustHeight()},closeMoreDetails:function(){this.moreDetailLink.style.display="";this.moreDetailsCntr.style.display="none";this.tasksGridPane.show();
this.clearCompletedPane.setShowing(this.hasCompleted);this.dueDateInput.value=this.dueDateInputDefaultValue;b.addClass(this.dueDateInput,"default");this.reminderMenu.setOption(1);this.dueDateSelect.setOption(0);this.remindAtEndInputCntr.style.display="none";this.reminderTimeSelect.value="";this.remindAtEndInput.value="";this.addNoteInput.value="";this.updateBtn.setLabel(Config.Strings.AddItem);this.reminderDetailsRow.style.display="";this.layoutWidget.domNode.style.height=this.defaultHeight+"px";
this.adjustHeight();this.layoutWidget.layout()},openPopUpNew:function(a,e,f,g,h,j,k){this.open(f,g,h,j,k);this.tasksGridPane.setShowing(!1);this.clearCompletedPane.setShowing(!1);this.dueDateDefaultValue=Config.Strings.Optional;this.dueDateInput.value=this.dueDateDefaultValue;a&&a!=""?(b.removeClass(this.addTaskInputNode,"default"),this.addTaskInputNode.value=a,b.removeClass(this.addTaskImage,"wsSmallAddDisabled"),b.addClass(this.addTaskImage,"wsSmallAddButton")):this.addTaskInputNode.value=this.addTaskInputNodeDefaultValue;
this.adjustHeight()},onContextMenu:function(a){var e=this.getRightClickMenu();e.isShowingNow&&e.close();this.rightClickMenu.rowIndex=a.rowIndex;var b=this.gridModel.task.taskCompleted[a.rowIndex],g=this.rightClickMenu.getChildren();g[3].setEnabled(!b);g[4].setEnabled(b);e.open(a.pageX,a.pageY,null,[]);a.preventDefault();a.stopPropagation()},getRightClickMenu:function(){if(!this.rightClickMenu){var a=[{caption:Config.Strings.Edit,onClick:b.hitch(this,"editTaskFromMenu")},{caption:Config.Strings.Delete,
onClick:b.hitch(this,"deleteTaskFromMenu")},{separator:!0},{caption:Config.Strings.MarkToDoComplete,onClick:b.hitch(this,"markCompleteFromMenu")},{caption:Config.Strings.MarkToDoIncomplete,onClick:b.hitch(this,"markIncompleteFromMenu")},{separator:!0},{caption:Config.Strings.NewToDo,onClick:b.hitch(this,"openMoreDetails")}];this.rightClickMenu=ws.widget.createMenu(a)}return this.rightClickMenu},deleteTaskFromMenu:function(){this.deleteTask(this.rightClickMenu.rowIndex)},editTaskFromMenu:function(){this.editTask(this.rightClickMenu.rowIndex)},
markCompleteFromMenu:function(){this.markComplete(this.rightClickMenu.rowIndex)},markIncompleteFromMenu:function(){this.markIncomplete(this.rightClickMenu.rowIndex)},startupMoreDetails:function(){this.connect(this.dueDateInputCntr,"onclick",b.hitch(this,"showDueDatePopupPicker",this.dueDateInput));this.connect(this.dueDateInput,"onfocus",b.hitch(this,"showDueDatePopupPicker",this.dueDateInput));this.connect(this.dueDateInput,"onblur",b.hitch(this,"resetDueDatePicker",this.dueDateInput));this.connect(this.remindAtEndInputCntr,
"onclick",b.hitch(this,"showDueDatePopupPicker",this.remindAtEndInput));this.connect(this.reminderTimeSelect,"onclick",b.hitch(this,"showTimePicker",this.reminderTimeSelect));this.connect(this.dueDatePopupPicker.datePicker,"selectDateConnect","fillInDateField");this.connect(this.eventTimePopupPicker.timePicker,"selectTimeConnect","fillInTimeField");this.connect(this.reminderMenu,"valueChanged","handleReminder");this.connect(this.dueDateSelect,"valueChanged","dueDateSelected")},populateFields:function(a){this.currentTaskUID=
a;var e=this.model.componentEnum,f=null,f=this.model.components[a];this.addTaskInputNode.value=f[e.summary];b.removeClass(this.addTaskInputNode,"default");b.removeClass(this.addTaskImage,"wsSmallAddDisabled");b.addClass(this.addTaskImage,"wsSmallAddButton");if(f[e.end]){var g=ws.date.formatDateTime(f[e.end],Config.Strings.DateYear);ws.date.formatDateTime(f[e.end],this.timeFormat);b.removeClass(this.dueDateInput,"default");this.dueDateInput.value=g}else this.dueDateInput.value="";if(f[e.reminderEnabled]&&
g!=""){if(this.enableReminderRow(),a=ws.panels.TaskPanelUtil.GetReminderEndDate(f[e.reminderLeadTime],f[e.end],Config.Strings.DateYear,this.timeFormat),this.reminderTimeSelect.value=a.time,this.dueDateSelect.setOption(ws.panels.TaskPanelUtil.GetLeadTimeMenuOption(f[e.reminderLeadTime]),!0),this.dueDateSelect.currentValue=="OnThisDate")this.remindAtEndInput.value=a.date}else{b.addClass(this.reminderTimeSelect,"reminderTimeSelectDefault");if(this.dueDateInput.value=="")this.dueDateInput.value=this.dueDateInputDefaultValue,
b.addClass(this.dueDateInput,"default");this.disableReminderRow()}if(f[e.description]!="")this.addNoteInput.value=f[e.description];this.openMoreDetails()},enableReminderRow:function(a){var e=b.trim(this.dueDateInput.value);if(e!=""&&e!=this.dueDateDefaultValue||a)if(this.dueDateSelect.setClass("dueDateSelect"),this.dateHasBeenChosen=!0,!this.reminderTimeSelect.value)a=new Date,a=ws.calendar.calutil.GetNext30MinuteIncrement(a),this.reminderTimeSelect.value=ws.date.formatDateTime(a,this.timeFormat);
this.dueDateSelect.setClass("dueDateSelect");this.reminderMenu.setOption(1,!0)},disableReminderRow:function(){this.reminderMenu.setOption(0,!0)},reminderOnBlur:function(){if(this.dueDateInput.value==""&&!this.dueDatePopupPicker.isShowingNow)b.addClass(this.dueDateInput,"default"),this.dueDateInput.value=this.dueDateInputDefaultValue,this.dateHasBeenChosen=!1},reminderOnFocus:function(){if(b.hasClass(this.dueDateInput,"default"))b.removeClass(this.dueDateInput,"default"),this.dueDateInput.value=""},
onChange:function(){this.dueDateInput.value==""&&!this.dueDatePopupPicker.isShowingNow?(b.addClass(this.dueDateInput,"default"),this.dueDateInput.value=this.dueDateInputDefaultValue,this.dateHasBeenChosen=!1):this.dateHasBeenChosen=!0},onClickAddFromInput:function(){b.hasClass(this.addTaskImage,"wsSmallAddButton")&&this.updateTask()},updateTask:function(a){a&&a.stopPropagation();var e=this.model.components,a=this.model.componentEnum,f=null,g=!1,h="",j=this.addTaskInputNode.value,j=b.trim(j),k=Config.Strings.DateYear;
if(j!=""&&this.isUpdateTaskEnabled()){var l=null,o=null,n=null;this.currentTaskUID!=null?(this.addTaskFlag=!1,this.updateTaskFlag=!0,f=e[this.currentTaskUID],o=f[a.start],l=this.model.getComponentArgsForTask(f),l.sortBy=this._sortBy,l.sortDir=this._sortDir,l.summary=j,n=Config.Strings.ToDoUpdated):(this.addTaskFlag=!0,this.updateTaskFlag=!1,o=new Date,l=this.getAddTaskArgs(),l.summary=j,l.start=ws.date.formatISO8601(o),n=Config.Strings.ToDoCreated);var p=b.trim(this.dueDateInput.value);if(p!=""&&
!b.hasClass(this.dueDateInput,"default")){var x=e=null;if(this.reminderTimeSelect.value!="")j=ws.date.ParseHourMinTextField(this.reminderTimeSelect.value,this.timeFormat,this.timeFormatShort),e=j.hr,x=j.min;var q=ws.panels.TaskPanelUtil.GetLeadTimeInMinutesHelper(this.dueDateSelect.currentValue),j=!0;if(q!=0){var w=ws.date.ParseDateFromFormat(p,k),q=ws.date.add(w,ws.date.dateParts.MINUTE,-q),q=ws.date.formatDateTime(q,k);ws.panels.TaskPanelUtil.ValidateDate(q,e,x,k,this.model.currentServerTime).isDateInPast&&
(j=!1)}p=ws.panels.TaskPanelUtil.ValidateDate(p,e,x,k,this.model.currentServerTime);if(p.isValidDate)if(k=p.oDate,e!=null)if(!p.isDateInPast&&j){l.end=ws.date.formatISO8601(k);l.start=l.end;l.reminderEnabled=!0;_argsLeadTime=null;this.dueDateSelect.currentValue=="OnThisDate"&&(_argsLeadTime={time:this.reminderTimeSelect.value,taskDate:k,remDate:this.remindAtEndInput.value,timeFmt:this.timeFormat,shortTimeFmt:this.timeFormatShort});g=ws.panels.TaskPanelUtil.GetLeadTimeInMinutes(this.dueDateSelect.currentValue,
_argsLeadTime?_argsLeadTime:null);typeof g=="string"?h=g:l.reminderLeadTime=g;if(k<o)l.start=l.end;g=!0}else this.taskPanel&&!this.taskPanel.addTaskFlag?(g=!1,h=Config.Strings.InvalidReminderDateInPastOnCreate):(l.end=ws.date.formatISO8601(k),l.start=l.end,g=!0,h=null,l.reminderEnabled=!1,l.reminderLeadTime=0);else{if(g=!0,l.reminderEnabled=!1,l.reminderLeadTime=0,l.end=ws.date.formatISO8601(k),k<o)l.start=l.end}else ws.widget.OkCancelDialog.alert(Config.Strings.InvalidDateOnCreate)}else{g=!1;l.description=
this.addNoteInput.value;l.end=null;l.reminderEnabled=!1;l.reminderLeadTime=0;if(f!=null)l.status=ws.panels.TaskPanelUtil.GetTodoStatus(f[a.status]);l.start=ws.date.formatISO8601(new Date);l.loadCallback=b.hitch(this,function(){b.publish("WSFeedbackStart",[n,!0]);if(this.onSavedCB)this.onSavedCB()});if(!h||h.length==0){if(this.onBeforeSaveCB)this.onBeforeSaveCB();this.model.saveComponent(l);this.clearTaskInput()}}if(g){l.description=this.addNoteInput.value;if(f!=null)l.status=ws.panels.TaskPanelUtil.GetTodoStatus(f[a.status]);
if(l.end!=null&&l.end.length==0)l.start=ws.date.formatISO8601(new Date);l.start=l.end;l.loadCallback=b.hitch(this,function(){b.publish("WSFeedbackStart",[n,!0]);if(this.onSavedCB)this.onSavedCB()});if(!h||h.length==0){if(this.onBeforeSaveCB)this.onBeforeSaveCB();this.model.saveComponent(l);this.clearTaskInput()}}h&&h.length>0&&ws.widget.OkCancelDialog.alert(h)}},showDueDatePopupPicker:function(a){b.isIE&&this.reminderOnFocus();this.dueDatePopupPicker.isShowingNow||(ws.widget.popup({popup:this.dueDatePopupPicker,
around:a,orient:{BL:"TL"}}),b.marginBox(this.dueDatePopupPicker.domNode,{w:this.dueDatePopupPicker.width}));this.dateInputField=a;if(this.dueDateInput.value==this.dueDateInputDefaultValue)this.dueDateInput.value=""},resetDueDatePicker:function(){setTimeout(b.hitch(this,function(){if(this.dueDateInput.value=="")this.dueDateInput.value=this.dueDateInputDefaultValue,b.addClass(this.dueDateInput,"default")}),200)},handleReminder:function(){switch(this.reminderMenu.currentValue){case "noReminder":this.reminderDetailsRow.style.display=
"none";this.reminderTimeSelect.value="";break;case "remindAt":this.dueDateSelect.setOption(0,!0),this.reminderDetailsRow.style.display="",this.dueDateSelect.sizeMyself()}this.adjustHeight()},fillNotes:function(a){if(a)this.addNoteInput.value=a},changeDefaultTextForNote:function(){},dueDateSelected:function(){this.remindAtEndInputCntr.style.display=this.dueDateSelect.currentValue=="OnThisDate"?"":"none";this.adjustHeight()},adjustHeight:function(){var a=this.defaultHeight;this.moreDetailsCntr.style.display==
""||this.doHideTodoList?a=b.marginBox(this.taskFormPane.domNode).h:this.gridModel.task.taskCount>0&&(a+=124);b.isIE==7&&(a-=10);this.layoutWidget.domNode.style.height=a+"px";this.layoutWidget.resize();this.adjustPosition()},adjustPosition:function(){if(this.popupNode){k.placeOnScreenAroundElement(this.popupNode,this.around,this.orient,null);var a=b.position(this.popupNode);if(this.padding)this.popupNode.style.left=a.x+this.padding[0]+"px",this.popupNode.style.top=a.y+this.padding[1]+"px";ws.widget.pointer({node:this.domNode,
side:this.pointerSide,target:this.around,nudge:this.nudge});this.popupNode.style.zIndex="997"}},showTimePicker:function(a){if(!this.eventTimePopupPicker.isShowingNow){ws.widget.popup({popup:this.eventTimePopupPicker,around:a,orient:{BL:"TL"}});var e=new Date,a=ws.date.ParseHourMinTextField(a.value,this.timeFormat,this.timeFormatShort);a!=null?(e.setHours(a.hr,a.min),this.eventTimePopupPicker.initializeTime(e)):this.eventTimePopupPicker.initializeTime()}},isUpdateTaskEnabled:function(){return b.hasClass(this.addTaskInputNode,
"default")?!1:!0},fillInDateField:function(a){this.dateInputField.value=ws.date.formatDateTime(new Date(a),Config.Strings.DateYear);b.removeClass(this.dueDateInput,"default");if(this.dueDateInput==this.dateInputField)this.enableReminderRow();else if(!this.dateHasBeenChosen)this.dateHasBeenChosen=!0},fillInTimeField:function(a){this.reminderTimeSelect.value=a}}),ws.panels.TaskPanelUtil={IsDateInPast:function(a){return a<new Date},IsValidDate:function(a,e){var b=!0;a!=null&&a.length>0&&(b=null!=ws.date.ParseDateFromFormat(a,
e));return b},ValidateDate:function(a,e,b,g,h){var j=!1,k=!1,l={},a=ws.date.ParseDateFromFormat(a,g);null!=a&&(j=!0,null!==e&&a.setHours(e,b),k=a<h);l.isValidDate=j;l.isDateInPast=k;l.oDate=a;return l},GetLeadTimeInMinutesHelper:function(a){var e=0;switch(a){case "Default":e=0;break;case "OneDayBefore":e=1440;break;case "TwoDaysBefore":e=2880;break;case "OneWeekBefore":e=10080;break;case "OnThisDate":e=0;break;default:e=0}return e},GetLeadTimeInMinutes:function(a,e){var b=0;switch(a){case "Default":b=
0;break;case "OneDayBefore":b=1440;break;case "TwoDaysBefore":b=2880;break;case "OneWeekBefore":b=10080;break;case "OnThisDate":if(e){var b=ws.date.ParseDateFromFormat(e.remDate,Config.Strings.CalDateParseFormat),g=ws.date.ParseHourMinTextField(e.time,e.timeFmt,e.shortTimeFmt);g==null?b=Config.Strings.Calendar_AddEvent_InvalidTimeCustomRemind:(b.setHours(g.hr,g.min),b=this._getLeadTime(b,e.taskDate))}break;default:b=0}return b},_getLeadTime:function(a,e){var b=e.getTime()-a.getTime();return b>0?Math.round(b/
1E3/60):Config.Strings.Calendar_AddEvent_ReminderAfterEvent},BuildTimeMenuItems:function(){for(var a=[],e,b=Config.Strings.CalTimeFormatRange1,g=new Date,h=0;h<24;h++)g.setHours(h,0),e=ws.date.formatDateTime(g,b),a.push({display:e,selected:null,value:h});return a},GetTodoStatus:function(a){switch(a){case 0:return"Unknown";case 1:return"Draft";case 2:return"Completed";case 3:return"Cancelled";case 4:return"Assigned";case 5:return"In_Progress";case 6:return"Not_Started";default:return"In_Progress"}},
GetLeadTimeMenuOption:function(a){switch(a){case 0:return 0;case 1440:return 1;case 2880:return 2;case 10080:return 3;default:return 4}},GetReminderEndDate:function(a,e,b,g){a=ws.date.add(e,ws.date.dateParts.MINUTE,-1*a);e={};e.date=ws.date.formatDateTime(a,b);e.time=ws.date.formatDateTime(a,g);return e}};b._hasResource["ws.address.PeopleApp"]||(b._hasResource["ws.address.PeopleApp"]=!0,b.provide("ws.address.PeopleApp"),b.declare("ws.address.PeopleApp",[k._Widget,k._Templated],{templateString:b.cache("ws.address",
"PeopleApp.html",'<div class="appNode appPpl">\r\n\t<div class="layoutWidget" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget">\r\n\t\t<div class="appTitleBar" dojoType="ws.widget.Pane" layoutAlign="top">\r\n\t\t\t<div class="appTitleLink" dojoAttachPoint="appTitleLink" dojoAttachEvent="onclick: appMenu"><span class="appTitle">${NavPeople}</span><img src="${spacer}" class="mainSprite appTitleArrow"></div>\r\n\t\t\t<ul>\r\n\t\t\t\t<li class="mainSprite appTitleClose" dojoAttachEvent="onclick: appClose"></li>\r\n\t\t\t\t<li class="mainSprite appTitleSearch" dojoAttachEvent="onclick: searchContacts,onmouseout: onMouseOut,onmouseover: onMouseOver" dojoAttachPoint="appTitleSearch"></li>\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t\t<div dojoType="ws.widget.Pane" class="searchBox" style="display:none;" layoutAlign="top">\r\n\t\t\t<div class="cSearchInput" dojoType="ws.widget.ClearableTextbox" dojoAttachPoint="searchBox" defaultValue="${ContactAppSearchDef}"></div>\r\n\t\t</div>\r\n\t\t<div dojoAttachPoint="appPplNode" dojoType="ws.widget.Pane" class="appPplNode" layoutAlign="client"></div>\r\n\t\t<div dojoAttachPoint="appPplNoResult" dojoType="ws.widget.Pane" class="appPplNoResult" layoutAlign="client" style="display:none;">\r\n\t\t\t<div class="noResultMsg">${NoMatchesFound}</div>\r\n\t\t</div>\r\n\t\t<div dojoAttachPoint="appPplEmpty" dojoType="ws.widget.Pane" layoutAlign="client" style="display:none;">\r\n\t\t\t<div class="appPplEmptyMsg">${ContactAppEmpty}</div>\r\n\t\t\t<div dojoAttachPoint="toolbar" dojoType="ws.widget.WSToolbar" vizType="Bare">\r\n\t\t\t\t<div dojoType="ws.widget.Pane" toolbarPosition="center">\r\n\t\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick: addContact">${ContactAppEmptyBtn}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,_inited:!1,_started:!1,searchMode:!1,startup:function(){if(!this._started)this.model=new ws.address.AddressModel({sortable:!0,fullTextSearchable:!0}),this.connect(this.model,"modelUpdated","modelUpdated"),this.model.core.sortData(Settings.AddressNameSortOrder?Settings.AddressNameSortOrder:Config.DefaultAddressNameSortOrder,"Ascending"),this.connect(this.appPplNode.domNode,"onclick","handleClick"),this.connect(this.appPplNode.domNode,
"oncontextmenu","handleRClick"),this.connect(this.searchBox,"clear","searchClear"),b.query(".appTitleClose",this.domNode).style("display","none"),this.connect(this.searchBox.textbox,"onkeyup","onKeyPressSearchField"),this._started=!0},init:function(){if(!this._inited)this.model.initData(),this.model.isLoading()||this.modelUpdated(),this._inited=!0},onMouseOut:function(){b.addClass(this.appTitleSearch,"appTitleSearch");this.searchMode||b.removeClass(this.appTitleSearch,"appTitleSearchSel")},onMouseOver:function(){b.addClass(this.appTitleSearch,
"appTitleSearchSel")},modelUpdated:function(){var a=this.model.getRolodex(),e=0,b=this.searchBox.getValue(),g=this.model.getSearchString();if(!b||b&&b==g){var h=this.model.getRowCount();if(h==0)g?(this.appPplEmpty.hide(),this.appPplNoResult.show()):(this.appPplEmpty.show(),this.appPplNoResult.hide()),this.appPplNode.hide(),this.toolbar.layout();else{this.appPplEmpty.hide();this.appPplNoResult.hide();this.appPplNode.show();for(var g=["<ul>"],j="appPplSection appPplSectionOne",k=!0;a[e]==-1;)e++;for(var l=
0;l<h;l++){if(Config.UseRolodexQuickContacts&&!b&&a[e]==l){g.push("<li class='"+j+"'>"+ws.string.alphabet.charAt(e).toUpperCase()+"</li>");k&&(k=!1,j="appPplSection");for(;a[++e]==-1&&e<a.length;);}var o=this.model.getRow(l);g.push("<li class='appPplItem' _row='"+l+"'>"+ws.string.escapeXml(o.name||o.email1||o.email2||o.screenName||"")+"</li>")}g.push("</ul>");this.appPplNode.domNode.innerHTML=g.join("")}}},onResized:function(){this.inherited(arguments);this.model.getRowCount()==0&&this.toolbar.layout()},
fullView:function(a){b.stopEvent(a);ws.WebSuite.displayContactListView(null,"")},appClose:function(a){ws.WebSuite.Navigation.restoreApp();b.stopEvent(a)},handleClick:function(a){b.stopEvent(a);if(a=ws.widget.getEventTarget(a,"appPplItem","appPplNode"))if(a=b.attr(a,"_row")){var e=this.getEmail(this.model.getRow(+a));e&&e.length>0&&(a=k.byId("composeMessage"),ws.WebSuite._currentTab=="composeMessage"&&!a.isSendConfirmationOnShow()?ws.WebSuite.reuseComposeWindow(e):ws.WebSuite.getCompose(null,b.hitch(this,
function(a){a.reset({to:e})})))}},handleRClick:function(a){var e=ws.widget.getEventTarget(a,"appPplItem","appPplNode");b.stopEvent(a);if(e){this.menu||this.createContextMenu();var f=b.attr(e,"_row");f?(this.lastContact=this.model.getRow(+f),this.menu.open(a.pageX,a.pageY,e)):this.lastContact=null}},getEmail:function(a){return a.email1||a.email2||a.screenName||a.composeValue||""},createContextMenu:function(){var a=[{caption:Config.Strings.ContactAppSendMessage,onClick:b.hitch(this,function(){var a=
this.getEmail(this.lastContact);a&&a.length>0&&ws.WebSuite.getCompose(null,b.hitch(this,function(b){b.reset({to:a})}))})},{caption:Config.Strings.ContactAppAddCC,onClick:b.hitch(this,function(){var a=this.getEmail(this.lastContact);if(a&&a.length>0){var f=k.byId("composeMessage");ws.WebSuite._currentTab=="composeMessage"&&!f.isSendConfirmationOnShow()?ws.WebSuite.reuseComposeWindow(a,"cc"):ws.WebSuite.getCompose(null,b.hitch(this,function(b){b.reset({cc:a})}))}})},{caption:Config.Strings.ContactAppAddBCC,
onClick:b.hitch(this,function(){var a=this.getEmail(this.lastContact);if(a&&a.length>0){var f=k.byId("composeMessage");ws.WebSuite._currentTab=="composeMessage"&&!f.isSendConfirmationOnShow()?ws.WebSuite.reuseComposeWindow(a,"bcc"):ws.WebSuite.getCompose(null,b.hitch(this,function(b){b.reset({bcc:a})}))}})},{caption:Config.Strings.ContactAppDetails,onClick:b.hitch(this,function(){this.lastContact.bType=="d"?ws.WebSuite.editDistributionList(this.lastContact.uid):ws.WebSuite.showContactDetails(this.lastContact)})},
{caption:Config.Strings.ContactAppEdit,onClick:b.hitch(this,function(){b.publish("WSFeedbackStart",[Config.Strings.Loading]);this.lastContact.bType=="d"?ws.WebSuite.editDistributionList(this.lastContact.uid):this.model.getContact({uid:this.lastContact.uid,load:b.hitch(this,function(a){b.publish("WSFeedbackEnd",[Config.Strings.Loading]);ws.WebSuite.editContact(this.lastContact.uid,a,!0)}),error:b.hitch(this,function(a){b.publish("WSFeedbackEnd",[Config.Strings.Loading]);window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,
"Dialogs.ok shown - Error Handler for addressModel.getContact-showContact file:ContactDetails.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorLoadingContact)})})})},{caption:Config.Strings.ContactAppDelete,onClick:b.hitch(this,function(){this.model.clearRolodex();this.model.deleteAddresses({uids:[this.lastContact.uid]})})}];this.menu=ws.widget.createMenu(a)},createAppMenu:function(){var a=[{caption:Config.Strings.NewContact,onClick:b.hitch(this,function(){ws.WebSuite.editContact(null,null,!0)})},
{caption:Config.Strings.NewDistList,onClick:b.hitch(this,function(){ws.WebSuite.createDistList()})},{separator:!0},{caption:Config.Strings.ContactAppFullTip,onClick:b.hitch(this,function(){ws.WebSuite.displayContactListView(null,"")})}];this.appTitleMenu=ws.widget.createMenu(a)},addContact:function(a){ws.WebSuite.editContact(0,null,!0);b.stopEvent(a)},appMenu:function(a){b.stopEvent(a);this.appTitleMenu||this.createAppMenu();this.appTitleMenu.open(this.appTitleLink)},searchContacts:function(a){b.stopEvent(a);
this.searchMode?(b.query(".searchBox",this.domNode).style("display","none"),b.addClass(this.appTitleSearch,"appTitleSearch"),b.removeClass(this.appTitleSearch,"appTitleSearchSel"),this.searchBox.clear(),this.model.search("")):(b.query(".searchBox",this.domNode).style("display","block"),b.addClass(this.appTitleSearch,"appTitleSearchSel"),b.removeClass(this.appTitleSearch,"appTitleSearch"),this.searchBox.focus());this.layoutWidget.layout();this.searchMode=!this.searchMode},onResized:function(){this.inherited(arguments);
var a=b._getMarginSize(this.domNode).w;a>150&&b.style(this.searchBox.domNode,{width:a-22+"px"})},onKeyPressSearchField:function(a){a.keyCode==b.keys.ESCAPE?(this.searchTimer&&clearTimeout(this.searchTimer),this.model.search("")):(this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=setTimeout(b.hitch(this,function(){this.model.search(this.searchBox.getValue())}),500))},searchClear:function(){this.searchTimer&&clearTimeout(this.searchTimer);this.model.search("")}}));b._hasResource["ws.mail.FolderApp"]||
(b._hasResource["ws.mail.FolderApp"]=!0,b.provide("ws.mail.FolderApp"),b.declare("ws.mail.FolderApp",[k._Widget,k._Templated],{templateString:b.cache("ws.mail","FolderApp.html",'<div class="appNode appFolders">\r\n\t<div class="layoutWidget" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget">\r\n\t\t<div class="appTitleBar" dojoType="ws.widget.Pane" layoutAlign="top">\r\n\t\t\t<span class="appTitle">${NavMyFolders}</span>\r\n\t\t\t<ul>\r\n\t\t\t\t<li class="mainSprite appTitleClose" dojoAttachEvent="onclick: appClose"></li>\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t\t<div dojoAttachPoint="appFoldersNode" dojoAttachEvent="onClick:handleClick" class="appFoldersNode" dojoType="ws.widget.Pane" layoutAlign="client"></div>\r\n\t</div>\r\n</div>\r\n\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,startup:function(){},setModel:function(a){this.model=a;this.connect(this.model,"modelUpdated","modelUpdated");this.modelUpdated()},modelUpdated:function(){var a=b.query(".navItem .icon",ws.WebSuite.Navigation.myFoldersNode);a.myNode=this.appFoldersNode.domNode;a.myNode.innerHTML="";a.forEach(this.addMyFolder,this)},addMyFolder:function(a,e,f){var e=b.attr(a,"theFN"),a=this.model.getFolderByName(e),g="";a&&(g=ws.string.escapeXml(a.displayName),
g=g.replace(/ /gm,"&nbsp;"),f=b.create("div",{className:"folderItem",theFN:e},f.myNode),e==this.model.currentFolder&&b.addClass(f,"currFolderItem"),b.create("div",{className:"mainSprite iconPersonal"},f),e=b.create("span",{className:"name",innerHTML:g},f),a.unseenCount>0&&(b.create("div",{className:"unseen",innerHTML:a.unseenCount},f),b.style(e,"width","102px")))},handleClick:function(a){(a=ws.widget.getEventTarget(a,"folderItem","appFoldersNode"))&&ws.WebSuite.Navigation.displayFolder(b.attr(a,"theFN"),
ws.UserContext.ActiveScreenName);this.appClose()},appClose:function(){ws.WebSuite.Navigation.closeFlyoutFolders()}}));b._hasResource["ws.calendar.EventsApp"]||(b._hasResource["ws.calendar.EventsApp"]=!0,b.provide("ws.calendar.EventsApp"),b.declare("ws.calendar.EventsApp",[k._Widget,k._Templated],{templateString:b.cache("ws.calendar","EventsApp.html",'<div class="appNode appEvent">\r\n\t<div dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget" class="layoutWidget">\r\n\t\t<div class="appTitleBar" dojoType="ws.widget.Pane" layoutAlign="top">\r\n\t\t\t<div class="appTitleLink" dojoAttachPoint="appTitleLink" dojoAttachEvent="onclick: appMenu"><span class="appTitle">${NavEvents}</span><img src="${spacer}" class="mainSprite appTitleArrow"></div>\r\n\t\t\t<ul>\r\n\t\t\t\t<li class="mainSprite appTitleClose" dojoAttachEvent="onclick: restoreApp" style="display:none;"></li>\r\n\t\t\t\t<li class="mainSprite appTitleAddEv" dojoAttachEvent="onclick: addEvent,onmouseout: onMouseOut,onmouseover: onMouseOver" dojoAttachPoint="appTitleAddEv"></li>\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t\t<div class="eventNode" dojoType="ws.widget.Pane" dojoAttachPoint="eventNode" dojoAttachEvent="onClick: viewEvent" layoutAlign="client"></div>\r\n\t\t<div dojoAttachPoint="appEventEmpty" dojoType="ws.widget.Pane" layoutAlign="client" style="display:none;">\r\n\t\t\t<div class="appEventEmptyMsg">${EventAppEmpty}</div>\r\n\t\t\t<div dojoAttachPoint="toolbar" dojoType="ws.widget.WSToolbar" vizType="Bare">\r\n\t\t\t\t<div dojoType="ws.widget.Pane" toolbarPosition="center">\r\n\t\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachEvent="onClick: addEvent">${EventAppEmptyBtn}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\t\t\t\t\r\n\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,dateFormat:Config.Strings.Panel_EventPanel_DateFormat,timeFormat:Config.Strings.Panel_EventPanel_TimeFormat,dayofWeekFormat:Config.Strings.Panel_EventPanel_DayOfWeekFormat,numDays:90,isAnonymous:!1,_inited:!1,model:null,calendarNodes:{},startup:function(){this.currDate=new Date;this.connect(this.eventNode.domNode,"oncontextmenu","onContextMenu")},onMouseOut:function(){b.addClass(this.appTitleAddEv,"appTitleAddEv");b.removeClass(this.appTitleAddEv,
"appTitleAddEvSel")},onMouseOver:function(){b.addClass(this.appTitleAddEv,"appTitleAddEvSel");b.removeClass(this.appTitleAddEv,"appTitleAddEv")},setModel:function(a){this.model=a;this.connect(this.model,"modelUpdated","modelUpdated");this.connect(this.model,"requestUpdate","loadData")},init:function(){if(!this._inited){this.model||this.setModel(new ws.calendar.CalendarViewModel({modelType:"event"}));this.model.isModelFetchedOnce?this.modelUpdated():ws.lang.setTimeout(this,function(){this.loadData()},
100);this._inited=!0;var a=ws.UserContext.Locale;(a=="fr-fr"||a=="fr-ca"||a=="es-us")&&b.addClass(this.layoutWidget.domNode,"l10n")}},onResized:function(){this.inherited(arguments);this.hasEventDaysCount==0&&this.toolbar.layout()},getDefaultEventArgs:function(){return{compType:"EVENT",calendars:!0,components:!0,index:!0,dayBucketIndex:!0,enums:!0,dtstart:null,dtend:null,sortBy:null,sortDir:null}},loadData:function(){var a=this.getDefaultEventArgs(),e=new Date;this.calStartDate=e;this.calEndDate=ws.date.add(e,
ws.date.dateParts.MONTH,3);a.dtstart=ws.date.formatISO8601(this.calStartDate);a.dtend=ws.date.formatISO8601(this.calEndDate);this.model.getData(a)},updateEventData:function(){this.eventLists=Array(this.numDays);ws.date.formatDateTime(this.currDate,Config.Strings.Panel_EventPanel_MonthFormat);this.hasEventDaysCount=0;for(var a=this.model.index,e=this.model.components,b=this.model.componentEnum,g=this.model.calendarEnum,h=this.currDate,j=0;j<this.numDays;j++){var k=ws.date.formatDateTime(h,this.dateFormat);
this.eventLists[j]={rawDate:h,date:k,dayList:[]};h=ws.date.add(h,ws.date.dateParts.DAY,1)}h=this.model.indexEnum;for(j=0;j<a.length;j++){var l=a[j],o=l[h.id],n=e[o];if(!(n==null||n[b.compType]!=0)){var p=null,x=p=k=null,q=this.model.getComponentArgs(n);q.id=o;if(l[h.rid])q.rid=l[h.rid];o=this.model.calendars[n[b.calid]][g.writable];if(q.rid){q.start=l[this.model.indexEnum.start];q.end=l[this.model.indexEnum.end];if(n[this.model.componentEnum.recurEnd])q.recurEnd=ws.date.formatISO8601(n[this.model.componentEnum.recurEnd]);
p=new Date(l[this.model.indexEnum.start]);k=ws.date.formatDateTime(p,this.dateFormat);p=ws.date.formatDateTime(p,this.timeFormat)}else p=new Date(n[b.start]),k=ws.date.formatDateTime(p,this.dateFormat),p=ws.date.formatDateTime(p,this.timeFormat),x=n[b.end],q.start=n[b.start],q.end=n[b.end];l={startTimeFormatted:p,startTime:n[b.start],endTime:x,args:q,writeable:o};for(n=0;n<this.numDays;n++)if(k==this.eventLists[n].date){this.eventLists[n].dayList.push(l);this.hasEventDaysCount++;break}}}},modelUpdated:function(){if(this.model&&
this.model.isModelFetchedOnce){this.updateEventData();this.updateAppMenu();var a=this.eventNode.domNode;if(this.hasEventDaysCount>0){this.appEventEmpty.hide();this.eventNode.show();for(var e=a.childNodes,f=e.length-1;f>=0;f--)b.destroy(e[f]);for(e=0;e<this.eventLists.length;e++)if(f=this.eventLists[e].dayList,f.length>0){this.eventLists[e].node=b.create("div",{className:"eRow dayRow",innerHTML:this.eventLists[e].rawDate==this.currDate?Config.Strings.Panel_EventPanel_Today:this.eventLists[e].date},
a);for(var g=0;g<f.length;g++){var h=f[g].startTimeFormatted;if(f[g].args.allDay)h=Config.Strings.AllDay;var j=b.create("div",{className:"eRow eventRow bgColor",evid:f[g].args.id,_day:e},a);b.create("span",{className:"eventTime",innerHTML:h},j);b.create("span",{className:"eventSummary",innerHTML:f[g].args.summary,title:f[g].args.summary},j)}}}else this.appEventEmpty.show(),this.eventNode.hide(),this.toolbar.layout();b.setSelectable(a,!1)}},getComponent:function(a,e){var b=0,g=this.eventLists.length;
e&&(b=e,g=e+1);for(;b<g;b++)for(var h=this.eventLists[b].dayList,j=0;j<h.length;j++)if(a==h[j].args.id)return h[j];return null},restoreApp:function(a){b.stopEvent(a);ws.WebSuite.Navigation.restoreApp()},calFullView:function(a){a&&b.stopEvent(a);ws.WebSuite.Navigation.searchActive(!1);ws.WebSuite.Navigation.showCalendar(!0,function(){k.byId("calendarView").backToList()})},addEvent:function(a){a&&b.stopEvent(a);ws.WebSuite.getAddEditWidget(b.hitch(this,function(a){null!=a&&(a.setModel(this.model),a.show(0))}))},
viewEvent:function(a){b.stopEvent(a);var e=ws.widget.getEventTarget(a,"eRow","eventNode");if(b.hasClass(e,"dayRow")){d=null;for(a=0;a<this.eventLists.length;a++)if(e==this.eventLists[a].node)d=this.eventLists[a].rawDate;d&&ws.WebSuite.selectTab("calendarView",function(a){a.selectDayView();a.setDate(d)})}else{var a=b.attr(e,"evid"),f=b.attr(e,"_day"),g=this.getComponent(a,+f);if(g){var h=b.clone(g.args);ws.WebSuite.getEventQuickViewWidget(b.hitch(this,function(a){a.setModel(this.model);a.initializeView(h,
g.writeable==1,e,"right",this.model.calendars[h.calid][this.model.calendarEnum.sponsoredCalIconURL]);ws.reporting.reportAction("Event Quick View")}))}}},updateAppMenu:function(){var a=this.model.getCalendarList(),e=this.model.calendarEnum;if(a&&e){if(this.appTitleMenu){var f=this.appTitleMenu.getChildren();b.forEach(f,b.hitch(this,function(a,e){e>4&&(this.appTitleMenu.removeChild(a),a.destroy())}))}else this.createAppMenu();for(f=0;f<a.length;f++){var g=a[f],h=g[e.id],j=g[e.displayName],k=g[e.selected],
g="<div class='wsCalCB "+("wsCalCB_"+g[e.color].substring(1)+(k?" checked":" unchecked"))+"'></div><div class='text'>"+ws.string.escapeXml(j)+"</div>";el=new ws.widget.WSMenuItem({caption:g,onClick:b.hitch(this,"toggleCalendarItem",h)});el._onClick=b.hitch(el,function(a){if(!this.disabled)this.onClick();b.stopEvent(a)});this.appTitleMenu.addChild(el);this.calendarNodes[h]=el}}},toggleCalendarItem:function(a){var e=this.model.calendarEnum,a=this.model.calendars[a],b=this.model.getCalendarArgs(a,!0);
b.selected=!a[e.selected];b.search=this.model.searchStr;b.searchIn=null;b.sortBy=null;b.sortDir=null;b.ignoreCache=!1;this.model.saveCalendar(b)},createMenu:function(a,e){var f=new ws.widget.WSMenu({id:a});b.forEach(e,function(a){a&&(a=new (a.dojoType?eval(a.dojoType):a.separator?ws.widget.WSMenuSeparator:ws.widget.WSMenuItem)(a),f.addChild(a))});b.body().appendChild(f.domNode);f.startup();return f},promptConfirmDelete:function(){var a=this.eventData;a.rid&&a.rid.length>0?ws.calendar.calutil.showConfirmRecurDialog("delete",
b.hitch(this,function(e,b){e&&this.deleteEvent(a,b)})):ws.widget.OkCancelDialog.alert(Config.Strings.RegEventMsg,b.hitch(this,function(e){e&&this.deleteEvent(a)}),!0)},deleteEvent:function(a,e){var f=this.model.getDefaultComponentArgs(!1);f.id=a.id;if(a.rid)f.rid=a.rid;f.index=!0;e||(e="CHANGE_CURRENT");f.recurChangeMode=e;f.loadCallback=b.hitch(this,function(){b.publish("WSFeedbackStart",[Config.Strings.EventDeleted,!0])});this.model.deleteEvents(f)},createAppMenu:function(){this.appTitleMenu=this.createMenu("eventAppMenu",
[{caption:Config.Strings.NewEvent,onClick:b.hitch(this,function(){this.addEvent()})},{caption:Config.Strings.AddCalendar,onClick:b.hitch(this,function(){ws.WebSuite.Navigation.selectApp(ws.WebSuite.Navigation.APP_ADDCALENDAR)})},{separator:!0},{caption:Config.Strings.EventAppFullTip,onClick:b.hitch(this,function(){this.calFullView()})},{separator:!0}])},appMenu:function(a){b.stopEvent(a);this.appTitleMenu||this.createAppMenu();this.appTitleMenu.open(this.appTitleLink)},createContextMenu:function(){var a=
[{caption:Config.Strings.Edit,onClick:b.hitch(this,function(){this.eventData&&ws.WebSuite.getAddEditWidget(b.hitch(this,function(a){a.setModel(this.model);a.show(1,this.eventData)}))})},{caption:Config.Strings.Delete,onClick:b.hitch(this,function(){this.promptConfirmDelete()})}];this.contextMenu=ws.widget.createMenu(a)},onContextMenu:function(a){b.stopEvent(a);var e=ws.widget.getEventTarget(a,"eventRow","eventNode");if(e){var f=b.attr(e,"_day");this.eventData=this.getComponent(b.attr(e,"evid"),+f).args;
this.nodeData=e;this.contextMenu||this.createContextMenu();this.contextMenu.open(a.pageX,a.pageY)}}}));if(!b._hasResource["ws.calendar.TodoEditDialog"])b._hasResource["ws.calendar.TodoEditDialog"]=!0,b.provide("ws.calendar.TodoEditDialog"),b.declare("ws.calendar.TodoEditDialog",[ws.widget.WSModalPane,k._Templated],{templateString:b.cache("ws.calendar","TodoEditDialog.html",'<div class="todoAppEditDlg" style="display: none;">\r\n\t<div class="inner">\r\n\t\t<div  class="mainSprite wsCloseBtn" dojoAttachEvent="onclick: closeCard"></div>\r\n\t\t<div class="todoTitle">${EditTodoTitle}</div>\r\n\r\n\t\t<input type="text" dojoAttachPoint="taskNameInput" maxlength="100" class="wsInput taskNameInput default" dojoAttachEvent="onfocus: onFocus, onblur: onBlur, onkeypress: onKeyPressInput"/>\r\n\r\n\t\t<div class="dueDateDiv">\r\n            <div class="mainSprite calIcon icon"></div>\r\n\t\t\t<div class="dueDateLabel">${DueDate}</div>\r\n\t\t\t<input type="text" dojoAttachPoint="dueDateInput" class="wsInput dueDateInput" dojoAttachEvent="onblur: reminderOnBlur, onfocus: reminderOnFocus, onchange: onChange, onkeypress: onKeyPressInput"/>\r\n            <div class="clearBoth"></div>\r\n\t\t</div>\r\n        <div class="separator"></div>\r\n\t\t<div class="reminderMenuRow" dojoAttachPoint="reminderMenuRow">\r\n            <div class="mainSprite reminderMenuIcon icon"></div>\r\n            <ul dojoType="ws.widget.WSSelect" dojoAttachPoint="reminderMenu" size="byValue">\r\n\t\t\t\t<li value="noReminder">${NoReminder}</li>\r\n\t\t\t\t<li value="remindAt">${RemindMeAt}</li>\r\n\t\t\t</ul>\r\n\t\t\t<input type="text" class="wsInput reminderTimeSelectDefault" dojoAttachPoint="reminderTimeSelect" />\r\n\t\t</div>\r\n\t\t<div dojoAttachPoint="reminderDetailsRow" class="reminderDetailsDiv" style="display:none">\r\n\t\t\t<ul dojoType="ws.widget.WSSelect" dojoAttachPoint="dueDateSelect">\r\n\t\t\t\t<li value="Default">${OnDueDate}</li>\r\n\t\t\t\t<li value="OneDayBefore">${OneDayBefore}</li>\r\n\t\t\t\t<li value="TwoDaysBefore">${TwoDaysBefore}</li>\r\n\t\t\t\t<li value="OneWeekBefore">${OneWeekBefore}</li>\r\n\t\t\t\t<li value="OnThisDate">${OnThisDate}</li>\r\n\t\t\t</ul>\r\n\t\t\t<input type="text" class="wsInput remindDateInput" dojoAttachPoint="remindAtEndInput" style="display:none" />\r\n\t\t</div>\r\n        <div class="separator"></div>\r\n\t\t<div dojoAttachPoint="addNoteInputRow" class="addNoteInputDiv">\r\n            <div class="mainSprite icon iconNotes"></div>\r\n            <div defaultValue="${Panel_TodoPanel_EnterNote}" class="addNoteInputDefault" dojoAttachPoint="addNoteInput" dojoType="ws.widget.DefaultTextarea"></div>\r\n\t\t\t<\!--<textarea dojoAttachEvent="onclick:changeDefaultTextForNote" dojoAttachPoint="addNoteInput" class="addNoteInputDefault" wrap="virtual"></textarea>--\>\r\n\t\t</div>\r\n\t\t<div class="updateBtnRow">\r\n\t\t\t<div dojoAttachPoint="updateButton" dojoType="ws.widget.Button" dojoAttachEvent="onClick: updateTask">${UpdateItem}</div>\r\n\t\t</div>\r\n\t\t<div dojoType="ws.widget.PopupDatePicker" dojoAttachPoint="dueDatePopupPicker" hidePickerOnSetDate="true" closeOnMouseOut="true"></div>\r\n\t\t<div dojoType="ws.widget.PopupTimePicker" dojoAttachPoint="eventTimePopupPicker" closeOnMouseOut="true"></div>\r\n\t\t<span style="clear: both;"></span>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,model:null,taskName:null,dateHasBeenChosen:!1,taskNameInputDefaultValue:Config.Strings.EnterTask,addTaskInputDefaultValue:Config.Strings.EnterTask,dueDateDefaultValue:Config.Strings.Panel_TodoPanel_NoDueDate,noteDefaultValue:Config.Strings.Panel_TodoPanel_EnterNote,timeFormat:Config.Strings.CalTimeFormatRange1,timeFormatShort:Config.Strings.CalTimeFormatRange2,reminderFlag:!1,noteFlag:!1,currentTaskUID:null,_sortBy:"DueTime",_sortDir:"Decending",
startup:function(){this.connect(this.domNode,"onclick","generalClickHandler");this.dueDateInput.onclick=b.hitch(this,"showDueDatePopupPicker",this.dueDateInput);this.dueDateInput.onfocus=b.hitch(this,"showDueDatePopupPicker",this.dueDateInput);this.remindAtEndInput.onclick=b.hitch(this,"showDueDatePopupPicker",this.remindAtEndInput);this.reminderTimeSelect.onclick=b.hitch(this,"showTimePicker",this.reminderTimeSelect);b.connect(this.dueDatePopupPicker.datePicker,"selectDateConnect",this,"fillInDateField");
b.connect(this.eventTimePopupPicker.timePicker,"selectTimeConnect",this,"fillInTimeField");b.connect(this.reminderMenu,"valueChanged",this,"handleReminder");b.connect(this.dueDateSelect,"valueChanged",this,"dueDateSelected");this.defaultView()},generalClickHandler:function(a){a.target&&b.hasClass(a.target,"calIcon")&&(this.showDueDatePopupPicker(this.dueDateInput),this.dueDateInput.focus(),b.isFF&&this.reminderOnFocus())},defaultView:function(){this.hideReminderRows()},populateFields:function(a){var e=
this.model.componentEnum,f=null,f=this.model.components[a];this.taskNameInput.value=f[e.summary];b.removeClass(this.taskNameInput,"default");if(f[e.end]){var g=ws.date.formatDateTime(f[e.end],Config.Strings.DateYear);ws.date.formatDateTime(f[e.end],this.timeFormat);b.removeClass(this.dueDateInput,"dueDateInputDefault");this.dueDateInput.value=g}else this.dueDateInput.value="";if(f[e.reminderEnabled]&&g!=""){if(a=ws.panels.TaskPanelUtil.GetReminderEndDate(f[e.reminderLeadTime],f[e.end],Config.Strings.DateYear,
this.timeFormat),this.reminderTimeSelect.value=a.time,this.dueDateSelect.setOption(ws.panels.TaskPanelUtil.GetLeadTimeMenuOption(f[e.reminderLeadTime]),!0),this.dueDateSelect.currentValue=="OnThisDate")this.remindAtEndInput.value=a.date}else{b.addClass(this.reminderTimeSelect,"reminderTimeSelectDefault");if(this.dueDateInput.value=="")this.dueDateInput.value=this.dueDateDefaultValue,b.addClass(this.dueDateInput,"dueDateInputDefault");this.disableReminderRow()}f[e.description]!=""&&this.fillNotes(f[e.description])},
getAddTaskArgs:function(){var a=this.model.getDefaultTaskArgs();a.sortBy=this._sortBy;a.sortDir=this._sortDir;return a},updateTask:function(a){a&&a.stopPropagation();var e=this.model.components,a=this.model.componentEnum,f=null,g=!1,h="",j=this.taskNameInput.value,j=b.trim(j),k=Config.Strings.DateYear;if(j!=""&&this.isUpdateTaskEnabled()){var l=null,o=null,n=null;this.currentTaskUID!=null?(f=e[this.currentTaskUID],o=f[a.start],l=this.model.getComponentArgsForTask(f),l.sortBy=this._sortBy,l.sortDir=
this._sortDir,l.summary=this.taskNameInput.value,n=Config.Strings.ToDoUpdated):(o=new Date,l=this.getAddTaskArgs(),l.summary=j,l.start=ws.date.formatISO8601(o),n=Config.Strings.ToDoCreated);var p=b.trim(this.dueDateInput.value);if(p!=""&&!b.hasClass(this.dueDateInput,"dueDateInputDefault")){var x=e=null;if(this.reminderFlag)j=ws.date.ParseHourMinTextField(this.reminderTimeSelect.value,this.timeFormat,this.timeFormatShort),e=j.hr,x=j.min;var q=ws.panels.TaskPanelUtil.GetLeadTimeInMinutesHelper(this.dueDateSelect.currentValue),
j=!0;if(q!=0){var w=ws.date.ParseDateFromFormat(p,k),q=ws.date.add(w,ws.date.dateParts.MINUTE,-q),q=ws.date.formatDateTime(q,k);ws.panels.TaskPanelUtil.ValidateDate(q,e,x,k,this.model.currentServerTime).isDateInPast&&(j=!1)}p=ws.panels.TaskPanelUtil.ValidateDate(p,e,x,k,this.model.currentServerTime);if(p.isValidDate)if(k=p.oDate,e!=null)if(!p.isDateInPast&&j){l.end=ws.date.formatISO8601(k);l.start=l.end;l.reminderEnabled=!0;_argsLeadTime=null;this.dueDateSelect.currentValue=="OnThisDate"&&(_argsLeadTime=
{time:this.reminderTimeSelect.value,taskDate:k,remDate:this.remindAtEndInput.value,timeFmt:this.timeFormat,shortTimeFmt:this.timeFormatShort});g=ws.panels.TaskPanelUtil.GetLeadTimeInMinutes(this.dueDateSelect.currentValue,_argsLeadTime?_argsLeadTime:null);typeof g=="string"?h=g:l.reminderLeadTime=g;if(k<o)l.start=l.end;g=!0}else this.taskPanel&&!this.taskPanel.addTaskFlag?(g=!1,h=Config.Strings.InvalidReminderDateInPastOnCreate):(l.end=ws.date.formatISO8601(k),l.start=l.end,g=!0,h=null,l.reminderEnabled=
!1,l.reminderLeadTime=0);else{if(g=!0,l.reminderEnabled=!1,l.reminderLeadTime=0,l.end=ws.date.formatISO8601(k),k<o)l.start=l.end}else o=this.domNode.parentNode,o.style.zIndex=998,ws.widget.OkCancelDialog.alert(Config.Strings.InvalidDateOnCreate)}else{g=!1;l.description=this.addNoteInput.getValue();l.end=null;l.reminderEnabled=!1;l.reminderLeadTime=0;if(f!=null)l.status=ws.panels.TaskPanelUtil.GetTodoStatus(f[a.status]);l.start=ws.date.formatISO8601(new Date);l.loadCallback=b.hitch(this,function(){b.publish("WSFeedbackStart",
[n,!0]);if(this.onSavedCB)this.onSavedCB(),this.onSavedCB=null});if(!h||h.length==0)this.model.saveComponent(l),this.closeCard()}if(g){l.description=this.addNoteInput.getValue();if(f!=null)l.status=ws.panels.TaskPanelUtil.GetTodoStatus(f[a.status]);if(l.end!=null&&l.end.length==0)l.start=ws.date.formatISO8601(new Date);l.start=l.end;l.loadCallback=b.hitch(this,function(){b.publish("WSFeedbackStart",[n,!0]);if(this.onSavedCB)this.onSavedCB(),this.onSavedCB=null});if(!h||h.length==0)this.model.saveComponent(l),
this.closeCard()}if(h&&h.length>0)o=this.domNode.parentNode,o.style.zIndex=998,ws.widget.OkCancelDialog.alert(h)}},showTimePicker:function(a){if(!this.eventTimePopupPicker.isShowingNow){ws.widget.popup({popup:this.eventTimePopupPicker,around:a,orient:{BL:"TL"}});var e=new Date,a=ws.date.ParseHourMinTextField(a.value,this.timeFormat,this.timeFormatShort);a!=null?(e.setHours(a.hr,a.min),this.eventTimePopupPicker.initializeTime(e)):this.eventTimePopupPicker.initializeTime()}},isUpdateTaskEnabled:function(){return b.hasClass(this.taskNameInput,
"default")?!1:!0},addReminder:function(){this.enableReminderRow(!0)},closeReminder:function(){},addNote:function(){this.openNote()},openNote:function(a){this.fillNotes(a)},closeNote:function(){},reset:function(){ws.widget.popup.close(this);this.defaultView();b.addClass(this.taskNameInput,"default");this.taskNameInput.value=this.taskNameInputDefaultValue;b.addClass(this.dueDateInput,"dueDateInputDefault");this.dueDateInput.value=this.dueDateDefaultValue;this.reminderTimeSelect.value="";this.addNoteInput.setValue();
this.reminderFlag=!1},fillInDateField:function(a){this.dateInputField.value=ws.date.formatDateTime(new Date(a),Config.Strings.DateYear);b.removeClass(this.dueDateInput,"dueDateInputDefault");if(this.dueDateInput==this.dateInputField)this.enableReminderRow();else if(!this.dateHasBeenChosen)this.disableReminderRow(),this.dateHasBeenChosen=!0},fillInTimeField:function(a){this.reminderTimeSelect.value=a},onKeyPressInput:function(a){if(a.keyCode==b.keys.ENTER)this.updateTask();else if(a.keyCode==b.keys.ESCAPE)b.addClass(this.taskNameInput,
"default"),this.taskNameInput.value=this.taskNameInputDefaultValue,b.addClass(this.dueDateInput,"dueDateInputDefault"),this.dueDateInput.value=this.dueDateInputDefaultValue,this.dueDatePopupPicker.hidePopup(),this.closeCard()},hideReminderRows:function(){this.reminderDetailsRow.style.display="none";this.reminderTimeSelect.style.display="none";this.remindAtEndInput.style.display="none";this.reminderMenu.setOption(0,!0)},showReminderRows:function(){this.reminderMenu.setOption(1,!0);this.dueDateSelect.sizeMyself()},
enableReminderRow:function(a){var e=b.trim(this.dueDateInput.value);if(e!=""&&e!=this.dueDateDefaultValue||a)if(this.dueDateSelect.setClass("dueDateSelect"),this.dateHasBeenChosen=!0,!this.reminderTimeSelect.value)a=new Date,a=ws.calendar.calutil.GetNext30MinuteIncrement(a),this.reminderTimeSelect.value=ws.date.formatDateTime(a,this.timeFormat);this.dueDateSelect.setClass("dueDateSelect");this.reminderTimeSelect.enabled=!0;this.reminderFlag=this.dueDateSelect.enabled=!0;this.showReminderRows()},disableReminderRow:function(){this.reminderFlag=
this.reminderTimeSelect.enabled=!1;this.hideReminderRows()},reminderOnFocus:function(){if(b.hasClass(this.dueDateInput,"dueDateInputDefault"))b.removeClass(this.dueDateInput,"dueDateInputDefault"),b.addClass(this.dueDateInput,"dueDateInput"),this.dueDateInput.value=""},reminderOnBlur:function(){if(this.dueDateInput.value==""&&!this.dueDatePopupPicker.isShowingNow)this.disableReminderRow(),b.addClass(this.dueDateInput,"dueDateInputDefault"),this.dueDateInput.value=this.dueDateDefaultValue,this.dateHasBeenChosen=
!1},openPopUpNew:function(a,e,f,g,h){this.dueDateDefaultValue=Config.Strings.Optional;this.updateButton.setLabel(Config.Strings.AddItem);b.addClass(this.dueDateInput,"dueDateInputDefault");this.dueDateInput.value=this.dueDateDefaultValue;e?this.openNote(e):this.closeNote();a?(b.removeClass(this.taskNameInput,"default"),this.taskNameInput.value=a):this.taskNameInput.value=this.taskNameInputDefaultValue;f!=null&&ws.widget.popup({popup:this,around:f,padding:h,orient:g});ws.widget.hidePointer(this.domNode)},
openPopUp:function(a){this.dueDateDefaultValue=Config.Strings.Panel_TodoPanel_NoDueDate;this.updateButton.setLabel(Config.Strings.UpdateItem);b.removeClass(this.dueDateInput,"dueDateInputDefault");this.dateHasBeenChosen=!1;this.currentTaskUID=a;this.populateFields(a);this.show();this.reminderMenu.sizeMyself();this.dueDateSelect.sizeMyself()},showDueDatePopupPicker:function(a){b.isIE&&this.reminderOnFocus();this.dueDatePopupPicker.isShowingNow||ws.widget.popup({popup:this.dueDatePopupPicker,around:a,
orient:{BL:"TL"}});this.dateInputField=a},onFocus:function(){if(b.hasClass(this.taskNameInput,"default"))this.taskNameInput.value="",b.removeClass(this.taskNameInput,"default")},onBlur:function(){if(this.taskNameInput.value=="")this.taskNameInput.value=this.taskNameInputDefaultValue,b.addClass(this.taskNameInput,"default")},onChange:function(){this.dueDateInput.value==""&&!this.dueDatePopupPicker.isShowingNow?(this.disableReminderRow(),b.addClass(this.dueDateInput,"dueDateInputDefault"),this.dueDateInput.value=
this.dueDateDefaultValue,this.dateHasBeenChosen=!1):this.dateHasBeenChosen=!0},fillNotes:function(a){this.addNoteInput.setValue(a)},handleReminder:function(){switch(this.reminderMenu.currentValue){case "noReminder":this.reminderDetailsRow.style.display="none";this.reminderTimeSelect.style.display="none";this.remindAtEndInput.style.display="none";this.reminderFlag=!1;break;case "remindAt":this.dueDateSelect.setClass("dueDateSelect"),this.reminderTimeSelect.style.display="",this.reminderTimeSelect.enabled=
!0,this.dueDateSelect.enabled=!0,this.dueDateSelect.setOption(0,!0),this.reminderDetailsRow.style.display="",this.dueDateSelect.sizeMyself(),this.reminderFlag=!0}},dueDateSelected:function(){this.remindAtEndInput.style.display=this.dueDateSelect.currentValue=="OnThisDate"?"":"none"},closeCard:function(){this.hide()},onClose:function(){this.reset()}}),ws.panels.TaskPanelUtil={IsDateInPast:function(a){return a<new Date},IsValidDate:function(a,e){var b=!0;a!=null&&a.length>0&&(b=null!=ws.date.ParseDateFromFormat(a,
e));return b},ValidateDate:function(a,e,b,g,h){var j=!1,k=!1,l={},a=ws.date.ParseDateFromFormat(a,g);null!=a&&(j=!0,null!==e&&a.setHours(e,b),k=a<h);l.isValidDate=j;l.isDateInPast=k;l.oDate=a;return l},GetLeadTimeInMinutesHelper:function(a){var e=0;switch(a){case "Default":e=0;break;case "OneDayBefore":e=1440;break;case "TwoDaysBefore":e=2880;break;case "OneWeekBefore":e=10080;break;case "OnThisDate":e=0;break;default:e=0}return e},GetLeadTimeInMinutes:function(a,e){var b=0;switch(a){case "Default":b=
0;break;case "OneDayBefore":b=1440;break;case "TwoDaysBefore":b=2880;break;case "OneWeekBefore":b=10080;break;case "OnThisDate":if(e){var b=ws.date.ParseDateFromFormat(e.remDate,Config.Strings.CalDateParseFormat),g=ws.date.ParseHourMinTextField(e.time,e.timeFmt,e.shortTimeFmt);g==null?b=Config.Strings.Calendar_AddEvent_InvalidTimeCustomRemind:(b.setHours(g.hr,g.min),b=this._getLeadTime(b,e.taskDate))}break;default:b=0}return b},_getLeadTime:function(a,e){var b=e.getTime()-a.getTime();return b>0?Math.round(b/
1E3/60):Config.Strings.Calendar_AddEvent_ReminderAfterEvent},BuildTimeMenuItems:function(){for(var a=[],e,b=Config.Strings.CalTimeFormatRange1,g=new Date,h=0;h<24;h++)g.setHours(h,0),e=ws.date.formatDateTime(g,b),a.push({display:e,selected:null,value:h});return a},GetTodoStatus:function(a){switch(a){case 0:return"Unknown";case 1:return"Draft";case 2:return"Completed";case 3:return"Cancelled";case 4:return"Assigned";case 5:return"In_Progress";case 6:return"Not_Started";default:return"In_Progress"}},
GetLeadTimeMenuOption:function(a){switch(a){case 0:return 0;case 1440:return 1;case 2880:return 2;case 10080:return 3;default:return 4}},GetReminderEndDate:function(a,e,b,g){a=ws.date.add(e,ws.date.dateParts.MINUTE,-1*a);e={};e.date=ws.date.formatDateTime(a,b);e.time=ws.date.formatDateTime(a,g);return e}};b._hasResource["ws.calendar.TodoApp"]||(b._hasResource["ws.calendar.TodoApp"]=!0,b.provide("ws.calendar.TodoApp"),b.declare("ws.calendar.TodoApp",[k._Widget,k._Templated],{templateString:b.cache("ws.calendar",
"TodoApp.html",'<div class="appNode appTodo">\r\n\t<div dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget" class="layoutWidget">\r\n\t\t<div class="appTitleBar" dojoType="ws.widget.Pane" layoutAlign="top">\r\n\t\t\t<div class="appTitleLink" dojoAttachPoint="appTitleLink" dojoAttachEvent="onclick: appMenu"><span class="appTitle">${Panel_TodoLabel}</span><img src="${spacer}" class="mainSprite appTitleArrow"></div>\r\n\t\t\t<ul>\r\n\t\t\t\t<li class="mainSprite appTitleClose" dojoAttachEvent="onclick: restoreApp" style="display:none;"></li>\r\n\t\t\t\t<li class="mainSprite appTitleAddTask" dojoAttachPoint="appTitleAddTask" dojoAttachEvent="onclick: quickAdd,onmouseout: onMouseOut,onmouseover: onMouseOver"></li>\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t\t<div class="newItemBox" dojoType="ws.widget.Pane" layoutAlign="top" style="display:none;">\r\n\t\t\t<div dojoType="ws.widget.DefaultTextbox" dojoAttachPoint="newTaskBox" defaultValue="${EnterTask}"></div>\r\n\t\t</div>\r\n\t\t<div class="contentNode" dojoType="ws.widget.Pane" dojoAttachPoint="contentNode" layoutAlign="client">\r\n\t\t\t<div dojoAttachPoint="appTodoEmpty" dojoType="ws.widget.Pane" layoutAlign="client" style="display:none;">\r\n\t\t\t\t<div class="appTodoEmptyMsg">${TodoAppEmpty}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class="todoNode" dojoAttachPoint="todoNode" dojoAttachEvent="onclick: onItemClick"></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\t\t\t\t\r\n\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,sortBy:"DueTime",sortDir:"Decending",dateFormat:Config.Strings.Cal_TodoPanel_DueDateFormat,numHoursShowCompleted:24,showCompleted:!1,taskList:[],quickAddMode:!1,_inited:!1,_started:!1,startup:function(){if(!this._started)this.model=new ws.calendar.CalendarViewModel({modelType:"todo"}),this.model.isAnonymous=this.isAnonymous,this.newTaskBox._onKeyUp=b.hitch(this,"addTaskKeyUp"),this._started=!0},onMouseOut:function(){b.addClass(this.appTitleAddTask,
"appTitleAddTask");this.quickAddMode||b.removeClass(this.appTitleAddTask,"appTitleAddTaskSel")},onMouseOver:function(){b.addClass(this.appTitleAddTask,"appTitleAddTaskSel")},restoreApp:function(a){b.stopEvent(a);ws.WebSuite.Navigation.restoreApp()},init:function(){if(!this._inited){this.sessionStart=(new Date).getTime();this.connect(this.model,"requestUpdate","loadData");this.connect(this.model,"modelUpdated","modelUpdated");if(Settings.ToDo_LastClearedCompleted_Timestamp)this.lastClearedTime=(new Date(parseFloat(Settings.ToDo_LastClearedCompleted_Timestamp))).getTime();
this.loadData();this._inited=!0}},loadData:function(){var a=this.model.getDefaultTaskArgs();a.sortBy=this.sortBy;a.sortDir=this.sortDir;this.model.getData(a)},onResized:function(){this.inherited(arguments);var a=b._getMarginSize(this.domNode).w;a>150&&b.query(".newItemBox .wsInput",this.domNode).style({width:a-30+"px"})},createAppMenu:function(){var a=[{caption:Config.Strings.TodoAppNew,onClick:b.hitch(this,function(){this.quickAdd()})},{separator:!0},{caption:Config.Strings.TodoAppShowAll,isCheckable:!0,
checked:!1,onClick:b.hitch(this,function(){this.showCompleted=!this.showCompleted;this.modelUpdated()})}];this.appTitleMenu=ws.widget.createMenu(a)},updateAppMenu:function(){this.appTitleMenu.getChildren()[2].setChecked(this.showCompleted)},appMenu:function(a){b.stopEvent(a);this.appTitleMenu||this.createAppMenu();this.updateAppMenu();this.appTitleMenu.open(this.appTitleLink)},modelUpdated:function(){var a=this.model.index,e=this.model.components,f=this.model.componentEnum,g=null,g=null,h=!1,j=!1;
if(a){this.taskList=[];for(var k=0;k<a.length;k++)g=a[k],componentName=g[0],g=e[componentName],h=!1,(h=ws.lang.undefinedOrNull(g[f.completed])?!0:this.showCompleted?this.lastClearedTime?g[f.completed]>=this.sessionStart&&g[f.completed].getTime()>this.lastClearedTime:!0:g[f.completed]>=this.sessionStart)&&!j&&(j=!!g[f.completed]),g[f.summary].length>48&&ws.string.summary(g[f.summary],47),h&&this.taskList.push({calId:g[f.calid],uid:g[f.id],name:g[f.summary],start:g[f.start],due:g[f.end],completed:g[f.completed],
status:g[f.status],reminder:g[f.reminderEnabled]});this.orderTaskList();this.buildDom();b.style(b.body(),"position","absolute");setTimeout(function(){b.style(b.body(),"position","")},100)}},isToday:function(a){var e=new Date;return e.getYear()==a.getYear()&&e.getMonth()==a.getMonth()&&e.getDate()==a.getDate()},buildDom:function(){this.todoNode.innerHTML="";this.newItem=null;if(this.taskList.length==0)this.todoNode.style.display="none",this.appTodoEmpty.domNode.style.display="block";else{this.todoNode.style.display=
"block";this.appTodoEmpty.domNode.style.display="none";for(var a=0;a<this.taskList.length;a++){var e=this.taskList[a],f=b.create("div",{className:"taskItem",_row:""+a},this.todoNode);if(b.indexOf(this.model.newComponents,e.uid)!=-1)this.newItem=f;e.completed&&b.addClass(f,"taskComp");b.create("div",{className:"mainSprite taskCk "+(e.completed?"ckOn":"ckOff")},f);b.create("div",{className:"taskName",innerHTML:e.name},f);if(e.due){var g=b.create("div",{className:"taskDateDiv"},f);e.reminder&&b.create("div",
{className:"mainSprite taskRemind"},g);e=this.isToday(e.due)?Config.Strings.Panel_EventPanel_Today:ws.date.formatDateTime(e.due,this.dateFormat);b.create("span",{className:"taskDue",innerHTML:e},g)}b.create("div",{className:"mainSprite taskDelete"},f)}this.newItem&&setTimeout(b.hitch(this,function(){this.newItem.scrollIntoView()}),100)}},orderTaskList:function(){this.taskList.sort(function(a,e){if(a.completed&&!e.completed)return 1;if(!a.completed&&e.completed)return-1;if(a.due&&!e.due)return-1;if(e.due&&
!a.due)return 1;if(e.due&&a.due){if(a.due<e.due)return-1;if(e.due<a.due)return 1}if(a.start<e.start)return-1;if(e.start<a.start)return 1;return 0})},onClearCompleted:function(){ws.widget.OkCancelDialog.alert(Config.Strings.ClearCompletedDialog,b.hitch(this,function(a){if(a)this.lastClearedTime=(new Date).getTime(),ws.settings.saveNow({ToDo_LastClearedCompleted_Timestamp:this.lastClearedTime.toString()}),this.modelUpdated()}),!0)},onItemClick:function(a){b.stopEvent(a);var e=ws.widget.getEventTarget(a,
"taskDelete","todoNode"),f=ws.widget.getEventTarget(a,"taskCk","todoNode"),g=ws.widget.getEventTarget(a,"taskItem","todoNode");if(g)if(a=this.taskList[+b.attr(g,"_row")],e)e=this.model.getDefaultTaskArgs(),e.sortBy=this._sortBy,e.sortDir=this._sortDir,e.calid=a.calId,e.id=a.uid,e.loadCallback=b.hitch(this,function(){b.publish("WSFeedbackStart",[Config.Strings.ToDoDeleted,!0])}),this.model.deleteEvents(e);else if(f)this.markItem(g,a,!a.completed);else{if(!this.editDetailDlg)this.editDetailDlg=new ws.calendar.TodoEditDialog({model:this.model,
destroyOnClose:!1}),this.editDetailDlg.startup();this.editDetailDlg.addNote();this.editDetailDlg.addReminder();this.editDetailDlg.openPopUp(a.uid)}},markItem:function(a,e,f){var g=ws.date.formatISO8601(new Date),h=this.model.componentEnum,j=this.model.components[e.uid];e.completed=f?g:null;e.status=f?2:5;var k=this.model.getComponentArgsForTask(j);k.id=e.uid;k.calId=j[h.calid];k.completed=g;k.status=f?"Completed":"In_Progress";k.percentComplete=f?100:0;k.sortBy=this._sortBy;k.sortDir=this._sortDir;
if(e.due)k.end=ws.date.formatISO8601(j[h.end]);if(e.reminder)k.reminderEnabled=!0,k.reminderLeadTime=j[h.reminderLeadTime],k.reminderDeliveryOptions=j[h.reminderDeliveryOptions];e=b.query(".taskCk",a)[0];f?(b.addClass(a,"taskComp"),b.removeClass(e,"ckOff"),b.addClass(e,"ckOn")):(b.removeClass(a,"taskComp"),b.removeClass(e,"ckOn"),b.addClass(e,"ckOff"));k.loadCallback=b.hitch(this,function(){b.publish("WSFeedbackStart",[f?Config.Strings.ToDoMarkedCompleted:Config.Strings.ToDoMarkedIncomplete,!0])});
this.model.saveComponent(k);this.orderTaskList();this.buildDom()},quickAdd:function(a){a&&b.stopEvent(a);this.quickAddMode?(b.query(".newItemBox",this.domNode).style("display","none"),b.addClass(this.appTitleAddTask,"appTitleAddTask"),b.removeClass(this.appTitleAddTask,"appTitleAddTaskSel")):(b.query(".newItemBox",this.domNode).style("display","block"),b.addClass(this.appTitleAddTask,"appTitleAddTaskSel"),b.removeClass(this.appTitleAddTask,"appTitleAddTask"),this.newTaskBox.textbox.focus());this.layoutWidget.layout();
this.quickAddMode=!this.quickAddMode},updateTask:function(){var a=this.newTaskBox.getValue(),a=b.trim(a);if(a!=""){var e=this.model.getDefaultTaskArgs();e.sortBy=this._sortBy;e.sortDir=this._sortDir;e.start=ws.date.formatISO8601(new Date);e.summary=a;e.end=null;e.reminderEnabled=!1;e.reminderLeadTime=0;e.start=ws.date.formatISO8601(new Date);e.loadCallback=b.hitch(this,function(){b.publish("WSFeedbackStart",[Config.Strings.ToDoCreated,!0])});this.model.saveComponent(e);this.newTaskBox.setValue("")}},
addTaskKeyUp:function(a){a.keyCode==b.keys.ENTER?(this.updateTask(),this.newTaskBox.textbox.blur()):a.keyCode==b.keys.ESCAPE&&(this.newTaskBox.setValue(""),this.newTaskBox.textbox.blur())}}));b._hasResource["ws.suite.Navigation"]||(b._hasResource["ws.suite.Navigation"]=!0,b.provide("ws.suite.Navigation"),b.declare("SearchResultsInfo",null,{constructor:function(a,e,b){this.Scope=a;this.SearchString=e;this.Label=b}}),b.declare("ws.suite.Navigation",[k._Widget,k._Templated],{templateString:b.cache("ws.suite",
"Navigation.html",'<div class="WSNavigation">\r\n\t<div dojoType="ws.widget.WSSplitContainer" dojoAttachPoint="splitContainer" sizerWidth="9" orientation="vertical" persist="false">\r\n\t\t<div dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget" class="folderPane" sizeMin="224">\r\n\t\t\t<div layoutAlign="top" dojoType="ws.widget.Pane" class="controlsPane">\r\n\t\t\t\t<ul class="controlsPaneBtns" dojoAttachPoint="controlsPaneBtns">\r\n\t\t\t\t\t<li class="cp-compose" dojoAttachEvent="onclick:composeMessage">\r\n\t\t\t\t\t\t<div class="unselectable cpBtn" dojoAttachPoint="composeBtn" dojoAttachEvent="onmouseenter:onmouseoverCP,onmouseleave:onmouseoutCP,onmousedown:onmousedownCP,onmouseup:onmouseupCP">\r\n\t\t\t\t\t\t\t<div class="icon"></div>\r\n\t\t\t\t\t\t\t<div class="label">${Email}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li class="cp-chat" dojoAttachPoint="composeIMBtn" dojoAttachEvent="onclick:composeIM">\r\n\t\t\t\t\t\t<div class="unselectable cpBtn" data-title="${NavMenuIM}" dojoAttachEvent="onmouseenter:onmouseoverCP,onmouseleave:onmouseoutCP,onmousedown:onmousedownCP,onmouseup:onmouseupCP">\r\n\t\t\t\t\t\t\t<div class="icon"></div>\r\n\t\t\t\t\t\t\t<div class="label">${IMshort}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li class="cp-sms" dojoAttachPoint="composeSMSBtn" dojoAttachEvent="onclick:composeSMS">\r\n\t\t\t\t\t\t<div class="unselectable cpBtn" data-title="${NavMenuText}" dojoAttachEvent="onmouseenter:onmouseoverCP,onmouseleave:onmouseoutCP,onmousedown:onmousedownCP,onmouseup:onmouseupCP">\r\n\t\t\t\t\t\t\t<div class="icon"></div>\r\n\t\t\t\t\t\t\t<div class="label">${Text_Message}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li class="cp-refresh" dojoAttachEvent="onclick:checkMail">\r\n\t\t\t\t\t\t<div class="unselectable cpBtn" data-title="${CheckMailButton}" dojoAttachEvent="onmouseenter:onmouseoverCP,onmouseleave:onmouseoutCP,onmousedown:onmousedownCP,onmouseup:onmouseupCP">\r\n\t\t\t\t\t\t\t<div class="icon"></div>\r\n\t\t\t\t\t\t\t<div class="label">${CheckMailButtonLabel}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t<div layoutAlign="client" dojoType="ws.widget.Pane" class="mainPane" dojoAttachPoint="mainPane">\r\n\t\t\t\t<div dojoType="ws.widget.Pane" dojoAttachPoint="searchAreaPane" class="searchPane">\r\n\t\t\t\t\t<div class="searchInputDiv" dojoAttachPoint="searchArea">\r\n\t\t\t\t\t\t<div class="wsTinyArrow" dojoAttachPoint="searchDropDown" dojoAttachEvent="onclick: openSearchMenu"></div>\r\n\t\t\t\t\t\t<input class="wsInput searchInput" type="text" dojoAttachPoint="searchField" dojoAttachEvent="onkeyup: onKeyPressSearchField" />\r\n\t\t\t\t\t\t<div class="goSearch" dojoAttachPoint="searchBtn" dojoAttachEvent="onclick: searchApp"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div dojoAttachPoint="todayItemCntr" class="todayItemCntr">\r\n\t\t\t\t\t<div dojoAttachPoint="todayItem" class="navItem navItemToday">\r\n\t\t\t\t\t\t<div class="icon iconTodayOnAOL"></div>\r\n\t\t\t\t\t\t<div class="text">${TodayOnAOL}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t<\!-- Mail --\>\r\n\t\t\t\t<div dojoAttachPoint="sysFoldersNode"></div>\r\n\r\n\t\t\t\t<div class="quotaWarning" dojoAttachPoint="quotaWarningContainer" style="display: none;">\r\n\t\t\t\t\t<div class="mainSprite wsCloseBtn" dojoAttachEvent="onclick: closeQuotaWarning"></div>\r\n\t\t\t\t\t<span dojoAttachPoint="quotaWarningTextNode"></span>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<\!-- Contacts --\>\r\n\t\t\t\t<div dojoAttachPoint="contactsItem" class="navItem" dojoAttachEvent="onclick: showContacts">\r\n\t\t\t\t\t<div class="icon iconContacts"></div>\r\n\t\t\t\t\t<div class="text">${NavContacts}</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<\!-- Calendar --\>\r\n\t\t\t\t<div dojoAttachPoint="calendarItem" class="navItem">\r\n\t\t\t\t\t<div class="icon iconCalendar"></div>\r\n\t\t\t\t\t<div class="text">${NavCalendar}</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<\!-- My Folders --\>\r\n\t\t\t\t<div dojoAttachPoint="myFoldersItem" dojoAttachEvent="onclick: toggleMyFolders" class="navItem myFoldersItem">\r\n\t\t\t\t\t<div class="icon iconToggle"></div>\r\n\t\t\t\t\t<div class="text myFolderText">${NavMyFolders}</div>\r\n\t\t\t\t\t<span dojoAttachEvent="onclick: showCreateFolder" class="ctrl wsLink wsSmallAddButton" style="display:none" title="${NavAdd}"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojoAttachPoint="myFoldersContainer" style="display:none" class="myFoldersContainer">\r\n\t\t\t\t\t<div dojoAttachPoint="myFoldersNode" style="overflow:hidden"></div>\r\n\t\t\t\t\t<div dojoAttachPoint="createFolderNode" class="wsInput createFolder" style="display:none">\r\n\t\t\t\t\t\t<input type="text" dojoAttachEvent="onkeypress: onCreateFolderKeyPress" dojoAttachPoint="createFolderInput" maxlength="${folderMaxLen}" />\r\n\t\t\t\t\t\t<div dojoAttachEvent="onclick: createFolder" class="wsLargeAdd"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t</div>\r\n\t\t<div class="appsPane" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="appsPane" sizeMin="30">\r\n\t\t\t<div class="appsToolbar" layoutAlign="top" dojoType="ws.widget.Pane">\r\n\t\t\t\t<ul class="apBtns">\r\n\t\t\t\t\t<li class="ap-aim" dojoAttachPoint="apAimBtn" dojoAttachEvent="onclick:selectAimApp">\r\n\t\t\t\t\t\t<div class="apBtn" data-title="${MiniNavTipAim}" dojoAttachEvent="onmouseenter:onmouseoverAP,onmouseleave:onmouseoutAP,onmousedown:onmousedownAP,onmouseup:onmouseupAP">\r\n\t\t\t\t\t\t\t<div class="mainSprite icon"></div>\r\n                            <div class="border"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li class="ap-contact" dojoAttachEvent="onclick:selectContactApp" dojoAttachPoint="apContactBtn">\r\n\t\t\t\t\t\t<div class="apBtn" data-title="${MiniNavTipPeople}" dojoAttachEvent="onmouseenter:onmouseoverAP,onmouseleave:onmouseoutAP,onmousedown:onmousedownAP,onmouseup:onmouseupAP">\r\n\t\t\t\t\t\t\t<div class="mainSprite icon"></div>\r\n                            <div class="border"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li class="ap-event" dojoAttachPoint="apEventBtn" dojoAttachEvent="onclick:selectEventApp">\r\n\t\t\t\t\t\t<div class="apBtn" data-title="${MiniNavTipEvents}" dojoAttachEvent="onmouseenter:onmouseoverAP,onmouseleave:onmouseoutAP,onmousedown:onmousedownAP,onmouseup:onmouseupAP">\r\n\t\t\t\t\t\t\t<div class="mainSprite icon"></div>\r\n                            <div class="border"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li class="ap-todo" dojoAttachPoint="apTodoBtn" dojoAttachEvent="onclick:selectTodoApp">\r\n\t\t\t\t\t\t<div class="apBtn" data-title="${MiniNavTipTodos}" dojoAttachEvent="onmouseenter:onmouseoverAP,onmouseleave:onmouseoutAP,onmousedown:onmousedownAP,onmouseup:onmouseupAP">\r\n\t\t\t\t\t\t\t<div class="mainSprite icon"></div>\r\n                            <div class="border"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t\t<div class="appStack" dojoAttachPoint="appStack" layoutAlign="client" dojoType="dijit.layout.StackContainer">\r\n\t\t\t\t<div id="aimApp" class="appAim" dojoType="dijit.layout.LayoutContainer">\r\n\t\t\t\t\t<div class="appNode" dojoType="ws.widget.Pane" layoutAlign="top">\r\n\t\t\t\t\t\t<div class="appTitleBar">\r\n\t\t\t\t\t\t\t<img class="mainSprite AIMTitleLogo" src="${spacer}">\r\n\t\t\t\t\t\t\t<div dojoType="ws.widget.DropDownButton" dojoAttachPoint="presenceDisplay" class="presence" style="display: none;">\r\n\t\t\t\t\t\t\t\t<div id="presenceIcon" class="status-online"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t<li class="mainSprite appTitleClose" dojoAttachEvent="onclick:restoreApp" style="display:none"></li>\r\n\t\t\t\t\t\t\t\t<li class="mainSprite appTitleSearch" dojoAttachPoint="aimSearchBtn" dojoAttachEvent="onclick: searchAIM,onmouseout: onAimMouseOut,onmouseover: onAimMouseOver" ></li>\r\n\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\t\t\t\t\r\n\t\t\t\t\t<div class="aimSignIn" dojoType="ws.widget.Pane" dojoAttachPoint="aimSignIn" layoutAlign="client">\r\n\t\t\t\t\t\t<div dojoType="ws.widget.Button" dojoAttachPoint="aimSignInBtn" dojoAttachEvent="onClick:AIMSignIn" toolbarPosition="center">${Label_Signin}</div>\r\n\t\t\t\t\t\t<div class="fbPromo">\r\n\t\t\t\t\t\t\t<div class="mainSprite fbIcon"></div>\r\n\t\t\t\t\t\t\t<div class="fbMsg">${AimAppFBPromoMsg}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class="aimErrorNode" dojoAttachPoint="aimErrorNode" style="display:none">\r\n\t\t\t\t\t\t\t<div class="mainSprite errorIcon"></div>\r\n\t\t\t\t\t\t\t<div class="errorMsg" dojoAttachPoint="aimErrorMsg"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class="aimLoading" dojoType="ws.widget.Pane" dojoAttachPoint="aimLoading" layoutAlign="client">\r\n\t\t\t\t\t\t<div class="aimSpinner" dojoAttachPoint="aimSpinner"></div>\r\n\t\t\t\t\t\t<div class="aimLoadingMsg">${AimAppLoading}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div id="contactApp" dojoType="ws.address.PeopleApp"></div>\r\n\t\t\t\t<div id="eventApp" dojoType="ws.calendar.EventsApp"></div>\r\n\t\t\t\t<div id="todoApp" dojoType="ws.calendar.TodoApp"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div class="navToolbar" dojoAttachPoint="navToolbar">\r\n\t\t<div class="cpNavItem" dojoAttachEvent="onclick:composeMessage,onmouseenter:onmouseoverMNC,onmouseleave:onmouseoutMNC">\r\n\t\t\t<div class="icon cp-compose"></div>\r\n\t\t\t<div class="label">${Email}</div>\r\n\t\t</div>\r\n\t\t<div class="mnScrollCont" dojoAttachPoint="mnScrollCont">\r\n\t\t\t<div class="mnScroller" dojoAttachPoint="mnMailDiv">\r\n\t\t\t\t<div class="shNavItem" dojoAttachPoint="shNavItem" data-title="${MiniNavTipSearch}" dojoAttachEvent="onclick:miniNavSearch,onmouseenter:onmouseoverMNS,onmouseleave:onmouseoutMNS">\r\n\t\t\t\t\t<div class="icon iconSearch"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="navItem mnToday" dojoAttachPoint="mnToday" data-title="${MiniNavTipToday}" dojoAttachEvent="onmouseenter:onmouseoverMN,onmouseleave:onmouseoutMN">\r\n\t\t\t\t\t<div class="icon iconTodayOnAOL"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="mnSysFolders" dojoAttachPoint="mnSysFolders"></div>\r\n\t\t\t\t<div class="navItem mnContacts" dojoAttachPoint="mnContacts" data-title="${MiniNavTipContacts}" dojoAttachEvent="onmouseenter:onmouseoverMN,onmouseleave:onmouseoutMN">\r\n\t\t\t\t\t<div class="icon iconContacts"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="navItem mnCalendar" dojoAttachPoint="mnCalendar" data-title="${MiniNavTipCalendar}" dojoAttachEvent="onmouseenter:onmouseoverMN,onmouseleave:onmouseoutMN">\r\n\t\t\t\t\t<div class="icon iconCalendar"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="navItem mnFolders" dojoAttachPoint="mnFolders" data-title="${MiniNavTipFolders}" dojoAttachEvent="onmouseenter:onmouseoverMN,onmouseleave:onmouseoutMN">\r\n\t\t\t\t\t<div class="icon iconPersonal"></div>\r\n\t\t\t\t\t<div class="mnUnseen" style="display:none"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class="mnAppsDiv" dojoAttachPoint="mnAppsDiv">\r\n\t\t\t\t<div class="mnSeparator"></div>\r\n\t\t\t\t<div class="navItem aimApp" data-title="${MiniNavTipAim}" dojoAttachEvent="onmouseenter:onmouseoverMN,onmouseleave:onmouseoutMN">\r\n\t\t\t\t\t<div class="icon iconAIM"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="navItem contactApp" data-title="${MiniNavTipPeople}" dojoAttachEvent="onmouseenter:onmouseoverMN,onmouseleave:onmouseoutMN">\r\n\t\t\t\t\t<div class="icon iconPeople"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="navItem eventApp" data-title="${MiniNavTipEvents}" dojoAttachEvent="onmouseenter:onmouseoverMN,onmouseleave:onmouseoutMN">\r\n\t\t\t\t\t<div class="icon iconEvents"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="navItem todoApp" data-title="${MiniNavTipTodos}" dojoAttachEvent="onmouseenter:onmouseoverMN,onmouseleave:onmouseoutMN">\r\n\t\t\t\t\t<div class="icon iconToDos"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class="mnScUp" dojoAttachEvent="onmousedown:onmnScrollUp,onmouseup:onmnScrollEnd"><div class="mainSprite mnScrollUp"></div></div>\r\n\t\t<div class="mnScDn" dojoAttachEvent="onmousedown:onmnScrollDn,onmouseup:onmnScrollEnd"><div class="mainSprite mnScrollDn"></div></div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,searchScope:"alltext",searchFieldColor:"#000",AOLQuotaMailboxSwitched:!Settings.ViewNewOld,SEARCH_QUERY_SAVE_LIMIT:5,APP_MAIL:0,APP_CALENDAR:1,APP_CONTACTS:2,APP_TODAY:3,APP_SETTINGS:5,APP_ADDCALENDAR:6,APP_EDITCALENDAR:7,APP_TODOS:8,DRAGTYPES_MAIL:[],DRAGTYPES_CALENDAR:[0,1,2],DRAGTYPES_CONTACTS:[],FOLDERS_NO_COUNT:{Sent:!0,IM:!0,OldMail:!0,Deleted:!0},FOLDERS_NO_BOLD:{Sent:!0,IM:!0,OldMail:!0,Deleted:!0},folderMaxLen:ws.mail.folderName.MaxLength,
recentSearch:null,spinner:null,aimAutoStart:!1,aimStart:!1,scrollBarWidth:0,isMini:!1,oldNavWidth:180,miniSearchDat:{oldSi:null,app:null},navCollapserHidden:!1,startup:function(){this.aim=this.selectedApp=null;this.folderNodes={};this.mnFolderNodes={};this.accountNodes={};this.dropTargets={};this.disableHover=!1;this.showCalendarIndexCB=null;this.navItemHeight=b._getMarginSize(this.myFoldersItem).h;var a="";if(!Settings.EnableAIMPanel)this.composeIMBtn.style.display="none",a="three";if(!Settings.EnableAIMPanel||
!Settings.ShowMobileIcon)this.composeSMSBtn.style.display="none",a=a==""?"three":"two";a&&b.addClass(this.controlsPaneBtns,a);b.subscribe("WSDeferredInit",b.hitch(this,function(){ws.bubbleConfig.showPinBubble("NewImTextBtns",this.controlsPaneBtns,!0);ws.bubbleConfig.showPinBubble("MiniNavNub",null,!0);ws.bubbleConfig.showPinBubble("MiniMods",null,!0)}));a="<span>("+(b.isMac?Config.Strings.OptKey:Config.Strings.AltKey)+" "+Config.Strings.KeyWriteMail+")</span>";b.attr(this.composeBtn,"data-title",
ws.string.substituteParams(Config.Strings.NavWriteMailTip,a));b.attr(b.query(".cpNavItem",this.navToolbar)[0],"data-title",ws.string.substituteParams(Config.Strings.NavWriteMailTip,a));ws.html.setShowing(this.todayItemCntr,Config.EnableTodayCurtain);ws.html.setShowing(this.mnToday,Config.EnableTodayCurtain);b.connect(this.todayItem,"onclick",b.hitch(this,"selectApp",this.APP_TODAY));b.connect(this.calendarItem,"onclick",b.hitch(this,"selectApp",this.APP_CALENDAR));b.connect(this.calendarItem,"onmouseover",
b.hitch(this,"onMouseOverItem",this.calendarItem));b.connect(this.calendarItem,"onmouseout",b.hitch(this,"onMouseOutItem",this.calendarItem));b.connect(this.contactsItem,"onclick",b.hitch(this,"displayContactListView",this.APP_CONTACTS));b.connect(this.contactsItem,"onmouseover",b.hitch(this,"onMouseOverItem",this.contactsItem));b.connect(this.contactsItem,"onmouseout",b.hitch(this,"onMouseOutItem",this.contactsItem));b.connect(this.myFoldersItem,"onmouseover",b.hitch(this,"onMouseOverItem",this.myFoldersItem));
b.connect(this.myFoldersItem,"onmouseout",b.hitch(this,"onMouseOutItem",this.myFoldersItem));b.connect(this.todayItem,"onmouseover",b.hitch(this,"onMouseOverItem",this.todayItem));b.connect(this.todayItem,"onmouseout",b.hitch(this,"onMouseOutItem",this.todayItem));b.query(".navCollapser").connect("onclick",b.hitch(this,"toggleNav"));b.query(".navCollapser").connect("onmouseover",b.hitch(this,"onMouseOverNC"));b.query(".navCollapser").connect("onmouseout",b.hitch(this,"onMouseOutNC"));b.subscribe("/dnd/start",
this,function(){this.disableHover=!0});b.subscribe("/dnd/drop",this,function(){this.disableHover=!1});b.subscribe("/dnd/cancel",this,function(){this.disableHover=!1});b.subscribe("dragStart",this,function(a){if(a&&a.source&&a.source.type=="message")this.dragMessageStarted=this.disableHover=!0});b.subscribe("dragEnd",this,function(a){if(a&&a.source&&a.source.type=="message")this.disableHover=!1,window.clearTimeout(this.autoScrollTO),this.dragMessageStarted=this.autoScrollStarted=!1});b.subscribe("ws_view-selectChild",
this,"hiliteCurrentApp");if(!Settings.EnableAIMPanel||ws.UserContext.ParentalControls=="K"||ws.UserContext.ParentalControls=="Y")b.query(".navToolbar .aimApp",this.domNode).style("display","none"),b.query(".appsToolbar",this.appsPane.domNode).addClass("noAimApp"),this.apAimBtn.style.display="none";else{if(Settings.ChatAutoSignOn=="True")b.subscribe("WSDeferredInit",this,"AIMSignIn"),this.aimAutoStart=!0;b.subscribe("aimSignIn",this,"AIMSignIn");b.subscribe("aimError",this,"AIMError")}this.defineMenus();
Settings.FoldersVisible&&!(ws.browser.win2k&&b.isIE==6)&&setTimeout(b.hitch(this,"showMyFolders",!0,!0),0);b.connect(this.searchField,"onfocus",this,"onFocusSearchField");b.connect(this.searchField,"onblur",this,"onBlurSearchField");b.subscribe("SendConf/show",b.hitch(this,"updateNavCollapser",!1));b.subscribe("SendConf/hide",b.hitch(this,"updateNavCollapser",!0));b.subscribe("Settings/show",this,"onSettingsShow");b.subscribe("Settings/hide",this,"onSettingsHide");this.decodeRecentSearchSetting();
this.scrollBarWidth=ws.WebSuite.scrollbarWidth;this.subscribe("ListSpacingResize","resize");this.subscribe("toolbarLayoutUpdate","resize");this.splitContainer.addSizerFunc(b.hitch(this,"splitSizer"));this.splitContainer.addClickFunc(b.hitch(this,"splitClick"));this.connect(this.appsPane,"layout","appPaneResize");this.aimLoading.hide();this.initMiniNav();Settings.MiniNavMode&&setTimeout(b.hitch(this,"toggleNav"),0);this.subscribe("WebSuite/CloseNotification","notificationClosed")},appPaneResize:function(){var a=
Math.floor(b._getMarginSize(this.appsPane.domNode).h);if(a!=0&&this.appsPane.isShowing()){var e=1,e=a<=30?0:a<=230?1:a-30;e==0?(b.query(".appCurr",this.apBtns).removeClass("appCurr"),b.query(".dijitSplitContainerSizerV .thumb",this.domNode).addClass("openThumb")):(this.selectAppById(this.currentApp,!0),b.query(".dijitSplitContainerSizerV .thumb",this.domNode).removeClass("openThumb"));if(e!=Settings.NavAppPaneSize)Settings.NavAppPaneSize=e,this.appResizeTimer&&clearTimeout(this.appResizeTimer),this.appResizeTimer=
setTimeout(b.hitch(this,"_appPaneResize",e),2E3)}},_appPaneResize:function(a){ws.settings.saveSoon({NavAppPaneSize:Math.floor(a)})},splitSizer:function(a,e){var b=this.coords.h,g=b-30-9,b=b-230-9;Settings.NavAppPaneSize==0?e<190?e=190:e>g-20?e=g:e>b&&(e=b):e<190?e=190:e>b+20?e=g:e>b&&(e=b);return e},splitClick:function(){Settings.NavAppPaneSize==0?this.showAppPane():this.hideAppPane()},resizeNavItem:function(){if(b.isIE==6){var a=b.contentBox(this.domNode).w-20;a<0&&(a=0);b.marginBox(this.myFoldersNode,
{w:a});b.marginBox(this.myCalendarsNode,{w:a});b.marginBox(this.subCalendarsNode,{w:a})}},initMiniNav:function(){b.query(".mnToday",this.navToolbar).connect("onclick",b.hitch(this,"selectApp",this.APP_TODAY));b.query(".mnFolders",this.navToolbar).connect("onclick",this,"flyoutFolders");b.query(".contactApp",this.navToolbar).connect("onclick",b.hitch(this,"flyoutApp","contactApp"));b.query(".eventApp",this.navToolbar).connect("onclick",b.hitch(this,"flyoutApp","eventApp"));b.query(".aimApp",this.navToolbar).connect("onclick",
b.hitch(this,"flyoutApp","aimApp"));b.query(".todoApp",this.navToolbar).connect("onclick",b.hitch(this,"flyoutApp","todoApp"));b.query(".mnScrollCont",this.navToolbar).connect("onmouseover",b.hitch(this,"onMouseOverMn"));b.query(".mnScrollCont",this.navToolbar).connect("onmouseout",b.hitch(this,"onMouseOutMn"));b.query(".mnScUp",this.navToolbar).connect("onmouseover",b.hitch(this,"onMouseOverMn"));b.query(".mnScUp",this.navToolbar).connect("onmouseout",b.hitch(this,"onMouseOutMn"));b.query(".mnScDn",
this.navToolbar).connect("onmouseover",b.hitch(this,"onMouseOverMn"));b.query(".mnScDn",this.navToolbar).connect("onmouseout",b.hitch(this,"onMouseOutMn"));b.query("#contactApp .appTitleBar",this.appStack.domNode).connect("onmouseover",b.hitch(this,"onMouseOverAT"));b.query("#contactApp .appTitleBar",this.appStack.domNode).connect("onmouseout",b.hitch(this,"onMouseOutAT"));b.query("#eventApp .appTitleBar",this.appStack.domNode).connect("onmouseover",b.hitch(this,"onMouseOverAT"));b.query("#eventApp .appTitleBar",
this.appStack.domNode).connect("onmouseout",b.hitch(this,"onMouseOutAT"));b.connect(this.mnContacts,"onclick",b.hitch(this,"displayContactListView",this.APP_CONTACTS));b.connect(this.mnCalendar,"onclick",b.hitch(this,"selectApp",this.APP_CALENDAR));this.mnSearch=b.create("div",{className:"mnSearch"},b.body());var a=b.create("div",{className:"searchInputDiv"},this.mnSearch);this.mnSearchField=b.create("input",{className:"wsInput searchInput",type:"text"},a);b.connect(this.mnSearchField,"onkeyup",this,
"onKeyPressSearchField");a=b.create("div",{className:"mainSprite wsTinyArrow"},this.mnSearch);b.connect(a,"onclick",this,"openSearchMenu");a=b.create("div",{className:"mainSprite mnSearchGo"},this.mnSearch);b.connect(a,"onclick",this,"mnSearchGo");b.connect(this.mnSearchField,"onfocus",this,"onFocusSearchField");b.connect(this.mnSearchField,"onblur",this,"onBlurSearchField");(a=b.isIE||b.isWebKit?b.body():b.doc)&&b.connect(a,"onmousedown",this,"onDocumentMouseDown");this.connect(this.navToolbar,b.isFF?
"DOMMouseScroll":"onmousewheel",this.mnHandleWheel)},toggleNav:function(){if(k.byId("ws_navsplitter")){var a=ws.WebSuite.getCurrentViewId(),e=k.byId(a),f=e?e.searchInfoPane:null;a=="calendarView"&&e.selectedViewId==e.VIEW_UPCOMING&&(e=e.views[e.VIEW_UPCOMING]);if(this.isMini){if(this.isMini=!1,a=this.mnSearchField.value,this.restoreApp(),this.mnSearchClose(),b.style(this.navToolbar,"display","none"),b.style(this.splitContainer.domNode,"display","block"),b.style(this.domNode,"width",this.oldNavWidth+
"px"),b.query("#navCollapser div").removeClass("iconExpand").addClass("iconCollapse"),ws.settings.saveSoon({MiniNavMode:!1}),Settings.MiniNavMode=!1,e&&f&&f.isShowing())this.searchActive(!1,f),this.searchField.focus(),this.searchField.value=a}else this.isMini=!0,a=this.searchField.value,this.oldNavWidth=b._getMarginSize(this.domNode).w,b.style(this.navToolbar,"display","block"),b.style(this.splitContainer.domNode,"display","none"),b.style(this.domNode,"width","42px"),b.query("#navCollapser div").removeClass("iconCollapse").addClass("iconExpand"),
ws.settings.saveSoon({MiniNavMode:!0}),Settings.MiniNavMode=!0,e&&f&&f.isShowing()?(this.searchActive(!0,f),this.mnSearchField.value=a):this.searchActive(!1);this.onResized();ws.WebSuite.resize();this.resetMnScroll();this.searchAreaPane.domNode.scrollIntoView();if(b.isFF||b.isWebKit)b.style(b.body(),"position","absolute"),setTimeout(function(){b.style(b.body(),"position","")},100)}},onDocumentMouseDown:function(a){if(this.isMini){var e=ws.WebSuite.getCurrentViewId(),b=k.byId(e),g=this.searchMenu&&
this.searchMenu.domNode&&ws.html.overElement(this.searchMenu.domNode,a),h=b&&b.searchInfoPane&&b.searchInfoPane.isShowing();e=="calendarView"&&b&&b.selectedViewId==b.VIEW_UPCOMING&&(h=b.views[b.VIEW_UPCOMING].searchInfoPane.isShowing());if(ws.html.overElement(this.mnSearch,a)||ws.html.overElement(this.shNavItem,a)||g||h)return;a=this.mnSearchField;(a.style.color==""||a.value==void 0||a.value=="")&&this.mnSearchClose()}ws.widget.hideInstatip()},onMouseOverNC:function(){var a=b.byId("navCollapser");
a&&ws.widget.showInstatip(a,{side:"bottom",label:this.isMini?Config.Strings.MiniNavExpand:Config.Strings.MiniNavCollapse})},onMouseOutNC:function(){var a=b.byId("navCollapser");a&&ws.widget.hideInstatip(a)},onMouseOverMn:function(){var a=b.query(".mnScrollCont",this.navToolbar)[0];a.scrollHeight>a.clientHeight&&(b.query(".mnScUp",this.navToolbar).style("display","block"),b.query(".mnScDn",this.navToolbar).style("display","block"))},onMouseOutMn:function(){var a=b.query(".mnScrollCont",this.navToolbar)[0];
a.scrollHeight>a.clientHeight&&(b.query(".mnScUp",this.navToolbar).style("display",""),b.query(".mnScDn",this.navToolbar).style("display",""))},onmnScrollUp:function(a){var e=this;b.hasClass(this.mnSearch,"mnSearchActive")||this.mnSearchClose();this.closeFlyout();b.stopEvent(a);if(this.mnScrollInt)this.onmnScrollEnd();this.mnScrollInt=setInterval(function(){var a=b.query(".mnScrollCont")[0];a.scrollTop-=10;a.className=a.className;e.positionConnector();e.positionFolderConnector(e.mnFolders,e.flyoutConnector)},
50)},onmnScrollDn:function(a){var e=this;b.hasClass(this.mnSearch,"mnSearchActive")||this.mnSearchClose();this.closeFlyout();b.stopEvent(a);if(this.mnScrollInt)this.onmnScrollEnd();this.mnScrollInt=setInterval(function(){var a=b.query(".mnScrollCont")[0];a.scrollTop+=10;a.className=a.className;e.positionConnector();e.positionFolderConnector(e.mnFolders,e.flyoutConnector)},50)},onmnScrollEnd:function(){clearInterval(this.mnScrollInt);this.mnScrollInt=null},closeFlyout:function(){if(this.flyout)this.flyout.style.display=
"none",b.query(".navAppCurr",this.domNode).removeClass("navAppCurr")},mnHandleWheel:function(a){b.hasClass(this.mnSearch,"mnSearchActive")||this.mnSearchClose();this.closeFlyout();if(!a)a=window.event;b.stopEvent(a);b.isFF?a.axis==a.VERTICAL_AXIS&&(b.query(".mnScrollCont",this.navToolbar)[0].scrollTop+=a.detail/3*20):b.query(".mnScrollCont",this.navToolbar)[0].scrollTop+=a.wheelDelta/120*-20;this.positionFolderConnector(this.mnFolders,this.flyoutConnector)},resetMnScroll:function(){b.query(".mnScrollCont")[0].scrollTop=
0},addMNFolder:function(a,e,f){var e=b.attr(a,"theFN"),g=this.mailModel.getFolderByName(e),h="";if(g){var j=Config.ShowFolderMessageCount&&!this.FOLDERS_NO_COUNT[g.type],k=g.type=="Drafts"?g.count:g.unseenCount,h=ws.string.escapeXml(g.displayName),h=h.replace(/ /gm,"&nbsp;"),f=b.create("div",{className:"navItem"},f.myNode);b.attr(f,"data-title",h);b.create("div",{className:a.className},f);j&&k>0&&b.create("div",{className:"mnUnseen",innerHTML:k>99?"99+":k,theCount:k},f);b.connect(f,"onclick",b.hitch(this,
"displayFolder",e,ws.UserContext.ActiveScreenName));b.connect(f,"onmouseenter",b.hitch(this,"onmouseoverMN",{target:f},"navItem","mnSysFolders"));b.connect(f,"onmouseleave",b.hitch(this,"onmouseoutMN",{target:f},"navItem","mnSysFolders"));this.mnFolderNodes[e]=f}},addMNMyFolder:function(a,e,f){a=b.attr(a,"theFN");(e=this.mailModel.getFolderByName(a))&&Config.ShowFolderMessageCount&&e.unseenCount>0&&(this.showMNFoldersUnseen+=e.unseenCount);this.mnFolderNodes[a]=f.myNode},updateMiniNavFolders:function(){var a=
b.query(".mnScrollCont")[0].scrollTop;this.mnFolderNodes={};this.showMNFoldersUnseen=0;this.mnSysFolders.innerHTML="";var e=b.query(".navItem .icon",this.sysFoldersNode);e.myNode=this.mnSysFolders;e.forEach(this.addMNFolder,this);e=b.query(".navItem .icon",this.myFoldersNode);e.myNode=this.mnFolders;e.forEach(this.addMNMyFolder,this);b.query(".mnUnseen",this.mnFolders).style("display",this.showMNFoldersUnseen>0?"block":"none");if(this.showMNFoldersUnseen>0)e=b.query(".mnUnseen",this.mnFolders)[0],
e.innerHTML=this.showMNFoldersUnseen>99?"99+":this.showMNFoldersUnseen,b.attr(e,"theCount",this.showMNFoldersUnseen);this.hiliteCurrentApp();setTimeout(function(){b.query(".mnScrollCont")[0].scrollTop=a},100)},mnSearchClose:function(){this.mnSearch.style.display="none";b.removeClass(this.shNavItem,"mnSearchSelected")},notificationClosed:function(){var a=b.hasClass(this.mnSearch,"mnSearchActive"),e=b.position(this.shNavItem);a&&b.marginBox(this.mnSearch,{l:e.x-2+e.w,t:e.y})},miniNavSearch:function(a){var e=
ws.WebSuite.ViewWidget.selectedChildWidget,f;ws.widget.hideInstatip();f=b.hasClass(this.mnSearch,"mnSearchActive");var g=ws.WebSuite.settingsWidget&&ws.WebSuite.settingsWidget.isShowing();if(f)b.removeClass(this.shNavItem,"mnSearchSelected");else if(this.mnSearch.style.display=="none"&&!g){this.resetMnScroll();g=b.position(this.shNavItem);f=g.y;if(e.notification&&e.notification.isShowing()&&(e=e.searchInfoPane)&&e.domNode)if(e=b.position(e.domNode),e.y)f=e.y;b.marginBox(this.mnSearch,{l:g.x-2+g.w,
t:f});this.mnSearch.style.display="block";typeof a=="boolean"&&a||b.addClass(this.shNavItem,"mnSearchSelected");this.mnSearchField.focus()}else this.mnSearchClose()},getSearchWidget:function(){return this.isMini?this.mnSearchField:this.searchField},onResized:function(){this.inherited(arguments);var a=b._getMarginSize(this.domNode),e=b._getMarginSize(this.domNode).w;if(this.isMini){if(!this.coords)return;var a=b.query(".mnScrollCont")[0].scrollTop,f=b._getMarginSize(this.mnMailDiv).h,g=b._getMarginSize(this.mnAppsDiv).h,
h=this.coords.h-40;b.marginBox(this.mnScrollCont,{h:h});this.mnScrollCont.scrollTop=0;f+g>h?b.style(this.mnAppsDiv,{position:"relative"}):b.style(this.mnAppsDiv,{position:""});b.query(".mnScrollCont")[0].scrollTop=a}else{var j=this.mainPane.domNode.scrollHeight!=this.mainPane.domNode.clientHeight?ws.WebSuite.scrollbarWidth:0,f=230;Settings.NavAppPaneSize==0?f=30:Settings.NavAppPaneSize>1&&(f=Settings.NavAppPaneSize+30);this.appsPane.sizeShare=f;this.layoutWidget.sizeShare=a.h-f-this.splitContainer.sizerWidth;
this.splitContainer.resize(a);this.searchArea.style.width=Math.max(e-30-j,0)+"px";this.searchField.style.width=Math.max(e-75-j,0)+"px";this.aimSignInBtn.sizeMyself();this.resizeAimSignin();b.query(".text span",this.sysFolderNode).forEach(function(a){var f=14;a.nextSibling&&(f=b._getMarginSize(a.nextSibling).w+10);a.style.width=Math.max(e-f-j-58,0)+"px"});b.query(".text span",this.myFoldersContainer).forEach(function(a){var f=14;a.nextSibling&&(f=b._getMarginSize(a.nextSibling).w+10);a.style.width=
Math.max(e-f-j-58,0)+"px"})}window.setTimeout(b.hitch(this,function(){this.positionConnector()}),10);b.byId("navCollapser").style.left=e+1+"px"},selectApp:function(a){if(a!=this.selectedApp){(this.selectedApp==this.APP_CALENDAR||this.selectedApp==this.APP_ADDCALENDAR||this.selectedApp==this.APP_EDITCALENDAR)&&a!=this.APP_ADDCALENDAR&&a!=this.APP_EDITCALENDAR&&a!=this.APP_TODOS&&this.showCalendar(!1);switch(a){case this.APP_CALENDAR:this.searchActive(!1);this.showCalendar(!0);break;case this.APP_CONTACTS:this.showContacts();
break;case this.APP_ADDCALENDAR:this.showAddCalendar();break;case this.APP_TODAY:this.showToday();break;case this.APP_TODOS:this.toggleTodos()}this.onResized()}},hiliteCurrentApp:function(){var a=ws.WebSuite.getCurrentViewId();if(a){var e=null,f=null,g=!1;switch(a){case "AddressList":e=this.contactsItem;f=this.mnContacts;this.selectedApp=this.APP_CONTACTS;this.hideCalendar();break;case "calendarView":e=this.calendarItem;f=this.mnCalendar;this.selectedApp=this.APP_CALENDAR;break;case "addCalendar":case "editCalendar":case "subscribeCalendar":e=
this.calendarItem;f=this.mnCalendar;this.selectedApp=this.APP_CALENDAR;break;case "todayPage":g=!0;e=this.todayItem;f=b.query(".mnToday",this.navToolbar)[0];this.selectedApp=this.APP_TODAY;this.clearSearchField();this.searchActive(!1);break;case "composeMessage":this.mnSearchClose();default:if(this.mailModel)if(this._folderListUpdated)e=this.folderNodes[this.mailModel.currentFolder],f=this.mnFolderNodes[this.mailModel.currentFolder];else if(!this.folderListChangedCB)this.folderListChangedCB=b.hitch(this,
function(){this.hiliteCurrentApp();this.folderListChangedCB=null});this.selectedApp=this.APP_MAIL;this.hideCalendar()}this.currentHiliteNode&&b.removeClass(this.currentHiliteNode,"navItemCurrent");b.query(".navItemCurrent",this.navToolbar).removeClass("navItemCurrent");this.closeFlyoutFolders();this.folderFlyout&&this.folderFlyout.style.display=="none"&&b.removeClass(this.mnFolders,"folderBtnSelected");if((a=k.byId(a))&&a.searchInfoPane&&a.searchInfoPane.isShowing())b.addClass(this.shNavItem,"navItemCurrent");
else{if(e)b.addClass(e,"navItemCurrent"),this.currentHiliteNode=e;f&&b.addClass(f,"navItemCurrent")}this.updateNavCollapser(!g)}},setMailModel:function(a){this.mailModel=a;b.connect(this.mailModel,"folderListChanged",this,"updateFolderList");b.connect(this.mailModel,"modelUpdated",this,"hiliteCurrentApp");b.connect(this.mailModel,"infoUpdated",this,"onMailInfoUpdated");b.connect(this.mailModel,"modelUpdated",b.hitch(this,"modelUpdated","mail"));b.connect(this.mailModel,"newMailReceived",this,"playNewMailSound");
b.connect(this.mailModel.activeCachedList,"newMailReceived",this,"playNewMailSound");this.updateFolderList();this.onMailInfoUpdated();this.mailModel.isLoading()||this.maybePlayYgmSound()},updateFolderList:function(){b.isIE==6&&ws.browser.win2k?setTimeout(b.hitch(this,"_updateFolderList"),0):this._updateFolderList()},_updateFolderList:function(){for(var a=ws.UserContext.ActiveScreenName,e=this.mailModel.folders,f=e?e.length:0,g=["Personal","Saved","AutoSavedRead","AutoSavedSent","SavedIMs"],h=this.sysFoldersNode,
j=this.myFoldersNode,k={},l="",o=null,n=!1,p=!1,x=!1,q=0;q<f;q++){var w=!1,s=e[q];if(s){var u=s.type,A=s.name;!x&&s.type=="Aggregated"&&(x=!0);var B=!1;Config.ShowFolderMessageCount&&(B=!0);var E=u=="Spam",F=u=="Personal"&&s.permanent==!1,z=this.folderNodes[A];if(A==Config.DeletedItemsFolderName&&this.AOLQuotaMailboxSwitched==Settings.ViewNewOld)z&&(b._destroyElement(z),z=null,delete this.folderNodes[A],delete this.dropTargets[A]),this.AOLQuotaMailboxSwitched=!Settings.ViewNewOld;if(!z){z=document.createElement("div");
z.className="navItem";b.connect(z,"onclick",b.hitch(this,"displayFolder",A,a));b.connect(z,"onmouseover",b.hitch(this,"onMouseOverItem",z));b.connect(z,"onmouseout",b.hitch(this,"onMouseOutItem",z));var C=b.indexOf(g,u)==-1?h:j;if(C==h){if(u=="AllInboxes")b.place(z,C,"first"),w=!0;else if(!Settings.HasAggregatedAccount&&(u=="Inbox"||u=="NewMail"))b.place(z,C,"first"),w=!0;else if(u=="OldMail")this.folderNodes.NewMail?b.place(z,this.folderNodes.NewMail,"after"):b.place(z,C,"first");else{if(Settings.HasAggregatedAccount&&
s.type!="Aggregated"&&!p&&x)n=document.createElement("div"),n.className="wsSeparator",C.appendChild(n),p=!0;C.appendChild(z)}n=!0}else b.place(z,C),o=z;if(Settings.HasAggregatedAccount)if(s.type=="Inbox")z.title=s.displayName;else if(s.type=="Aggregated")z.title=s.name==s.displayName?s.displayName:s.displayName+"  "+s.name;var C="",D=ws.string.escapeXml(s.displayName),D=D.replace(/ /gm,"&nbsp;"),G=Config.ImapStoreFolderDepthStartAt;if(Config.EnableIMAPFolderHierarchy){s.depth>=G&&(l=this.getParentFolder(s.name));
for(var I=Config.FolderHierarchyDelimiter,D="",H=G;H<s.depth;H++)D+=" ";for(H=G;H<s.depth;H++)D+=I;D!=""&&(G=this.getParentFolder(s.name),G!=l&&(C='<div class = "text">'+G+"</div>",l=G));D=ws.string.escapeXml(D+s.displayName);D=D.replace(/ /gm,"&nbsp;")}C+=w?'<div class="icon '+this.getFolderIconClass(s)+'" theFN="'+A+'"></div><div class="text"><span id="inboxNode">'+D+"</span>":'<div class="icon '+this.getFolderIconClass(s)+'" theFN="'+A+'"></div><div class="text"><span>'+D+"</span>";B&&(C+='<div class="unseen"></div>');
C+="</div>";z.innerHTML=C;w={type:"Mail"};w.showEdit=F;w.showEmpty=E;w.folderName=A;b.connect(z,"oncontextmenu",b.hitch(this,this.onContextMenu,w));if(F)b.create("span",{className:"ctrl wsLink iconEdit",title:Config.Strings.NavEdit,style:{display:"none"},onclick:b.hitch(this,"editFolder",A)},z);else if(E&&(E=b.create("span",{className:"ctrl wsLink iconDeleted",style:{display:"none"},title:Config.Strings.NavEmpty,onclick:b.hitch(this,"emptyFolder",A)},z),u=="Spam"||u=="Deleted"))E.title=ws.string.substituteParams(Config.Strings.NavEmptyToolTip,
s.displayName);this.folderNodes[A]=z}if(B&&!this.FOLDERS_NO_COUNT[u]){B=b.query(".unseen",z)[0];try{b._destroyElement(B)}catch(J){}B=document.createElement("div");B.className="unseen";E=u=="Drafts"?s.count:s.unseenCount;F=E>0?E:"";if(s.type=="Aggregated"&&s.status>1)B.title=Config.Strings.AggregateErrorTip,b.addClass(B,"aggError"),B.onclick=b.hitch(this,"onAggError",A,s.status);else if(E>0)B.innerHTML=""+E;b.toggleClass(z,"hasUnseen",E>0&&!this.FOLDERS_NO_BOLD[u]);z.childNodes[1].appendChild(B);if(!Settings.HasAggregatedAccount&&
(u=="Inbox"||u=="NewMail")||u=="AllInboxes")ws.browser.setWindowTitle(Config.Strings.MessageListTitle+(E>0?" ("+F+")":""))}k[A]=!0;if(!this._initSearchField)if(this._initSearchField=!0,this.mailModel.allowAllTextSearch()){if(this.searchScope="alltext",this.searchField.value=this.getSearchGhostText(Config.Strings.Mail),this.mnSearchField)this.mnSearchField.value=this.getSearchGhostText(Config.Strings.Mail)}else if(this.searchScope="subject",this.searchField.value=this.getSearchGhostText(Config.Strings.Subject),
this.mnSearchField)this.mnSearchField.value=this.getSearchGhostText(Config.Strings.Subject);this._folderListUpdated=!0}}for(s in this.folderNodes)s in k||(b._destroyElement(this.folderNodes[s]),delete this.folderNodes[s]);o&&!n&&b.window.scrollIntoView(o);this.updateMiniNavFolders();this.setupFolderDropTargets();if(this.folderListChangedCB)this.folderListChangedCB(),this.folderListChangedCB=null;this.onResized();b.isIE==7&&(b.style(this.mainPane.domNode,"overflow-y","hidden"),b.style(this.mainPane.domNode,
"overflow-y","auto"))},onAggError:function(a,e,f){if(!f)f=window.event;f.stopPropagation?f.stopPropagation():f.cancelBubble=!0;var g;if(!(e<2)){f="<div class='aggDlgTitle'>"+Config.Strings.AggregateErrorTitle+"</div>";switch(e){case 2:f+=ws.string.substituteParams(Config.Strings.AggregateErrorConn,a);f+=ws.string.substituteParams(Config.Strings.AggregateErrorAuth,a);a=Config.Strings.AggregatePhButton;g=b.hitch(this,"launchPhoenixMgmt");break;case 4:f+=ws.string.substituteParams(Config.Strings.AggregateErrorRate,
a);ws.widget.Dialogs.ok(f,g,!1);return;case 5:f+=ws.string.substituteParams(Config.Strings.AggregateErrorConn,a);ws.widget.Dialogs.ok(f,g,!1);return;default:f+=ws.string.substituteParams(Config.Strings.AggregateErrorConn,a),a=Config.Strings.AggregateRetryButton,g=b.hitch(this,"aggRetry")}ws.widget.Dialogs.show(f,[a],g,{newCancel:!0});return!1}},launchPhoenixMgmt:function(a){a==0&&ws.io.openWindow("http://"+Config.DefaultPhoenixEndPoint+"/"+Config.PhoenixMgmtUri)},aggRetry:function(a){a==1&&ws.WebSuite.checkMail()},
checkMail:function(a){ws.WebSuite.checkMail();(a.ctrlKey||a.metaKey)&&a.altKey&&b.publish("snippetViewUpdate")},composeIM:function(){ws.presence.launchIM("",!0,!1)},composeSMS:function(){ws.presence.launchIM("",!0,!0)},getFolderIconClass:function(a){return a.type=="AllInboxes"?"iconInbox":a.type=="SavedIMs"?"iconPersonal":a.type=="Aggregated"||a.type=="Inbox"&&Settings.HasAggregatedAccount?"iconL"+a.account:"icon"+a.type},getParentFolder:function(a){return a.split(Config.FolderNameSeparator)[Config.ImapStoreFolderDepthStartAt-
1]},setupFolderDropTargets:function(){ws.lang.ensureLayersLoadedSoon(b.hitch(this,function(){if(!this.myFoldersDropTarget)this.myFoldersDropTarget=new ws.dnd.NavigationDropTarget(this.myFoldersItem,["message"],this,"myFolders");var a={};b.forEach(this.mailModel.folders||[],function(e){a[e.name]=!0;this.folderNodes[e.name]&&!this.dropTargets[e.name]&&(this.dropTargets[e.name]=new ws.dnd.NavigationDropTarget(this.folderNodes[e.name],["message"],this,e.name))},this);for(var e in this.dropTargets)a[e]||
(ws.dnd.dragManager.unregisterDropTarget(this.dropTargets[e]),delete this.dropTargets[e])}))},onMailInfoUpdated:function(){var a=Settings.HasUnlimitedMailStorage?0:Math.round(100*(Settings.MailStorageUsed/Settings.MailStorageQuota));ws.html.setInnerText(this.quotaWarningTextNode,ws.string.substituteParams(Config.Strings.QuotaWarning,a));ws.html.setShowing(this.quotaWarningContainer,a>=90&&!this.closedQuotaWarning)},closeQuotaWarning:function(){this.quotaWarningContainer.style.display="none";this.closedQuotaWarning=
!0},displayFolder:function(){if(ws.WebSuite.isRecordTimingData)ws.WebSuite.messageListTimerStart=new Date;this.selectApp(this.APP_MAIL);this.hideCreateFolder()},composeMessage:function(){},showMyFolders:function(a){this.hideCreateFolder();this.toggleTwisty(a,this.myFoldersContainer);this.onResized()},toggleMyFolders:function(){var a=this.myFoldersContainer.style.display=="none";this.showMyFolders(a);ws.settings.saveSoon({FoldersVisible:a})},expandMyFolders:function(){var a=this.myFoldersContainer.style.display==
"none";a&&this.toggleMyFolders();return a},showCreateFolder:function(a){this.showMyFolders(!0);this.createFolderNode.style.display="";this.createFolderInput.value=Config.Strings.NewFolder;b.window.scrollIntoView(this.createFolderNode);ws.html.selectInputText(this.createFolderInput);a.stopPropagation()},hideCreateFolder:function(){this.createFolderNode.style.display="none"},onCreateFolderKeyPress:function(a){a.keyCode==b.keys.ENTER?this.createFolder():a.keyCode==b.keys.ESCAPE&&this.hideCreateFolder()},
createFolder:function(){this._createFolder({newName:this.createFolderInput.value,okCB:b.hitch(this,"hideCreateFolder")})},_createFolder:function(a){a&&a.newName&&this.mailModel.createFolder({newName:a.newName,dialogOkCB:b.hitch(this,function(){ws.html.selectInputText(this.createFolderInput)}),load:b.hitch(this,function(){var e=a.undo?ws.string.substituteParams(Config.Strings.FolderRestored,a.newName):Config.Strings.FolderCreated;b.publish("WSFeedbackStart",[e,!0]);a.okCB&&a.okCB()}),error:function(e){window.ws_ErrLgr&&
!e&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for mailModel.createFolder-_createFolder file:Navigation.js");ws.widget.Dialogs.ok(e?e:ws.string.substituteParams(Config.Strings.ErrorCreatingFolder,a.newName))}})},editFolder:function(a,e){this.editFolderDialog?this.editFolderDialog.show(a):(b.publish("WSFeedbackStart",[Config.Strings.Loading]),setTimeout(b.hitch(this,function(){this.createEditFolderDialog(b.hitch(this,function(){this.editFolderDialog.show(a);b.publish("WSFeedbackEnd",
[Config.Strings.Loading])}))}),0));e&&e.stopPropagation()},createEditFolderDialog:function(a){ws.lang.ensureLayersLoaded(b.hitch(this,function(){this.editFolderDialog=new ws.mail.EditFolderDialog({model:this.mailModel,undoDeleteFolderCB:b.hitch(this,"_createFolder"),undoEmptyFolderCB:b.hitch(this,"restoreMessages")});b.body().appendChild(this.editFolderDialog.domNode);this.editFolderDialog.startup();a&&a()}))},emptyFolder:function(a,e){var f=this.mailModel.getFolderByName(a);this.mailModel.getCachedListForFolder(f.name);
if(f.type!="Deleted"&&f.type!="Spam")this._emptyFolder(f,!0);else{var g=ws.string.substituteParams(Config.Strings.PermEmptyFolderConfirmation,f.displayName);ws.widget.Dialogs.okCancel(g,b.hitch(this,function(a){a&&this._emptyFolder(f)}))}e&&e.stopPropagation()},_emptyFolder:function(a,e){this.mailModel.emptyFolder({name:a.name,fetchUIDs:e,load:b.hitch(this,function(f){var g=null,h=null;if(e&&f.responseUIDs)g=f.responseUIDs;h=!Config.UseOMS&&(Config.EnableRestoreButton||Settings.ViewNewOld)?g&&g.length?
b.hitch(this,"restoreMessages",g):null:g&&g.length?b.hitch(this.mailModel,"undoMoveMessages",g,Config.DeletedItemsFolderName,a.name):null;b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.FolderEmptied,a.displayName),!0,h])}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for mailModel.emptyFolder-_emptyFolder file:Navigation.js");ws.widget.Dialogs.ok(a||Config.Strings.EmptyFolderError)}})},restoreMessages:function(a){this.mailModel.restoreMessages({uids:a,
folder:Config.DeletedItemsFolderName,load:b.hitch(this,function(){this.mailModel.refetchFolderIndex(this.mailModel.currentFolder);var e=a.length==1?Config.Strings.MessageRestored:ws.string.substituteParams(Config.Strings.MessagesRestored,a.length);b.publish("WSFeedbackStart",[e,!0])}),error:function(a){ws.widget.Dialogs.ok(a||Config.Strings.ErrorRestoring)}})},deleteFolder:function(a){var e=this.mailModel.getFolderByName(a),a=e.count==-1?"":e.count,a=Config.EnableIMAPFolderHierarchy?ws.string.substituteParams(Config.Strings.DeleteHierarchyFolderConfirmation,
e.displayName):ws.string.substituteParams(Config.Strings.DeleteFolderConfirmation,e.displayName,a);e.count==0?this._deleteFolder(e,b.hitch(this,"_createFolder",{newName:e.displayName,undo:!0})):ws.widget.Dialogs.okCancel(a,b.hitch(this,function(a){a&&this._deleteFolder(e)}))},_deleteFolder:function(a,e){this.mailModel.deleteFolder({load:b.hitch(this,function(){e?this.folderListChangedCB=b.hitch(this,function(){b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.FolderDeleted,a.displayName),
!0,e]);this.folderListChangedCB=null}):(b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.FolderDeleted,a.displayName),!0,e]),this.folderListChangedCB=null)}),name:a.name,error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for mailModel.deleteFolder-_deleteFolder file:Navigation.js");ws.widget.Dialogs.ok(a||Config.Strings.DeleteFolderError)}})},changeFolderReadState:function(a){var e=this.mailModel.getCurrentFolder().type;
e=e=="NewMail"||e=="OldMail"?(e=this.mailModel.activeCachedList.GetAllUIDs())?e.concat([]):null:this.mailModel.activeCachedList.GetAllUIDs();e&&this.mailModel.changeMessagesReadState({uids:e,read:a,error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for mailModel.changeMessagesReadState-changeFolderReadState file:Navigation.js");ws.widget.Dialogs.ok(a||Config.Strings.MarkReadError)}})},newFolder:function(a){var e=this.rightClickMenu.Mail,
f=e.getChildren()[7];if(!this.newFolderInputMenu)this.newFolderInputMenu=new ws.widget.WSInputableMenuItem({okCB:b.hitch(this,"_createFolder"),defaultValue:Config.Strings.NewFolder,originalMenuItem:f,maxlength:ws.mail.folderName.MaxLength}),e.addChild(this.newFolderInputMenu);f.hide();this.newFolderInputMenu.show();this.newFolderInputMenu.initializeText(Config.Strings.NewFolder);a&&a.stopPropagation()},maybePlayYgmSound:function(){if(!this.maybePlayYgmSound.executed){var a=this.mailModel.getFolderByName(this.mailModel.getInboxFolderName());
if(a)this.maybePlayYgmSound.executed=!0,Settings.PlaySound&&a&&a.unseenCount&&ws.sound.play(Config.BaseAffinityResourcesURL+"sounds/ygm.mp3")}},playNewMailSound:function(){Settings.PlaySound&&ws.sound.play(Config.BaseAffinityResourcesURL+"sounds/newmail.mp3")},taskViewModel:{task:{taskCount:0,taskCalId:[],taskUId:[],taskName:[],taskCompleted:[],taskDueDate:[],taskStatus:[],taskReminderEnabled:[]},taskList:[]},toggleTodos:function(){if(!this.taskView)this.taskView=new ws.panels.TaskPanel,this.taskView.startup();
this.taskView.open(this.todosItem,{TR:"BL"},[ws.widget.pointerWidth,this.todosItem.offsetHeight/2+50],"left",5)},setContactsModel:function(a){this.abModel=a;b.connect(a,"search",b.hitch(this,"modelUpdated","contacts"))},setCalendarModel:function(a){this.calendarModel=a;b.connect(a,"searchUpdated",b.hitch(this,"modelUpdated","calendar"))},showCalendar:function(a,e){if(a){var b=ws.WebSuite.theCalendarModel;b&&b.refreshSearchResult();ws.WebSuite.selectCalendarApp(e)}else e&&e()},hideCalendar:function(){this.resetSearchField()},
showAddCalendar:function(){ws.WebSuite.selectTab("addCalendar")},addCalendar:function(a){this.selectApp(this.APP_ADDCALENDAR);a.stopPropagation()},selectCalendar:function(a){a=this.calendarModel.calendars[a];if(!a[this.calendarModel.calendarEnum.selected]){var e=!1;this.showCalendarIndexCB&&(e=this.showCalendarIndexCB());a=this.calendarModel.getCalendarArgs(a,e);a.selected=!0;this.calendarModel.saveCalendar(a)}},selectThisCalendarOnly:function(a){var e=this.calendarModel.calendarEnum,b=null,g=!0,
h;for(h in this.calendarModel.calendars){var j=this.calendarModel.calendars[h];h==a?(j[e.selected]||(g=!1),b=this.calendarModel.getCalendarArgs(j,!1),b.selected=!0,b.selectThisOnly=!0):j[e.selected]&&(g=!1)}b&&!g&&this.calendarModel.saveCalendar(b)},deleteCalendar:function(a,e){var f=this.calendarModel.calendarEnum,g=this.calendarModel.calendars,h=!1;if(g&&f){var g=g[a],j=g[f.calType],h=g!=null?g[f.worldReadable]:!1;!h&&j!=2&&(h=g[f.readWriteList],h=g[f.readOnlyList]||h)}ws.widget.Dialogs.okCancel(h?
Config.Strings.ConfirmCalDeleteShared:Config.Strings.ConfirmCalDelete,b.hitch(this,function(f){f&&(b.publish("WSFeedbackStart",[Config.Strings.Loading]),this.calendarModel.deleteCalendar({id:a,displayName:e,components:!1,index:!1,enums:!1,dayBucketIndex:!1,loadCallback:function(){b.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.CalendarDeleted,e),!0])},errorCallback:function(){b.publish("WSFeedbackEnd",[Config.Strings.Loading])}}),b.publish("EditCalendar/Delete"))}))},makeCalendarPublic:function(a,
e){b.publish("WSFeedbackStart",[Config.Strings.Loading]);var f=this.calendarModel.calendars[a],g=this.calendarModel.calendarEnum,h=this.showCalendarIndexCB?this.showCalendarIndexCB():!1,h=this.calendarModel.getCalendarArgs(f,h),f=f[g.ticket],f=f!=null&&f.length>0,j=h.worldReadable&&!f;h.worldReadable=!0;if(f)h.ticket="";h.loadCallback=function(){b.publish("WSFeedbackEnd",[Config.Strings.Loading]);var f=ws.string.substituteParams(j?Config.Strings.AlreadyPublic:Config.Strings.MakePublicSuccess,e);b.publish("WSFeedbackStart",
[f,!0,function(){var b;b=Config.EnableCalendarPublicHTMLURL?ws.calendar.calutil.getPublicCalendarURL(a,null):ws.calendar.calutil.getPublicCalendarData2(a,null);var f=ws.string.substituteParams(Config.Strings.PubCalEmailSubject,e),g=ws.string.substituteParams("<a href='{0}'>{1}</a>",b,e),h=(Config.EnableCalendarPublicHTMLURL?ws.string.substituteParams(Config.Strings.PubCalEmailBody,g,ws.UserContext.ActiveScreenName)+"<small>"+ws.string.substituteParams(Config.Strings.PubCalEmailFooter,b)+"</small>":
ws.string.substituteParams(Config.Strings.PubCalEmailBody2,g,ws.UserContext.ActiveScreenName)+"<small>"+ws.string.substituteParams(Config.Strings.PubCalEmailFooter2,b)+"</small>").replace(/\\n/g,"<br>");ws.WebSuite.getCompose("calendar",function(a){a.reset({subject:f,body:h,dontAddSignature:!0,isDirty:!0})})},null,Config.Strings.ShareLink])};h.errorCallback=function(){ws.widget.Dialogs.ok(Config.Strings.CalErrorSavingCal);b.publish("WSFeedbackEnd",[Config.Strings.Loading])};this.calendarModel.saveCalendar(h)},
setCalendarColor:function(a,e){var b=this.calendarModel.calendars[a],g=this.showCalendarIndexCB?this.showCalendarIndexCB():!1,b=this.calendarModel.getCalendarArgs(b,g);b.color=e;this.calendarModel.saveCalendar(b)},showContacts:function(a){ws.WebSuite.theAddressModel?(ws.WebSuite.theAddressModel.initData(),ws.WebSuite.displayContactListView(null,a)):setTimeout(b.hitch(this,function(){ws.WebSuite.deferComplete=!0;ws.lang.ensureLayersLoadedSoon(b.hitch(this,function(){ws.WebSuite.theAddressModel.initData();
ws.WebSuite.displayContactListView(null,a)}))}))},displayContactListView:function(a){a==this.selectedApp?ws.WebSuite.displayContactListView(null,null):this.selectApp(a)},showToday:function(){ws.WebSuite.showTodayPage()},autoScroll:function(a){t=b._abs(this.mainPane.domNode,!0);var e=b._getContentBox(this.mainPane.domNode),a=a.pageY-t.y;a<36?(this.autoScrollTO=ws.lang.setTimeout(b.hitch(this,"_autoScroll",-9),100),this.autoScrollStarted=!0):e.h-a<36?(this.autoScrollTO=ws.lang.setTimeout(b.hitch(this,
"_autoScroll",9),100),this.autoScrollStarted=!0):this.autoScrollStarted=!1},_autoScroll:function(a){if(this.autoScrollStarted){var e=this.mainPane.domNode.scrollTop;ws.dnd.dragManager.onScroll();this.mainPane.domNode.scrollTop+=a;e==this.mainPane.domNode.scrollTop?this.autoScrollStarted=!1:this.autoScrollTO=ws.lang.setTimeout(b.hitch(this,"_autoScroll",a),500)}},onMouseOverItem:function(a,e){if(!this.disableHover){b.addClass(a,"navItemHover");var f=b.query(".ctrl",a);if(f.length>0)f[0].style.display=
"",b.query(".text .unseen",a).style("display","none")}ws.dnd&&ws.dnd.dragManager&&ws.dnd.dragManager._dragTriggered&&this.dragMessageStarted&&this.autoScroll(e)},onMouseOutItem:function(a){if(!this.disableHover){b.removeClass(a,"navItemHover");var e=b.query(".ctrl",a);if(e.length>0)e[0].style.display="none",b.query(".text .unseen",a).style("display","")}},onMouseOverCalItem:function(a){this.disableHover||b.query(".ctrl",a).style("display","")},onMouseOutCalItem:function(a){this.disableHover||b.query(".ctrl",
a).forEach(function(a){if(a!=this.activeQuickActionButton)a.style.display="none"},this)},handleRightClickAction:function(a,e){var f=this.rightClickMenuArgs;switch(a){case "renameFolder":this.editFolder(f.folderName);break;case "emptyFolder":this.emptyFolder(f.folderName);break;case "deleteFolder":this.deleteFolder(f.folderName);break;case "markAllUnRead":this.changeFolderReadState(!1);break;case "markAllRead":this.changeFolderReadState(!0);break;case "newFolder":this.newFolder();break;case "goToCalendar":this.selectApp(this.APP_CALENDAR);
break;case "addCalendar":this.selectApp(this.APP_ADDCALENDAR);break;case "newEvent":this.selectApp(this.APP_CALENDAR);this.displayAddCalEvent();break;case "selectThisCalendar":this.selectCalendar(f.calId);break;case "selectThisCalendarOnly":this.selectThisCalendarOnly(f.calId);break;case "shareCalendar":case "editCalendar":this.editCalendar(f.calId);break;case "deleteCalendar":this.deleteCalendar(f.calId,f.displayName);break;case "makeCalendarPublic":this.makeCalendarPublic(f.calId,f.displayName);
break;case "setCalendarColor":this.setCalendarColor(f.calId,e);break;case "goToContacts":this.displayContactListView(this.APP_CONTACTS);break;case "newContact":ws.lang.ensureLayersLoaded(b.hitch(this,function(){ws.WebSuite.displayNewContactView()}));break;case "newDistList":ws.lang.ensureLayersLoaded(b.hitch(this,function(){ws.WebSuite.displayNewDistListView()}))}this.rightClickMenuArgs=null},displayAddCalEvent:function(){ws.WebSuite.getAddEditWidget(b.hitch(this,function(a){a.show()}))},defineMenus:function(){this.rightClickMenuDefinition=
{Mail:[{caption:Config.Strings.Rename,onClick:b.hitch(this,"handleRightClickAction","renameFolder")},{caption:Config.Strings.Empty,onClick:b.hitch(this,"handleRightClickAction","emptyFolder")},{caption:Config.Strings.Delete,onClick:b.hitch(this,"handleRightClickAction","deleteFolder")},{separator:!0},{caption:"",onClick:b.hitch(this,"handleRightClickAction","markAllUnRead")},{caption:"",onClick:b.hitch(this,"handleRightClickAction","markAllRead")},{separator:!0}],Contacts:[{caption:Config.Strings.GoToContacts,
onClick:b.hitch(this,"handleRightClickAction","goToContacts")},{separator:!0},{caption:Config.Strings.NewContact,onClick:b.hitch(this,"handleRightClickAction","newContact")},{caption:Config.Strings.NewDistList,onClick:b.hitch(this,"handleRightClickAction","newDistList")}],CalendarHead:[{caption:Config.Strings.GoToCalendar,onClick:b.hitch(this,"handleRightClickAction","goToCalendar")},{separator:!0},{caption:Config.Strings.AddCalendar,onClick:b.hitch(this,"handleRightClickAction","addCalendar")},{caption:Config.Strings.NewEventBtn,
onClick:b.hitch(this,"handleRightClickAction","newEvent")}],Calendar:[{caption:Config.Strings.AddEventBtn,onClick:b.hitch(this,"handleRightClickAction","newEvent")},{caption:Config.Strings.ShowThisCalendarOnly,onClick:b.hitch(this,"handleRightClickAction","selectThisCalendarOnly")},{separator:!0},{caption:Config.Strings.Edit,onClick:b.hitch(this,"handleRightClickAction","editCalendar")},{caption:Config.Strings.ShareThisCalendar,onClick:b.hitch(this,"handleRightClickAction","shareCalendar")},{caption:Config.Strings.MakePublic,
onClick:b.hitch(this,"handleRightClickAction","makeCalendarPublic")},{caption:Config.Strings.Delete,onClick:b.hitch(this,"handleRightClickAction","deleteCalendar")},{separator:!0},{dojoType:"ws.widget.CalendarColorPickerMenuItem",onClick:b.hitch(this,"handleRightClickAction","setCalendarColor")}]}},createRightClickMenu:function(a){var e=this.rightClickMenuDefinition[a];if(!e)return null;e=this.rightClickMenu[a]=ws.widget.createMenu(e);if(a=="Mail")a=new ws.widget.WSMenuItem({caption:Config.Strings.NewFolder}),
a._onClick=b.hitch(this,"newFolder"),e.addChild(a);b.connect(e,"onClose",this,"onCloseMenu");return e},getRightClickMenu:function(a){if(!this.rightClickMenu)this.rightClickMenu={};if(!this.rightClickMenuDefinition[a])return null;var e=this.rightClickMenu[a];e||(e=this.createRightClickMenu(a));return e},updateRightClickMenu:function(a){var e=this.rightClickMenuArgs,b=Settings.ViewNewOld?Config.Strings.KeepAllAsNewLabel:Config.Strings.MarkAllUnreadLabel,g=Settings.ViewNewOld?Config.Strings.IgnoreAllLabel:
Config.Strings.MarkAllReadLabel,h=a.getChildren();if(a==this.rightClickMenu.Mail)h[4].setCaption(b),h[5].setCaption(g),h[0].setEnabled(e.showEdit),h[1].setEnabled(e.showEmpty),h[2].setEnabled(e.showEdit),this.newFolderInputMenu&&this.newFolderInputMenu.restore(),e=e.folderName==this.mailModel.currentFolder&&this.mailModel.canChangeMessageReadState(),h[4].setEnabled(e),h[5].setEnabled(e);else if(a==this.rightClickMenu.Calendar)h[0].setShowing(e.showAddEvent),h[4].setShowing(e.showShare),h[5].setShowing(e.showPublish),
h[6].setShowing(e.showDelete),a=this.calendarModel.getCalendarList(),b=this.calendarModel.calendarEnum,e=ws.lang.findByProp(a,b.id,e.calId),h[8]&&h[8].setCurrentColor(a[e][b.color])},onQuickActionMenu:function(a,e){ws.lang.ensureLayersLoaded(b.hitch(this,"_onContextMenu",a,-1,-1,e));this.activeQuickActionButton=e},onContextMenu:function(a,e){b.stopEvent(e);ws.lang.ensureLayersLoaded(b.hitch(this,"_onContextMenu",a,e.pageX,e.pageY,e.target))},_onContextMenu:function(a,e,b,g){var h=a.type,j=this.getRightClickMenu(h);
if(j)j.isShowing()&&j.close(),this.rightClickMenuArgs=a,j=this.getRightClickMenu(h),this.updateRightClickMenu(j),e>=0?j.open(e,b,g):j.open(g)},onCloseMenu:function(){if(this.activeQuickActionButton)this.activeQuickActionButton.style.display="none",this.activeQuickActionButton=null},toggleTwisty:function(a,e){b.toggleClass(this.myFoldersItem,"myFoldersItemExpanded",a);e.style.display=a?"":"none"},isRecentSearchesAvailable:function(){for(var a=0;a<this.SEARCH_QUERY_SAVE_LIMIT;a++)if(this.recentSearch!=
null&&this.recentSearch[a]!=void 0)return a;return-1},isSearchQueryUnique:function(a,e,b){for(var g=0;g<this.SEARCH_QUERY_SAVE_LIMIT;g++)if(this.recentSearch!=null&&this.recentSearch[g]!=void 0&&this.recentSearch[g].Scope==a&&this.recentSearch[g].SearchString==e&&this.recentSearch[g].Label==b)return!1;return!0},decodeRecentSearchSetting:function(){if(this.recentSearch==null)this.recentSearch=[];for(var a=Settings.RecentSearchQueries.split(","),e=0;e<a.length-1;e++){var b=a[e].split(":");newEntry=
new SearchResultsInfo(b[0],b[1],b[2]);this.recentSearch.push(newEntry)}},encodeRecentSearchSetting:function(){for(var a="",b=0;b<this.recentSearch.length;b++)a+=this.recentSearch[b].Scope+":"+this.recentSearch[b].SearchString+":"+this.recentSearch[b].Label+",";ws.settings.saveSoon({RecentSearchQueries:a})},addRecentSearch:function(a,b){var f="";if(a=="alltext")f="";else if(a=="subject")f=Config.Strings.Subject;else if(a=="fromto")f=Config.Strings.FromTo;else if(a=="calendar")f=Config.Strings.Calendar;
else if(a=="contacts")f=Config.Strings.Contacts;newEntry=new SearchResultsInfo(a,b,f);this.recentSearch==null&&this.decodeRecentSearchSetting();this.isSearchQueryUnique(a,b,f)&&(this.recentSearch.push(newEntry),this.recentSearch.length>=this.SEARCH_QUERY_SAVE_LIMIT+1&&this.recentSearch.shift());this.encodeRecentSearchSetting()},populateSearchMenuWithRecentSearches:function(){if(this.isRecentSearchesAvailable()!=-1){this.searchMenu.addChild(new ws.widget.WSMenuSeparator);this.searchMenu.addChild(new ws.widget.WSMenuItem({caption:Config.Strings.RecentSearches,
isLabel:!0}));for(var a=this.recentSearch.length-1;a>=0;a--){var e=new ws.widget.WSMenuItem({caption:"&ldquo;"+this.recentSearch[a].SearchString+"&rdquo; <span>"+this.recentSearch[a].Label+"</span>",isCheckable:!1});e.onClick=b.hitch(this,"performRecentSearch",a);this.searchMenu.addChild(e)}}},openSearchMenu:function(a){this.searchMenu&&this.searchMenu.destroy();this.searchMenu=ws.widget.createMenu([{caption:Config.Strings.Mail,onClick:b.hitch(this,"setSearchScope","alltext",Config.Strings.Mail),
iconClass:""},{caption:Config.Strings.Subject,onClick:b.hitch(this,"setSearchScope","subject",Config.Strings.Subject),iconClass:""},{caption:Config.Strings.Sender,onClick:b.hitch(this,"setSearchScope","fromto",Config.Strings.Sender),iconClass:""},{separator:!0},{caption:Config.Strings.Calendar,onClick:b.hitch(this,"setSearchScope","calendar",Config.Strings.Calendar),iconClass:""},{caption:Config.Strings.Contacts,onClick:b.hitch(this,"setSearchScope","contacts",Config.Strings.Contacts),iconClass:""}]);
b.addClass(this.searchMenu.domNode,"searchDropDownMenu");var e=this.mailModel.allowAllTextSearch();Config.UseOMS&&Config.CrossFolderSearch&&this.populateSearchMenuWithRecentSearches();var f=0;if(this.searchScope=="calendar")f=4;else if(this.searchScope=="contacts")this.searchScope="contacts",f=5;else if(this.searchScope=="alltext")this.searchScope="alltext",f=0;else if(this.searchScope=="subject")this.searchScope="subject",f=1;else if(this.searchScope=="fromto")this.searchScope="fromto",f=2;this.searchMenu.getChildren()[f].setChecked(!0);
f=this.searchMenu;if(f.isShowing())f.close();else{f.getChildren()[0].setShowing(e);e=(this.mailModel.getCurrentFolder()||{}).type;e=e=="Sent"||e=="Drafts"||e=="AutoSavedSent"||e=="SavedIMs"?Config.Strings.Recipient:Config.Strings.Sender;if(Config.UseOMS&&Config.CrossFolderSearch)e=Config.Strings.FromTo;f.getChildren()[2].setCaption(e);f.open(a.target)}},performRecentSearch:function(a){var b=Config.Strings.Mail;if(this.recentSearch[a].Scope=="alltext")b=Config.Strings.Mail;else if(this.recentSearch[a].Scope==
"subject")b=Config.Strings.Subject;else if(this.recentSearch[a].Scope=="fromto")b=Config.Strings.Sender;else if(this.recentSearch[a].Scope=="calendar")b=Config.Strings.Calendar;var f=this.getSearchWidget();f.style.color=this.searchFieldColor;this.setSearchScope(this.recentSearch[a].Scope,b);f.value=this.recentSearch[a].SearchString;f.style.color=this.searchFieldColor;this.searchApp()},setSearchScope:function(a,e){this.searchScope=a;var f=this.searchMenu;f&&b.forEach(f.getChildren(),function(a){!a.separator&&
b.isFunction(a.setChecked)&&a.setChecked(a.caption==e)});f=this.getSearchWidget();if(f.style.color==""&&this.mailModel.getSearchString()==null)f.value=this.getSearchGhostText(e)},getSearchGhostText:function(a){if(a==Config.Strings.Sender)Config.UseOMS&&Config.CrossFolderSearch?a=Config.Strings.FromTo:(a=(this.mailModel.getCurrentFolder()||{}).type,a=a=="Sent"||a=="Drafts"||a=="AutoSavedSent"?Config.Strings.Recipient:Config.Strings.Sender);return ws.string.substituteParams(Config.Strings.SearchApp,
a)},removeSpecialCharacters:function(a){if(a)return a=a.replace(/^\s+/,""),a=a.replace(/^[\+\-\<\>]/,""),!Config.UseOMS||this.searchScope=="calendar"?a.replace(/[\=()&*~`!{}^#?%$;:\[\]"]+/g,""):a.replace(/[\/_()&~`!{}^#?%$;:\[\]"\r\n]+/g,"")},searchApp:function(){var a=this.getSearchWidget();if(a.style.color==""||a.value==void 0||a.value=="")return ws.widget.Dialogs.ok(Config.Strings.SearchFieldEmpty),!1;else{a.value=this.removeSpecialCharacters(a.value);if(a.value=="")return ws.widget.Dialogs.ok(Config.Strings.SearchFieldEmpty),
!1;this.searchScope=="calendar"?this.searchCalendar(this.searchScope):this.searchScope=="contacts"?this.searchContacts():(a.style.color=this.searchFieldColor,this.searchMail(this.searchScope))}return!0},searchMail:function(a){var b=this.getSearchWidget();this.searchMailCB&&b.style.color!=""&&this.searchMailCB(a,b.value)},searchCalendar:function(a){var b=this.getSearchWidget();this.searchCalendarCB&&b.style.color!=""&&this.searchCalendarCB(a,b.value)},searchContacts:function(){var a=this.getSearchWidget();
if(this.searchContactsCB){var b=a.value;if(a.style.color==""||b.length==0)b=void 0;this.searchContactsCB(b);b||a.blur()}},onFocusSearchField:function(){var a=this.getSearchWidget();if(a.style.color=="")a.value="";a.style.color=this.searchFieldColor},clearSearchField:function(){this.getSearchWidget().value="";this.setSearchScope(this.mailModel.allowAllTextSearch()?"alltext":"subject",Config.Strings.Mail);this.resetSearchField()},clearSearch:function(){this.setSearchScope(this.mailModel.allowAllTextSearch()?
"alltext":"subject",Config.Strings.Mail)},resetSearchField:function(a){var e=a||this.getSearchWidget();if(e.value=="")if(e.style.color="",a=this.searchMenu)b.forEach(a.getChildren(),function(a){if(a.checked&&!a.disabled)e.value=this.getSearchGhostText(a.caption)},this);else if(this.searchScope=="calendar")e.value=this.getSearchGhostText(Config.Strings.Calendar);else if(this.searchScope=="contacts")e.value=this.getSearchGhostText(Config.Strings.Contacts);else{try{var f=this.mailModel.allowAllTextSearch()}catch(g){}e.value=
f?this.getSearchGhostText(Config.Strings.Mail):this.getSearchGhostText(Config.Strings.Subject)}},onBlurSearchField:function(){this.resetSearchField()},mnSearchGo:function(){this.searchApp()},onKeyPressSearchField:function(a){var e=this.getSearchWidget(),f=b.hasClass(this.mnSearch,"mnSearchActive");if(e.style.color=="")e.value="",e.style.color=this.searchFieldColor;if(a.keyCode==b.keys.ENTER)this.searchScope=="contacts"&&this.searchTimer&&clearTimeout(this.searchTimer),this.searchApp()&&b.removeClass(this.shNavItem,
"mnSearchSelected"),a.preventDefault();else if(a.keyCode==b.keys.ESCAPE)a.preventDefault(),this.isMini&&!this._oldsiNode&&!f&&this.mnSearchClose();else if(this.searchScope=="contacts")this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=null,this.searchTimer=setTimeout(b.hitch(this,function(){this.searchContacts()}),500)},modelUpdated:function(a){this.searchStrUpdated(a);if(a=="mail")this.maybePlayYgmSound();else if(a=="calendar")this.searchScope="calendar";else if(a=="contacts")this.searchScope=
"contacts"},searchStrUpdated:function(a){if(!this.mailModel.searchInProgress){var b=null;if(a=="mail"){a=ws.WebSuite.getCurrentViewId();if(a=="AddressList"||a=="calendarView")return;this.mailModel.getSearchIn()!="before"&&(b=this.mailModel.getSearchString());Config.UseOMS&&Config.CrossFolderSearch&&b!=null&&this.addRecentSearch(this.searchScope,b)}else a=="calendar"&&this.calendarModel!=null?(b=this.calendarModel.getSearchString(),Config.UseOMS&&Config.CrossFolderSearch&&b!=null&&this.addRecentSearch(this.searchScope,
b)):a=="contacts"&&(b=this.abModel.getSearchString());b==null&&(b="");this.updateSearchStr(this.searchField,b);this.updateSearchStr(this.mnSearchField,b)}},updateSearchStr:function(a,b){if(a.value!=b){a.value=b;var f=!1;a.value!=""&&(f=!0);this.resetSearchField(a);if(f)a.style.color=this.searchFieldColor}},onmouseoverMNS:function(a){this.onmouseoverMN(a,"shNavItem")},onmouseoutMNS:function(a){this.onmouseoutMN(a,"shNavItem")},onmouseoverMNC:function(a){this.onmouseoverMN(a,"cpNavItem")},onmouseoutMNC:function(a){this.onmouseoutMN(a,
"cpNavItem")},onmouseoverMN:function(a,e,f){if(e=ws.widget.getEventTarget(a,e||"navItem",f||"navToolbar")){var f=0,g=b.query(".mnUnseen",e)[0],h={side:"right"};g&&(f=+b.attr(g,"theCount"));if(f>0)h.label=b.attr(e,"data-title")+"&nbsp;("+f+")";ws.widget.showInstatip(e,h)}this.onMouseOverItem(e,a)},onmouseoutMN:function(a,b,f){(b=ws.widget.getEventTarget(a,b||"navItem",f||"navToolbar"))&&ws.widget.hideInstatip(b);this.onMouseOutItem(b,a)},onMouseOverAT:function(a){if(a=ws.widget.getEventTarget(a,"appTitleBar",
"appTitleBar")){var e=b.position(a),f=b._getMarginSize(b.query(".appTitleLink",a)[0]).w-26;e.x+=f;e.y+=9;e.w-=f;ws.widget.showInstatip(a,{side:"top",nodePosition:e})}},onMouseOutAT:function(a){(a=ws.widget.getEventTarget(a,"appTitleBar","appTitleBar"))&&ws.widget.hideInstatip(a)},onmouseoverCP:function(a){if(a=ws.widget.getEventTarget(a,"cpBtn","controlsPaneBtns"))b.addClass(a.parentNode,"cpBtnHover"),ws.widget.showInstatip(a)},onmouseoutCP:function(a){if(a=ws.widget.getEventTarget(a,"cpBtn","controlsPaneBtns"))b.removeClass(a.parentNode,
"cpBtnHover"),b.removeClass(a.parentNode,"cpBtnClick"),ws.widget.hideInstatip(a)},onmousedownCP:function(a){(a=ws.widget.getEventTarget(a,"cpBtn","controlsPaneBtns"))&&b.addClass(a.parentNode,"cpBtnClick")},onmouseupCP:function(){b.query(".cpBtnClick",this.controlsPaneBtns).removeClass("cpBtnClick")},setupPresenceMenu:function(){this.presenceDisplay.menuDefinition=[{caption:Config.Strings.BuddyStatus_Label_Available,id:"aimWimMenuItem-online",iconClass:"presMenuItem status-online",onClick:b.hitch(this,
function(){ws.im.wim.setState("online","")})},{caption:Config.Strings.BuddyStatus_Label_Away,id:"aimWimMenuItem-away",iconClass:"presMenuItem status-away",onClick:b.hitch(this,function(){ws.im.wim.setState("away","")})},{caption:Config.Strings.BuddyStatus_Label_Invisible,id:"aimWimMenuItem-invisible",iconClass:"presMenuItem status-invisible",onClick:function(){ws.im.wim.setState("invisible","")}},{separator:!0},{caption:Config.Strings.AddBuddyTitle,id:"aimWimMenuItem-addBuddy",onClick:b.hitch(this,
"addBuddy")},{caption:Config.Strings.SetStatusMenuItem,id:"aimWimMenuItem-setStatus",onClick:b.hitch(this,"setStatus")},{separator:!0},{caption:Config.Strings.Menu_SetupFB,id:"aimWimMenuItem-setupFB",iconClass:"FBserviceIcon",onClick:b.hitch(this,function(){this.aim.promoConnect()})},{caption:Config.Strings.Menu_SigninFB,id:"aimWimMenuItem-signinFB",iconClass:"FBserviceIcon",onClick:function(){ws.im.wim.setServiceConnection("facebook",!0)}},{caption:Config.Strings.Menu_SignoutFB,id:"aimWimMenuItem-signoutFB",
iconClass:"FBserviceIcon",onClick:function(){ws.im.wim.setServiceConnection("facebook",!1)}},{separator:!0},{caption:Config.Strings.Label_AutoSignOn,id:"aimWimMenuItem-auto",isCheckable:!0,checked:!0,onClick:b.hitch(this,function(){var a=Settings.ChatAutoSignOn=="True"?"False":"True";ws.settings.saveSoon({ChatAutoSignOn:a});Settings.ChatAutoSignOn=a})},{caption:Config.Strings.Menu_SignOutAIM,id:"aimWimMenuItem-signOut",onClick:function(){ws.im.wim.end();ws.reporting.reportAction("IM Sign Out")}}];
this.presenceDisplay.updateMenu=function(){this.menu.setUnchecked();var a=b.query("#aimWimMenuItem-auto td");a&&a.length==3&&(b.attr(a[1],"colSpan","2"),b.byId("aimWimMenuItem-auto").removeChild(a[0]),a=b.query("#aimWimMenuItem-signOut td"),b.attr(a[1],"colSpan","2"),b.byId("aimWimMenuItem-signOut").removeChild(a[0]),a=b.query("#aimWimMenuItem-addBuddy td"),b.attr(a[1],"colSpan","2"),b.byId("aimWimMenuItem-addBuddy").removeChild(a[0]),a=b.query("#aimWimMenuItem-setStatus td"),b.attr(a[1],"colSpan",
"2"),b.byId("aimWimMenuItem-setStatus").removeChild(a[0]));Settings.ChatAutoSignOn=="True"&&k.byId("aimWimMenuItem-auto").setChecked(!0);if(ws.im.wim.user)switch(ws.im.wim.user.state){case "online":k.byId("aimWimMenuItem-online").setChecked(!0);break;case "away":k.byId("aimWimMenuItem-away").setChecked(!0);break;case "invisible":k.byId("aimWimMenuItem-invisible").setChecked(!0)}(a=ws.im.wim.getServiceConfig("facebook"))?(b.query(".wsMenuSeparator2",this.menu.domNode)[0].style.display="",!a.associated||
a.notAuthorized?(b.byId("aimWimMenuItem-setupFB").style.display="",b.byId("aimWimMenuItem-signinFB").style.display="none",b.byId("aimWimMenuItem-signoutFB").style.display="none"):a.online?(b.byId("aimWimMenuItem-setupFB").style.display="none",b.byId("aimWimMenuItem-signinFB").style.display="none",b.byId("aimWimMenuItem-signoutFB").style.display=""):(b.byId("aimWimMenuItem-setupFB").style.display="none",b.byId("aimWimMenuItem-signinFB").style.display="",b.byId("aimWimMenuItem-signoutFB").style.display=
"none")):(b.byId("aimWimMenuItem-setupFB").style.display="none",b.byId("aimWimMenuItem-signinFB").style.display="none",b.byId("aimWimMenuItem-signoutFB").style.display="none",b.query(".wsMenuSeparator2",this.menu.domNode)[0].style.display="none")}},updateUserPresence:function(a){var e=a.state;a.invisible&&(e="invisible");a=b.byId("presenceIcon");switch(e){case "online":case "invisible":case "away":case "mobile":a.className="status-"+e;break;case "idle":a.className="status-online"}},AIMError:function(a){this.onSessionEnd();
this.aimErrorMsg.innerHTML=a;this.aimErrorNode.style.display="block"},onSessionStart:function(){},onSessionEnd:function(){this.aim.hide();this.aimErrorNode.style.display="none";this.aimSignIn.show();this.aimLoading.hide();b.query(".appTitleAdd",this.domNode).style("display","none");b.query(".appTitleStatus",this.domNode).style("display","none");b.style(this.presenceDisplay.domNode,"display","none");setTimeout(b.hitch(this,function(){this.aimSignInBtn.sizeMyself();this.resizeAimSignin()}),0)},getAlistHtml:function(a){var b=
ws.im.wim.getBuddyById(a);return"<div class=\"alistItem\" onclick=\"dojo.publish('aimWimBuddyClicked', [{aimId: '"+a+'\'}]); return false;"><div class="alStatus '+this.aim.buddyListWidget.makePresenceStyle(b)+'"></div><span class="name">'+ws.string.escapeXml(ws.im.wim.getDisplayId(b.aimId))+"</span></div>"},updateAlist:function(){for(var a="",e=0,f=ws.im.wim.getAlist(),g=0;g<f.length;g++)if(a+=this.getAlistHtml(f[g]),e++,e>=5)break;f.length>0?b.query(".alistDiv",this.domNode).style("display","block"):
b.query(".alistDiv",this.domNode).style("display","none");b.query(".alistDiv",this.domNode).innerHTML(a.length>0?a:"<div></div>")},onBuddyListLoad:function(){this.aimLoading.hide();this.presenceDisplay.show();this.aimSearchBtn.style.display="block";this.spinner&&this.spinner.stop()},onAList:function(){Config.EnableCHAL&&this.updateAlist()},onAuthCancel:function(){this.onSessionEnd()},onPresenceChanged:function(a){if(Config.EnableCHAL){var e=ws.im.wim.getAlist();b.indexOf(e,a.aimId)!=-1&&this.updateAlist()}},
addBuddy:function(){this.aim&&this.aim.addBuddy()},setStatus:function(){if(this.aim)this.aim.onSetStatus()},onAimMouseOut:function(a){b.stopEvent(a);b.addClass(this.aimSearchBtn,"appTitleSearch");this.aim.searchBox.isShowing()||b.removeClass(this.aimSearchBtn,"appTitleSearchSel")},onAimMouseOver:function(a){b.stopEvent(a);b.addClass(this.aimSearchBtn,"appTitleSearchSel")},searchAIM:function(a){b.stopEvent(a);this.aim.onSearch(a)},onUserLoad:function(){this.updateUserPresence(ws.im.wim.user)},onmouseoverAP:function(a){if(a=
ws.widget.getEventTarget(a,"apBtn","apBtns"))b.addClass(a.parentNode,"apBtnHover"),ws.widget.showInstatip(a,{side:"top"})},onmouseoutAP:function(a){if(a=ws.widget.getEventTarget(a,"apBtn","apBtns"))b.removeClass(a.parentNode,"apBtnHover"),b.removeClass(a.parentNode,"apBtnClick"),ws.widget.hideInstatip(a)},onmousedownAP:function(a){(a=ws.widget.getEventTarget(a,"apBtn","apBtns"))&&b.addClass(a.parentNode,"apBtnClick")},onmouseupAP:function(){b.query(".apBtnClick",this.apBtns).removeClass("apBtnClick")},
AIMInit:function(a){Settings.EnableAIMPanel&&ws.lang.ensureLayersLoadedExtra(b.hitch(this,function(){if(!this.aim)this.aim=new ws.im.ImPanel,k.byId("aimApp").addChild(this.aim),this.setupPresenceMenu(),ws.im.wim.listeners.push(this);a&&a()}),{layers:["Aim"]})},AIMSignIn:function(){if(Settings.EnableAIMPanel){if(!this.spinner)this.spinner=new ws.Spinner("AimSignIn",this.aimSpinner);this.spinner.spin();this.aimSignIn.hide();this.aimLoading.show();k.byId("aimApp").layout();ws.lang.ensureLayersLoadedExtra(b.hitch(this,
function(){if(!this.aim)this.aim=new ws.im.ImPanel,k.byId("aimApp").addChild(this.aim),this.setupPresenceMenu(),ws.im.wim.listeners.push(this);this.aim.domNode.style.display="";this.aim.signOn()}),{layers:["Aim"]})}},selectAppById:function(a,b){switch(a){case "contactApp":this.selectContactApp(null,b);break;case "aimApp":this.selectAimApp(null,b);break;case "eventApp":this.selectEventApp(null,b);break;case "todoApp":this.selectTodoApp(null,b)}},showAppPane:function(){Settings.NavAppPaneSize=1;ws.settings.saveSoon({NavAppPaneSize:1});
this.onResized()},hideAppPane:function(){Settings.NavAppPaneSize=0;ws.settings.saveSoon({NavAppPaneSize:0});this.onResized()},selectContactApp:function(a,e){a&&this.currentApp!="contactApp"&&ws.reporting.reportAction("minicontacts-inline-open");this.currentApp="contactApp";var f=k.byId("contactApp");this.appStack.selectChild(f);f.init();b.query(".appCurr",this.apBtns).removeClass("appCurr");b.query(".ap-contact .apBtn",this.apBtns).addClass("appCurr");if(Settings.NavAppSelected!="contactApp")ws.settings.saveSoon({NavAppSelected:"contactApp"}),
Settings.NavAppSelected="contactApp";Settings.NavAppPaneSize==0&&!e&&this.showAppPane()},selectAimApp:function(a,e){if(!Settings.EnableAIMPanel||ws.UserContext.ParentalControls=="K"||ws.UserContext.ParentalControls=="Y")this.selectContactApp();else{a&&this.currentApp!="aimApp"&&ws.reporting.reportAction("miniaim-inline-open");this.currentApp="aimApp";this.appStack.selectChild(k.byId("aimApp"));b.query(".appCurr",this.apBtns).removeClass("appCurr");b.query(".ap-aim .apBtn",this.apBtns).addClass("appCurr");
if(Settings.NavAppSelected!="aimApp")ws.settings.saveSoon({NavAppSelected:"aimApp"}),Settings.NavAppSelected="aimApp";Settings.NavAppPaneSize==0&&!e&&this.showAppPane();this.aimSignInBtn.sizeMyself();setTimeout(b.hitch(this,function(){this.resizeAimSignin()}),200)}},selectEventApp:function(a,e){a&&this.currentApp!="eventApp"&&ws.reporting.reportAction("minical-inline-open");this.currentApp="eventApp";var f=k.byId("eventApp");this.appStack.selectChild(f);f.init();b.query(".appCurr",this.apBtns).removeClass("appCurr");
b.query(".ap-event .apBtn",this.apBtns).addClass("appCurr");if(Settings.NavAppSelected!="eventApp")ws.settings.saveSoon({NavAppSelected:"eventApp"}),Settings.NavAppSelected="eventApp";Settings.NavAppPaneSize==0&&!e&&this.showAppPane()},selectTodoApp:function(a,e){a&&this.currentApp!="todoApp"&&ws.reporting.reportAction("minitodo-inline-open");this.currentApp="todoApp";var f=k.byId("todoApp");this.appStack.selectChild(f);f.init();b.query(".appCurr",this.apBtns).removeClass("appCurr");b.query(".ap-todo .apBtn",
this.apBtns).addClass("appCurr");if(Settings.NavAppSelected!="todoApp")ws.settings.saveSoon({NavAppSelected:"todoApp"}),Settings.NavAppSelected="todoApp";Settings.NavAppPaneSize==0&&!e&&this.showAppPane()},resizeAimSignin:function(){var a=b._getMarginSize(b.byId("aimApp")).w,e=b._getMarginSize(this.aimSignInBtn.domNode);this.aimSignInBtn.domNode.style.left=(a-e.w)/2+"px"},hideConnector:function(a){a.style.display="none"},positionFolderConnector:function(a,e){if(this.folderFlyout&&this.folderFlyout.style.display!=
"none"){var f,g,h;g=this.folderFlyout;f=b.position(a);g=b.position(g);h=f.y-g.y;h>31&&h<g.h-31&&!b.hasClass(this.mnFolders,"navItemCurrent")?b.style(e,{height:f.h-2+"px",top:h+"px",display:"block"}):this.hideConnector(e)}},positionConnector:function(a){if(this.flyout&&this.flyout.style.display!="none"){if(!a)if(a=b.query(".navAppCurr",this.mnAppsDiv),a.length)a=b.query(".navAppCurr",this.mnAppsDiv)[0];else return;var e,a=b.position(a);e=b.position(this.flyout);b.style(this.flyoutConnector,{height:a.h-
2+"px",top:a.y-e.y+"px",display:"block"})}},flyoutApp:function(a){if(!this.reporting_idMap)this.reporting_idMap={contactApp:"minicontacts-flyout-open",aimApp:"miniaim-flyout-open",eventApp:"minical-flyout-open",todoApp:"minitodo-flyout-open"};ws.reporting.reportAction(this.reporting_idMap[a]);this.closeFlyoutFolders();var e=k.byId(a);e.init&&e.init();this.appStack.removeChild(e);this.flyout?this.restoreApp():(this.flyout=b.create("div",{className:"flyoutCont",style:"display:none;"},b.body()),this.flyoutConnector=
b.create("div",{className:"foConnector"},this.flyout));b.place(e.domNode,this.flyout,"first");b.removeClass(e.domNode,"dijitHidden");b.query(".navItem",this.mnAppsDiv).removeClass("navAppCurr");var f=b.query("."+a,this.mnAppsDiv)[0];b.hasClass(f,"navItemCurrent")||b.query("."+a,this.mnAppsDiv).addClass("navAppCurr");ws.widget.hideInstatip(b.query("."+a,this.mnAppsDiv)[0]);e.show();b.query(".appTitleClose",e.domNode).style("display","");this.flyout.style.display="";var g=b._getMarginSize(e.domNode);
g.w=180;if(g.h<200)g.h=200;if(g.h!=Settings.NavAppPaneSize&&Settings.NavAppPaneSize>1)g.h=Settings.NavAppPaneSize;b.marginBox(e.domNode,{w:g.w,h:g.h});a=="aimApp"&&this.resizeAimSignin();setTimeout(function(){e.resize()},0);this.positionConnector(f)},flyoutFolders:function(){this.restoreApp();b.addClass(this.mnFolders,"folderBtnSelected");if(!this.folderFlyout)this.folderFlyout=b.create("div",{id:"folderFlyCont",className:"folderFlyCont",style:"display:none;"},b.body()),this.folderApp=new ws.mail.FolderApp,
this.folderFlyout.appendChild(this.folderApp.domNode),this.folderApp.setModel(this.mailModel),this.flyoutConnector=b.create("div",{className:"foConnector"},this.folderFlyout),this.connect(this.folderApp,"handleClick",b.hitch(this,this.hideConnector,this.flyoutConnector)),this.connect(this.folderApp,"appClose",b.hitch(this,function(){b.removeClass(this.mnFolders,"folderBtnSelected")}));var a=ws.WebSuite.viewportSize.h,e=b._getMarginSize(this.appStack.domNode),f=b.position(this.mnFolders);e.w=180;if(e.h<
200)e.h=200;b.style(this.folderApp.domNode,{width:e.w+"px",height:e.h+"px"});f.y=f.y-e.h/2+20;if(f.y+e.h>a)f.y=a-e.h-2;this.folderFlyout.style.top=f.y+"px";var g=this.folderApp;setTimeout(function(){g.resize()},0);this.folderFlyout.style.display="block";b.hasClass(this.mnFolders,"navItemCurrent")||this.positionFolderConnector(this.mnFolders,this.flyoutConnector)},closeFlyoutFolders:function(){if(this.folderFlyout)this.folderFlyout.style.display="none",b.removeClass(this.mnFolders,"folderBtnSelected")},
restoreApp:function(){if(this.flyout){this.flyout.style.display="none";var a=this.flyout.firstChild;if(a&&a.className!="foConnector"){var e=k.byNode(a);e.hide();b.query(".navItem",this.mnAppsDiv).removeClass("navAppCurr");this.flyout.removeChild(a);this.appStack.addChild(e);b.query(".appTitleClose",e.domNode).style("display","none");this.selectAppById(e.domNode.id);this.hiliteCurrentApp()}}this.closeFlyoutFolders()},searchActive:function(a,e,f){var g=e;if(e&&e.domNode)g=e.domNode,e.coords=null;if(this.isMini)if(a)this.searchActive(!1,
null,!0),this.miniNavSearch(!0),this.miniSearchDat.oldSi=g,b._getMarginSize(this.mnSearch),b._getMarginSize(g),b.addClass(this.mnSearch,"mnSearchActive"),b.addClass(g,"searchInfoMini");else{if(!g)g=this.miniSearchDat.oldSi;b.removeClass(this.mnSearch,"mnSearchActive");g&&b.removeClass(g,"searchInfoMini");this.mnSearchClose();if(!f)this.mnSearchField.value="";this.miniSearchDat.oldSi=null}else{if(!g)g=this.miniSearchDat.oldSi;g&&b.removeClass(g,"searchInfoMini");this.mnSearchClose();this.miniSearchDat.oldSi=
null}},updateNavCollapser:function(a){var e=ws.WebSuite.getCurrentViewId();if(e=="todayPage"||e=="composeMessage"&&k.byId("composeMessage").isSendConfirmationOnShow())a=!1;this.navCollapserHidden=!a;b.query(".navCollapser").style("display",a?"block":"none")},onSettingsShow:function(){this.restoreApp();this.mnSearchClose()},onSettingsHide:function(){if(b.hasClass(this.mnSearch,"mnSearchActive")&&this.isMini)this.mnSearch.style.display="block"},showMnSearch:function(a){if(this.isMini){var e=b.hasClass(this.mnSearch,
"mnSearchActive");this.mnSearch.style.display=a&&e?"block":"none"}}}));b._hasResource["ws.mail.Stationery"]||(b._hasResource["ws.mail.Stationery"]=!0,b.provide("ws.mail.Stationery"),b.declare("ws.mail.Stationery",[k._Widget,k._Templated],{templateString:b.cache("ws.mail","stationery.html",'<div class="stationery">\r\n    <img src="${spacer}" class="mainSprite wsCloseBtn" dojoAttachEvent="onclick:closeStationery">\r\n\t<div class="title" dojoAttachPoint="titleDiv">${StationeryTitle}</div>\r\n\t<div class="category" dojoAttachPoint="category">\r\n\t\t<div dojoType="ws.widget.DropDownLink" minWidth="152" dojoAttachPoint="catButton" class="wsIconButton"></div>\r\n\t</div>\r\n\t<div class="listPane" dojoAttachPoint="listPane">\r\n\t\t<ul class="list" dojoAttachPoint="list"></ul>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,_init:!1,rcCategory:{id:"RECENTLYUSED",label:Config.Strings.StationeryRecent},categories:null,categoriesReady:!1,items:{},subcatMenuDefHash:{},selCatIdx:0,selSubcatIdx:0,params:{recentlyUsed:[],selected:null,maxInRecentlyUsed:5,maniURLBase:Config.StationeryConfigURL,maniFilePrefix:"ws_stationery",JSONPCallbackPostFix:"?callback=?",resourceURL:Config.StationeryConfigResourcePath,maxItemLabelLenInList:23,maxItemLabelLenInSelection:11,
lang:"en",country:"us"},startup:function(){ws.WebSuite.StationeryWidget=this;JSONCallback=function(a){var e=ws.WebSuite.StationeryWidget;if(a&&a.categories)e.categories=a.categories,e.initialize();else if(a&&a.items&&(e.items[a.categoryId]=a,e.categories[e.selCatIdx].id==a.categoryId))e._populateItemList(a),b.publish("CategoriesReady"),e.categoriesReady=!0};this.rcKey=this.rcCategory.id;b.io.script.get({url:Config.StationeryConfigURL+"ws_stationery.js",load:b.hitch(this,function(){}),error:b.hitch(this,
function(){}),timeout:b.hitch(this,function(){})});this.connect(this.list,"onclick",this._clickHandler)},initialize:function(){for(var a=[],e=0;e<this.categories.length;e++){var f=this.categories[e];a.push({caption:f.label,onClick:b.hitch(this,"catMenuClick",e),params:{catIdx:e},enabled:f.id=="RECENTLYUSED"?!1:!0})}a.push({separator:!0});var e="about:blank",g=f="",h=this.params.selected;if(h&&h.id&&h.label)e=Config.StationeryConfigResourcePath+h.version+"/"+h.id+"/thumbnail.jpg",f=h.label,f.length>
this.params.maxItemLabelLenInSelection&&(f=f.substring(0,this.params.maxItemLabelLenInSelection)+"..."),g=h.label;a.push({noHoverColor:!0,caption:"<div><div>"+Config.Strings.StationeryCurrent+"</div><div class='imgOuterWrapper'><div class='imgInnerWrapper' title='"+g+"'><img style='' width=120 src='"+e+"'/><div class='overlay'></div><span>"+f+"</span></div></div><a class='clear'>"+Config.Strings.StationeryClearLinkLbl+"</a>",stayOpenAfterClick:!0});this.catButton.setLabel(this.categories[this.selCatIdx].label);
this.catButton.setMenuDefinition(a);this.catButton.getMenu();this.catMenu=this.catButton.menu;this.catMenu.recentlyUsedIdx=2;this.catMenu.separatorIdx=a.length-1;this.catMenu.currentSelectionIdx=a.length;this.connect(this.catMenu.domNode,"onmousedown",this._clearClick);this.catMenu.hideChild(this.catMenu.separatorIdx);this.catMenu.hideChild(this.catMenu.currentSelectionIdx);this._init=!0;this.setListPaneHeight();this.populateItemList(this.categories[this.selCatIdx].id);this.resize()},_selectStationery:function(a){var e=
this.params;if(!e.selected)e.selected={};var f="",g="",h=this.items[this.categories[this.selCatIdx].id];if(h)h=h.items;if(h)for(var j=0;j<h.length;j++){var k=h[j];if(k.id==a){f=k.label;g=k.version;h=b.query(".stationery .list li:eq("+j+")")[0];h.addClass("selected");b.query(".overlay",h).style("display","none");b.query(".clearOverlay",h).style("display","");b.query(".clear",h).style("display","");break}}e.selected.id=a;e.selected.label=f;e.selected.version=g;e.selected.imgWidth=156;e.selected.imgHeight=
70;this.catMenu.showChild(this.catMenu.separatorIdx);b.query("#"+this.catMenu.id+" img").attr("src",Config.StationeryConfigResourcePath+e.selected.version+"/"+e.selected.id+"/thumbnail.jpg");f=e.selected.label;a=ws.string.escapeXml(f);b.query("#"+this.catMenu.id+" .imgInnerWrapper").attr("title",a);f.length>e.maxItemLabelLenInSelection&&(f=f.substring(0,e.maxItemLabelLenInSelection)+"...",a=ws.string.escapeXml(f));b.query("#"+this.catMenu.id+" .imgInnerWrapper span")[0].innerHTML=a;this.catMenu.showChild(this.catMenu.currentSelectionIdx);
b.publish("stationery/select",[e.selected,Config.StationeryConfigResourcePath+e.selected.version+"/"+e.selected.id+"/template.htm",null,Config.StationeryConfigResourcePath+e.selected.version+"/"+e.selected.id+"/thumbnail.jpg"])},closeStationery:function(){b.publish("stationery/close")},selectStationery:function(a){this.categoriesReady?_selectStationery(a):b.subscribe("CategoriesReady",function(){_selectStationery(a)})},catMenuClick:function(a){this.params.catIdx=a;this.selCatIdx=this.catButton.params.catIdx=
this.params.catIdx;this.catButton.setLabel(this.categories[this.selCatIdx].label);this.populateItemList(this.categories[this.selCatIdx].id);this.setListPaneHeight();return!1},populateItemList:function(a){this.list.innerHTML="";this.items[a]?this._populateItemList(this.items[a]):(a=this.params.maniURLBase+this.params.maniFilePrefix+"_"+a+".js",a+=this.params.JSONPCallbackPostFix,b.io.script.get({url:a,load:b.hitch(this,function(){}),error:b.hitch(this,function(){}),timeout:b.hitch(this,function(){})}))},
reset:function(){this._clearSelectedItem();this.catMenuClick(0)},_clearSelectedItem:function(){var a;this.params.selected&&(a=b.query("[stationery="+this.params.selected.id+"]"));a&&a.length>0&&b.removeClass(a[0],"selected");this.params.selected=null;this.catMenu.hideChild(this.catMenu.separatorIdx);this.catMenu.hideChild(this.catMenu.currentSelectionIdx)},_clearClick:function(a){if(a.target&&(a.target.className=="clear"||b.hasClass(a.target,"selected")))a.stopPropagation&&a.stopPropagation(),this.catMenu.hideChild(this.catMenu.separatorIdx),
this.catMenu.hideChild(this.catMenu.currentSelectionIdx),this.catMenu.hide(),b.query(".stationery .list li").removeClass("selected"),this.params.selected=null,b.publish("stationery/clear",[this.params.selected,null])},getItemsInCat:function(a){var b=[];return b=a.items},updateRecentlyUsed:function(a,b,f){if(!f||!f.id)return a;for(var b=a[b],g=b.items.length-1;g>=0;g--)b.items[g].id==f.id&&b.items.splice(g,1);var g={},h;for(h in f)g[h]=f[h];b.items.splice(0,0,g);if(!this.params.maxInRecentlyUsed)this.params.maxInRecentlyUsed=
5;b.items&&b.items.length>this.params.maxInRecentlyUsed&&b.items.splice(this.params.maxInRecentlyUsed,1);catMenu.showChild(catMenu.recentlyUsedIdx);return a},_populateItemList:function(a){for(var a=a.items,b="",f=0,g=0;g<a.length;g++){var h=a[g],j="";this.params.selected&&this.params.selected.id==h.id&&(j="selected");var k=h.imgWidth||156,l=h.imgHeight||70,o=h.label;h.label.length>this.params.maxItemLabelLenInList&&(o=h.label.substring(0,this.params.maxItemLabelLenInList)+"...");var n=ws.string.escapeXml(h.label);
b+="<li _ver='"+h.version+"' stationery='"+h.id+"' class='"+j+"' label='"+n+"' imgWidth= "+k+" imgHeight="+l+">";b+="<div class='item'><img style= width="+k+" height="+l+" src='"+Config.StationeryConfigResourcePath+h.version+"/"+h.id+"/thumbnail.jpg'/>";b+="<div class='overlay'>"+o+"</div>";b+="<div class='imgOverlay'><div class='btnArrowImg'></div>"+Config.Strings.ThemesPickerSelected+"</div>";b+="</div></li>";f++}this.list.innerHTML+=b},_clickHandler:function(a){for(var e=a.target;e.className!=
"list";){if(e.tagName.toLowerCase()=="li")break;e=e.parentNode}if(e.className!="list")b.hasClass(e,"selected")?(a.stopPropagation(),this._clearClick({target:e})):(this._clearSelectedItem(),b.addClass(e,"selected"),this.params.selected=this.params.selected||{},this.params.selected.id=b.attr(e,"stationery"),this.params.selected.label=ws.string.unescapeXml(b.attr(e,"label")),this.params.selected.version=b.attr(e,"_ver"),this.params.selected.imgWidth=b.attr(e,"imgWidth"),this.params.selected.imgHeight=
b.attr(e,"imgHeight"),this.catMenu.showChild(this.catMenu.separatorIdx),b.query("#"+this.catMenu.id+" img").attr("src",Config.StationeryConfigResourcePath+this.params.selected.version+"/"+this.params.selected.id+"/thumbnail.jpg"),a=this.params.selected.label,ws.string.escapeXml(a),b.query("#"+this.catMenu.id+" .imgInnerWrapper").attr("title",a),a.length>this.params.maxItemLabelLenInSelection&&(a=a.substring(0,this.params.maxItemLabelLenInSelection)+"...",ws.string.escapeXml(a)),this.catMenu.showChild(this.catMenu.currentSelectionIdx),
this.catMenu.close(),b.publish("stationery/select",[this.params.selected,Config.StationeryConfigResourcePath+this.params.selected.version+"/"+this.params.selected.id+"/template.htm",null,Config.StationeryConfigResourcePath+this.params.selected.version+"/"+this.params.selected.id+"/thumbnail.jpg"]))},setListPaneHeight:function(){var a=b.marginBox(this.domNode).h,e=b.marginBox(this.titleDiv).h,f=b.marginBox(this.category).h;b.style(this.listPane,"height",Math.max(a-e-f-0-15,0)+"px")},resize:function(){this._init&&
(this.setListPaneHeight(),this.catMenu.hide())},onResized:function(){document.all?(window.resizeEnd=window.resizeEnd==null?{}:window.resizeEnd,clearTimeout(window.resizeEnd),window.resizeEnd=setTimeout(this.resize,100)):this.resize()}}));b._hasResource["ws.suite.SidePanel"]||(b._hasResource["ws.suite.SidePanel"]=!0,b.provide("ws.suite.SidePanel"),b.declare("ws.suite.SidePanel",[k._Widget,k._Templated],{templateString:b.cache("ws.suite","SidePanel.html",'<div class="SidePanel">\r\n\t<div dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget" class="layoutWidget">\r\n\t\t<div dojoType="dijit.layout.StackContainer" layoutAlign="client" dojoAttachPoint="panelStack" style="overflow:hidden;">\r\n\t\t\t<div dojoType="ws.widget.ContainerPane" dojoAttachPoint="towerAd" style="overflow:hidden;width:100%;"></div>\r\n\t\t\t<div dojoType="ws.widget.ContainerPane" dojoAttachPoint="stationery" style="height:100%;width:100%"></div>\r\n\t\t</div>\r\n\t\t<div dojoType="ws.widget.Pane" layoutAlign="bottom" dojoAttachPoint="copyrightDIV" class="CopyRightDiv"></div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,adWidget:null,stationeryWidget:null,hasAdConfig:!0,scrollMods:{},isCompactWidth:!1,checkScreenResolutionTimer:null,initialScreenResolutionWidth:-1,todayPageShowing:!1,widthClasses:["spSmall","spSmall","spMedium","spLarge"],startup:function(){this.copyrightDIV.domNode.innerHTML=ws.string.substituteParams(Config.Strings.Copyright,(new Date).getFullYear());this.adWidget=new ws.widget.Advertisement({adtype:"sidepanel"});this.adWidget.startup();if(this.adWidget.adConfig)this.adWidget.layoutAlign=
this.adWidget.adConfig.location,this.towerAd.addChild(this.adWidget),this.panelStack.selectChild(this.towerAd);this.subscribe("ws_view-selectChild","handleMainStackSelect");this.connect(ws.WebSuite.theMailModel,"modelUpdated","resetAdScroll")},updateWidth:function(){var a=ws.WebSuite.getCurrentViewId();this.hasAdConfig=this.adWidget.adConfig&&ws.WebSuite.widthMode>1?!0:!1;ws.WebSuite.widthMode==1&&this.hide();this.hasAdConfig&&this.isClosed&&(a=="composeMessage"?k.byId("composeMessage").isSendConfirmationOnShow()||
this.show():a!="todayPage"&&this.show());this.domNode.className="SidePanel "+this.widthClasses[ws.WebSuite.widthMode-1]},setupAdScroll:function(a,e){if(e&&this.scrollMods[e]){var f=this.scrollMods[e];b.disconnect(f.a);b.disconnect(f.b)}f={};f.a=b.connect(a,"onscroll",null,this.handleScroll);f.b=b.connect(a,b.isFF?"DOMMouseScroll":"onmousewheel",null,this.handleWheel);e&&(this.scrollMods[e]=f)},handleScroll:function(a){var a=a.currentTarget?a.currentTarget:this,e=ws.WebSuite.SidePanel;b.hitch(e,e.isSelectedPanel)(e.towerAd)&&
(new b.Animation({node:e.towerAd.domNode,duration:200,properties:{scrollTop:{start:e.towerAd.domNode.scrollTop,end:a.scrollTop}},curve:[e.towerAd.domNode.scrollTop,a.scrollTop],onAnimate:function(a){this.node.scrollTop=a}})).play()},handleWheel:function(a){if(!a)a=window.event;var e=a.currentTarget?a.currentTarget:this,f=ws.WebSuite.SidePanel;b.hitch(f,f.isSelectedPanel)(f.towerAd)&&e.offsetHeight>=e.scrollHeight&&(b.isFF?a.axis==a.VERTICAL_AXIS&&(f.towerAd.domNode.scrollTop+=a.detail/3*20):f.towerAd.domNode.scrollTop+=
a.wheelDelta/120*-20)},resetAdScroll:function(){ws.WebSuite.SidePanel.towerAd.domNode.scrollTop=0},handleMainStackSelect:function(a){!this.hasAdConfig||a&&a.id&&a.id=="todayPage"?this.hide():(this.show(),this.panelStack.selectChild(this.towerAd),this.updateWidth());this.resetAdScroll()},showStationery:function(){var a=!1;if(!this.stationeryWidget)this.stationeryWidget=new ws.mail.Stationery,this.stationeryWidget.startup(),this.stationery.addChild(this.stationeryWidget),a=!0;return a||!this.isSelectedPanel(this.stationery)?
(this.panelStack.selectChild(this.stationery),this.updateWidth(!0),this.stationeryWidget.resize(),this.show(!0),!0):(this.handleMainStackSelect(),!1)},resetStationery:function(){this.stationeryWidget&&this.stationeryWidget.reset()},show:function(a){if((this.hasAdConfig||a)&&this.domNode.style.display!="")this.inherited(arguments),this.domNode.style.display="",this.adWidget&&this.adWidget.block(!1),ws.WebSuite.resize()},hide:function(){if(this.domNode.style.display!="none")this.inherited(arguments),
this.domNode.style.display="none",this.adWidget&&this.adWidget.block(!0),ws.WebSuite.resize()},resize:function(){this.inherited(arguments);this.updateWidth();if(this.isSelectedPanel(this.stationery))this.stationeryWidget.resize();else if(this.isSelectedPanel(this.towerAd)){var a=b.marginBox(this.domNode).h;b.style(this.towerAd.domNode,"height",a+"px")}},isSelectedPanel:function(a){if(!this.isClosed()&&this.panelStack.selectedChildWidget==a)return!0;return!1},isClosed:function(){return this.domNode.style.display==
"none"}}));b._hasResource["ws.widget.Splitter"]||(b._hasResource["ws.widget.Splitter"]=!0,b.provide("ws.widget.Splitter"),b.declare("ws.widget.Splitter",k._Widget,{orientation:"left",splitterWidth:1,splitterMargin:3,minWidth:0,maxWidth:400,prefWidth:0,collapseThreshhold:0,collapsable:!1,isCollapsed:!1,expandTitle:"",collapseTitle:"",css:{templateString:""},startup:function(){this.isOrientationRight=!1;this.startY=this.startX=0;this.bounds=this.resizeNodeSize=this.resizeNode=this.size=null;this.domNode.style.position=
"absolute";this.domNode.className="wsSplitter "+this.orientation;b.marginBox(this.domNode,{w:this.splitterWidth+2*this.splitterMargin});this.visibleNode=b.create("div",{className:"separator",style:{height:"100%",width:this.splitterWidth+"px",position:"absolute",left:this.splitterMargin+"px"}},this.domNode);if(this.collapsable)this.collapseNode=b.create("div",{className:"collapseButton",style:{position:"absolute",zIndex:this.domNode.style.zIndex+1}},this.domNode),this.connect(this.collapseNode,"onmousedown",
"onCollapse");this.setCursor();this.connect(this.domNode,"onmousedown","onMouseDown");this.connect(this.domNode,"onmousemove","setCursor")},addSizerFunc:function(a){this.sizerFunc=a},setCursor:function(){this.isDisabled?this.domNode.style.cursor="auto":this.orientation=="right"?(this.isOrientationRight=!0,this.domNode.style.cursor=b.isIE<9?"e-resize":"ew-resize"):(this.isOrientationRight=!1,this.domNode.style.cursor=b.isIE<9?"w-resize":"ew-resize")},setHeight:function(a){this.domNode.style.height=
a+"px";this.visibleNode.style.height=a+"px"},isLeftMouseDown:function(a){if(a&&typeof a.which!="undefined"&&a.which==1)return!0;if(a&&typeof a.button!="undefined"&&a.button==1)return!0;return!1},onMouseDown:function(a){if(!this.isDisabled){this.startX=parseInt(this.domNode.offsetLeft)+this.splitterMargin;this.startY=parseInt(this.domNode.offsetTop);this.size={width:this.splitterWidth,height:b._getMarginSize(this.domNode).h};var e=null;if(this.isOrientationRight)for(e=this.domNode.nextSibling;e&&e.nodeType!=
1;)e=e.nextSibling;else for(e=this.domNode.previousSibling;e&&e.nodeType!=1;)e=e.previousSibling;this.resizeNode=e;this.resizeNodeSize={width:b._getMarginSize(this.resizeNode).w,height:b._getMarginSize(this.resizeNode).h};var f=e=0;this.isOrientationRight?(f=parseInt(this.domNode.offsetLeft)+this.size.width,f+=this.resizeNodeSize.width,e=f-this.maxWidth-this.size.width,f=f-this.minWidth-this.size.width):(f=parseInt(this.resizeNode.offsetLeft),e=f+this.minWidth,f+=this.maxWidth);this.bounds={minLeft:e,
maxLeft:f};this.backdrop&&b._destroyElement(this.backdrop);e=ws.WebSuite.viewportSize;this.backdrop=b.create("div",{className:"wsSplitterBackdrop",style:{width:e.w-2+"px",height:e.h-2+"px",zIndex:2099,cursor:this.domNode.style.cursor}},b.body());this.backdrop.tabIndex=-1;this.backdrop.focus();this.domNode.style.zIndex=2098;this.docHandles=[b.connect(this.backdrop,"onmousemove",this,"onMouseMove"),b.connect(this.backdrop,"onmouseup",this,"onMouseUp")];b.stopEvent(a)}},onCollapse:function(a){if(!this.isDisabled){this.killCapturedEvent(a);
if(this.isCollapsed){this.isCollapsed=!1;a=b.window.getBox().w-this.minWidth;if(this.prefWidth<=0)this.prefWidth=this.minWidth;var e=b.window.getBox().w-this.prefWidth;if(e<=0||e>a)e=a;this.domNode.style.left=e+"px";if(this.collapseTitle!=""&&this.collapseNode)this.collapseNode.title=this.collapseTitle}else{this.isCollapsed=!0;this.startX=parseInt(this.domNode.offsetLeft)+this.splitterMargin;this.startY=parseInt(this.domNode.offsetTop);this.size={width:b._getMarginSize(this.domNode).w-this.splitterMargin,
height:b._getMarginSize(this.domNode).h};if(this.isOrientationRight){for(a=this.domNode.nextSibling;a&&a.nodeType!=1;)a=a.nextSibling;this.resizeNode=a;this.resizeNodeSize={width:b._getMarginSize(this.resizeNode).w,height:b._getMarginSize(this.resizeNode).h}}a=b.window.getBox().w;b.isSafari&&(a-=5);this.domNode.style.left=a+"px";if(this.expandTitle!=""&&this.collapseNode)this.collapseNode.title=this.expandTitle}b.toggleClass(this.collapseNode,"collapsed",this.isCollapsed);this.resize(!this.isCollapsed);
b.publish("Splitter/collapse",[{id:this.id,isCollapsed:this.isCollapsed}]);this._onCollapseCalled=!0}},onMouseUp:function(a){if(!this.isDisabled)b.forEach(this.docHandles,b.disconnect),this.docHandles=[],document.body.style.cursor="",b._destroyElement(this.backdrop),this.backdrop=null,this._onCollapseCalled?this._onCollapseCalled=!1:this.resize(),b.stopEvent(a)},onMouseMove:function(a){if(!this._onCollapseCalled)if(this.isLeftMouseDown(a)){ws.html.clearSelection();this.killCapturedEvent(a);var e=
a.pageX;if(this.isOrientationRight){if(e>this.bounds.maxLeft-this.collapseThreshhold)e=this.bounds.maxLeft;if(e>this.bounds.maxLeft)e=this.bounds.maxLeft;if(e<this.bounds.minLeft)e=this.bounds.minLeft}else if(this.sizerFunc)e=this.sizerFunc(e);else{if(e<this.bounds.minLeft+this.collapseThreshhold)e=this.bounds.minLeft;if(e<this.bounds.minLeft)e=this.bounds.minLeft;if(e>this.bounds.maxLeft)e=this.bounds.maxLeft}this.domNode.style.left=e-this.splitterMargin+"px";b.stopEvent(a)}else this.onMouseUp(a)},
killCapturedEvent:function(a){this.isLeftMouseDown(a)&&a&&b.stopEvent(a)},resize:function(a){var e=!1;if(this.isOrientationRight){e=this.startX+this.size.width+this.resizeNodeSize.width-(parseInt(this.domNode.offsetLeft)+this.size.width+this.splitterMargin);if(b.isIE==6)this.resizeNode.style.right="-1px";b.marginBox(this.resizeNode,{w:e})}else e=parseInt(this.resizeNode.offsetLeft),e=parseInt(this.domNode.offsetLeft)+this.splitterMargin-e,e<this.minWidth?(e=180,ws.WebSuite.Navigation.toggleNav()):
(ws.WebSuite.Navigation.isMini&&ws.WebSuite.Navigation.toggleNav(),b.marginBox(this.resizeNode,{w:e}));e=e<=0?!0:!1;this.resizeNode.style.display=e?"none":"";this.domNode.style.zIndex="";if(!e&&!a){a=parseInt(this.domNode.style.left);e=b._getMarginSize(this.domNode).w;a=b.window.getBox().w-a-e;if(a<this.minWidth)a=this.minWidth;b.publish("Splitter/resize",[{id:this.domNode.id,width:a+"px"}])}},cancel:function(){b.forEach(this.docHandles,b.disconnect);this.docHandles=[];b._destroyElement(this.backdrop);
this.backdrop=null;this.domNode.style.left=this.startX+"px";this.domNode.style.zIndex=""},enableSizing:function(a){this.isDisabled=!a;this.setCursor()}}));if(!b._hasResource["ws.address.AddressBookUtil"])b._hasResource["ws.address.AddressBookUtil"]=!0,b.provide("ws.address.AddressBookUtil"),ws.address.AddressBookUtil={LoadSortDefaults:function(){},GetRequestParamsForPrint:function(a,b){var f,g=b.sortBy,h=b.sortDir,j=b.nameFormat,k=b.categoryFilter;a!="selected"&&(g==null&&this.LoadSortDefaults(),
g!=null&&(f+=ws.string.substituteParams("&sort={0}&sortDir={1}",g,h)));a=="category"&&k&&(f=ws.string.substituteParams("{0}&category={1}",f,encodeURIComponent(k)));return f+"&nameFormat="+j},OpenLocateOnMapWindow:function(a){a=Config.BaseABPagesURL+"addresslist-locate.aspx?"+a;a+="&user="+ws.io.getUserUid();var b=ws.string.substituteParams("status=yes,resizable=yes,menubar=yes,scrollbars=yes,left={0},top={1},width={2},height={3}","5","5","725","725");(a=ws.io.openWindow(a,"",b))&&a.focus();ws.reporting.report("Locate Map",
"Addresses")},OpenAddressPrintWindow:function(a){a=Config.BaseABPagesURL+"addresslist-print.aspx?"+a;a+="&user="+ws.io.getUserUid();var b=ws.string.substituteParams("status=yes,resizable=yes,menubar=yes,scrollbars=yes,left={0},top={1},width={2},height={3}","5","5","780","500");(a=ws.io.openWindow(a,"",b))&&a.focus();ws.reporting.report("Print Contacts","Addresses")},getNameInfoHTML:function(a,b,f,g){var h=[];b=="FirstLastNick"||b=="FirstLastEmailScreenNamePhone"?(a.firstName&&h.push(a.firstName),
a.lastName&&h.push(a.lastName)):b=="LastFirstNick"||b=="LastFirstEmailScreenNamePhone"?(a.lastName&&a.firstName?h.push(a.lastName+","):a.lastName&&h.push(a.lastName),a.firstName&&h.push(a.firstName)):b=="LastNoCommaFirstNick"&&(a.lastName&&h.push(a.lastName),a.firstName&&h.push(a.firstName));g||(a.nickName&&h.push("("+a.nickName+")"),!a.nickName&&!a.firstName&&!a.lastName&&(a.email1?h.push(a.email1):a.email2?h.push(a.email2):a.screenName?h.push(a.screenName):a.phone&&h.push(a.phone)));a=h.join(" ");
f||(a=ws.string.escapeXml(a));return a},_mapAddressesToContacts:function(a,e){for(var f=b.map(a.getValue().split(/[;,]/),b.trim),g=0;g<f.length;g++)f[g]||f.splice(g--,1);for(var h=a.selectedContacts,j=[],g=f.length-1;g>=0;g--)for(var k=0;k<h.length;k++){if(h[k].screenName==f[g]){j.push(h[k]);f.splice(g,1);break}if(h[k].bType=="d"&&h[k].contactUids.length&&h[k].composeValue.match(f[g]))for(var l=h[k].contactUids.split(","),o=0;o<l.length;o++){var n=e.getRecordByUID(l[o]*1);if(n.screenName==f[g]){j.push(n);
f.splice(g,1);break}}}return{addresses:f,contacts:j}}};b._hasResource["ws.address.record"]||(b._hasResource["ws.address.record"]=!0,b.provide("ws.address.record"),b.declare("ws.address.record",null,{constructor:function(a,b){var f=!1,g=b.split(a.DELIMITER_FIELD);this.uid=g[0];this.addressMap=0;this.bType="c";for(var h,j,k=1;k<g.length;k+=2)switch(h=g[k],j=g[k+1],h){case a.CONTACT_FNAME:this.firstName=j;break;case a.CONTACT_LNAME:this.lastName=j;break;case a.CONTACT_NNAME:this.nickName=j;break;case a.CONTACT_SNAME:this.screenName=
j;this.hasEmail=!0;break;case a.CONTACT_DNAME:this.displayName=j;this.hasEmail=!0;break;case a.CONTACT_EMAIL1:this.email1=j;this.hasEmail=!0;break;case a.CONTACT_EMAIL2:this.email2=j;this.hasEmail=!0;break;case a.CONTACT_PHONE1:this.phone1=j;break;case a.CONTACT_PHONE2:this.phone2=j;break;case a.CONTACT_PHONE3:this.phone3=j;break;case a.CONTACT_PHONE4:this.phone4=j;break;case a.CONTACT_PHONE5:this.phone5=j;break;case a.CONTACT_PHONE1TYPE:this.phone1Type=j;break;case a.CONTACT_PHONE2TYPE:this.phone2Type=
j;break;case a.CONTACT_PHONE3TYPE:this.phone3Type=j;break;case a.CONTACT_PHONE4TYPE:this.phone4Type=j;break;case a.CONTACT_PHONE5TYPE:this.phone5Type=j;break;case a.CONTACT_CATEGORY:this.category=parseInt(j);break;case a.DISTROLIST_NAME:this.name=j;this.bType="d";break;case a.DISTROLIST_COUNT:this.count=j;this.bType="d";break;case a.DISTROLIST_ENTRY:this.composeValue=j;this.hasEmail=!0;this.bType="d";break;case a.DISTROLIST_CONTACT_UIDS:this.contactUids=j;this.bType="d";break;case a.DISTROLIST_DISTROLISTTYPE:this.distributionListType=
j;this.bType="d";break;case a.SHAREDGROUP_NAME:this.name=j;this.bType="d";f=!0;break;case a.SHAREDGROUP_ENTRY:this.composeValue=j;this.hasEmail=!0;this.bType="d";f=!0;break;case a.CONTACT_ADDR_BITMAP:this.addressMap=parseInt(j);break;case a.CONTACT_CONTACTTYPE:this.contactType=j;break;case a.CONTACT_COMPANY:this.company=j;break;case a.DISPLAY_CONTACT:this.columnDisplayName=j}if(this.bType=="d"&&f)this.bType="s";if(!this.name)this.name=ws.address.AddressBookUtil.getNameInfoHTML(this,Settings.AddressNameDisplayFormat,
!0)}}));if(!b._hasResource["ws.address.AddressModel"])b._hasResource["ws.address.AddressModel"]=!0,b.provide("ws.address.AddressModel"),b.declare("ws.address.ABList",null,{DELIMITER_RECORD:"\u0001",DELIMITER_FIELD:"\u0002",constructor:function(a,e,f,g){this._data=a;this._compareData=a.toLowerCase();b.mixin(this,e);this.topContactsDL=null;this.topContactsEnabled=f;this.topContactsDLName=g;this.indices={};this.getIndex();this._deletedRecordOffsets=[];this.undoItem=null;this.abHasDistroList=this._compareData.indexOf(this.DISTROLIST_ENTRY)!=
-1;this.getTopContactsInfo();this.topContactsIndex=this.getTopContactsIndex()},getRecordAtOffset:function(a){a+=1;var b=this._data.indexOf(this.DELIMITER_RECORD,a),a=b==-1?this._data.substr(a):this._data.substr(a,b-a);return new ws.address.record(this,a)},getOffsetOfUid:function(a){var b=this._data.indexOf(this.DELIMITER_RECORD+a+this.DELIMITER_FIELD);b==-1&&(b=this._data.indexOf(this.DELIMITER_RECORD+a));return b},getUidOfOffset:function(a){return this._data.substr(a+1,this._data.indexOf(this.DELIMITER_FIELD,
a)-a-1)},getIndex:function(a,b){a||(a="base");this.indices[a]||(this.indices[a]=b?this.buildTypedIndex(b):this.buildIndex());return this.indices[a]},buildIndex:function(){var a=0,b={offsets:[]};if(!this._data)return b;for(;a!=-1;)b.offsets.push(a),a=this._data.indexOf(this.DELIMITER_RECORD,a+1);return b},buildTypedIndex:function(a){for(var e=[],f=0;f<a.length;f++)e.push(this._getMatches("base",null,this.DELIMITER_FIELD+a[f]+this.DELIMITER_FIELD));for(var g=0,f=0;f<e.length;f++)g+=e[f].offsets.length;
for(var a={offsets:[],fields:[],typeIndex:a},h,j,k=b.map(e,function(){return 0});a.offsets.length<g;){h=-1;for(f=0;f<e.length;f++)if(k[f]<e[f].offsets.length&&(h==-1||e[f].offsets[k[f]]<h))h=e[f].offsets[k[f]],j=f;a.offsets.push(h);a.fields.push(j);k[j]+=1}return a},getTopContactsInfo:function(){if(this.abHasDistroList&&this.topContactsEnabled&&this.topContactsDLName){var a=this.getIndex();if(a&&a.offsets&&a.offsets.length>0)for(var b=0;b<a.offsets.length;b++){var f=this.getRecordAtOffset(a.offsets[b]);
if(f&&f.bType=="d"&&f.name==this.topContactsDLName){this.topContactsDL=f;this.topContactsDLOffset=a.offsets[b];break}}}},getTopContactsIndex:function(){var a={offsets:[]},b=this.getIndex();if(b&&this.topContactsDL)for(var f=0;f<b.offsets.length;f++){var g=this.getRecordAtOffset(b.offsets[f]);g&&this.isTopContact(g)&&a.offsets.push(b.offsets[f])}return a},isTopContact:function(a){if(!this.topContactsDL||!a)return!1;if(a.bType=="c"){if(a.name==this.topContactsDL.name)return!0;for(var b=this.topContactsDL.contactUids.split(","),
f=0;f<b.length;f++)if(b[f]==a.uid)return!0}return!1},hasTopContacts:function(){if(this.topContactsDL)return!0;return!1},getMatches:function(a,b,f,g){var f=f.toLowerCase(),g=(g?"":this.DELIMITER_FIELD)+f,g=this._getMatches(a,b,g),h=!1;if(this.abHasDistroList){a=this._getMatches(a,b,", "+f);for(b=0;b<a.offsets.length;b++){h=!1;for(f=0;f<g.offsets.length;f++)a.offsets[b]==g.offsets[f]&&(h=!0);if(!h)g.offsets=g.offsets.concat(a.offsets),g.fields=g.fields.concat(a.fields)}}this._resortIndexWithTopContactsFirst(g);
return g},getMatchesByFieldType:function(a,b,f,g){return this._getMatches(a,b,this.DELIMITER_FIELD+f+this.DELIMITER_FIELD+g.toLowerCase()+this.DELIMITER_FIELD)},_getMatches:function(a,b,f){for(var a=this.getIndex(a||"base",b),b={offsets:[],fields:[]},g=a.offsets[0]-1,h=0,j=a.offsets.length;(g=this._compareData.indexOf(f,g+1))!=-1;){for(;a.offsets[h]<g&&h<j;)h++;var k=h-1,l=a.offsets[k],o=this._compareData.indexOf(this.DELIMITER_RECORD,l+1);if(!(o!=-1&&o<g)){if(f.indexOf(this.DISTROLIST_ENTRY)>0){for(var n=
-1,p=g-2;p>=0;p--)if(this._compareData.charAt(p)==this.DELIMITER_FIELD){n=p;break}if(this._compareData.substring(n+1,g)=="0")continue}if(a.fields){g=[];for(n=[];a.offsets[k]==l;){p=o!=-1?this._compareData.substring(l+1,o):this._compareData.substring(l+1);if(p.indexOf(this.DISTROLIST_ENTRY,0)>-1){var x=p.indexOf(this.DISTROLIST_NAME,0),q=p.indexOf(this.DELIMITER_FIELD,x+2);if(p.substring(x+1,q).indexOf(f)==-1)break}n.unshift(l);g.unshift(a.fields[k]);k--}b.offsets.push.apply(b.offsets,n);b.fields.push.apply(b.fields,
g)}else b.offsets.push(l);if(h==j)break;g=a.offsets[h]}}this._removeOffsetsFromIndex(b,this._deletedRecordOffsets);this._resortIndexWithTopContactsFirst(b);return b},getRolodex:function(a,b,f){a=this.getIndex(a,b);if(a.rolodex&&this.rolodexIsCurrent)return a.rolodex;a.rolodex=[];for(var b={},g=0;g<ws.string.alphabet.length;g++)b[ws.string.alphabet.charAt(g)]=-1;for(var h=g=0;g<a.offsets.length;){var j=a.offsets[g],k=g+1>=a.offsets.length?-1:a.offsets[g+1];if(j==k)g++;else{if(j=this._compareData.substring(j,
k==-1?this._compareData.length:k))if(j=this._getNextOffsetForRolodexTypes(f,j),j.nextOffset!=-1)j=j.nextLetter,b[j]==-1&&(b[j]=h);g++;h=g}}for(g=0;g<ws.string.alphabet.length;g++)j=ws.string.alphabet.charAt(g),a.rolodex.push(b[j]);this.rolodexIsCurrent=!0;return a.rolodex},_getNextOffsetForRolodexTypes:function(a,b){var f=-1,g,h="",j=b.indexOf(this.CONTACT_SNAME);j==-1&&(j=b.indexOf(this.CONTACT_EMAIL1));j==-1&&(j=b.indexOf(this.CONTACT_EMAIL2));j==-1&&(g=b.indexOf(this.DELIMITER_FIELD+this.DISTROLIST_NAME+
this.DELIMITER_FIELD)!=-1);if(g){var k=b.indexOf(this.DISTROLIST_COUNT)+2;b.charAt(k)!="0"&&(k=this.DELIMITER_FIELD+this.DISTROLIST_NAME+this.DELIMITER_FIELD,f=b.indexOf(k),h=b.substring(f+k.length,f+k.length+1).toLowerCase())}else{a.primary&&(k=this.DELIMITER_FIELD+a.primary+this.DELIMITER_FIELD,f=b.indexOf(k));f==-1&&a.secondary&&(k=this.DELIMITER_FIELD+a.secondary+this.DELIMITER_FIELD,f=b.indexOf(k));if(f==-1&&a.other.length)for(g=0;g<a.other.length;){k=this.DELIMITER_FIELD+a.other[g]+this.DELIMITER_FIELD;
f=b.indexOf(k);if(f>-1)break;g++}f!=-1&&(h=b.substring(f+k.length,f+k.length+1).toLowerCase())}return{nextOffset:f,nextLetter:h}},deleteRecordsByOffset:function(a){for(var e in this.indices)this._removeOffsetsFromIndex(this.indices[e],a);if(this.topContactsDLOffset&&b.indexOf(a,this.topContactsDLOffset)!=-1)this.topContactsDLOffset=this.topContactsDL=this.topContactsIndex=null;this.topContactsIndex&&this.topContactsIndex.offsets.length>0&&this._removeOffsetsFromIndex(this.topContactsIndex,a);this._deletedRecordOffsets.push.apply(this._deletedRecordOffsets,
a)},_resortIndexWithTopContactsFirst:function(a){if(a&&a.offsets&&a.offsets.length&&this.topContactsIndex&&this.topContactsIndex.offsets.length)for(var e=0,f=0;a.offsets.length>0&&f<a.offsets.length;){if(b.indexOf(this.topContactsIndex.offsets,a.offsets[f])!=-1){if(this.topContactsDL&&a.offsets[f]==this.topContactsDLOffset){a.offsets.splice(f,1);a.fields&&a.fields.length>0&&a.fields.splice(f,1);continue}var g=a.offsets[f];a.offsets.splice(f,1);a.offsets.splice(e,0,g);a.fields&&a.fields.length>0&&
(g=a.fields[f],a.fields.splice(f,1),a.fields.splice(e,0,g));e++}f++}},_removeOffsetsFromIndex:function(a,e){if(e.length)for(var f,g=0;g<e.length;g++)for(;(f=b.indexOf(a.offsets,e[g]))!=-1;)a.offsets.splice(f,1),a.fields&&a.fields.splice(f,1)}}),b.declare("ws.address.AddressModelCore",null,{sortByTypes:["None","FirstLastNick","LastFirstNick","NickFirstLast","PreferredEmail","ScreenName","Email1","Email2","PreferredPhone","Cellular","Fax","HomePhone","Pager","WorkPhone","LastFirstEmailScreenNamePhone",
"FirstLastEmailScreenNamePhone"],sortByTypePrefMap:{FirstLastNick:"Name",LastFirstNick:"Name",NickFirstLast:"Name",PreferredEmail:"PreferredEmail",LastFirstEmailScreenNamePhone:"LastFirstEmailScreenNamePhone",FirstLastEmailScreenNamePhone:"FirstLastEmailScreenNamePhone"},sortDirectionTypes:["Ascending","Descending"],constructor:function(a){this.hash="";this.sortBy=Settings.AddressNameSortOrder?Settings.AddressNameSortOrder:Config.DefaultAddressNameSortOrder;this.oldSortBy=Config.DefaultAddressNameSortOrder;
this.oldSortDirection=this.sortDirection=this.sortDirectionTypes[0];this.errorState=this.loadDataInProgress=this.isSorted=!1;this.categories=null;this.initLoadFinished=!1;if(a&&a.loadData)ws.WebSuite&&ws.WebSuite.initialized&&!ws.WebSuite.deferredInitComplete?(this.waitForDeferredInit=!0,b.subscribe("WSDeferredInit",this,"deferredInit")):this.loadData();b.subscribe("SettingsChanged/General",this,b.hitch(this,"loadData",!0))},loadData:function(a){if(!this.waitForDeferredInit&&!this.loadDataInProgress){this.loadDataInProgress=
!0;if(a)this.sortBy=Settings.AddressNameSortOrder?Settings.AddressNameSortOrder:Config.DefaultAddressNameSortOrder;if(this.sortBy=="LastFirstNick")this.sortBy="LastFirstEmailScreenNamePhone";else if(this.sortBy=="LastFirstNick")this.sortBy="FirstLastEmailScreenNamePhone";if(this.sortBy!=this.oldSortBy||this.sortDirection!=this.oldSortDirection||this.isSorted||!a)this._autoCompleteContacts({hash:this.hash,sortBy:this.sortBy,sortDirection:this.sortDirection},!0),this.oldSortBy=this.sortBy,this.oldSortDirection=
this.sortDirection;else if(a)this.loadDataInProgress=!1}},sortData:function(a,e){if(a&&this.sortDirection&&!(!a in this.sortByTypePrefMap)){if(this.sortBy=="LastFirstNick")this.sortBy="LastFirstEmailScreenNamePhone";else if(this.sortBy=="FirstLastNick")this.sortBy="FirstLastEmailScreenNamePhone";if(this.sortBy!=a||this.sortDirection!=e)this.sortBy=a,this.sortDirection=e,this.isSorted=!0,this._autoCompleteContacts({sortBy:this.sortBy,sortDirection:this.sortDirection},!0);else if(this.sortBy=="FirstLastEmailScreenNamePhone")this.isSorted=
!0,b.publish("ws.address.AddressModel.coreUpdated",[!0])}},_autoCompleteContacts:function(a,e){var f={action:"AutoCompleteContacts",content:a?a:{},async:Settings.AsynchronousAddressBook?!0:!1,load:b.hitch(this,function(a){if("listString"in a){this.hash=a.hash;this.unorderedCategories=a.categories;this.userCategories=[];this.categories=[];for(var f=0,j=0;j<this.unorderedCategories.length;j++)switch(this.unorderedCategories[j]){case "Family":this.categories[0]="Family";break;case "Friends":this.categories[1]=
"Friends";break;case "Co-Workers":this.categories[2]="Co-Workers";break;case "Auto-Added":this.categories[3]="Auto-Added";break;case "Uncategorized":this.categories[4]="Uncategorized";break;case "General":this.categories[5]="General";break;default:this.userCategories[f]=this.unorderedCategories[j],f++}for(f=0;f<this.userCategories.length;f++)this.categories.push(this.userCategories[f]);this.topContactsEnabled=a.tcenabled&&Config.TopContactsEnabled&&Settings.EnableTopContacts||!1;this.topContactsDLName=
a.tcname||"";this.loadDataInProgress=!1;this.initLoadFinished=!0;e?(this.abListCustomSort=new ws.address.ABList(a.listString,a.listFields,this.topContactsEnabled,this.topContactsDLName),b.publish("ws.address.AddressModel.coreUpdated",[e]),this.coreUpdated(e)):(this.abList=new ws.address.ABList(a.listString,a.listFields,this.topContactsEnabled,this.topContactsDLName),b.publish("ws.address.AddressModel.coreUpdated"),this.coreUpdated())}}),error:b.hitch(this,function(){this.loadDataInProgress=!1;if(!this.abList)this.errorState=
!0,b.publish("ws.address.AddressModel.loadError");this.initLoadFinished=!0})};ws.io.rpc(f)},coreUpdated:function(){},isLoading:function(){return!this.abList&&(this.waitForDeferredInit||this.loadDataInProgress)},deferredInit:function(){this.waitForDeferredInit=!1;this.loadData()}}),b.declare("ws.address.AddressModel",null,{indexName:null,indexTypes:null,constructor:function(a){a=a||{};if(!this.core)ws.address.AddressModel.prototype.core=new ws.address.AddressModelCore({loadData:Config.EnableAutoCompleteContactsOnStartUp});
this._abList=a.sortable?"abListCustomSort":"abList";this.filteredIndex={offsets:[],fields:[]};this.searchFilteredIndex={offsets:[],fields:[]};this.categoryFilteredIndex={offsets:[],fields:[]};this._isSortableListModel=a.sortable;this._isFullTextSearchable=a.fullTextSearchable;Config.EnableAutoCompleteContactsOnStartUp||a.fetchDataOnInit&&this.initData();this.selectedUids={};b.subscribe("ws.address.AddressModel.coreUpdated",this,"_coreUpdated");b.subscribe("ws.address.AddressModel.loadError",this,
"modelUpdated");b.subscribe("SettingsChanged/AddressNameDisplayFormat",b.hitch(this,function(){this.core[this._abList].rolodexIsCurrent=!1}));this._setIndexTypes()},getActiveAbList:function(){return this.core?this.core[this._abList]:null},initData:function(){this.getActiveAbList()||this.core.loadData()},deferredInit:function(){this.core.deferredInit()},isLoading:function(){return this.core.isLoading()},isErrorState:function(){return this.core.errorState},_coreUpdated:function(a,b){if(this._isSortableListModel)this._abList=
"abListCustomSort",this._updateViews();else if(b)this._abList="abList",this._updateViews()},_updateViews:function(){this._setIndexTypes();!this.currentTextSearch&&!this.currentCategorySearch?this.modelUpdated(!0):(this.currentTextSearch&&this.search(this.currentTextSearch,!0),this.currentCategorySearch&&this.categoryFilter(this.currentCategorySearch,!0))},modelUpdated:function(){},change:function(){},getCategories:function(){return this.core.categories},getUnorderedCategories:function(){return this.core.unorderedCategories},
getCurrentCategorySearchString:function(){var a=null;if(typeof this.currentCategorySearch=="undefined")a=null;else if(null!==this.currentCategorySearch&&this.currentCategorySearch!=""&&null!=this.getCategories())try{a=this.getUnorderedCategories()[this.currentCategorySearch]}catch(b){a=null}return a},getRow:function(a){return this.core[this._abList].getRecordAtOffset(this.getOffsetForRow(a))},getSearchString:function(){return this.currentTextSearch},searchDLName:function(a){var b=null;if(!this.core||
!this.core[this._abList])return null;a&&(b=this.core[this._abList].getMatchesByFieldType(null,null,this.core[this._abList].DISTROLIST_NAME,a));for(var f=0;f<b.offsets.length;f++){var g=this.core[this._abList].getRecordAtOffset(b.offsets[f]);if(g.bType=="d"&&g.name.toLowerCase()==a.toLowerCase())return g}return null},search:function(a,b){this.currentTextSearch=a;this.selectedUids={};if(this.core[this._abList]){if(a!=null)this.searchFilteredIndex=this.core[this._abList].getMatches(this.indexName,this.indexTypes,
a,this._isFullTextSearchable);this.handleFilters(b)}},categoryFilter:function(a,b){this.selectedUids={};this.currentCategorySearch=a=a.toString();if(this.core[this._abList]){if(a&&this.core[this._abList])this.categoryFilteredIndex=a==Config.Strings.TopContacts_DisplayName?this.core[this._abList].topContactsIndex:this.core[this._abList].getMatchesByFieldType(this.indexName,this.indexTypes,this.core[this._abList].CONTACT_CATEGORY,a);this.handleFilters(b)}},handleFilters:function(a){if(this.currentTextSearch&&
this.currentCategorySearch)this.filteredIndex={offsets:ws.lang.intersection(this.searchFilteredIndex.offsets,this.categoryFilteredIndex.offsets)};else if(this.currentTextSearch)this.filteredIndex=this.searchFilteredIndex;else if(this.currentCategorySearch)this.filteredIndex=this.categoryFilteredIndex;this.modelUpdated(a)},getRecordByUID:function(a){return this.getRow(this.getRowForUid(a))},getRecordByScreenName:function(a){if(this.core[this._abList])for(var b=this.core[this._abList].getMatchesByFieldType(null,
null,this.core[this._abList].CONTACT_SNAME,a),f=0;f<b.offsets.length;f++){var g=this.core[this._abList].getRecordAtOffset(b.offsets[f]);if(g.screenName.toLowerCase()==a.toLowerCase())return g}return null},getRecordByEmail:function(a){if(!a)return null;if(this.core[this._abList]){for(var e=this.core[this._abList].getMatchesByFieldType(null,null,this.core[this._abList].CONTACT_EMAIL1,a),f=0;f<e.offsets.length;f++){var g=this.core[this._abList].getRecordAtOffset(e.offsets[f]);if(g.email1&&g.email1.toLowerCase()==
a.toLowerCase())return g}e=this.core[this._abList].getMatchesByFieldType(null,null,this.core[this._abList].CONTACT_EMAIL2,a);for(f=0;f<e.offsets.length;f++)if(g=this.core[this._abList].getRecordAtOffset(e.offsets[f]),g.email2&&g.email2.toLowerCase()==a.toLowerCase())return g}if((a=ws.presence.parseEmailAddress(a))&&b.indexOf(Config.KnownDomains,a.domain)!=-1)return this.getRecordByScreenName(a.name);return null},clearRolodex:function(){var a=this.core[this._abList];if(a)a.rolodexIsCurrent=!1},getRolodex:function(){var a=
Settings.AddressNameSortOrder;if(this.core[this._abList]){var b={};b.primary=a.indexOf("First")==0?this.core[this._abList].CONTACT_FNAME:this.core[this._abList].CONTACT_LNAME;b.secondary=a.indexOf("First")==0?this.core[this._abList].CONTACT_LNAME:this.core[this._abList].CONTACT_FNAME;b.other=[];this.core[this._abList].CONTACT_NNAME&&b.other.push(this.core[this._abList].CONTACT_NNAME);this.core[this._abList].CONTACT_EMAIL1&&b.other.push(this.core[this._abList].CONTACT_EMAIL1);this.core[this._abList].EMAIL2&&
b.other.push(this.core[this._abList].CONTACT_EMAIL2);this.core[this._abList].CONTACT_SNAME&&b.other.push(this.core[this._abList].CONTACT_SNAME);return this.core[this._abList].getRolodex(this.indexName,this.indexTypes,b)}else{a=[];for(b=0;b<ws.string.alphabet.length;b++)a[b]=-1;return a}},deleteAddresses:function(a){if(typeof a.rows!="undefined")a.uids=this.getUidsForRows(a.rows);this._addressAction("Delete",a);this._removeAddressesLocal(a.uids)},getContact:function(a){a.uids=[a.uid.toString()];this._addressAction("GetContact",
a)},getDistributionList:function(a){a.uids=[a.uid.toString()];this._addressAction("GetDistributionList",a)},createOrModifyContact:function(a){a.uids=[a.uid.toString()];this._addressAction("CreateOrModifyContact",a);this.core.loadData()},createOrModifyDistributionList:function(a){a.uids=[a.uid.toString()];this._addressAction("CreateOrModifyDistributionList",a);this.core.loadData()},importContacts:function(a){this._addressAction("Import",a);this.core.loadData()},exportContacts:function(a){this._addressAction("Export",
a);this.core.loadData()},addAddressToTopContacts:function(a){this._addressAction("AddAddressToTopContacts",a);this.core.loadData()},addContactToTopContacts:function(a){a.uids=[a.uid.toString()];this._addressAction("AddContactToTopContacts",a);this.core.loadData()},addAddressToNegativeTopContacts:function(a){this._addressAction("AddAddressToNegativeTopContacts",a)},addContactToNegativeTopContacts:function(a){a.uids=[a.uid.toString()];this._addressAction("AddContactToNegativeTopContacts",a)},removeAddressFromTopContacts:function(a){this._addressAction("RemoveAddressFromTopContacts",
a);this.core.loadData()},removeContactFromTopContacts:function(a){a.uids=[a.uid.toString()];this._addressAction("RemoveContactFromTopContacts",a);this.core.loadData()},_addressAction:function(a,b){b.addressAction=a;var f=b.formNode;delete b.formNode;ws.io.rpc({action:"AddressAction",content:b,formNode:f,async:Settings.AsynchronousAddressBook?!0:!1,load:b.load,error:b.error})},_removeAddressesLocal:function(a){if(this.core[this._abList]){var e=this.getOffsetsForUids(a,this._abList);this.core[this._abList].deleteRecordsByOffset(e);
this._abList=="abListCustomSort"&&this.core.abList?(e=this.getOffsetsForUids(a,"abList"),this.core.abList.deleteRecordsByOffset(e)):this._abList=="abList"&&this.core.abListCustomSort&&(e=this.getOffsetsForUids(a,"abListCustomSort"),this.core.abListCustomSort.deleteRecordsByOffset(e));b.forEach(a,function(a){a in this.selectedUids&&delete this.selectedUids[a]},this);this.core.abListCustomSort?b.publish("ws.address.AddressModel.coreUpdated",[!0]):b.publish("ws.address.AddressModel.coreUpdated");this.rolodexIsCurrent=
!1}},undoDeletedItem:function(){var a=this.getUndoItem();if(a)a.uid=0,"composeValue"in a?(a.contactUids=b.map(a.contacts,function(a){return a.uid}),a.error=function(){},this.createOrModifyDistributionList(a)):(a.error=function(){},this.createOrModifyContact(a)),this.setUndoItem()},setUndoItem:function(a){this.core.undoItem=a?a:null},getUndoItem:function(){return this.core.undoItem},_setIndexTypes:function(){},_getFullIndex:function(){return this.currentTextSearch||this.currentCategorySearch?this.filteredIndex:
this.core[this._abList]?this.core[this._abList].getIndex(this.indexName,this.indexTypes):{offsets:[],fields:[]}},_getOffsetIndex:function(){return this._getFullIndex().offsets},getOffsetForRow:function(a){return this._getOffsetIndex()[a]},getOffsetsForUids:function(a,b){for(var f=[],g=b?b:this._abList,h=0;h<a.length;h++)f.push(this.core[g].getOffsetOfUid(a[h]));return f},getUidForRow:function(a){return this.core[this._abList].getRecordAtOffset(this._getOffsetIndex()[a]).uid},getRowForUid:function(a){a=
this.core[this._abList].getOffsetOfUid(a);return a!=-1?b.indexOf(this._getOffsetIndex(),a):-1},getUidsForRows:function(a){var b=[];if(this.core[this._abList])for(var f=0;f<a.length;f++)b.push(this.getUidForRow(a[f]));return b},getRowsForUids:function(a){var b=[];if(this.core[this._abList])for(var f=0;f<a.length;f++)b.push(this.getRowForUid(a[f]));return b},getRowCount:function(){return this._getOffsetIndex().length},toggleSelectRow:function(a,b){this.core[this._abList]&&this.toggleSelectUid(this.getUidForRow(a),
b)},toggleSelectUid:function(a,b){(b=typeof b=="undefined"?!this.isSelected(a):b)?this.selectedUids[a]=!0:delete this.selectedUids[a];this.change(this.getRowForUid(a))},selectRange:function(a,b,f){for(;a<=b;a++)this.toggleSelectRow(a,f);return!0},selectAll:function(){this.selectedUids={};for(var a=this._getOffsetIndex(),b=0;b<a.length;b++)this.selectedUids[this.core[this._abList].getUidOfOffset(a[b])]=!0;this.modelUpdated();return!0},deselectAll:function(){this.selectedUids={};this.modelUpdated()},
getSelectedUids:function(){var a=[],b;for(b in this.selectedUids)a.push(b);return a},isSelected:function(a){return a in this.selectedUids},isAllInViewSelected:function(){return this.isAllSelected()},isAllSelected:function(){var a=this.getSelectedUids();return a.length>0&&this._getOffsetIndex().length==a.length},isAllSelReal:function(){return this.isAllSelected()},isAnySelected:function(){return!ws.lang.isEmptyObject(this.selectedUids)},isTopContact:function(a){return this.core[this._abList].isTopContact(this.core[this._abList].getRecordAtOffset(this._getOffsetIndex()[a]))},
isUidTopContact:function(a){return this.core[this._abList].isTopContact(this.getRecordByUID(a))},topContactsEnabled:function(){if(this.core&&this.core[this._abList]&&this.core[this._abList].topContactsEnabled)return!0;return!1},hasTopContacts:function(){if(!this.topContactsEnabled())return!1;return this.core[this._abList].hasTopContacts()}}),ws.address.AddressModel.onMainWindowClosed=function(){ws.address.AddressModel.prototype.core=new ws.address.AddressModelCore({loadData:Config.EnableAutoCompleteContactsOnStartUp});
ws.address.AddressModel.prototype.core.deferredInit()},b.declare("ws.address.AllAddressModel",ws.address.AddressModel,{indexName:"emailIndex",_setIndexTypes:function(){if(this.core){var a=this.core[this._abList];if(a)this.indexTypes=Config.AddScreenNameToAutoComplete==!0?[a.CONTACT_SNAME,a.CONTACT_EMAIL1,a.CONTACT_EMAIL2,a.DISTROLIST_ENTRY,a.SHAREDGROUP_ENTRY]:[a.CONTACT_EMAIL1,a.CONTACT_EMAIL2,a.DISTROLIST_ENTRY,a.SHAREDGROUP_ENTRY]}},getRow:function(a){var b=this._getFullIndex();if(this.indexTypes&&
b){var f=this.core[this._abList].getRecordAtOffset(b.offsets[a]);switch(this.indexTypes[b.fields[a]]){case this.core[this._abList].CONTACT_SNAME:f.composeValue=f.screenName;break;case this.core[this._abList].CONTACT_EMAIL1:f.composeValue=f.email1;break;case this.core[this._abList].CONTACT_EMAIL2:f.composeValue=f.email2}return f}else return null},deleteAddresses:null,_removeAddressesLocal:null,toggleSelectRow:null,toggleSelectUid:null,selectRange:function(){return!1},selectAll:function(){return!1},
deselectAll:null,getSelectedUids:function(){return[]},isSelected:function(){return!1},isAllSelected:function(){return!1},isAllSelReal:function(){return!1},getRowForUid:null,getRowsForUids:null});b._hasResource["ws.address.PeoplePicker"]||(b._hasResource["ws.address.PeoplePicker"]=!0,b.provide("ws.address.PeoplePicker"),b.declare("ws.address.PeoplePickerGridModel",l.grid.data.Dynamic,{columns:{NameAndEmail:0},modelUpdated:function(){},constructor:function(a,e,f){this.model=f;b.connect(this.model,"modelUpdated",
this,"modelUpdated")},getDatum:function(a,b){var f=this.model.getRow(a);if(f==null)return"Contact Error";switch(b){case this.columns.NameAndEmail:var g=f.bType=="c"||f.bType=="s"?f.composeValue:f.count==1?Config.Strings.OneAddress:ws.string.substituteParams(Config.Strings.NAddresses,f.count);return"<span>"+ws.string.escapeXml(f.name)+"</span> "+g}},getRowCount:function(){return this.model.getRowCount()}}),b.declare("ws.address.PeoplePicker",ws.widget.ListView,{templateString:b.cache("ws.address",
"PeoplePicker.html",'<div style="display:none" class="wsMenu">\r\n\t<div class="peoplePicker listView" dojoType="dijit.layout.LayoutContainer" dojoAttachPoint="layoutWidget">\r\n\t\t<div dojoAttachPoint="rolodexPane" dojoType="ws.widget.Pane" layoutAlign="bottom" class="rolodex"></div>\r\n\t\t<div dojoType="ws.widget.Pane" layoutAlign="client">\r\n\t\t\t<div dojoAttachPoint="grid" dojoType="dojox.Grid"></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),css:{templateString:""},wrapperModelClass:ws.address.PeoplePickerGridModel,
showHeader:!1,highlightRow:0,rowHeight:20,autosizeColumnId:"NameAndEmail",initView:function(){this.columns=[{id:"NameAndEmail",width:"75px"}];this.inherited(arguments);this.connect(ws.WebSuite,"processKeyPress","onKeyPress")},showHighlight:function(a){b.toggleClass(this.grid.domNode,"showHighlight",a)},handleCellClick:function(a){if(a=this.model.getRow(a.rowIndex))this.onContactSelected(a)},onContactSelected:function(){},searchAndOpen:function(a,e){this.highlightRow=0;this.model.search(a);if(this.model.isLoading()){this.showRolodex(!1);
if(!a)this.showRolodexHandle=b.connect(this.model,"modelUpdated",b.hitch(this,function(){this.showRolodex(!a);this.onResized();b.disconnect(this.showRolodexHandle);this.showRolodexHandle=null}));ws.widget.popup({popup:this,around:e,padding:this.padding||[0,-1]})}else if(this.model.getRowCount()==0){ws.widget.popup.close(this);return}else this.isShowing()||(this.showRolodex(!a),ws.widget.popup({popup:this,around:e,padding:this.padding||[0,-1]}),this.scrollToRow(0));if(b.isMac&&b.isMoz)this.domNode.style.overflow=
"auto",ws.lang.setTimeout(this,function(){this.domNode.style.overflow=""},0)},move:function(a,e){k.placeOnScreenAroundElement(this.popupNode,a,{BL:"TL",TL:"BL"});if(e){var f=b.coords(this.popupNode);if(e.offsetHeight)this.popupNode.style.top=f.t+e.offsetHeight+"px";if(e.offsetWidth)this.popupNode.style.left=f.l+e.offsetWidth+"px"}},close:function(){ws.widget.popup.close(this)},onOpen:function(){this.onResized()},onClose:function(){},showRolodex:function(a){this.rolodexPane.setShowing(a);if(a){if(!this.rolodexBuilt){var e=
Array(ws.string.alphabet.length);ucLetters=ws.string.alphabet.toUpperCase();for(a=0;a<ws.string.alphabet.length;a++)e.push('<span class="wsLink">'+ucLetters.charAt(a)+"</span>");this.rolodexPane.domNode.innerHTML=e.join("");this.connect(this.rolodexPane.domNode,"onclick",b.hitch(this,"scrollToLetter"));this.rolodexBuilt=!0}e=b.query("span",this.domNode);for(a=0;a<ws.string.alphabet.length;a++)b.toggleClass(e[a],"ppLinkDisabled",this.model.getRolodex()[a]==-1)}},scrollToLetter:function(a){if(a.target&&
(a=a.target.innerHTML)&&a.length==1)if(a=ws.string.alphabet.indexOf(a.toLowerCase()),a=this.model.getRolodex()[a],a!=-1){this.scrollToRow(a);var b=this.grid.rows.overRow;this.grid.rows.setOverRow(a);this.onMouseOutRow({rowIndex:b});this.onMouseOverRow({rowIndex:a})}},processKeyPress:function(a){if(!this.isShowing())return!1;var e=!0;switch(a.keyCode){case b.keys.TAB:case b.keys.ENTER:this.onContactSelected(this.model.getRow(this.highlightRow));break;case b.keys.DOWN_ARROW:this.setHighlightRow(this.highlightRow+
1,!0);break;case b.keys.UP_ARROW:this.setHighlightRow(this.highlightRow-1,!1);break;case b.keys.ESCAPE:ws.widget.popup.close(this);break;default:e=!1}e&&a.preventDefault();return e},setHighlightRow:function(a,b){a<0?a=0:a>=this.model.getRowCount()&&(a=this.model.getRowCount()-1);this.highlightRow=a;var f=this.grid.views.views[0];if(f.getCellNode(this.highlightRow,0)){var g=!1;if(b){var h=Math.floor((f.scrollboxNode.scrollTop+this.grid.scroller.windowHeight)/this.rowHeight-1);this.highlightRow>h&&
(g=!0)}else h=Math.floor(f.scrollboxNode.scrollTop/this.rowHeight+1),this.highlightRow<h&&(g=!0);g&&this.scrollOnKeyPress(b?f.scrollboxNode.scrollTop+this.rowHeight:f.scrollboxNode.scrollTop-this.rowHeight)}this.model.modelUpdated()},getRowClasses:function(a){var b=this.inherited(arguments);a==this.highlightRow&&b.push("row-highlight");this.model.isTopContact(a)&&b.push("row-top-contact");return b},getHighlightedContact:function(){return this.model.getRowCount()>0?this.model.getRow(0):null},onKeyPress:function(a){this.isShowing()&&
this._onKeyPress(a)},onEnterKeyPress:function(a){this.onContactSelected(this.model.getRow(a))},onOtherKeyPress:function(a){if(Config.EnableKeyboardShortcuts)switch(a.keyCode){case b.keys.ESCAPE:ws.widget.popup.close(this)}}}));b._hasResource["ws.address.AddressField"]||(b._hasResource["ws.address.AddressField"]=!0,b.provide("ws.address.AddressField"),b.declare("ws.address.AddressField",[k._Widget,k._Templated],{templateString:"<textarea dojoAttachPoint='field' dojoAttachEvent='onkeydown: onKeyDown, onkeypress: onKeyPress, onfocus: onFocus, onblur: onBlur' tabindex='${tabindex}' class='wsInput ${className}' style='float: left; height: 18px; overflow-x: hidden; overflow-y: auto; width: ${fieldWidth}; padding: 1px 2px;'>${value}</textarea>",
value:"",defaultValue:"",_wordSeparators:";,",_pickerActive:!1,_pickerMode:"explicit",tabindex:500,minHeight:b.isMac?16:17,maxHeight:60,fieldWidth:"90%",className:"",startup:function(){this.setValue(this.value);ws.browser.ipad&&this.field.setAttribute("autocorrect","off")},postCreate:function(){this.inherited(arguments);this.selectedContacts=[];this.createPeoplePicker();this.connect(this.peoplePicker,"onContactSelected","onContactSelected");this.connect(this.peoplePicker,"onClose",b.hitch(this,function(){this._pickerActive=
!1}))},createPeoplePicker:function(){if(!this.peoplePicker)ws.address.AddressField.prototype.peoplePicker=new ws.address.PeoplePicker,this.peoplePicker.setModel(new ws.address.AllAddressModel({fetchDataOnInit:!1,sortable:!0})),this.peoplePicker.model.core.sortData(Settings.AddressNameSortOrder?Settings.AddressNameSortOrder:Config.DefaultAddressNameSortOrder,"Ascending"),this.peoplePicker.model.initData()},togglePeoplePicker:function(a){this._pickerActive?this.peoplePicker.close():(this.peoplePicker.showHighlight(!1),
this.peoplePicker.searchAndOpen("",this._getAnchorNode(a)),clearTimeout(this.keypressTimeout),this._pickerActive=!0,this._pickerMode="explicit",this.field.focus())},getValue:function(){return this.field.value==this.defaultValue?"":b.trim(this.field.value)},setValue:function(a,e,f){this.selectedContacts=[];a==this.defaultValue?this.field.value=a:((a=a||"")&&typeof a=="string"&&(a=a.replace(/\s+$/,"")),this.field.value=b.trim(a)==""?this.defaultValue:this.declaredClass!="ws.address.SingleAddressField"&&
!(a.charAt(a.length-1)==";"||a.charAt(a.length-1)==",")?a+", ":e?a:a+" ");this.resizeSelf(f);this._updateClass()},_updateClass:function(){this.defaultValue!=""&&b.toggleClass(this.field,"wsInputDefault",this.field.value==this.defaultValue)},onFocus:function(){b.publish("AddressFieldFocusChange",[this]);if(this.field.value==this.defaultValue)this.field.value="";this._updateClass();this.field.focus()},onBlur:function(){b.publish("AddressFieldBlurChange",[this]);if(b.trim(this.field.value)=="")this.field.value=
this.defaultValue;this._updateClass()},onKeyDown:function(a){if(b.isIE)if(a.keyCode==b.keys.ESCAPE)this._pickerActive&&this.peoplePicker.close(),a.preventDefault();else if(a.keyCode==b.keys.BACKSPACE)this.onKeyPress(a)},onKeyPress:function(a){a.stopPropagation();if(this._pickerActive&&this.peoplePicker.processKeyPress(a))b.publish("AddressFieldKeyPressHandle",[this,a.keyCode,!0]);else if(b.publish("AddressFieldKeyPressHandle",[this,a.keyCode,!1]),a.keyCode==b.keys.ENTER)b.stopEvent(a);else{if(a.target.selectionStart==
a.target.textLength&&(a.keyChar==";"||a.keyChar==","))this.field.value+=a.keyChar+" ",b.stopEvent(a);this.keypressTimeout&&clearTimeout(this.keypressTimeout);this.keypressTimeout=ws.lang.setTimeout(this,"_onKeyPress",100,a);this.resizeTimeout&&clearTimeout(this.resizeTimeout);this.resizeTimeout=ws.lang.setTimeout(this,"resizeSelf",150)}},_getAnchorNode:function(a){var b=a&&a.domNode?a.domNode:null;return b=!b&&a&&a.tagName?a:this.anchorNode||this.field},_onKeyPress:function(){var a=this.matchText();
a==null&&(a="");if(b.trim(a)=="")this._pickerActive&&this.peoplePicker.close();else if(this.field.value!=this._lastValue)this._pickerMode="autocomplete",this.peoplePicker.showHighlight(!0),this.peoplePicker.searchAndOpen(a,this._getAnchorNode()),this._pickerActive=this.peoplePicker.isShowing();this._lastValue=this.field.value},matchText:function(){var a=this.field.value,b=this._lastValue?this._lastValue:"",f=this._wordSeparators,g=-1;if(a==b)return this._matchValue;var h=a.length>b.length?b.length:
a.length;for(i=0;i<h;++i)if(a.charAt(i)!=b.charAt(i)){g=i;break}g<0&&(g=a.length-1);for(b=g;b>0&&f.indexOf(a.charAt(b))<0;)--b;for(;g<a.length&&f.indexOf(a.charAt(g))<0;)g++;for(a=a.substring(b,g);a.length>0&&(f.indexOf(a.charAt(0))>=0||a.charAt(0)==" ");)a=a.substring(1),++b;this._matchValue=a.toLowerCase();this._matchStart=b;this._matchEnd=g;return a},onContactSelected:function(a){if(this._pickerActive&&a){this.selectedContacts.push(a);var e=a.composeValue;if(b.trim(e)!=""){if(this._pickerMode==
"autocomplete"){this.matchText();if(this.declaredClass!="ws.address.SingleAddressField"){if(this._matchEnd==this.field.value.length&&(e+=", "),this._matchStart>=0&&this._matchEnd>=0)this.field.value=this.field.value.substring(0,this._matchStart)+e+this.field.value.substring(this._matchEnd)}else this.field.value=e;this.setInsertionPoint(-1);this.clearMatch();this.peoplePicker.close()}else if(e=this.field.value,e=e.replace(/^\s+/,""),e=e.replace(/\s+$/,""),this.field.value=e,this.declaredClass!="ws.address.SingleAddressField")b.trim(e)==
""?this.field.value=a.composeValue+", ":this.field.value+=e.charAt(e.length-1)==";"||e.charAt(e.length-1)==","?" "+a.composeValue+", ":", "+a.composeValue+", ",this.scrollToEnd();this.resizeSelf();this.focus()}}},setInsertionPoint:function(a){this.setSelectionRange(a,a);a<0&&this.scrollToEnd()},setSelectionRange:function(a,b){if(a<0||a>this.field.value.length)a=this.field.value.length;if(b<0||b>this.field.value.length)b=this.field.value.length;b<a&&(b=a);if(this.field.setSelectionRange)this.field.setSelectionRange(a,
b);else if(this.field.createTextRange){var f=this.field.createTextRange();f.collapse(!0);f.moveEnd("character",b);f.moveStart("character",a);f.select()}},clearMatch:function(){this._matchValue="";this._insertionPoint=this._matchEnd=this._matchStart=-1;this._lastValue=this.value},focus:function(a){a=a?a:0;try{this.field.focus()}catch(b){a<3&&(a++,ws.lang.setTimeout(this,this.focus,200,a))}},resizeSelf:function(){this.createMeasureNode();this.measureNode.innerHTML=this.field.value.replace(/\n/g,"<br>");
this.measureNode.style.width=parseInt(this.field.style.width)+"px";var a=Math.min(this.maxHeight,Math.max(this.minHeight,b.contentBox(this.measureNode).h));if(a!=parseInt(this.field.style.height))this.field.style.height=a+"px",this._pickerActive&&this.peoplePicker.move(this.field),this.onResizedSelf()},createMeasureNode:function(){if(!this.measureNode)this.measureNode=b.create("div",{style:{position:"absolute",visibility:"hidden",top:"-10000px",left:"10000px",fontSize:"12px"}},b.body())},onResizedSelf:function(){},
scrollToEnd:function(){this.field.scrollTop=1E4}}),b.declare("ws.address.SingleAddressField",ws.address.AddressField,{templateString:"<input maxlength='${maxlength}' type='text' dojoAttachPoint='field' dojoAttachEvent='onkeydown: onKeyDown, onkeypress: onKeyPress' tabindex='${tabindex}' class='wsInput' style='width: ${fieldWidth};' value='${value}' />",maxlength:Config.MaxFilterFieldLength,resizeSelf:function(){},scrollToEnd:function(){}}));b._hasResource["ws.mail.MailFilterModel"]||(b._hasResource["ws.mail.MailFilterModel"]=
!0,b.provide("ws.mail.MailFilterModel"),b.declare("ws.mail.MailFilterModel",null,{filterId:-1,priority:-1,filterName:"",from:"",to:"",cc:"",bcc:"",subject:"",messageContains:"",filterType:"",moveToFolder:"",tagName:"",filterAlertOnlineAIM:!1,filterAlertDevice:!1,filterAlertDeviceId:-1,deviceNumber:"",setFilter:function(a,b){this.priority=b;this.filterId=a.filterId;this.filterName=a.filterName;this.from=a.from;this.to=a.to;this.cc=a.cc;this.bcc=a.bcc;this.subject=a.subject;this.messageContains=a.messageContains;
this.filterType=a.filterType;for(var f=0;f<a.actionList.length;f++){var g=a.actionList[f];switch(g.type){case "FOLDER":this.moveToFolder=g.folder;break;case "ALERTS":this.filterAlertOnlineAIM=g.online;this.filterAlertDevice=g.device;this.filterAlertDeviceId=g.deviceId;this.deviceNumber=g.deviceNumber;break;case "TAG":this.tagName=g.tagName}}},createFilter:function(a){b.mixin(a,this);this._filterAction("Create",a)},deleteFilter:function(a){b.mixin(a,this);this._filterAction("Delete",a)},modifyFilter:function(a){b.mixin(a,
this);this._filterAction("Modify",a)},_filterAction:function(a,b){b.filterAction=a;ws.io.rpc({action:"FilterAction",content:b,load:b.load,error:b.error})}}),b.declare("ws.mail.MailFilters",null,{filters:[],add:function(a,b){var f=new ws.mail.MailFilterModel;f.setFilter(a,b);this.filters.push(f)},addAll:function(a){for(var b=0;b<a.length;b++)(Config.ShowStacksOnUI||a[b].filterType!="stack")&&this.add(a[b],b+1)},clear:function(){this.filters=[]},get:function(a){return this.filters[a]},size:function(){return this.filters.length},
updatePriority:function(a){this._filterAction("UpdatePriority",a)},loadFromRpc:function(a){this._filterAction("GetList",a)},getMobileNumber:function(a){this._filterAction("GetMobileNumber",a)},_filterAction:function(a,b){b.filterAction=a;ws.io.rpc({action:"FilterAction",content:b,load:b.load,error:b.error})}}));b._hasResource["ws.mail.MailFilterModalPane"]||(b._hasResource["ws.mail.MailFilterModalPane"]=!0,b.provide("ws.mail.MailFilterModalPane"),b.declare("ws.mail.MailFilterModalPane",[ws.widget.WSModalPane,
k._Templated],{widgetsInTemplate:!0,templateString:b.cache("ws.mail","MailFilterModalPane.html",'<div class="WSModalPane mailFilterModalPane">\r\n\t<div class="WSModalPaneInner">\r\n\t\t<div class="mainSprite wsCloseBtn" dojoAttachEvent="onclick: onCancel"></div>\r\n\t\t<div class="modalContainer">\r\n\t\t\t<h2 dojoAttachPoint="filterNameLabel">${MailFilter_FilterNameLabel}</h2>\r\n\t\t\t<input type="text" dojoType="ws.widget.DefaultTextbox" dojoAttachPoint="nameField" value="${MailFilter_FilterNameValue}" doValueSelect="true" widgetId="filterName" size="28" maxlength="${maxFilterNameLength}" fieldWidth="250px"></input>\r\n\t\t\r\n\t\t\t<table border="0" cellpadding="0" cellspacing="0" class="filterFormTable">\r\n\t\t\t\t<tbody>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan="4"><h3>${MailFilter_FilterText1}:</h3></td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td width="20%" class="labelCell">${From}</td>\r\n\t\t\t\t\t<td width="30%" class="valueCell"><input type="text" dojoType="ws.address.SingleAddressField" dojoAttachPoint="fromField" defaultValue="${MailFilter_EnterAnEmailAddress}" value="${from}" fieldWidth="200px" dojoAttachEvent="onBlur: checkSpamTip" /></td>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<td width="20%" class="labelCell">${Cc}</td>\r\n\t\t\t\t\t<td width="30%" class="valueCell"><input type="text" dojoType="ws.address.SingleAddressField" dojoAttachPoint="ccField" defaultValue="${MailFilter_EnterAnEmailAddress}" fieldWidth="200px"></input></td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td class="labelCell">${To}</td>\r\n\t\t\t\t\t<td class="valueCell"><input type="text" dojoType="ws.address.SingleAddressField" dojoAttachPoint="toField" defaultValue="${MailFilter_EnterAnEmailAddress}" fieldWidth="200px"></input></td>\r\n\t\t\t\t\t<td class="labelCell">${Bcc}</td>\r\n\t\t\t\t\t<td class="valueCell">\r\n\t\t\t\t\t\t<div dojoType="ws.widget.WSSelect" dojoAttachPoint="bccMenu"></div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\t\t\r\n\t\t\t\t\t<td class="labelCell">${Subject}</td>\r\n\t\t\t\t\t<td class="valueCell"><input type="text" dojoType="ws.widget.DefaultTextbox" dojoAttachPoint="subjectField" defaultValue="${MailFilter_EnterAWordOrPhrase}" value="${subject}" size="28" maxlength="${maxFilterFieldLength}" fieldWidth="200px"></input></td>\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t<td class="labelCell">${MailFilter_ContainsThisWord}</td>\r\n\t\t\t\t\t<td class="valueCell"><input type="text" dojoType="ws.widget.DefaultTextbox" dojoAttachPoint="containsField" defaultValue="${MailFilter_EnterAWordOrPhrase}" value="${alltext}" size="28" maxlength="${maxFilterFieldLength}" fieldWidth="200px"></input></td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan="4"><h3>${MailFilter_FilterText2}</h3></td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan="1" class="labelCell">${MailFilter_MoveToFolder}:</td>\r\n\t\t\t\t\t<td colspan="3" dojoAttachPoint="bottomRow" class="valueCell">\r\n\t\t\t\t\t\t<div dojoType="ws.widget.WSSelect" dojoAttachPoint="moveToFolderSelect" class="folderDroppy" dojoAttachEvent="valueChanged: checkSpamTip"></div>\r\n\t\t\t\t\t\t<div dojoAttachPoint="spamTip" class="spamTip" style="display:none;">\r\n\t\t\t\t\t\t\t<div class="spamTipText">${MailFilter_SpamTip2}</div>\r\n\t\t\t\t\t\t\t<div class="spamTipButtons">\r\n\t\t\t\t\t\t\t\t<div dojoType="ws.widget.Button" toolbarPosition="center" dojoAttachPoint="blockButton" dojoAttachEvent="onClick: spamTipClicked" class="blockButton"></div>\r\n\t\t\t\t\t\t\t\t<a href="#" dojoAttachEvent="onclick: removeSpamTip" class="wsLink NoThanks">${NoThanks}</a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr dojoAttachPoint="DeliveryAlert" style="display:none;">\r\n\t\t\t\t\t<td class="labelCell">${MailFilter_AlertMe}</td>\r\n\t\t\t\t\t<td colspan="3" class="valueCell">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t<div dojoType="ws.widget.Checkbox" dojoAttachPoint="OnlineIMField" style="float:left"></div>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<div dojoType="ws.widget.Checkbox" dojoAttachPoint="DeviceField" style="display:none;float:left;margin-left:30px"></div>\r\n\r\n\t\t\t\t\t\t<div style="float:left;margin-top:6px">\r\n\t\t\t\t\t\t\t<a class="wsLink" href="#" title="${MailFilter_SetupMobilePhone}" dojoAttachPoint="SetupMobilePhoneNode" dojoAttachEvent="onclick: getMobileDevice" style="display:none;">${MailFilter_SetupMobilePhone}</a>\r\n\t\t\t\t\t\t\t<a class="wsLink" href="#" title="${MailFilter_AfterSetupMobilePhone}" dojoAttachPoint="AfterSetupMobilePhoneNode" dojoAttachEvent="onclick: callUDR" style="display:none;">${MailFilter_AfterSetupMobilePhone}</a>\r\n\t\t\t\t\t\t\t<a class="wsLink" href="#" dojoAttachPoint="EditMobilePhoneNode" title="${MailFilter_EditMobilePhone}" dojoAttachEvent="onclick: editMobileClicked" style="display:none;">${MailFilter_Edit}</a>\r\n\t\t\t\t\t\t\t<a class="wsLink" href="#" dojoAttachPoint="AfterEditMobilePhoneNode" title="${MailFilter_AfterEditRefresh}" dojoAttachEvent="onclick: callUDR" style="display:none;">${MailFilter_AfterEditRefresh}</a>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<span dojoAttachPoint="phoneSelectDiv" style="display:none;">\r\n\t\t\t\t\t\t\t\t<span style="float:left;">${Cellular}:</span>\r\n\t\t\t\t\t\t\t\t<div dojoType="ws.widget.WSSelect" dojoAttachPoint="phoneSelect" class="phoneSelect"></div>\r\n\t\t\t\t\t\t\t</span>\t\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\r\n\t\t\t<div dojoType="ws.widget.WSToolbar" vizType="Bare" dojoAttachPoint="toolbar">\r\n\t\t\t\t<div dojoType="ws.widget.Button" toolbarPosition="left" dojoAttachPoint="saveButton" dojoAttachEvent="onClick: onSave">${Create}</div>\r\n\t\t\t\t<div dojoType="ws.widget.Button" toolbarPosition="left" type="Bare" dojoAttachPoint="cancelButton" dojoAttachEvent="onClick: onCancel">${Cancel}</div>\r\n\t\t\t</div>\r\n\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},mailModel:null,filterModel:null,subject:"",from:"",alltext:"",moveToFolder:"",filterAlertOnlineAIM:!1,filterAlertDevice:!1,maxFilterNameLength:Config.MaxFilterNameLength,maxFilterFieldLength:Config.MaxFilterFieldLength,filterList:new ws.mail.MailFilters,kidTeenAccount:ws.UserContext.ParentalControls=="Y"||ws.UserContext.ParentalControls=="K",startup:function(){this.inherited(arguments);this._updateMoveToFolders();this._updateBccMenu();if(ws.UserContext.MailboxType=="ANGELIA"&&
Config.FilterToAlertEnabled&&!this.kidTeenAccount)this.DeliveryAlert.style.display="",this.OnlineIMField.setLabel(ws.string.substituteParams(Config.Strings.MailFilter_DeliverAlertAIM,ws.UserContext.UserScreenName)),this.DeviceField.show(),this.checkDeviceRegistered();this.filterModel?(ws.html.setInnerText(this.filterNameLabel,Config.Strings.MailFilter_FilterEditLabel),this.saveButton.setLabel(Config.Strings.Save),this.fillInForm()):(this.checkFilterListLength(),this.saveButton.setLabel(Config.Strings.Create),
this.setMoveToFolder(this.moveToFolder));this.checkSpamTip();this.domNode.style.zIndex="998";this.bg.style.zIndex="997"},show:function(){this.inherited(arguments);b.isIE==6&&this.nameField.textbox.setFocus()},fillInForm:function(){this.nameField.setValue(this.filterModel.filterName);this.fromField.setValue(this.filterModel.from,!0);this.toField.setValue(this.filterModel.to,!0);this.ccField.setValue(this.filterModel.cc,!0);this.bccMenu.setOptionByValue(this.filterModel.bcc);this.subjectField.setValue(this.filterModel.subject);
this.containsField.setValue(this.filterModel.messageContains);this.setMoveToFolder(this.filterModel.moveToFolder);this.OnlineIMField.setChecked(this.filterModel.filterAlertOnlineAIM);this.DeviceField.setChecked(this.filterModel.filterAlertDevice)},setMoveToFolder:function(a){(!a||!this.moveToFolderSelect.setOptionByValue(a))&&this.moveToFolderSelect.setOption(0)},getErrors:function(){var a=[];b.trim(this.nameField.getValue())==""&&a.push(Config.Strings.MailFilter_ErrorNoFilterName);b.trim(this.fromField.getValue())==
""&&b.trim(this.toField.getValue())==""&&b.trim(this.ccField.getValue())==""&&b.trim(this.bccMenu.currentValue)==""&&b.trim(this.subjectField.getValue())==""&&b.trim(this.containsField.getValue())==""&&a.push(Config.Strings.MailFilter_ErrorNoCriteria);var e=this.fromField.getValue()+this.toField.getValue()+this.ccField.getValue()+this.bccMenu.currentValue;(e.indexOf(" ")!=-1||e.indexOf(",")!=-1||e.indexOf(";")!=-1)&&a.push(Config.Strings.MailFilter_ErrorTooManyWords);ws.UserContext.MailboxType=="ANGELIA"&&
Config.FilterToAlertEnabled?!this.filterToAlertEnabled()&&this.moveToFolderSelect.currentValue==""&&a.push(Config.Strings.MailFilter_ErrorNoMoveToFolderFilterToAlert):this.moveToFolderSelect.currentValue==""&&a.push(Config.Strings.MailFilter_ErrorNoMoveToFolder);(this.invalidCriteria(this.nameField.getValue())||this.invalidCriteria(this.subjectField.getValue())||this.invalidCriteria(this.containsField.getValue()))&&a.push(Config.Strings.MailFilter_ErrorInvalidCriteriaChars);(this.invalidEmail(this.fromField.getValue())||
this.invalidEmail(this.ccField.getValue())||this.invalidEmail(this.toField.getValue()))&&a.push(Config.Strings.MailFilter_ErrorInvalidEmailChars);return a},filterToAlertEnabled:function(){return this.OnlineIMField.checked||this.DeviceField.checked?!0:!1},onCancel:function(){var a=Config.Strings.ConfirmSaveSettings,a=a.replace(/\\n/g,"\n");if(this.filterModel)if(this.nameField.getValue()==this.filterModel.filterName&&this.fromField.getValue()==this.filterModel.from&&this.toField.getValue()==this.filterModel.to&&
this.ccField.getValue()==this.filterModel.cc&&this.subjectField.getValue()==this.filterModel.subject&&this.containsField.getValue()==this.filterModel.messageContains&&this.moveToFolderSelect.currentValue==this.filterModel.moveToFolder&&this.OnlineIMField.checked==this.filterModel.filterAlertOnlineAIM&&this.DeviceField.checked==this.filterModel.filterAlertDevice)this.hide();else if(confirm(a))this.onSave();else this.hide();else if(this.nameField.getValue()==Config.Strings.MailFilter_FilterNameValue&&
this.fromField.getValue()==""&&this.toField.getValue()==""&&this.ccField.getValue()==""&&this.subjectField.getValue()==""&&this.containsField.getValue()==""&&this.moveToFolderSelect.currentValue=="")this.hide();else if(confirm(a))this.onSave();else this.hide()},onSave:function(){this.saveButton.setEnabled(!1);if(!this.filterModel)this.filterModel=new ws.mail.MailFilterModel;this._cleanFilterForm();var a=this.getErrors();if(a.length>0){for(var e="<h3 style='margin:0;padding:0'>"+Config.Strings.ErrorHeader+
"</h3><ul style='margin:0;padding:10px 5px 10px 25px'>",f=0;f<a.length;f++)e+="<li>"+a[f]+"</li>";e+="</ul>";this.domNode.style.display="none";ws.widget.Dialogs.ok(e,b.hitch(this,function(){this.domNode.style.display="";this.saveButton.setEnabled(!0)}))}else this._populateFilterFromForm(),this.filterModel.filterId==-1?(this.filterModel.createFilter({load:b.hitch(this,function(a){ws.WebSuite?(this.saveButton.setEnabled(!0),this.hide(),b.publish("WSMailFilter/Filter/Modify",[a.filterList])):this.hide()}),
error:b.hitch(this,function(a){this.hide(!0);window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for filterModel.createFilter-onSave file:MailFilterModalPane.js");ws.widget.Dialogs.ok(a||Config.Strings.MailFilter_ErrorCreating,b.hitch(this,function(){this.show();this.saveButton.setEnabled(!0)}))})}),ws.reporting.reportAction("Add Filter")):(this.filterModel.modifyFilter({filterId:this.filterModel.filterId,load:b.hitch(this,function(a){this.saveButton.setEnabled(!0);
this.hide();b.publish("WSMailFilter/Filter/Modify",[a.filterList])}),error:b.hitch(this,function(a){this.hide(!0);window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for filterModel.modifyFilter-onSave file:MailFilterModalPane.js");ws.widget.Dialogs.ok(a||Config.Strings.MailFilter_ErrorCreating,b.hitch(this,function(){this.show();this.saveButton.setEnabled(!0)}))})}),ws.reporting.reportAction("Edit Filter"))},_updateBccMenu:function(){var a=[];a.push({display:Config.Strings.None,
value:""});a.push({display:ws.string.summary(ws.UserContext.UserAddress,23),value:ws.UserContext.UserAddress});this.bccMenu.setOptions(a)},_updateMoveToFolders:function(){if(!this.mailModel)this.mailModel=ws.WebSuite.theMailModel;var a=ws.lang.difference(this.mailModel.getFoldersCanMoveToFromInbox(),Config.FoldersToExcludeForFilters),e=[];e.push({display:Config.Strings.MailFilter_MoveToFolder+"...",value:"",selected:!0});for(var f=0;f<this.mailModel.folders.length;f++)b.indexOf(a,this.mailModel.folders[f].name)!=
-1&&e.push({display:ws.string.escapeXml(ws.string.summary(this.mailModel.folders[f].displayName,23)),value:this.mailModel.folders[f].name});e.push({isSeparator:!0});e.push({display:Config.Strings.NewFolder,value:"",_onClick:b.hitch(this,"newFolder")});this.moveToFolderSelect.setOptions(e);this.folderMenu=a=this.moveToFolderSelect.getMenu();e=this.folderMenu.getChildren();this.newFolderMenuItem=e[e.length-1];b.addClass(a.domNode,"mailFilterMoveToMenu");if(b.isIE==6)a.domNode.style.width=a.getBorderBoxWidth()+
10+"px"},newFolder:function(a){a&&a.stopPropagation();if(!this.newFolderInputMenuItem)this.newFolderInputMenuItem=new ws.widget.WSInputableMenuItem({okCB:b.hitch(this,"createNewFolder"),defaultValue:Config.Strings.NewFolder,originalMenuItem:this.newFolderMenuItem,maxlength:ws.mail.folderName.MaxLength}),this.folderMenu.addChild(this.newFolderInputMenuItem);ws.lang.setTimeout(this,function(){this.newFolderInputMenuItem.show();this.newFolderMenuItem.hide();this.folderMenu.domNode.scrollTop=this.folderMenu.domNode.scrollHeight;
this.newFolderInputMenuItem.initializeText(Config.Strings.NewFolder);if(!b.isIE&&this.folderMenu.getChildren().length>8)b.query(".inputableItemLabel",this.newFolderInputMenuItem.domNode)[0].style.paddingRight="16px"},0)},checkFilterListLength:function(){this.filterList.clear();this.filterList.loadFromRpc({load:b.hitch(this,function(a){a.filterList.length>=Config.MaxFilters&&(ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.MailFilter_ErrorMaxCount,Config.MaxFilters)),this.hide(!0))})})},
editMobileClicked:function(){this.EditMobilePhoneNode.style.display="none";this.AfterEditMobilePhoneNode.style.display="";var a=Config.MobilePhoneLink,a=a.replace(/\{0\}/,ws.UserContext.Locale);ws.io.openWindow(a)},getMobileDevice:function(){this.SetupMobilePhoneNode.style.display="none";this.AfterSetupMobilePhoneNode.style.display="";var a=Config.MobilePhoneLink,a=a.replace(/\{0\}/,ws.UserContext.Locale);ws.io.openWindow(a)},callUDR:function(){this.checkDeviceRegistered()},checkDeviceRegistered:function(){this.filterList.getMobileNumber({load:b.hitch(this,
function(a){if(a.filterAlertDeviceNumber!=""&&a.filterAlertDeviceNumber!="false"){var e=eval("("+a.filterAlertDeviceNumber+")");if(e.length>1){var f=[];b.forEach(e,function(a){f.push({display:a.number,value:a.id})});this.phoneSelect.setOptions(f);this.phoneSelectDiv.style.display=""}else a=ws.string.substituteParams(Config.Strings.MailFilter_DeliverAlertDevice,this.formatDeviceNumber(a.filterAlertDeviceNumber)),this.DeviceField.setLabel(a),this.DeviceField.setDisabled(!1),this.AfterSetupMobilePhoneNode.style.display=
"none",this.SetupMobilePhoneNode.style.display="none",this.EditMobilePhoneNode.style.display="",this.AfterEditMobilePhoneNode.style.display="none"}else a.filterAlertDeviceNumber=="false"?(this.filterModel?(this.DeviceField.setChecked(this.filterModel.filterAlertDevice),this.DeviceField.checked?(this.DeviceField.setDisabled(!1),a=ws.string.substituteParams(Config.Strings.MailFilter_DeliverAlertDevice,""),this.DeviceField.setLabel(a)):(this.DeviceField.setDisabled(!0),this.DeviceField.setChecked(!1))):
(this.DeviceField.setDisabled(!0),this.DeviceField.setChecked(!1)),this.SetupMobilePhoneNode.style.display="",this.EditMobilePhoneNode.style.display="none",this.AfterSetupMobilePhoneNode.style.display="none",this.AfterEditMobilePhoneNode.style.display="none"):(this.SetupMobilePhoneNode.style.display="",this.EditMobilePhoneNode.style.display="none",this.AfterSetupMobilePhoneNode.style.display="none",this.AfterEditMobilePhoneNode.style.display="none",this.DeviceField.setDisabled(!0),this.DeviceField.setChecked(!1),
this.DeviceField.setLabel(""))})})},formatDeviceNumber:function(a){return a!=""&&a.length==10?a.substr(0,3)+"-"+a.substr(3,3)+"-"+a.substr(6):a},createNewFolder:function(a){if(a&&a.newName){var e=Config.NewFolderPrefix+a.newName;if(ws.mail.folderName.validate(a.newName,e,null,this.mailModel.folders)){var f=this.moveToFolderSelect.options;f.splice(f.length-2,0,{display:ws.string.escapeXml(ws.string.summary(a.newName,23)),value:e});this.moveToFolderSelect.setOption(f.length-3);var g=this.moveToFolderSelect.getMenu(),
h=new ws.widget.WSMenuItem({caption:ws.string.escapeXml(ws.string.summary(a.newName,23))});h.startup();h.onClick=b.hitch(this.moveToFolderSelect,"setOption",f.length-3,!0);g.addChild(h,g.getChildren().length-3);this.mailModel.createFolder({newName:a.newName,load:b.hitch(this,function(a){this.moveToFolderSelect.currentValue=a.iName;b.publish("WSFeedbackStart",[Config.Strings.FolderCreated,!0]);this.checkSpamTip()}),error:b.hitch(this,function(b){var e=this.moveToFolderSelect.options;e.splice(e.length-
3,1);this.moveToFolderSelect.setOption(0);g.removeChild(h);window.ws_ErrLgr&&!b&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for mailModel.createFolder-createNewFolder file:MailFilterModalPane.js");ws.widget.Dialogs.ok(b?b:ws.string.substituteParams(Config.Strings.ErrorCreatingFolder,a.newName))})})}}return!1},_cleanFilterForm:function(){this.fromField.setValue(this.formatEmailAddress(this.fromField.getValue()),!0);this.ccField.setValue(this.formatEmailAddress(this.ccField.getValue()),
!0);this.toField.setValue(this.formatEmailAddress(this.toField.getValue()),!0)},_populateFilterFromForm:function(){this.filterModel.filterName=this.nameField.getValue();this.filterModel.from=this.fromField.getValue();this.filterModel.cc=this.ccField.getValue();this.filterModel.to=this.toField.getValue();this.filterModel.bcc=this.bccMenu.currentValue;this.filterModel.subject=this.subjectField.getValue();this.filterModel.messageContains=this.containsField.getValue();this.filterModel.moveToFolder=this.moveToFolderSelect.currentValue;
this.filterModel.filterAlertOnlineAIM=this.OnlineIMField.checked;this.filterModel.filterAlertDevice=this.DeviceField.checked;this.filterModel.filterAlertDeviceId=this.phoneSelect.currentValue},invalidCriteria:function(a){return a.search(/[\"\\]/)!=-1},invalidEmail:function(a){return a.search(/[\"\\]/)!=-1},formatEmailAddress:function(a){if(a&&a.length>0){var b=a.search(/@/);b==-1?a.search(/\./)==-1?a+="@"+Config.AuthUserDomain:a.substring(a.lastIndexOf(".")).match(/\.(?:[a-zA-Z]{2}|com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|museum)$/)==
null?a+="@"+Config.AuthUserDomain:a="*@"+a:b==0&&(a="*"+a)}return a},getButtonLabel:function(){var a=this.fromField.getValue(),a=this.fromField.getValue(),e=a.split(/[\s+,;]/),f=0;b.forEach(e,b.hitch(this,function(a){a&&a.length>0&&f++}));return f>1?ws.string.substituteParams(Config.Strings.MailFilter_BlockAddresses,f):ws.string.substituteParams(Config.Strings.MailFilter_Block,a)},checkSpamTip:function(){var a=this.fromField.getValue();this.moveToFolderSelect.currentValue=="Spam"&&a.length>0&&Settings.EnableSpamSettings?
(this.spamTip.style.display="",this.DeliveryAlert.style.display="none",this.toolbar.hide(),this.blockButton.setLabel(this.getButtonLabel(a)),this.blockButton.setTitle(a),this.bottomRow.style.backgroundColor="#FFFBB1"):this.removeSpamTip();this.toolbar.layout()},removeSpamTip:function(){this.spamTip.style.display="none";this.bottomRow.style.backgroundColor="";if(ws.UserContext.MailboxType=="ANGELIA"&&Config.FilterToAlertEnabled&&!this.kidTeenAccount)this.DeliveryAlert.style.display="";this.toolbar.show();
this.toolbar.layout()},spamTipClicked:function(){var a=this.fromField.getValue();(_ws_isOpenerWS()?opener.ws.WebSuite:ws.WebSuite).openSettings("spamSettings",b.hitch(this,function(a){if(a&&a.length>0){var f=_ws_isOpenerWS()?opener.dijit.byId("SpamSettings"):k.byId("SpamSettings");f.spamAddressSelect.setOption(0);f.onSpamAddressChange();a=a.split(/[\s*,;]/);b.forEach(a,b.hitch(this,function(a){a&&a.length>0&&f.addSenderBlockAddress(a)}));f.onChange();_ws_isOpenerWS()&&opener.focus()}},a));this.hide(!0)}}));
b._hasResource["ws.mail.MessageStatusDialog"]||(b._hasResource["ws.mail.MessageStatusDialog"]=!0,b.provide("ws.mail.MessageStatusDialog"),b.declare("ws.mail.MessageStatusDialog",[ws.widget.WSModalPane,k._Templated],{templateString:b.cache("ws.mail","MessageStatusDialog.html",'<div class="WSModalPane dialogContent">\r\n\t<div class="WSModalPaneInner">\r\n\t\t<div class="modalContainer">\r\n\t\t\t<div style="width:100%;*height:200px;max-height:300px;overflow-y:auto">\r\n\t\t\t\t<div dojoAttachPoint="titleNode" class="statusTitle"></div>\r\n\t\t\t\t<div dojoAttachPoint="statusBodyNode" class="statusBody">\r\n\t\t\t\t\t<table>\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td valign="top" align="left" dojoAttachPoint="statusNode"></td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\t\t\t\t\r\n\t\t\t\t<div dojoAttachPoint="additionalStatuses"></div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType="ws.widget.WSToolbar" dojoAttachPoint="statusToolbar" vizType="Bare">\r\n\t\t\t\t<div dojoAttachPoint="okButton" dojoType="ws.widget.Button" minWidth="26" toolbarPosition="center" dojoAttachEvent="onClick: hide">${OK}</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),
css:{templateString:""},widgetsInTemplate:!0,destroyOnClose:!1,model:null,dateFormat:Config.Strings.MsgListShortDateFormat,multipleMsgs:!1,additionalStatusHTML:'<div class="separatorDiv"></div><div class="statusTitle">{0}</div><div class="statusBody">\t<table>\t\t<tr>\t\t\t<td valign="top" align="left">{1}</td>\t\t</tr>\t</table></div>',show:function(a,e){this.model.getMessageStatus({folder:a,uids:e,load:b.hitch(this,"statusReceived"),error:b.hitch(this,"statusError")});this.titleNode.innerHTML="&nbsp;";
this.statusNode.innerHTML=Config.Strings.Loading;this.additionalStatuses.innerHTML="";this.multipleMsgs=!1;this.inherited(arguments)},statusReceived:function(a){if(a.status)ws.html.setInnerText(this.statusNode,a.status);else{for(var e=0;e<a.allMessagesStatus.length;e++){var f=ws.string.summary(a.allMessagesStatus[e].subject?a.allMessagesStatus[e].subject:"",32),f=f||Config.Strings.YourMessageNoCaps,g="";b.forEach(a.allMessagesStatus[e].statuses,function(a){g+=ws.string.escapeXml(a.address);g+=" "+
a.status;a.time&&(g+=" "+ws.date.formatDateTime(new Date(a.time),this.dateFormat));g+="<br>"},this);this.buildMessageStatusNode(f,g);this.multipleMsgs=!0}this.statusToolbar.onResized();this.okButton.sizeMyself();this.checkSize()}},buildMessageStatusNode:function(a,b){if(this.multipleMsgs){var f=ws.string.substituteParams(Config.Strings.MessageStatusHeader,a);this.additionalStatuses.innerHTML+=ws.string.substituteParams(this.additionalStatusHTML,f,b)}else ws.html.setInnerText(this.titleNode,ws.string.substituteParams(Config.Strings.MessageStatusHeader,
a)),this.statusNode.innerHTML=b},statusError:function(a){this.statusNode.innerHTML=a||Config.Strings.MessageStatusError}}));b._hasResource["dojox.io.scriptFrame"]||(b._hasResource["dojox.io.scriptFrame"]=!0,b.provide("dojox.io.scriptFrame"),function(){var a=b.io.script;l.io.scriptFrame={_waiters:{},_loadedIds:{},_getWaiters:function(a){return this._waiters[a]||(this._waiters[a]=[])},_fixAttachUrl:function(){},_loaded:function(e){var f=this._getWaiters(e);this._loadedIds[e]=!0;this._waiters[e]=null;
for(var j=0;j<f.length;j++){var k=f[j];k.frameDoc=b.io.iframe.doc(b.byId(e));a.attach(k.id,k.url,k.frameDoc)}}};var e=a._canAttach,f=l.io.scriptFrame;a._canAttach=function(a){var h=a.args.frameDoc;if(h&&b.isString(h)){var j=b.byId(h),k=f._getWaiters(h);j?f._loadedIds[h]?(a.frameDoc=b.io.iframe.doc(j),this.attach(a.id,a.url,a.frameDoc)):k.push(a):(k.push(a),b.io.iframe.create(h,l._scopeName+".io.scriptFrame._loaded('"+h+"');"));return!1}else return e.apply(this,arguments)}}());if(!b._hasResource["ws.im.wim"])b._hasResource["ws.im.wim"]=
!0,b.provide("ws.im.wim"),ws.im.wim={_token:null,_tokenExpiresIn:0,_aimsid:null,_fetchBaseUrl:null,_requestId:1,_removalIntervalId:0,_fetchFailures:0,_sessionFailures:0,lastIMStatusCode:0,_offlineGroupName:"Offline",_systemAimId:">>$y$tem<<",listeners:[],events:"buddylist,presence,im,typing,offlineIM",user:null,buddies:{},phones:{},acceptedBuddies:{aolsystemmsg:!0},declinedBuddies:{},ignoredBuddies:{},blockedBuddies:{},allowedBuddies:{},pdMode:"permitAll",gotBL:!1,onlineBuddies:0,Alist:[],groups:[],
serviceData:{},pendingNick:null,cannedAwayMessages:[Config.Strings.BuddyStatus_Label_IAmAway,Config.Strings.BuddyStatus_Label_OnThePhone,Config.Strings.BuddyStatus_Label_BeRightBack],use24hour:!1,resetUserData:function(){this._token=null;this._tokenExpiresIn=0;this._redirectUrl=this._fetchBaseUrl=this._aimsid=null;this._fetchFailures=0;this.user=null;this.buddies={};this.groups=[];this.customOnlineMessages=[];this.customAwayMessages=[];this.ignoredBuddies={};this.blockedBuddies={};this.allowedBuddies=
{};this.pdMode="permitAll";this.Alist=[];this.gotBL=!1},removeListener:function(a){a=b.indexOf(this.listeners,a);a>-1&&this.listeners.splice(a,1)},getTokenFromWim:function(){this._token=null;this._call("auth/getToken","_getTokenResponse",1,{language:Config.PageLocale})},start:function(){this._endCalled=!1;var a=this;b.addOnLoad(function(){a._token=null;var e=!1,g=ws.io.getObjectCookie("Auth");g!=null&&g.hasOwnProperty("wim")&&g.wim.length>0&&(e=!0);e?ws.io.rpc({action:"GetOpenAuthToken",load:b.hitch(this,
function(b){a._token=b.token_a;a._token&&a._token.length>0?a._startSession():a.getTokenFromWim()}),error:b.hitch(this,function(){a.getTokenFromWim()})}):a.getTokenFromWim()});var e=function(){ws.im.wim.end(!0)};typeof window.addEventListener=="undefined"?window.attachEvent("onunload",e):window.addEventListener("unload",e,!1);e=(new Date).toLocaleTimeString();this.use24hour=e.charAt(e.length-1)!="M"},end:function(a){this._stopFetchEvents();if(!this._endCalled){this._endCalled=!0;var b="_sessionEndResponse";
a&&(this._removalIntervalId&&clearInterval(this._removalIntervalId),this._stopFetchEvents(),b=null);this._call("aim/endSession",b,1,{aimsid:this._aimsid,invalidateToken:0});for(b=a=(new Date).getTime();a+1E3>b;)b=(new Date).getTime()}},setState:function(a,b,f){this._call("presence/setState","_setStateResponse",9,{aimsid:this._aimsid,view:a,idle:f})},setStatus:function(a){this.tmpStatus=a=(a||"").replace(/^\s+/,"").replace(/\s+$/,"");this._call("presence/setStatus","_setStatusResponse",9,{aimsid:this._aimsid,
statusMsg:a})},setTyping:function(a,b){Settings.ChatPrivacyTyping&&this._call("im/setTyping","_discardResponse",9,{aimsid:this._aimsid,typingStatus:b,t:a})},sendSMS:function(a,b,f){this.phones[b]=a;this.sendIm(b,f,!1,!1)},sendIm:function(a,b,f,g){f=f||!1;(new Date).getTime();this.lastIMStatusCode=0;delete this.declinedBuddies[a];delete this.ignoredBuddies[a];this._call("im/sendIM","_discardResponse",9,{aimsid:this._aimsid,t:a,message:b,offlineIM:f,autoResponse:g})},restoreConversation:function(a,
e){var f=b.create("div",{innerHTML:e},b.body()),g="",h="",j=b.query(".vcard",f);if(j.length>2)return!1;for(var k=0;k<j.length;k++)g=j[k].getAttribute("uid"),h=b.query(".fn",j[k])[0].innerHTML;if(!g||g.length==0)return!1;if(j=ws.im.wim.buddies[g]){if(j.im=[],j.aimid==j.displayId&&h!=g)j.displayId=h}else j=ws.im.wim.buddies[g]={aimId:g,displayId:h};h=b.query(".service",f)[0].innerHTML;if(h=="facebook")j.service=h;h=b.query(".message",f);for(j=0;j<h.length;j++){k={senderAimId:"",message:"",autoresponse:!1,
timestamp:0};if(h[j].hasChildNodes())for(var l=b.hasClass(h[j],"status"),o=0;o<h[j].childNodes.length;o++)if(b.hasClass(h[j].childNodes[o],"username"))if(l)k.senderAimId=this._systemAimId;else if(b.hasClass(h[j].childNodes[o],"buddyImName"))k.senderAimId=g;else{var n=h[j].childNodes[o].getElementsByTagName("a");k.senderAimId=n.length==0?h[j].childNodes[o].innerHTML:n[0].innerHTML}else if(b.hasClass(h[j].childNodes[o],"messageData"))k.message=h[j].childNodes[o].innerHTML;else if(b.hasClass(h[j].childNodes[o],
"timestamp")&&(n=h[j].childNodes[o].getAttribute("title"),n=ws.date.GetDateFromFormat(n.substr(0,15),"yyyyMMddTHHmmss"),n!=0))k.timestamp=n/1E3;k.senderAimId&&k.senderAimId.length>0&&this._storeIm(g,k)}b._destroyElement(f);ws.presence.launchAIMPanel(g,!1,!1,!0);return!0},addBuddy:function(a,b,f){if(f&&f.length>0)this.pendingNick=f;this._call("buddylist/addBuddy","_addBuddyResponse",5,{aimsid:this._aimsid,buddy:a,group:b})},removeBuddy:function(a,b){this._call("buddylist/removeBuddy","_removeBuddyResponse",
5,{aimsid:this._aimsid,buddy:a,group:b})},removeGroup:function(a){this._call("buddylist/removeGroup","_removeGroupResponse",5,{aimsid:this._aimsid,group:a})},renameGroup:function(a,b){this._call("buddylist/renameGroup","_renameGroupResponse",5,{aimsid:this._aimsid,oldGroup:a,newGroup:b})},getPresence:function(a,b){this._getPresenceCallback=b;this._call("presence/get","_getPresenceResponse",9,{aimsid:this._aimsid,t:a})},blockBuddy:function(a){this.pdMode="denySome";this._call("preference/setPermitDeny",
"_discardResponse",5,{aimsid:this._aimsid,pdBlock:a,pdMode:this.pdMode});this.blockedBuddies[a]=!0;var b=this.buddies[a];this.buddies[a].state="offline";this._notify("onPresenceChanged",{aimId:a,oldValues:b})},unblockBuddy:function(a){this._call("preference/setPermitDeny","_discardResponse",5,{aimsid:this._aimsid,pdBlockRemove:a,pdMode:this.pdMode});delete this.blockedBuddies[a];this.buddies[a].state="online";this._notify("onPresenceChanged",{aimId:a,oldValues:this.buddies[a]})},ignoreBuddy:function(a,
b){b?this.ignoredBuddies[a]=b:delete this.ignoredBuddies[a];this._notify("onPresenceChanged",{aimId:a,oldValues:this.buddies[a]})},editBuddy:function(a){this._ebData=a;a.og&&a.ng?this._call("buddylist/moveBuddy","_moveBuddyResponse",9,{aimsid:this._aimsid,buddy:a.bn,group:a.og,newGroup:a.ng}):this._moveBuddyResponse()},_ebData:null,_moveBuddyResponse:function(){this._ebData&&this._ebData.dn!=null&&ws.im.wim.setNickname(this._ebData.bn,this._ebData.dn);this._ebData=null},setNickname:function(a,b){this._call("buddylist/setBuddyAttribute",
"_discardResponse",9,{aimsid:this._aimsid,t:a,friendly:b})},moveBuddy:function(a,b,f){this._call("buddylist/moveBuddy","_discardResponse",9,{aimsid:this._aimsid,buddy:a,group:b,newGroup:f})},makeTimeStamp:function(a){return ws.date.formatTime(a,this.use24hour?"H:mm":"h:mma").toLowerCase()},_getPresenceResponse:function(a){a.users&&a.users[0]&&this._getPresenceCallback(a.users[0])},_removeGroupResponse:function(){this._notify("onGroupRemoved")},_renameGroupResponse:function(){this._notify("onGroupRenamed")},
_addBuddyResponse:function(a){this._notify("onBuddyAdded");if(this.pendingNick!=null)this.setNickname(a.results[0].buddy,this.pendingNick),this.pendingNick=null},_removeBuddyResponse:function(){this._notify("onBuddyRemoved")},isInBuddyList:function(a){return ws.im.wim.groups.length==0||!(!this.buddies[a]||!this.buddies[a].groups)},getBuddyByNick:function(a){a=a.toLowerCase();for(id in this.buddies)if(this.buddies[id].friendly&&this.buddies[id].friendly.toLowerCase()==a)return this.buddies[id];return null},
getBuddyById:function(a){var b={aimId:a,state:"offline"};if(this.user==null||a.length==0)return b;var f=a.toLowerCase();if(this.user&&f==this.user.aimId.toLowerCase())return this.user;return this.isInBuddyList(a)?this.buddies[a]:b},getMiniIconUrl:function(a){if(a.state=="online"&&ws.im.wim.isBuddyAllowed(a.aimId)&&a.buddyIcon&&a.buddyIcon.length>0)return a.buddyIcon;return Config.SpacerImageURL},isEditableGroup:function(a){return a.name!="Offline"&&a.name!="Recent Buddies"&&!a.groupPermissions},isBuddyAllowed:function(a){var b=
this.pdMode!="denyAll"&&(this.pdMode=="permitAll"||this.pdMode=="denySome"&&!(a in this.blockedBuddies)||this.pdMode=="permitSome"&&a in this.allowedBuddies||this.pdMode=="permitOnList"&&this.isInBuddyList(a));return!(a in this.ignoredBuddies)&&b},getGroup:function(a){a=ws.lang.findByProp(ws.im.wim.groups,"name",a);return ws.im.wim.groups[a]},normalize:function(a){return a.toLowerCase().replace(/\s/g,"")},getDisplayId:function(a){return this.user&&a==this.user.aimId?this.user.displayId:this.buddies[a]&&
this.buddies[a].displayId?this.buddies[a].friendly||this.buddies[a].displayId:a},getExpressions:function(a,b){a=this.normalize(a);this._expressions[a]?b&&b(this._expressions[a]):this._call("expressions/get",function(f){this._expressions[a]=f.expressions;b&&b(f.expressions)},9,{t:a})},_expressions:{},playEventSound:function(a){ws.sound.play(Config.BaseResourcesURL+"sounds/"+{imSound:"voom.mp3"}[a])},replaceMsgTokens:function(a){var b=new Date,a=a.replace(/%n/gi,ws.im.wim.user.displayId),a=a.replace(/%t/gi,
b.toLocaleTimeString());return a=a.replace(/%d/gi,b.toLocaleDateString())},_getTokenResponse:function(a){if(a.token){this._token=a.token.a;this._tokenExpiresIn=a.token.expiresIn;var b=this;setTimeout(function(){b._startSession()},10)}else this._notify("onError",Config.Strings.Error_BadGetTokenResponse+a)},_startSessionResponse:function(a){a.fetchBaseURL?(this._aimsid=a.aimsid,this._fetchBaseUrl=a.fetchBaseURL,this.user=a.myInfo,this._fetchTimeoutId=setTimeout(this._fetchEvents,700),this._getPermitDeny(),
this._notify("onSessionStart"),this._notify("onUserLoad"),this._sessionFailures=0):this._notify("onError",Config.Strings.Error_BadStartSessionResponse+a)},_startSession:function(){var a="";Config.EnableIMServices&&(a+=",service");this._call("aim/startSession","_startSessionResponse",1,{events:this.events+a,assertCaps:"",interestCaps:"",language:Config.PageLocale})},_restartSession:function(){this._stopFetchEvents();this.resetUserData();this.start()},_getPermitDeny:function(){this._call("preference/getPermitDeny",
"_permitDenyResponse",9,{aimsid:this._aimsid})},_permitDenyResponse:function(a){this.blockedBuddies={};this.allowedBuddies={};this.pdMode=a.pdMode;a.blocks&&b.forEach(a.blocks,b.hitch(this,function(a){this.blockedBuddies[a]=!0}));a.allows&&b.forEach(a.allows,b.hitch(this,function(a){this.allowedBuddies[a]=!0}))},_fetchEvents:function(){ws.im.wim._fetchTimeoutId!=0&&ws.im.wim._call("fetchEvents","_fetchEventsResponse",9,{timeout:ws.im.wim._fetchTimeout})},_fetchTimeout:2E4,_fetchEventsResponse:function(a){if(a.fetchBaseURL)this._fetchBaseUrl=
a.fetchBaseURL;var e=!0,f=a.events;this._fetchFailures=0;var g=!1;if(f){for(var h=0;h<f.length;h++){var j=f[h];if(j.type=="sessionEnded")e=!1,this.resetUserData(),this._notify("onSessionEnd");else if(j.type=="buddylist")this._unpackBuddyList(j.eventData),Config.EnableCHAL&&!this.gotBL&&this._fetchAlist(),g=this.gotBL=!0;else if(j.type=="presence")this._presenceChanged(j.eventData);else if(j.type=="im"||j.type=="offlineIM"){var k=j.eventData,l=k.aimId||k.source.aimId,o=k.message.match(/<[a-z]/ig),
n=k.message.match(/<\/[a-z]/ig);if(o&&n&&o.length!=n.length)k.message=ws.html.getText(k.message);this.phones[l]&&(l=this.phones[l]);if(j.type=="offlineIM")k.message=ws.string.substituteParams(Config.Strings.IM_Notice_OfflineIM,ws.date.timeAgo(k.timestamp*1E3))+" "+k.message;if(k.source)this.buddies[l]?this._presenceChanged(k.source):this.buddies[l]=k.source;this.isBuddyAllowed(l)&&this._notify("onIm",{senderAimId:l,message:k.message,autoresponse:k.autoresponse,timestamp:k.timestamp})}else j.type==
"typing"?this.isBuddyAllowed(j.eventData.aimId)&&this._notify("onTypingChanged",{aimId:j.eventData.aimId,status:j.eventData.typingStatus}):j.type=="service"&&(b.mixin(this.serviceData,j.eventData),this.gotBL&&this.serviceData.serviceURLs&&this.serviceData.serviceConfigs&&(g=!0))}g&&this._notify("onBuddyListLoad")}e?this._fetchTimeoutId=setTimeout(this._fetchEvents,a.timeToNextFetch||700):this._stopFetchEvents()},_removeComment:function(a,b){for(var f=0;f<a.comments.length;f++)if(a.comments[f].id==
b.id){a.comments[f].splice(f,1);break}},_removeActivity:function(a,b){for(var f=0;f<a.length;f++)if(a[f].id==b)return a.splice(f,1)[0];return null},_updateActivity:function(a,b,f){for(var g=0;g<a.length;g++)a[g].id==b&&(a[g]=f)},_sessionEndResponse:function(){this._notify("onSessionEnd");this.resetUserData()},_storeIm:function(a,b){var f=this.buddies[a];f||(f=this.buddies[a]={aimId:a,displayId:a,state:"offline"});if(!f.im)f.im=[];if(!f.groups)f.groups=[this._offlineGroupName];f.im.push(b)},_decodePresence:function(a){if(a.awayMsg)a.awayMsg=
a.awayMsg;if(a.statusMsg)a.statusMsg=a.statusMsg},_setStateResponse:function(a){this._decodePresence(a.myInfo);this.user=a.myInfo;this._notify("onUserLoad")},_setStatusResponse:function(){this.user.statusMsg=this.tmpStatus;this._decodePresence(this.user);this._notify("onUserLoad")},isStateOffline:function(a){return b.indexOf(["offline","unknown","notfound"],a)!=-1},_presenceChanged:function(a){var b=null;this._decodePresence(a);var f=this.buddies[a.aimId];if(a.aimId==this.user.aimId)this.user=a;if(f){for(var g in a)if(g!=
"im"&&(!f[g]||f[g]!=a[g]))b||(b={}),b[g]=f[g],f[g]=a[g];if(f.awayMsg&&!a.awayMsg)b.awayMsg=f.awayMsg,f.awayMsg=null;if(f.statusMsg&&!a.statusMsg)b.statusMsg=f.statusMsg,f.statusMsg=null}else f=this.buddies[a.aimId]=a,b={};this.updateOnlineCount();f.baseTime=new Date;b&&this._notify("onPresenceChanged",{aimId:a.aimId,oldValues:b})},_stopFetchEvents:function(){clearTimeout(this._fetchTimeoutId);this._fetchTimeoutId=0},_call:function(a,e,f,g){g||(g={});var h="",h="fetchEvents"==a?this._fetchBaseUrl:
"auth/getToken"==a?Config.AuthServer+a:a.indexOf("lifestream")==0?Config.LSServer+a:Config.WIMServer+a;if(h!=null){a=="im/sendIM"&&(h+="?comscoreChannel=websuite");g.r=this._requestId++;g.k=Config.WIMKey;g.f="json";if(this._token)g.a=this._token;var j=7E3;g.timeout&&(j+=g.timeout);e={url:h,callbackParamName:"c",content:g,load:b.hitch(this,"_loadResponse"),error:b.hitch(this,"_errorResponse"),timeout:j,preventCache:!0,_wimAction:a,_wimCall:e,_wimErrorType:f};if(a=="fetchEvents")e.frameDoc="fetchEframe";
b.io.script.get(e)}},_loadResponse:function(a,e){var a=a.response,e=e.args,f=a.statusCode;if(f==200){if(e._wimCall)if(b.isFunction(e._wimCall))e._wimCall.apply(this,[a.data]);else this[e._wimCall](a.data)}else!Config.UseRealToken&&(f==330||f==401||f==450)&&a.data&&a.data.redirectURL?(this._waitingBindArgs=e,this._needAuth(a.data.redirectURL)):Config.UseRealToken&&f==401?this._sessionFailures==0&&(this._sessionFailures++,ws.lang.setTimeout(this,"_restartSession",1E3)):(this._notify("onError",{action:e._wimAction,
statusCode:a.statusCode,statusText:Config.Strings.UnspecifiedError,params:e.content,errorType:e._wimErrorType,errorMsg:a.statusText,resp:a}),type="error")},_errorResponse:function(a,b){b=b.args;b._wimAction=="aim/startSession"&&this._sessionFailures==0?(this._sessionFailures++,this._restartSession()):b._wimAction=="aim/endSession"?this.resetUserData():a&&a.dojoType=="timeout"?b._wimAction=="fetchEvents"?++this._fetchFailures>2?this._restartSession():this._fetchTimeoutId=setTimeout(this._fetchEvents,
700):this._notify("onError",{errorType:b._wimErrorType,errorMsg:Config.Strings.Error_ActionTimedOut+b._wimAction}):this._notify("onError",{errorType:b._wimErrorType,errorMsg:a})},_notify:function(a,b){for(var f=0;f<this.listeners.length;f++){var g=this.listeners[f];if(g[a])g[a](b)}},_needAuth:function(a,b){this._redirectUrl=a;this._authAction=b;var f=this;this._authInterval=setInterval(function(){f._watchAuth()},200);this._launchAuth()},_watchAuth:function(){var a=window.location.hash;if(a&&a!="#"&&
"#AUTHDONE|#AUTHCANCEL|#CONSENTDONE|#CONSENTCANCEL|#CONSENTINVALIDTOKEN".indexOf(a)!=-1)clearTimeout(this._authInterval),this._authInterval=0,window.location="#",this._closeAuth(),a=="#AUTHDONE"||a=="#CONSENTDONE"?b.io.script.get(this._waitingBindArgs):a=="#AUTHCANCEL"?this._notify("onAuthCancel"):a=="#CONSENTCANCEL"?this._notify("onConsentCancel"):a=="#CONSENTINVALIDTOKEN"?this._notify("onConsentInvalidToken"):this._notify("onError",Config.Strings.Error_InvalidAuthState+a)},_launchAuth:function(){var a=
this._redirectUrl+(this._redirectUrl.indexOf("?")==-1?"?":"&")+"k="+Config.WIMKey+"&refresh="+(new Date).getTime(),e=b.byId("aimWimAuthWindow");if(e)e.style.display="block",e.src=a;else{e=b.doc.createElement("div");e.id="aimWimAuthWindow";e.frameborder=0;var f=e.style;f.position="absolute";f.top="5px";f.border="2px solid black";f.backgroundColor="white";f.left="5px";f.width="530px";f.height="400px";f.zIndex="1000";f=b.doc.createElement("iframe");f.src=a;f.style.width="100%";f.style.height="100%";
f.frameborder=0;a=b.doc.createElement("span");b.addClass(a,"mainSprite wsCloseBtn");a.style.position="absolute";a.style.top="4px";a.style.right="4px";a.style.zindex="200";b.connect(a,"onclick",this,"_cancelAuth");e.appendChild(a);e.appendChild(f);b.body().appendChild(e)}},_cancelAuth:function(){this._closeAuth();this._notify("onAuthCancel")},_closeAuth:function(){var a=b.byId("aimWimAuthWindow");a&&a.parentNode.removeChild(a)},_unpackBuddyList:function(a){if(a&&a.groups){var b=this.buddies;this.buddies=
{};this.groups=[];this.onlineBuddies=0;for(var f={displayName:Config.Strings.BuddyList_Label_GroupOffline,name:this._offlineGroupName,buddies:[],isOfflineGroup:!0},a=a.groups,g=0;g<a.length;g++){var h=a[g].name,j=a[g].buddies,k=j.length,l=a[g];l.displayName=h=="Recent Buddies"?Config.Strings.BuddyList_Label_GroupRecentBuddies:h;l.buddies=[];this.groups.push(l);for(var o=0;o<k;o++){var n=j[o].aimId,p=this.buddies[n];if(!p&&(p=this.buddies[n]=j[o],p.groups=[this._offlineGroupName],f.buddies.push(n),
this.isStateOffline(p.state)||this.onlineBuddies++,b[n]&&b[n].im))p.im=b[n].im;p.baseTime=new Date;p.groups.push(h);l.buddies.push(n)}}for(id in b)if(!this.buddies[id])this.buddies[id]=b[id],this.buddies[id].groups=[this._offlineGroupName],f.buddies.push(id);f.buddies=f.buddies.sort();this.groups.push(f)}},updateOnlineCount:function(){this.onlineBuddies=0;for(id in this.buddies)this.isStateOffline(this.buddies[id].state)||this.onlineBuddies++},_discardResponse:function(){},reportAction:function(a,
b,f){if(Config.EnableAIMReporting){var g="";f&&(g=",additional="+f);this._call("aim/reportAction","_discardResponse",9,{aimsid:this._aimsid,action:"type="+a+",id="+encodeURIComponent(b)+g})}},getServiceUrls:function(a){if(this.user&&this.serviceData&&this.serviceData.serviceURLs)for(var b=0;b<this.serviceData.serviceURLs.length;b++)if(this.serviceData.serviceURLs[b].name==a)return this.serviceData.serviceURLs[b].urls;return null},getServiceConfig:function(a){if(this.user&&this.serviceData.serviceConfigs)for(var b=
0;b<this.serviceData.serviceConfigs.length;b++)if(this.serviceData.serviceConfigs[b].name==a)return this.serviceData.serviceConfigs[b];return null},setServiceConnection:function(a,b){this._call("service/setConnection","_discardResponse",9,{aimsid:this._aimsid,serviceName:a,connected:b?"1":"0"})},disableService:function(a){this._call("service/setCredentials","_discardResponse",9,{aimsid:this._aimsid,s:this.user.aimId,serviceName:a,serviceToken:"",serviceUid:"",serviceApiKey:""})},setServiceSignon:function(a,
b){this._call("service/setAttributes","_discardResponse",9,{aimsid:this._aimsid,serviceName:a,autoLogin:b?"1":"0"})},setGroupCollapsed:function(a,b){this._call("buddylist/setGroupAttribute","_discardResponse",9,{aimsid:this._aimsid,group:a,collapsed:b?"1":"0"})},_fetchAlist:function(){b.io.script.get({url:Config.CHALServer+"chal/getRankedAlist",callbackParamName:"c",content:{f:"json",sg:this.user.aimId,rankingRuleset:"mail-personal",devId:Config.CHALKey},load:b.hitch(this,"_updateAlist"),error:b.hitch(this,
"_errorAlist"),timeout:7E3})},_updateAlist:function(a){if(a.response.statusCode==200){for(var b=[],a=a.response.data.aList.contacts,f=0;f<a.length;f++)if(this.getBuddyById(a[f].address),b.push(a[f].address),b.length>=5)break;this.Alist=b;this._notify("onAList")}},_errorAlist:function(){},getAlist:function(){return this.Alist}},ws.im.wim.listeners.push({onSessionStart:function(){this.mouseMoveHandler=b.connect(b.body(),"onmousemove",this,"onMouseMove");clearInterval(this.updateInterval);this.updateInterval=
setInterval(b.hitch(this,"updateIdleState"),6E4);this.lastActivity=new Date;this.lastStateToken="online"},onSessionEnd:function(){clearInterval(this.updateInterval);b.disconnect(this.mouseMoveHandler);clearInterval(this.updateInterval)},onMouseMove:function(){this.lastActivity=new Date;this.lastStateToken!="online"&&this.updateIdleState()},updateIdleState:function(){if(Settings.ChatShowIdleTime&&ws.im.wim.user!=null){var a=ws.im.wim.user.state;if(!(a=="invisible"||a=="away")){var a=Math.round((new Date-
this.lastActivity)/1E3),b=a>900,f=b?this.lastActivity:"online";if(f!=this.lastStateToken)ws.im.wim.setState(b?"idle":"online",null,a),this.lastStateToken=f}}}});b._hasResource["ws.layers.dojo2"]||(b._hasResource["ws.layers.dojo2"]=!0,b.provide("ws.layers.dojo2"))}}});
